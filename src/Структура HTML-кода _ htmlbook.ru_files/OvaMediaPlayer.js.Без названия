try{!function(i){var n={};function r(e){var t;return(n[e]||(t=n[e]={i:e,l:!1,exports:{}},i[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}r.m=i,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t){e.exports={AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt",Progress:"Progress",TimeUpdated:"TimeUpdated",BlockingTagPassback:"BlockingTagPassback",SlowConnection:"SlowConnection",OmidSessionStart:"OmidSessionStart",OmidSessionFinish:"OmidSessionFinish"}},function(e,t){e.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,adErrorBeforeLoad:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,hijackAttempt:19,idleMode:20,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,newCompletion:25,replayAd:27,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,maxNetworkCalls:39,adPlaying:40,adLoaded:41,startAd:42,globalAdTimeout:53,adUnmuted:58,vpaidProgress:59,unloadPage:60,adDropped:61,blockedActionByHijack:62,unfriendlyVideo:83,buffering:90,bufferingEnded:91,blockingTagPassback:94,firstImpression:99,slowConnection:122,soundOnHover:123,omidDetected:136,delayedImpression:139,prebidNoRequest:143,prebidWinResponses:144,prebidBelowBid:147,prebidEmptyResponse:148,validPrebidResponse:149,prebidVastObjectFound:150,omidSessionsStart:154,omidSessionsFinish:155,prebidNoResponse:167,prebidNoInterpretation:168,prebidMissingCpm:169,earlyAdImpression:170,adImpressionTimeout:173,nativeAdSettingsInWF:181,adStarted:187,adVideoStart:188,heavyFilesBlocked:192}},function(e,t){e.exports={KPI:70,playerDisplayImpression:81,getAd:115,emptyWFResponse:91,noTagsInWFResponse:92,passbackOnEmptyFirstWF:97,forceWf:126,maxEmptyWfs:131,prebidSession:138,lowNetworkDownlink:157,ppdAdIsPlaying:158,start:"start",creativeView:"creativeView",close:"close",maxReadyVpaidHit:169,queueSizeHit:170}},function(e,t){e.exports={schemaValidationError:101,timeout:304,mediaFileNotSupported:403,undefinedError:900,generalVpaidError:901,noAdsMatcher:"no_fill|no ad|no video|no vast|nofill",codesMatcher:"101|301|302|303|304|402|900|901"}},function(e,t){e.exports={DIRECT:3,PMP_DIRECT:4,PMP:5,OPEN_EXCHANGE_RTB_DSP:6,OPEN_EXCHANGE_RTB_SSP:8,PREBID:13,PUBLISHER_DEMAND:14}},function(e,t){e.exports={VastFound:"VastFound",VastData:"VastData",ParserError:"parserError",NetworkFail:"networkFail"}},function(e,t){e.exports={inner:{NonVideoItemInWaterfall:"nonVideoItemInWaterfall",Mute:"mute",Unmute:"unmute"},outer:{NewCompletion:"NewCompletion",EmitQueueStatus:"emitQueueStatus"}}},function(e,t,i){function n(e){for(var t in d)e[t]=d[t];return e}function r(e,t){var i,n=this;if(arguments.length){if(t){if(i=o(n,e,!0)){if(!(i=i.filter(function(e){return e!==t&&e.originalListener!==t})).length)return r.call(n,e);n[a][e]=i}}else if((i=n[a])&&(delete i[e],!Object.keys(i).length))return r.call(n)}else delete n[a];return n}function o(e,t,i){if(!i||e[a])return(i=e[a]||(e[a]={}))[t]||(i[t]=[])}var s,a,d;s=function e(){if(!(this instanceof e))return new e},e.exports=s,a="listeners",d={on:function(e,t){return o(this,e).push(t),this},once:function(e,t){var i=this;return n.originalListener=t,o(i,e).push(n),i;function n(){r.call(i,e,n),t.apply(this,arguments)}},off:r,emit:function(e,t){var i=this,n=o(i,e,!0);if(!n)return!1;var r=arguments.length;{var s;1===r?n.forEach(function(e){e.call(i)}):2===r?n.forEach(function(e){e.call(i,t)}):(s=Array.prototype.slice.call(arguments,1),n.forEach(function(e){e.apply(i,s)}))}return!!n.length}},n(s.prototype),s.mixin=n},function(e,t){e.exports=function(){return{adimpression:[],impression:[],aderror:[],error:[],adclickthru:[],clickthru:[],adclickthrough:[],clickthrough:[],adclicktracking:[],clicktracking:[],adoloaded:[],loaded:[],adstarted:[],started:[],adstopped:[],stopped:[],adskipped:[],skipped:[],adskippablestatechange:[],skippablestatechange:[],adsizechange:[],sizechange:[],adlinearchange:[],linearchange:[],addurationchange:[],durationchange:[],adexpandedchange:[],expandedchange:[],advolumechange:[],volumechange:[],advideostart:[],start:[],advideofirstquartile:[],firstquartile:[],advideomidpoint:[],midpoint:[],advideothirdquartile:[],thirdquartile:[],advideocomplete:[],complete:[],adinteraction:[],interaction:[],aduseracceptinvitation:[],acceptinvitation:[],aduserminimize:[],minimize:[],aduserclose:[],close:[],adpaused:[],paused:[],pause:[],adplaying:[],playing:[],resume:[],adlog:[],log:[],adfound:[],admute:[],mute:[],adunmute:[],unmute:[],adfullscreen:[],fullscreen:[],creativeview:[],progress:[],viewability:[],viewable50precent1sec:[],fullyviewable1sec:[]}}},function(e,t){function n(e,t){var i=0,n=d(e.wfIndex),r=d(e.waterfallTagId),s=d(e.cpmFloor),o=d(e.fillrate),a=e.getValueByKey("scoreBoost")||0,n={wg:n,wi:r,fr:o,cf:s,mt:function(e){{if("flash"===e)return 1;if("javascript"===e)return 2}return 3}(e.type)||1,advb:a},i=(e.scoreSummary=n,1),r=t.get("qsrtscr");if(r&&"function"==typeof r)try{i=r(n,e,t)}catch(e){i=999999}return e.score=i}function d(e){return e=e||0,parseInt(e)}e.exports={sort:function(e,i){return e.sort(function(e,t){return e=n(e,i),n(t,i)<e?1:-1})}}},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==r(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===r(e)?e:String(e)}(n.key),n)}}var o={new:{id:0,name:"new"},adLoaded:{id:1,name:"adLoaded",timeKey:"ldd"},startAd:{id:2,name:"startAd",timeKey:"st"},adImpression:{id:3,name:"adImpression",timeKey:"imp"},adPlay:{id:4,name:"adPlay",timeKey:"pl"},adError:{id:5,name:"adError",timeKey:"err"},adComplete:{id:6,name:"adComplete",timeKey:"cmp"}},i=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.statuses=o,this.status=this.statuses.new.id,this.timeBetweenStatuses={},this._startTimer()}var t,i,n;return t=e,(i=[{key:"setStatus",value:function(e){this.timeBetweenStatuses[e.name]=this._getTime(),this.status=e.id,this._startTimer()}},{key:"get",value:function(){var e,t={cs:this._getTime()};for(e in this.timeBetweenStatuses)t[this.statuses[e].timeKey]=this.timeBetweenStatuses[e];return{st:this.status,ts:t}}},{key:"_startTimer",value:function(){this.time=Date.now()}},{key:"_getTime",value:function(){return Date.now()-this.time}}])&&s(t.prototype,i),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports={Statuses:o,VpaidStatus:i}},function(e,t,i){"use strict";function s(){}var o={};function a(e){var t=o[e];t&&(clearTimeout(t),delete o[e])}function n(e,t,i){var n=document.createElement("iframe");return n.src=t||"about:blank",n.className="cm-vpaid-iframe",n.marginWidth="0",n.marginHeight="0",n.frameBorder="0",n.width="100%",n.height="100%",i&&(n.style.zIndex=i),n.setAttribute("SCROLLING","NO"),e.innerHTML="",e.appendChild(n),n}function r(i,n){return Object.keys(n).forEach(function(e){var t=n[e];i=i.replace(new RegExp("{{"+e+"}}","g"),t)}),i}function d(e,t){e=e.contentWindow&&e.contentWindow.document;return!!e&&(e.write(t),!0)}e.exports={noop:s,validate:function(e,t){return e?null:new Error(t)},clearCallbackTimeout:a,callbackTimeout:function(e,t,i){var n=setTimeout(function(){t=s,delete n[r],i()},e),r=function(){t.apply(this,arguments)&&a(r)};return o[r]=n,r},createElementInEl:function(e,t,i){return t=document.createElement(t),i&&(t.id=i),e.appendChild(t),t},createIframeWithContent:function(e,t,i){if(d(e=n(e,null,i.zIndex),r(t,i)))return e},createIframe:n,setFullSizeStyle:function(e){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.margin="0px",e.style.padding="0px",e.style.border="none",e.style.width="100%",e.style.height="100%"},simpleTemplate:r,setIframeContent:d,extend:function(t,i){return Object.keys(i).forEach(function(e){t[e]=i[e]}),t},unique:function(e){var t=-1;return function(){return e+"_"+ ++t}}}},function(e,t,i){"use strict";var c=i(22),h={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(i,n){var t,e,r,s,o=!1,a=(n=n||{}).debug||!1;try{var d=c(),l=document.createRange(),u=document.getSelection();if((e=document.createElement("span")).textContent=i,e.ariaHidden="true",e.style.all="unset",e.style.position="fixed",e.style.top=0,e.style.clip="rect(0, 0, 0, 0)",e.style.whiteSpace="pre",e.style.webkitUserSelect="text",e.style.MozUserSelect="text",e.style.msUserSelect="text",e.style.userSelect="text",e.addEventListener("copy",function(e){var t;e.stopPropagation(),n.format&&(e.preventDefault(),void 0===e.clipboardData?(a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData(),t=h[n.format]||h.default,window.clipboardData.setData(t,i)):(e.clipboardData.clearData(),e.clipboardData.setData(n.format,i))),n.onCopy&&(e.preventDefault(),n.onCopy(e.clipboardData))}),document.body.appendChild(e),l.selectNodeContents(e),u.addRange(l),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");o=!0}catch(e){a&&console.error("unable to copy using execCommand: ",e),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(n.format||"text",i),n.onCopy&&n.onCopy(window.clipboardData),o=!0}catch(e){a&&console.error("unable to copy using clipboardData: ",e),a&&console.error("falling back to prompt"),r="message"in n?n.message:"Copy to clipboard: #{key}, Enter",s=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C",t=r.replace(/#{\s*key\s*}/g,s),window.prompt(t,i)}}finally{u&&("function"==typeof u.removeRange?u.removeRange(l):u.removeAllRanges()),e&&document.body.removeChild(e),d()}return o}},function(e,t){e.exports={AdStopped:"AdStopped",adsManagerLoaded:"adsManagerLoaded",complete:"AdVideoComplete",loaded:"AdLoaded",adError:"AdError",start:"AdImpression",firstQuartile:"AdVideoFirstQuartile",midpoint:"AdVideoMidpoint",thirdQuartile:"AdVideoThirdQuartile",click:"AdClickThru",userClose:"AdUserClose",skip:"AdSkipped",durationChange:"AdDurationChange",pause:"AdPaused",resume:"AdPlaying",volumeChange:"AdVolumeChange",mute:"AdVolumeChange",skippableStateChanged:"AdSkippableStateChange",linearChanged:"AdLinearChange",interaction:"AdInteraction",adProgress:"Progress"}},function(e,t,i){e.exports=i(28)},function(e,t,i){!function(ne,re){e.exports=function(){"use strict";function n(e){var t=typeof e;return e!==null&&(t==="object"||t==="function")}function d(e){return typeof e==="function"}var e=void 0;if(Array.isArray)e=Array.isArray;else e=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=e,r=0,t=void 0,s=void 0,o=function e(t,i){m[r]=t;m[r+1]=i;r+=2;if(r===2)if(s)s(y);else g()};function a(e){s=e}function l(e){o=e}var u=typeof window!=="undefined"?window:undefined,c=u||{},h=c.MutationObserver||c.WebKitMutationObserver,p=typeof self==="undefined"&&typeof ne!=="undefined"&&{}.toString.call(ne)==="[object process]",f=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function L(){return function(){return ne.nextTick(y)}}function F(){if(typeof t!=="undefined")return function(){t(y)};return v()}function B(){var e=0;var t=new h(y);var i=document.createTextNode("");t.observe(i,{characterData:true});return function(){i.data=e=++e%2}}function j(){var e=new MessageChannel;e.port1.onmessage=y;return function(){return e.port2.postMessage(0)}}function v(){var e=setTimeout;return function(){return e(y,1)}}var m=new Array(1e3);function y(){for(var e=0;e<r;e+=2){var t=m[e];var i=m[e+1];t(i);m[e]=undefined;m[e+1]=undefined}r=0}function W(){try{var e=Function("return this")().require("vertx");t=e.runOnLoop||e.runOnContext;return F()}catch(e){return v()}}var g=void 0;if(p)g=L();else if(h)g=B();else if(f)g=j();else if(u===undefined&&"function"==="function")g=W();else g=v();function b(e,t){var i=this;var n=new this.constructor(w);if(n[k]===undefined)M(n);var r=i._state;if(r){var s=arguments[r-1];o(function(){return D(r,n,s,i._result)})}else I(i,n,e,t);return n}function _(e){var t=this;if(e&&typeof e==="object"&&e.constructor===t)return e;var i=new t(w);P(i,e);return i}var k=Math.random().toString(36).substring(2);function w(){}var A=void 0,T=1,E=2;function U(){return new TypeError("You cannot resolve a promise with itself")}function N(){return new TypeError("A promises callback cannot return that same promise.")}function H(e,t,i,n){try{e.call(t,i,n)}catch(e){return e}}function q(e,n,r){o(function(t){var i=false;var e=H(r,n,function(e){if(i)return;i=true;if(n!==e)P(t,e);else V(t,e)},function(e){if(i)return;i=true;C(t,e)},"Settle: "+(t._label||" unknown promise"));if(!i&&e){i=true;C(t,e)}},e)}function z(t,e){if(e._state===T)V(t,e._result);else if(e._state===E)C(t,e._result);else I(e,undefined,function(e){return P(t,e)},function(e){return C(t,e)})}function S(e,t,i){if(t.constructor===e.constructor&&i===b&&t.constructor.resolve===_)z(e,t);else if(i===undefined)V(e,t);else if(d(i))q(e,t,i);else V(e,t)}function P(t,e){if(t===e)C(t,U());else if(n(e)){var i=void 0;try{i=e.then}catch(e){C(t,e);return}S(t,e,i)}else V(t,e)}function Q(e){if(e._onerror)e._onerror(e._result);O(e)}function V(e,t){if(e._state!==A)return;e._result=t;e._state=T;if(e._subscribers.length!==0)o(O,e)}function C(e,t){if(e._state!==A)return;e._state=E;e._result=t;o(Q,e)}function I(e,t,i,n){var r=e._subscribers;var s=r.length;e._onerror=null;r[s]=t;r[s+T]=i;r[s+E]=n;if(s===0&&e._state)o(O,e)}function O(e){var t=e._subscribers;var i=e._state;if(t.length===0)return;var n=void 0,r=void 0,s=e._result;for(var o=0;o<t.length;o+=3){n=t[o];r=t[o+i];if(n)D(i,n,r,s);else r(s)}e._subscribers.length=0}function D(e,t,i,n){var r=d(i),s=void 0,o=void 0,a=true;if(r){try{s=i(n)}catch(e){a=false;o=e}if(t===s){C(t,N());return}}else s=n;if(t._state!==A);else if(r&&a)P(t,s);else if(a===false)C(t,o);else if(e===T)V(t,s);else if(e===E)C(t,s)}function G(i,e){try{e(function e(t){P(i,t)},function e(t){C(i,t)})}catch(e){C(i,e)}}var x=0;function K(){return x++}function M(e){e[k]=x++;e._state=undefined;e._result=undefined;e._subscribers=[]}function J(){return new Error("Array Methods must be provided an Array")}var X=function(){function e(e,t){this._instanceConstructor=e;this.promise=new e(w);if(!this.promise[k])M(this.promise);if(i(t)){this.length=t.length;this._remaining=t.length;this._result=new Array(this.length);if(this.length===0)V(this.promise,this._result);else{this.length=this.length||0;this._enumerate(t);if(this._remaining===0)V(this.promise,this._result)}}else C(this.promise,J())}e.prototype._enumerate=function e(t){for(var i=0;this._state===A&&i<t.length;i++)this._eachEntry(t[i],i)};e.prototype._eachEntry=function e(t,i){var n=this._instanceConstructor;var r=n.resolve;if(r===_){var s=void 0;var o=void 0;var a=false;try{s=t.then}catch(e){a=true;o=e}if(s===b&&t._state!==A)this._settledAt(t._state,i,t._result);else if(typeof s!=="function"){this._remaining--;this._result[i]=t}else if(n===R){var d=new n(w);if(a)C(d,o);else S(d,t,s);this._willSettleAt(d,i)}else this._willSettleAt(new n(function(e){return e(t)}),i)}else this._willSettleAt(r(t),i)};e.prototype._settledAt=function e(t,i,n){var r=this.promise;if(r._state===A){this._remaining--;if(t===E)C(r,n);else this._result[i]=n}if(this._remaining===0)V(r,this._result)};e.prototype._willSettleAt=function e(t,i){var n=this;I(t,undefined,function(e){return n._settledAt(T,i,e)},function(e){return n._settledAt(E,i,e)})};return e}();function Y(e){return new X(this,e).promise}function $(r){var s=this;if(!i(r))return new s(function(e,t){return t(new TypeError("You must pass an array to race."))});else return new s(function(e,t){var i=r.length;for(var n=0;n<i;n++)s.resolve(r[n]).then(e,t)})}function Z(e){var t=this;var i=new t(w);C(i,e);return i}function ee(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function te(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var R=function(){function t(e){this[k]=K();this._result=this._state=undefined;this._subscribers=[];if(w!==e){typeof e!=="function"&&ee();this instanceof t?G(this,e):te()}}t.prototype.catch=function e(t){return this.then(null,t)};t.prototype.finally=function e(t){var i=this;var n=i.constructor;if(d(t))return i.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})});return i.then(t,t)};return t}();function ie(){var e=void 0;if(typeof re!=="undefined")e=re;else if(typeof self!=="undefined")e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if(i==="[object Promise]"&&!t.cast)return}e.Promise=R}return R.prototype.then=b,R.all=Y,R.race=$,R.resolve=_,R.reject=Z,R._setScheduler=a,R._setAsap=l,R._asap=o,R.polyfill=ie,R.Promise=R}()}.call(this,i(16),i(17))},function(e,t){var i,n,e=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return(i=setTimeout)(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}var a,d=[],l=!1,u=-1;function c(){l&&a&&(l=!1,a.length?d=a.concat(d):u=-1,d.length)&&h()}function h(){if(!l){for(var e=o(c),t=(l=!0,d.length);t;){for(a=d,d=[];++u<t;)a&&a[u].run();u=-1,t=d.length}a=null,l=!1,!function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return(n=clearTimeout)(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];d.push(new p(e,t)),1!==d.length||l||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=f,e.addListener=f,e.once=f,e.off=f,e.removeListener=f,e.removeAllListeners=f,e.emit=f,e.prependListener=f,e.prependOnceListener=f,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t){var i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){var n=i(19);"string"==typeof n&&(n=[[e.i,n,""]]),i(21)(n,{})},function(e,t,i){(e.exports=i(20)(!1)).push([e.i,"#_cm-css-reset {\n    height: inherit;\n    width: inherit;\n    direction: ltr;\n    text-align: left;\n}\n\n#_cm-css-reset.vpaid-player-container .vjs-tech {\n    background-color: #000000;\n}\n\n#_cm-css-reset.vpaid-player-container {\n    position: relative;\n    z-index: 99;\n}\n\n#_cm-css-reset.vpaid-player-container video ~ iframe {\n    z-index: 10;\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n#_cm-css-reset .vpaid-ad-controls {\n    -webkit-transition: opacity 500ms ease-out;\n    -moz-transition: opacity 500ms ease-out;\n    -o-transition: opacity 500ms ease-out;\n    transition: opacity 500ms ease-out;\n    opacity: 0;\n}\n\n#_cm-css-reset.vpaid-player-container:hover .vpaid-ad-controls {\n    opacity: 1;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-controls,\n#_cm-css-reset.vpaid-player-container .vpaid-ad-pause {\n    height: 30px;\n    right: 0;\n    position: absolute;\n    left: 0px;\n    bottom: 0;\n    z-index: 1001;\n    background-color: rgba(0, 0, 0, 1);\n    border-top: 1px rgba(255, 255, 255, 0.7) solid;\n}\n\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control {\n    width: 2em;\n}\n/*\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control:before {\n    line-height: 2;\n    font-size: 16px;\n}*/\n\n#_cm-css-reset\n    .vpaid-ad-controls.vjs-default-skin\n    .vjs-control.c-paused:before {\n    content: '\\e001';\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-container {\n    height: 30px;\n    width: 60px;\n    position: relative;\n    float: right;\n    margin-right: 10px;\n    top: 0;\n    cursor: pointer;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-mute-container {\n    height: 30px;\n    width: 30px;\n    position: relative;\n    float: right;\n    top: 0;\n    cursor: pointer;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-track {\n    height: 8px;\n    border: 1px #000000 solid;\n    box-shadow: 0 0 5px 1px rgb(255, 255, 255);\n    position: absolute;\n    z-index: 0;\n    right: 0;\n    top: 11px;\n    left: 0;\n    background: rgba(51, 51, 51, 0.9);\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-slider {\n    height: 8px;\n    border: 1px #000000 solid;\n    position: absolute;\n    width: 40%;\n    top: 11px;\n    left: 0;\n    background: rgba(183, 234, 187, 0.9);\n    z-index: 1;\n}\n\n/*#_cm-css-reset .mpegcnv::before {\n    content: \"\";\n    position: absolute;\n    \n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 100;\n}*/\n\n#_cm-css-reset .tbl-text {\n    font-family: Arial, Helvetica, sans-serif;\n    white-space: nowrap;\n    font-size: 11px;\n    color: #fff;\n    left: 10px;\n    top: 4px;\n    position: absolute;\n    font-weight: bold;\n    z-index: 1001;\n}\n\n#_cm-css-reset .mc-video {\n    z-index: 101;\n}\n\n#_cm-css-reset .vpaid-handler {\n    z-index: 1000;\n    height: 100%;\n    width: 100%;\n}\n\n#_cm-css-reset .speaker {\n    position: absolute;\n    width: 46px;\n    height: 46px;\n    bottom: -3px;\n    right: -5px;\n    z-index: 1001;\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-vol-on.svg');\n}\n#_cm-css-reset .speaker.mute {\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-vol-off.svg');\n}\n\n#_cm-css-reset .hide {\n    display: none;\n}\n\n#_cm-css-reset .mc-loud-video {\n    position: absolute;\n    pointer-events: none;\n}\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-panel {\n    display: none !important;\n    -webkit-appearance: none;\n}\n\n/* Old shadow dom for play button */\n\n#_cm-css-reset .mc-loud-video::--webkit-media-controls-play-button {\n    display: none !important;\n    -webkit-appearance: none;\n}\n\n/* New shadow dom for play button */\n\n/* This one works */\n\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-start-playback-button {\n    display: none !important;\n    -webkit-appearance: none;\n}\n\n#_cm-css-reset .mc-loud-video::-webkit-media-controls {\n    display: none !important;\n}\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-enclosure {\n    display: none !important;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show {\n    display: block;\n    margin: 0;\n    padding: 0;\n    position: initial;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show * {\n    position: absolute !important;\n    display: block;\n    margin: 0;\n    padding: 0;\n    background-color: transparent;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 100%;\n    z-index: 1000;\n    left: 0;\n    bottom: -32px;\n    -webkit-transition: bottom 0.35s ease-in-out;\n    -moz-transition: bottom 0.35s ease-in-out;\n    -o-transition: bottom 0.35s ease-in-out;\n    transition: bottom 0.35s ease-in-out;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .control {\n    z-index: 100;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .interactive {\n    pointer-events: all;\n    cursor: pointer;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.hide,\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .hide {\n    display: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show,\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .show {\n    display: block;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_progressbar_area {\n    width: 100%;\n    height: 5px;\n    bottom: 0%;\n    cursor: default;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_progressbar_area\n    .cm_video_controls_progressbar {\n    height: 100%;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_progressbar_area\n    .cm_video_controls_progressbar_bg {\n    width: 100%;\n    height: 100%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .white_bg {\n    background: rgba(255, 255, 255, 0.3);\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .blue_bg {\n    background: rgba(21, 75, 145, 1);\n    -webkit-transition: width 0.5s ease;\n    -moz-transition: width 0.5s ease;\n    -o-transition: width 0.5s ease;\n    transition: width 0.5s ease;\n    width: 0%;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .blue_bg.init_bg {\n    -webkit-transition: none;\n    -moz-transition: none;\n    -o-transition: none;\n    transition: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 27px;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_main_area\n    .play_pause {\n    top: 3px;\n    left: 5px;\n    width: 20px;\n    height: 20px;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_main_area\n    .play_pause\n    .pause {\n    width: 40px;\n    height: 27px;\n    top: -7px;\n    left: -8px;\n    background-image: url('https://vidstat.taboola.com/player-assets/pause2.svg');\n    background-size: 36px;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_main_area\n    .play_pause\n    .play {\n    border-top: 5px solid transparent;\n    border-left: 10px solid #fff;\n    border-bottom: 5px solid transparent;\n    left: 6px;\n    top: 5px;\n    z-index: 102;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_main_area\n    .title {\n    top: 7px;\n    left: 30px;\n    width: 140px;\n    text-align: left;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .cm_video_controls_main_area\n    .timer {\n    top: 6px;\n    right: 110px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .text {\n    color: white;\n    font-size: 13px;\n    font-weight: bold;\n    font-family: Arial, Helvetica, sans-serif;\n    top: 10px;\n    left: 28px;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    cursor: default;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .text.opt-out-hidden {\n    left: 13px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 100%;\n    right: 0px;\n    bottom: 0;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_mute {\n    width: 35px;\n    height: 27px;\n    right: 8px;\n    bottom: 5px;\n    background-size: 44px;\n    box-sizing: content-box;\n    background-position-y: center;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_mute.display_mute {\n    background-image: url('https://vidstat.taboola.com/player-assets/desk_muted2.svg');\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_mute.display_unmute {\n    background-image: url('https://vidstat.taboola.com/player-assets/desk_playing2.svg');\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .video-controls-scroller-area {\n    width: 80px;\n    height: 100%;\n    right: 5px;\n    top: 0%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .playerSaveButton {\n    position: absolute;\n    border: 1px solid #fff;\n    border-radius: 9px;\n    width: 50px;\n    height: 24px;\n    top: 20%;\n    left: 0;\n    font-size: 14px;\n    color: #fff;\n    text-align: center;\n    line-height: 24px;\n    cursor: pointer;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls_mobile {\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    pointer-events: none;\n    z-index: 1001;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area {\n    pointer-events: none;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_playpause.hide {\n    display: none;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_playpause.show {\n    display: block;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_playpause {\n    bottom: 28px;\n    left: 5px;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_playpause\n    .pause {\n    width: 40px;\n    height: 27px;\n    top: -10px;\n    left: -8px;\n    background-image: url(https://vidstat.taboola.com/player-assets/pause2.svg);\n    background-size: 40px;\n}\n\n#_cm-css-reset\n    ._cm-video-ad.vpaid-player-container\n    .video_controls\n    .video_controls_main_area\n    .cm_video_controls_playpause\n    .play {\n    border-top: 6px solid transparent;\n    border-left: 10px solid #fff;\n    border-bottom: 6px solid transparent;\n    left: 7px;\n    top: 3px;\n    z-index: 102;\n}\n\n#_cm-css-reset .mc-play {\n    width: 0;\n    height: 0;\n    border-top: 7px solid transparent;\n    border-left: 9px solid #fff;\n    border-bottom: 7px solid transparent;\n    left: 14px;\n    position: absolute;\n    bottom: 10px;\n    z-index: 1001;\n}\n\n#_cm-css-reset .mc-pause {\n    display: block;\n    width: 42px;\n    height: 42px;\n    left: -4px;\n    position: absolute;\n    bottom: -2px;\n    z-index: 1001;\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-pause.svg');\n}\n\n#_cm-css-reset .mc-pause.hide,\n#_cm-css-reset .mc-play.hide {\n    display: none;\n}\n\n#_cm-css-reset .mc-pause.show,\n#_cm-css-reset .mc-play.show {\n    display: block;\n}\n\n#_cm-css-reset .mc-progressbar_area {\n    width: 100%;\n    height: 5px;\n    bottom: 0%;\n    position: absolute;\n    z-index: 9999;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.white_bg {\n    background: rgba(255, 255, 255, 0.3);\n    width: 100%;\n    height: 100%;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.blue_bg {\n    background: rgba(21, 75, 145, 1);\n    -webkit-transition: width 0.5s ease;\n    -moz-transition: width 0.5s ease;\n    -o-transition: width 0.5s ease;\n    transition: width 0.5s ease;\n    position: absolute;\n    bottom: 0%;\n    height: 100%;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.blue_bg.init_bg {\n    -webkit-transition: none;\n    -moz-transition: none;\n    -o-transition: none;\n    transition: none;\n}\n\n#_cm-css-reset > .multi-vpaids {\n    height: 0px;\n}\n\n#_cm-css-reset *::-webkit-media-controls-panel {\n    display: none !important;\n    -webkit-appearance: none;\n}\n\n/* Old shadow dom for play button */\n\n#_cm-css-reset *::-webkit-media-controls-play-button {\n    display: none !important;\n    -webkit-appearance: none;\n}\n\n/* New shadow dom for play button */\n\n/* This one works! */\n\n#_cm-css-reset *::-webkit-media-controls-start-playback-button {\n    display: none !important;\n    -webkit-appearance: none;\n}\n\n#_cm-css-reset .cm-ad-player {\n    cursor: pointer;\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    z-index: 0;\n}\n\n@supports (object-fit: cover) {\n    #_cm-css-reset .cm-ad-player {\n        object-fit: cover;\n    }\n\n    #_cm-css-reset .cm-ad-player.vertical-video {\n        object-fit: contain;\n    }\n}\n\n#_cm-css-reset .cm-ad-player.ie-black-edges {\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n\n#_cm-css-reset .cm-ad-player-active {\n    visibility: visible;\n}\n\n#_cm-css-reset ._cm-ad-feed-manager ._cm-ad {\n    display: block !important;\n    visibility: hidden !important;\n}\n\n#_cm-css-reset ._cm-ad-choices-player {\n    position: absolute;\n    top: 16px;\n    left: 13px;\n}\n\n#_cm-css-reset ._cm-ad-choices-player-anchor {\n    display: inline-block;\n    opacity: 0.5;\n    vertical-align: middle;\n}\n\n#_cm-css-reset .interactive-video {\n    position: absolute;\n    z-index: 999 !important;\n    cursor: pointer;\n    transition: visibility 0.2s, opacity 0.5s linear;\n    display: initial !important;\n    opacity: 0.8;\n    font-size: 0.875rem;\n    padding-left: 0.75rem;\n    padding-right: 0.75rem;\n    padding-top: 0.25rem;\n    padding-bottom: 0.25rem;\n    font-weight: 600;\n    border-radius: 9999px;\n    font-size: 3.5vmin;\n    text-shadow: 1px 1px black;\n    font-family: Impact, Charcoal, sans-serif !important;\n    letter-spacing: 0.2px;\n}\n\n#_cm-css-reset .interactive-video-lbls {\n    font-family: Impact, Charcoal, sans-serif !important;\n    letter-spacing: 0.2px;\n}\n\n#_cm-css-reset .interactive-video.center {\n    position: relative;\n}\n\n#_cm-css-reset .interactive-video.hide {\n    opacity: 0;\n    visibility: hidden;\n}\n\n#_cm-css-reset .interactive-video-wrapper {\n    position: absolute;\n    width: 100%;\n    text-align: center;\n}\n\n#_cm-css-reset .interactive-video-wrapper.hide {\n    opacity: 0;\n    visibility: hidden;\n}\n\n#_cm-css-reset .interactive-video.show {\n    opacity: 1;\n    visibility: visible;\n}\n\n#_cm-css-reset .interactive-video-effect {\n    -webkit-transition: width 0s ease;\n    -moz-transition: width 0s ease;\n    -o-transition: width 0s ease;\n    transition: width 0s ease;\n    height: 1px;\n    background-color: white;\n    pointer-events: none;\n}\n\n#_cm-css-reset .interactive-video-effect-wrapper {\n    padding-left: 0.75rem;\n}\n\n@media only screen and (max-width: 768px) {\n    #_cm-css-reset .interactive-video {\n        font-size: 3vmin;\n    }\n}\n\n#_cm-css-reset .cm-vpaid-iframe {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    margin: 0px !important;\n    padding: 0px;\n    border: none;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n}\n\n.buff-vid {\n    z-index: 2147483647 !important;\n    position: fixed;\n    right: 0;\n    width: 1px;\n    height: 1px;\n}\n",""])},function(e,t,i){"use strict";e.exports=function(i){var a=[];return a.toString=function(){return this.map(function(e){var t=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa)return e=function(e){e=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),e="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(e," */")}(n),t=n.sources.map(function(e){return"/*# sourceURL=".concat(n.sourceRoot).concat(e," */")}),[i].concat(t).concat([e]).join("\n");return[i].join("\n")}(e,i);return e[2]?"@media ".concat(e[2],"{").concat(t,"}"):t}).join("")},a.i=function(e,t){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},n=0;n<this.length;n++){var r=this[n][0];null!=r&&(i[r]=!0)}for(var s=0;s<e.length;s++){var o=e[s];null!=o[0]&&i[o[0]]||(t&&!o[2]?o[2]=t:t&&(o[2]="(".concat(o[2],") and (").concat(t,")")),a.push(o))}},a}},function(e,t){function i(e){var t;return function(){return t=void 0===t?e.apply(this,arguments):t}}var d={},n=i(function(){return/msie 9\b/.test(window.navigator.userAgent.toLowerCase())}),r=i(function(){return document.head||document.getElementsByTagName("head")[0]}),s=null,o=0;function l(e,t){for(var i=0;i<e.length;i++){var n=e[i],r=d[n.id];if(r){r.refs++;for(var s=0;s<r.parts.length;s++)r.parts[s](n.parts[s]);for(;s<n.parts.length;s++)r.parts.push(c(n.parts[s],t))}else{for(var o=[],s=0;s<n.parts.length;s++)o.push(c(n.parts[s],t));d[n.id]={id:n.id,refs:1,parts:o}}}}function u(e){for(var t=[],i={},n=0;n<e.length;n++){var r=e[n],s=r[0],r={css:r[1],media:r[2],sourceMap:r[3]};i[s]?i[s].parts.push(r):t.push(i[s]={id:s,parts:[r]})}return t}function a(){var e=document.createElement("style"),t=r();return e.type="text/css",t.appendChild(e),e}function c(t,e){var i,n,r;return r=e.singleton?(e=o++,i=s=s||a(),n=h.bind(null,i,e,!1),h.bind(null,i,e,!0)):(i=a(),n=function(e,t){var i=t.css,n=t.media,t=t.sourceMap;if(t&&"function"==typeof btoa)try{i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(JSON.stringify(t))+" */",i='@import url("data:text/css;base64,'+btoa(i)+'")'}catch(e){}n&&e.setAttribute("media",n);if(e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}.bind(null,i),function(){i.parentNode.removeChild(i)}),n(t),function(e){e?e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap||n(t=e):r()}}function h(e,t,i,n){var r,s,o,i=i?"":n.css;e.styleSheet?e.styleSheet.cssText=(n=e.styleSheet.cssText,s=i,r=["/** >>"+(r=t)+" **/","/** "+r+"<< **/"],o=n.lastIndexOf(r[0]),s=s?r[0]+s+r[1]:"",0<=n.lastIndexOf(r[0])?(r=n.lastIndexOf(r[1])+r[1].length,n.slice(0,o)+s+n.slice(r)):n+s):(o=document.createTextNode(i),(r=e.childNodes)[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o))}e.exports=function(e,o){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");void 0===(o=o||{}).singleton&&(o.singleton=n());var a=u(e);return l(a,o),function(e){for(var t=[],i=0;i<a.length;i++){var n=a[i];(r=d[n.id]).refs--,t.push(r)}e&&l(u(e),o);for(var r,i=0;i<t.length;i++)if(0===(r=t[i]).refs){for(var s=0;s<r.parts.length;s++)r.parts[s]();delete d[r.id]}}}},function(e,t){e.exports=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,i=[],n=0;n<t.rangeCount;n++)i.push(t.getRangeAt(n));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null}return t.removeAllRanges(),function(){"Caret"===t.type&&t.removeAllRanges(),t.rangeCount||i.forEach(function(e){t.addRange(e)}),e&&e.focus()}}},function(e,t,i){"use strict";var a=i(11),s=a.unique("vpaidIframe"),d=i(24);function n(e,t,i,n,r){i=i||{},this._id=s(),this._destroyed=!1,this.store=r,this._frameContainer=a.createElementInEl(e,"div"),this._frameContainer.style.position="initial",this._videoEl=t,this._vpaidOptions=n||{timeout:1e4},this._templateConfig={template:i.template||'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');setTimeout(function () {try { if (window.top.onTaboolaVpaidJSVpaidIframeLoaded) { window.top.onTaboolaVpaidJSVpaidIframeLoaded(\'{"data":{"event": "ready", "id": "{{iframeID}}"}, "origin": "{{origin}}"}\'); } } catch (e) {}}, 100);<\/script></body></html>',extraOptions:i.extraOptions||{}}}function l(){u.call(this),function(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}.call(this)}function u(){!function(e){var t=this[e];t&&(t.remove&&t.remove(),delete this[e])}.call(this,"_frame"),c.call(this)}function c(){this._onLoad&&(window.removeEventListener("message",this._onLoad),a.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function h(){return window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}n.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,l.call(this))},n.prototype.isDestroyed=function(){return this._destroyed},n.prototype.loadAdUnit=function(e,r){!function(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}.call(this),l.call(this);var s=this,t=a.createIframeWithContent(this._frameContainer,this._templateConfig.template,a.extend({iframeURL_JS:e,iframeID:this.getID(),origin:h()},this._templateConfig.extraOptions)),o=(this.store.get("msnifrmsrchk")&&(t._src=t.src,Object.defineProperty(t,"src",{get:function(){return t._src},set:function(e){}})),this._frame=t,this._onLoad=a.callbackTimeout(this._vpaidOptions.timeout,function(e){o&&"string"==typeof e&&(e=JSON.parse(e));if(e.origin===h()){var t,i,n;if(o&&"string"!=typeof e)t=e.data;else try{t=JSON.parse(e.data)}catch(e){t={}}if(t.id===s.getID()){(t=s._frame.contentWindow?(i=s._frame.contentWindow.getVPAIDAd,a.validate("function"==typeof i,"the ad didn't return a function to create an ad")):"the iframe is not anymore in the DOM tree")||(n=s._frame.contentWindow.document.querySelector(".ad-element"),(n=new d(i(),n,s._videoEl,s._frame)).subscribe("AdStopped",function(){u.call(this),delete this._adUnit}.bind(s)),t=a.validate(n.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")),s._adUnit=n,c.call(s),r(t,t?null:n);try{o&&(window.top.onTaboolaVpaidJSVpaidIframeLoaded=void 0)}catch(e){}return!0}}}.bind(this),function(){r("timeout",null)}.bind(this)),this.store.get("istblvpd"));if(o)try{window.top.onTaboolaVpaidJSVpaidIframeLoaded=this._onLoad}catch(e){}window.addEventListener("message",this._onLoad)},n.prototype.unloadAdUnit=function(){l.call(this)},n.prototype.getID=function(){return this._id},e.exports=n},function(e,t,i){"use strict";var s=i(25),r=i(26),o=s.checkVPAIDInterface,d=i(11),a=(s.METHODS,"AdClickThru"),l=s.EVENTS.filter(function(e){return e!=a});function u(e,t,i,n){this._isValid=o(e),this._isValid&&(this._creative=e,this._el=t,this._videoEl=i,this._iframe=n,this._subscribers=new r,d.setFullSizeStyle(t),function(){{var t,i;l.forEach(function(e){this._creative.subscribe(function(e){this._subscribers.trigger(e,Array.prototype.slice.call(arguments).slice(1))}.bind(this,e),e)}.bind(this)),this._creative.subscribe(function(e,t,i){this._subscribers.triggerSync(a,{url:e,id:t,playerHandles:i})}.bind(this),a),this._videoEl&&(t=this._iframe.contentDocument.documentElement,i=this._videoEl,t.addEventListener("click",function(e){e.target===t&&i.click()}))}}.call(this))}function c(e,t,i,n){e?e(i,n):i&&t.trigger("AdError",i)}(u.prototype=Object.create(s.prototype)).isValidVPAIDAd=function(){return this._isValid},s.METHODS.forEach(function(r){-1===["subscribe","unsubscribe","initAd"].indexOf(r)&&(u.prototype[r]=function(){var e,t=s.prototype[r].length,i=Array.prototype.slice.call(arguments),t=t===i.length?i.pop():void 0,n=null;try{e=this._creative[r].apply(this._creative,i)}catch(e){n=e}c(t,this._subscribers,n,e)})}),u.prototype.initAd=function(e,t,i,n,r,s,o){var a;r=r||{},s=d.extend({slot:this._el,videoSlot:this._videoEl},s||{});try{this._creative.initAd(e,t,i,n,r,s)}catch(e){a=e}c(o,this._subscribers,a)},u.prototype.subscribe=function(e,t,i){this._subscribers.subscribe(t,e,i)},u.prototype.unsubscribe=function(e,t){this._subscribers.unsubscribe(t,e)},u.prototype.on=u.prototype.subscribe,u.prototype.off=u.prototype.unsubscribe,s.GETTERS.forEach(function(n){u.prototype[n]=function(e){var t,i=null;try{t=this._creative[n]()}catch(e){i=e}c(e,this._subscribers,i,t)}}),u.prototype.setAdVolume=function(e,t){var i;try{this._creative.setAdVolume(e),i=this._creative.getAdVolume()}catch(e){}c(t,this._subscribers,null,i)},u.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},e.exports=u},function(e,t,i){"use strict";var n=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];function r(e,t,i){}r.prototype.handshakeVersion=function(e,t){},r.prototype.initAd=function(e,t,i,n,r,s,o){},r.prototype.startAd=function(e){},r.prototype.stopAd=function(e){},r.prototype.skipAd=function(e){},r.prototype.resizeAd=function(e,t,i,n){},r.prototype.pauseAd=function(e){},r.prototype.resumeAd=function(e){},r.prototype.expandAd=function(e){},r.prototype.collapseAd=function(e){},r.prototype.subscribe=function(e,t,i){},r.prototype.unsubscribe=function(e,t){},r.prototype.getAdLinear=function(e){},r.prototype.getAdWidth=function(e){},r.prototype.getAdHeight=function(e){},r.prototype.getAdExpanded=function(e){},r.prototype.getAdSkippableState=function(e){},r.prototype.getAdRemainingTime=function(e){},r.prototype.getAdDuration=function(e){},r.prototype.getAdVolume=function(e){},r.prototype.getAdCompanions=function(e){},r.prototype.getAdIcons=function(e){},r.prototype.setAdVolume=function(e,t){},o(r,"METHODS",n),o(r,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),o(r,"SETTERS",["setAdVolume"]),o(r,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var s=n.filter(function(e){return-1===["skipAd"].indexOf(e)});function o(e,t,i){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:i})}o(r,"checkVPAIDInterface",function(t){return s.every(function(e){return"function"==typeof t[e]})}),e.exports=r},function(e,t,i){"use strict";function n(){this._subscribers={}}n.prototype.subscribe=function(e,t,i){this.isHandlerAttached(e,t)||this.get(t).push({handler:e,context:i,eventName:t})},n.prototype.unsubscribe=function(t,e){this._subscribers[e]=this.get(e).filter(function(e){return"*"!==t&&t!==e.handler})},n.prototype.unsubscribeAll=function(){this._subscribers={}},n.prototype.trigger=function(e,t){for(var i,n=this.get(e),r=0;r<n.length;r++)(i=n[r]).handler.call(i.context,t)},n.prototype.triggerSync=function(e,t){this.get(e).forEach(function(e){e.handler.call(e.context,t)})},n.prototype.get=function(e){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e]||[]},n.prototype.isHandlerAttached=function(t,e){return this.get(e).some(function(e){return t===e.handler})},e.exports=n},function(e,t,i){var n;void 0!==(t="function"==typeof(n=function(){"use strict";return function(i,n){var r;return function(){var e=this,t=arguments;clearTimeout(r);r=setTimeout(function(){i.apply(e,t)},n)}}})?n.apply(t,[]):n)&&(e.exports=t)},function(L,F,e){"use strict";e.r(F);e(18);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==B(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==B(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===B(e)?e:String(e)}(n.key),n)}}var t=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.label="["+e+"]",this.isDevelopModeOn=-1<this.debugLevels.indexOf("develop"),this.isTrackerOn=-1<this.debugLevels.indexOf("*")||-1<this.debugLevels.indexOf("qa")||this.isDevelopModeOn}var e,i,n;return e=t,(i=[{key:"table",value:function(e){this.isDevelopModeOn&&console.table(e)}},{key:"_templateLogging",value:function(e,t,i,n){if(this.isTrackerOn){var r,s="";for(r in i)s+="".concat(r,": ").concat(i[r],"; ");"string"==typeof t?console[n]("%c".concat(this.label," [").concat(e,"] ").concat(t),s):console[n]("%c".concat(this.label," [").concat(e,"]"),s,t)}}},{key:"debug",value:function(e,t,i){}},{key:"error",value:function(e,t,i){this._templateLogging(e,t,i,"error")}},{key:"warn",value:function(e,t,i){this._templateLogging(e,t,i,"warn")}},{key:"info",value:function(e,t,i){this._templateLogging(e,t,i,"info")}},{key:"log",value:function(e,t,i){this._templateLogging(e,t,i,"log")}},{key:"time",value:function(e){this.isTrackerOn&&console.time(e)}},{key:"timeEnd",value:function(e){this.isTrackerOn&&console.timeEnd(e)}}])&&j(e.prototype,i),n&&j(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),o=(t.prototype.debugLevels="",t);function W(){var e={};try{e=window.cmTag.config}catch(e){return{}}var t,i={};for(t in e)0===t.indexOf("player.settings.")&&(i[t.substr(16,t.length-16)]=function(e){if(/^\d+$/.test(e))return parseInt(e);if(/^true$|^false$/g.test(e))return"true"===e||!0===e;return e}(e[t]));return i}var t=e(3),s=e.n(t);function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==U(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==U(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===U(e)?e:String(e)}(n.key),n)}}var H=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.decodedData=atob(e),this.nextBits=0,this.numBitsRemaining=0,this.isEndOfStream=!1,this.pointerInDecodedData=0}var e,i,n;return e=t,(i=[{key:"getNextByte",value:function(){return this.pointerInDecodedData===this.decodedData.length?-1:this.decodedData.charCodeAt(this.pointerInDecodedData++)}},{key:"read",value:function(){if(this.isEndOfStream)return-1;if(0===this.numBitsRemaining){if(this.nextBits=this.getNextByte(),-1===this.nextBits)return this.isEndOfStream=!0,-1;this.numBitsRemaining=8}return this.numBitsRemaining--,this.nextBits>>7-this.numBitsRemaining&1}},{key:"isEof",value:function(){return this.isEndOfStream||0==this.numBitsRemaining&&this.pointerInDecodedData==this.decodedData.length}},{key:"readChar",value:function(){for(var e=0,t=0;t<7;t++)e|=this.read()<<t;return String.fromCharCode(e)}},{key:"readByte",value:function(){for(var e=0,t=0;t<8;t++)e|=this.read()<<t;return e}},{key:"read7bitString",value:function(e){for(var t="",i=0;i<e;i++)t+=this.readChar();return t}},{key:"read8bitString",value:function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t}},{key:"readBytes",value:function(e){for(var t=new ArrayBuffer(e),i=0;i<e;i++)t[i]=this.readByte();return t}},{key:"readInt",value:function(e){if(void 0!==e){for(var t=0,i=0;i<e;i++)t|=this.read()<<i;return t}for(var n=0,i=3;0<=i;i--)n+=this.readByte(),0<i&&(n<<=8);return n}},{key:"readLong",value:function(){for(var e=0,t=7;0<=t;t--)e+=this.readByte(),0<t&&(e<<=8);return e}},{key:"readShort",value:function(){for(var e=0,t=1;0<=t;t--)e+=this.readByte(),0<t&&(e<<=8);return e}},{key:"readFloat",value:function(){for(var e=new ArrayBuffer(4),t=new DataView(e),i=0;i<4;i++)t.setUint8(i,this.readByte());return t.getFloat32(0)}},{key:"readDouble",value:function(){for(var e=new ArrayBuffer(8),t=new DataView(e),i=0;i<8;i++)t.setUint8(i,this.readByte());return t.getFloat64(0)}},{key:"readBool",value:function(){return 0<this.read()}}])&&N(e.prototype,i),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==q(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==q(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===q(e)?e:String(e)}(n.key),n)}}var Q=function(){function d(e,t){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");if(this.results=null,e){for(var i=[],n=(this.dastKeys={0:{name:"stid",type:2},1:{name:"extuid",type:3},2:{name:"excid",type:10},3:{name:"ciuid",type:3},4:{name:"ciuidst",type:3},5:{name:"ciums",type:2},6:{name:"szid",type:10},7:{name:"cirid",type:5},8:{name:"cisid",type:5},9:{name:"segid",type:5},10:{name:"pstn",type:5},11:{name:"plcmnt",type:5},12:{name:"RID",type:2},13:{name:"cirf",type:5},14:{name:"base64",type:2},15:{name:"crid",type:2},16:{name:"cibp",type:7},17:{name:"cisbp",type:7},18:{name:"ciprbp",type:7},19:{name:"cmbb",type:7},20:{name:"noaop",type:10},21:{name:"ciage",type:1},22:{name:"cigndr",type:10},23:{name:"invc",type:2},24:{name:"slid",type:2},25:{name:"oslid",type:2},26:{name:"cntry",type:8},27:{name:"rgn",type:5},28:{name:"cty",type:5},29:{name:"citbp",type:7},30:{name:"rcatid",type:5},31:{name:"brsr",type:2},32:{name:"osid",type:2},33:{name:"frimp",type:2},34:{name:"frclk",type:2},35:{name:"frcnv",type:2},36:{name:"pubid",type:2},37:{name:"subid",type:2},38:{name:"ltstmp",type:3},39:{name:"mtmdlid",type:3},40:{name:"mdlid",type:3},41:{name:"cu1",type:2},42:{name:"cu2",type:2},43:{name:"cu3",type:2},44:{name:"cu4",type:2},45:{name:"cu5",type:2},46:{name:"cu6",type:2},47:{name:"cu7",type:2},48:{name:"cu8",type:2},49:{name:"cipid",type:2},50:{name:"cicmp",type:2},51:{name:"impts",type:2},52:{name:"clcts",type:2},53:{name:"convts",type:2},54:{name:"adid",type:3},55:{name:"dcid",type:10},56:{name:"compid",type:2},58:{name:"siteid",type:2},59:{name:"pix",type:3},60:{name:"chan",type:3},61:{name:"bo",type:8},62:{name:"so",type:8},63:{name:"oid",type:10},64:{name:"csec",type:3},65:{name:"skw",type:2},66:{name:"alng",type:2},67:{name:"auc64",type:3},68:{name:"mid",type:8},69:{name:"wif",type:6},70:{name:"ciipd",type:3},71:{name:"sec",type:6},72:{name:"adt",type:2},73:{name:"nsl",type:6},74:{name:"pti",type:6},75:{name:"dncf",type:6},76:{name:"obp",type:7},77:{name:"tz",type:5},78:{name:"md",type:6},79:{name:"mmt",type:1},83:{name:"udc",type:6},84:{name:"umexcid",type:10},85:{name:"verticalId",type:2},86:{name:"mbr",type:10},87:{name:"ts",type:3},88:{name:"omni",type:2},89:{name:"rpm",type:7},90:{name:"abt",type:5},91:{name:"dspadid",type:5},92:{name:"dspbid",type:5},93:{name:"dspcid",type:5},94:{name:"dspcrid",type:5},95:{name:"dspid",type:2},96:{name:"dspseat",type:5},97:{name:"urlDepth",type:2},98:{name:"ordid",type:3},99:{name:"servingDomain",type:5},100:{name:"omniType",type:9},101:{name:"frmi",type:3},102:{name:"fmmt",type:1},103:{name:"cmt",type:1},104:{name:"lat",type:7},105:{name:"long",type:7},106:{name:"prrp",type:7},107:{name:"pfrp",type:7},108:{name:"pgtp",type:9},109:{name:"tblc",type:9},110:{name:"mcr",type:8},111:{name:"ct",type:10},112:{name:"platform",type:9},113:{name:"cncat",type:5},114:{name:"cisrf",type:5},115:{name:"sortOrderType",type:1},116:{name:"groupId",type:5},117:{name:"testId",type:5},118:{name:"prl",type:2},119:{name:"pfrl",type:2},120:{name:"rtd",type:3},121:{name:"rndmt",type:2},122:{name:"sesid",type:5},123:{name:"seshas",type:3},124:{name:"palfr",type:7},125:{name:"splcmt",type:5},126:{name:"wurflb",type:5},127:{name:"wurflbv",type:5},128:{name:"wurflo",type:5},129:{name:"wurflov",type:5},130:{name:"wurflbn",type:5},131:{name:"wurflff",type:5},132:{name:"wurflmn",type:5},133:{name:"difa",type:5},134:{name:"aid",type:5},135:{name:"extuidst",type:5},136:{name:"tbuidst",type:5},137:{name:"aname",type:5},138:{name:"abRTB",type:5},139:{name:"mda",type:5},140:{name:"audsegid",type:5},141:{name:"smdt",type:3},142:{name:"at",type:2},143:{name:"ip",type:5},144:{name:"bundid",type:5},145:{name:"sturl",type:5},146:{name:"asiid",type:5},147:{name:"sid",type:5},148:{name:"appver",type:5},149:{name:"floor",type:4},150:{name:"instl",type:6},151:{name:"blang",type:5},152:{name:"gdpr",type:6},153:{name:"uconsnt",type:6},154:{name:"pcat",type:5},155:{name:"sdepth",type:2},156:{name:"pubidstr",type:5},157:{name:"tagidstr",type:5},158:{name:"uconsntstr",type:5},159:{name:"burl",type:5},160:{name:"pwidth",type:2},161:{name:"pheight",type:2},162:{name:"ctcs",type:10},163:{name:"cetcs",type:10},164:{name:"dspcats",type:5},165:{name:"smidis",type:2},166:{name:"smivrtb",type:2},167:{name:"smiv",type:2},168:{name:"mfrn",type:5},169:{name:"mfri",type:2},170:{name:"mfrp",type:4},171:{name:"mfrpl",type:2},172:{name:"mvecpmn",type:5},173:{name:"mvecpmi",type:2},174:{name:"mvecpmp",type:4},175:{name:"mvecpmpl",type:2},176:{name:"mfrtbn",type:5},177:{name:"mfrtbi",type:2},178:{name:"mfrtbp",type:4},179:{name:"mfrtbpl",type:2},180:{name:"mdisn",type:5},181:{name:"mdisi",type:2},182:{name:"mdisp",type:4},183:{name:"mdispl",type:2},184:{name:"debug",type:5},185:{name:"tpubid",type:2},186:{name:"scp",type:4},187:{name:"sii",type:3},188:{name:"csiid",type:5},189:{name:"ft",type:2},190:{name:"mfril",type:3},191:{name:"mvecpmil",type:3},192:{name:"mfrtbil",type:3},193:{name:"mdisil",type:3},194:{name:"subu",type:2},195:{name:"rid",type:5},196:{name:"muid",type:5},197:{name:"gdprven",type:6},198:{name:"gdprpur",type:6},199:{name:"pubnm",type:5},200:{name:"mPre",type:4},201:{name:"dspuid",type:5},202:{name:"tnetid",type:2},203:{name:"oafp",type:4},204:{name:"oee",type:6},205:{name:"itn",type:6},206:{name:"matchSource",type:2},207:{name:"ccpa",type:5},208:{name:"rs",type:2},209:{name:"dspat",type:2},210:{name:"ds",type:2},211:{name:"sdkt",type:5},212:{name:"sdkv",type:5},213:{name:"sdkos",type:5},214:{name:"uis",type:2},215:{name:"umt",type:3},216:{name:"fagg",type:2},217:{name:"ut",type:6}},e=(e=(e=e.substring(2,e.length-1)).replace(/_/g,"/")).replace(/-/g,"+"),this.bis=new H(e),this.bis.readInt(16),{});;){var r=this.bis.readInt(8);if(this.bis.isEof())break;if(this.dastKeys.hasOwnProperty(r)){var s=this.dastKeys[r];if(3==s.type&&(a=this.bis.readLong()),5==s.type){try{var o=this.decodeBerLength()}catch(e){i.push("key:".concat(r,",\n\t\t\t\t\t ").concat(e));continue}var a="";-1==o?0==this.bis.readByte()&&(a="ENTER_PLACEMENT_ID_HERE"):a=this.bis.read7bitString(o)}2==s.type&&(a=this.bis.readInt()),9==s.type&&(a=this.bis.readInt(4)),4==s.type&&(a=this.bis.readDouble()),1==s.type&&127<(a=this.bis.readByte())&&(a-=256),10==s.type&&(a=this.bis.readByte()),6==s.type&&(a=this.bis.readBool()),8==s.type&&32767<(a=this.bis.readShort())&&(a-=65536),7==s.type&&(a=this.bis.readFloat()),n[s.name]=a}else i.push("missing key:".concat(r," in dastDecoder"))}this.results=n,0<i.length&&t.set("dastDecoderError",i)}}var e,t,i;return e=d,(t=[{key:"fetchResults",value:function(){return this.results}},{key:"decodeBerLength",value:function(){var e=this.bis.readByte();if(255==e)return-1;if(128!=(128&e))return e=1e3<e?1e3:e;if(0==(e&=127))throw"Indefinite length not supported";if(4<e)throw"Encoding too long";for(var t=0,i=0;i<e;i++)t=(t<<8)+(255&this.bis.readByte());return t=1e3<t?1e3:t}}])&&z(e.prototype,t),i&&z(e,i),Object.defineProperty(e,"prototype",{writable:!1}),d}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var K=32766,J=null,X=void 0;function Y(e){var t,i;return e&&(null!==J?J:J=e.get("dpndonuntfrlgtoelstc")?(t=(i=e).get("elasticSessionId"),i.get("shouldSendDataToElastic")&&void 0!==t):(i=e,(i=parseInt(i.get("ga_factor")))?1===i||re(0,i=100<i?100:i)===i:J))}function $(e){return 0!==(e=Math.max(Math.min(100,e),0))&&(1===e||re(0,e)===e)}function Z(e,t,i){var n,r,s;Y(i)&&(e=e,t=t,n=(i=i).get("player_version"),r=i.get("ab_test")||"",r="".concat(r).concat(ie(t.tag,i)),(s=new XMLHttpRequest).open("POST","".concat(i.get("kbnul"),"/putes"),!0),i={event:e,timestamp:(new Date).toISOString(),version:n,abTest:r},i=Object.assign(i,t),s.send(m(ne(i))))}function ee(e,t,i,n){var r,s,o;Y(n)&&(e=e,t=t,i=i,r=(n=n).get("player_version"),s=n.get("ab_test")||"",(o=new XMLHttpRequest).open("POST","".concat(n.get("kbnul"),"/putes/").concat(e),!0),n={event:t,timestamp:(new Date).toISOString(),version:r,abTest:s},n=Object.assign(n,i),o.send(m(ne(n))))}function te(e){return e?1:0}function ie(e,t){return"".concat(e.requiredViewabilityDrawn?"!ronrv":"").concat(e.moatSampling?"!mtsmp":"").concat(t.get("isReadMoreOnPage")?"!rdmr":"")}function ne(e){var s,o;return s=!0,o=[],function e(t,i,n){var r=0;if(void 0===t)r=0;else if("boolean"==typeof t)r=4;else if("string"==typeof t)r=2*(t=s&&t.length>K?i[n]="STRING TOO LONG":t).length;else if("number"==typeof t)r=8;else if("function"==typeof t)try{r=2*t.toString().length}catch(e){}else if("object"===G(t)&&-1===o.indexOf(t))for(var n in o[o.length]=t)r=(r+=8)+e(t[n],t,n);return r}(e,e,null),e}function re(e,t){return Math.floor(Math.random()*(t-e+1))+e}var se="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("");function oe(e,t){var i=se,n=[],r=0;for(t=t||i.length,e=e||22,r=0;r<e;r++)n[r]=i[0|Math.random()*t];return n.join("")}function ae(e){return e="string"==typeof e&&0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")?"//"+e:e}function de(e){if(!e||"string"!=typeof e)return 0;var t,i;void 0===t&&(t=0);t^=-1;for(var n=0,r=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):t=127<n&&n<2048?(t+=String.fromCharCode(n>>6|192))+String.fromCharCode(63&n|128):(t=(t+=String.fromCharCode(n>>12|224))+String.fromCharCode(n>>6&63|128))+String.fromCharCode(63&n|128)}return t}(e)).length;n<r;n++)i=255&(t^e.charCodeAt(n)),t=t>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*i,8);return-1^t}function a(e,t){e.classList.add(t)}function d(e,t){e.classList.remove(t)}function le(e,t,i,n,r){try{!r&&e.contentWindow.console.error&&(e.contentWindow.console.error=function(){});var s="iframe"==e.tagName.toLowerCase()?e.contentDocument:e;s&&(s.querySelectorAll(t).forEach(function(e){le(e,t,i,n,r)}),i(s.querySelectorAll(n)))}catch(e){}}function ue(e){try{return/\{\s*\[native code\]\s*\}/.test(e.toString())}catch(e){return 1}}function m(e,t){try{var i,n=[],r=null;ue(Array.prototype.toJSON)||(r=Array.prototype.toJSON,delete Array.prototype.toJSON),i=JSON.stringify(e,function(e,t){if(null!=t&&"object"==G(t)){if(-1<n.indexOf(t))return;n.push(t)}return t},t)}catch(e){i=""}return null!==r&&(Array.prototype.toJSON=r),i}function c(e,t,i){e&&e.push(t,i,3<arguments.length&&void 0!==arguments[3]&&arguments[3],!(4<arguments.length&&void 0!==arguments[4])||arguments[4])}function l(e){return 1<e?e/100:e}function ce(e){return parseInt(e)}function he(e){return e<1e3?1e3*e:e}function u(e,t){var e={cijs:"convusmp",ttype:e,cisd:"convusmp",cipid:t.get("cipid")||"",crid:t.get("creativeId")||"",dast:t.get("auc_dast")||"",cmcv:"",uv:t.get("unit_version")||"",unm:t.get("unit_type")||"",cb:Date.now(),abt:t.get("ab_test")||"",mp:t.get("modifiedPlacement")||void 0,su:t.get("subUnitType")||""};return Object.assign(e,(e=t,t=window.cmTag&&window.cmTag.config?window.cmTag.config:{baseReportD:"taboola.com",dataCenter:"am"},{baseReportD:e.get("baseReportD")||t.baseReportD,dataCenter:e.get("dataCenter")||t.dataCenter}))}function h(e){if(!1!==X.get("isFirePixel")){var t,i=pe(e)+"?";for(t in e)void 0!==e[t]&&(i+=t+"="+e[t]+"&");document.createElement("img").src=i}}function pe(e){return X.get("pixelsUrl")||"//conv".concat(e.dataCenter,"mp.").concat(e.baseReportD,"/st")}function fe(e,t,i,n){var i=2<arguments.length&&void 0!==i?i:{},n=3<arguments.length&&void 0!==n?n:{},r=t.get("creatives"),s=encodeURIComponent(r.VIDEO_URL&&r.VIDEO_URL.url?r.VIDEO_URL.url:r.VIDEO_URL),o=(new Date).getTime();return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/(%%|\[|\{)referrer(%%|\]|\})/gi,r.REFERRER)).replace(/(%%|\[|\{)domain(%%|\]|\})/gi,r.DOMAIN)).replace(/(%%|\[|\{)video-url(%%|\]|\})/gi,s)).replace(/(%%|\[|\{)(page-url|site_full_url)(%%|\]|\})/gi,r.PAGE_URL)).replace(/(%%|\[|\{)player-width(%%|\]|\})/gi,r.PLAYER_WIDTH)).replace(/(%%|\[|\{)player-height(%%|\]|\})/gi,r.PLAYER_HEIGHT)).replace(/(%%|\[|\{)vidlength(%%|\]|\})/gi,r.VIDLENGTH)).replace(/(%%|\[|\{)keywords(%%|\]|\})/gi,r.KEY_WORDS)).replace(/(%%|\[|\{)description(%%|\]|\})/gi,r.DESCRIPTION)).replace(/(%%|\[|\{)vertical(%%|\]|\})/gi,r.VERTICAL)).replace(/(%%|\[|\{)tag(%%|\]|\})/gi,r.TAG||"")).replace(/(%%|\[|\{)cirf(%%|\]|\})/gi,encodeURIComponent(decodeURIComponent(r.CIRF)))).replace(/(%%|\[|\{)cb(%%|\]|\})/gi,"R0."+o)).replace(/(%%|\[|\{)country(%%|\]|\})/gi,t.get("country"))).replace(/(%%|\[|\{)ip(%%|\]|\})/gi,t.get("ip"))).replace(/(%%|\[|\{)ua(%%|\]|\})/gi,encodeURIComponent(navigator.userAgent))).replace(/(%%|\[|\{)dast(%%|\]|\})/gi,t.get("auc_dast")||"")).replace(/(%%|\[|\{)impression_id(%%|\]|\})/gi,i.impressionId||"")).replace(/(%%|\[|\{)duration(%%|\]|\})/gi,i.adDuration||0)).replace(/%%[^%]*%%/gi,"")).replace(/(\[|\{)site(\]|\})/gi,window.TRC?window.TRC.publisherId:"")).replace(/(\[|\{)site_id(\]|\})/gi,window.TRC?window.TRC.publisherId:"")).replace(/(\[|\{)site_domain(\]|\})/gi,r.DOMAIN)).replace(/(\[|\{)thumbnail(\]|\})/gi,r.VIDEO_URL&&r.VIDEO_URL.url?r.VIDEO_URL.url:"")).replace(/(%%|\[|\{)title(%%|\]|\})/gi,r.TITLE)).replace(/(%%|\[|\{)timestamp(%%|\]|\})/gi,Math.floor(o/1e3))).replace(/(\[|\{)platform(%%|\]|\})/gi,function(e){var t;switch(parseInt(e.get("dast.platform"))){case 1:t="Desktop";break;case 2:t="Mobile";break;case 3:t="Tablet"}return t}(t))).replace(/(\[|\{)campaign_id(\]|\})/gi,n.campaignId)).replace(/(\[|\{)campaign_item_id(\]|\})/gi,n.lineItem)).replace(/(\[|\{)request_id(\]|\})/gi,window.TRCImpl&&"function"==typeof window.TRCImpl.getGlobalRequestId?window.TRCImpl.getGlobalRequestId():"")}function ve(e,t,i){var n=e.document.createElement("script");n.type="text/javascript",n.innerHTML=t,n.onload=function(){i&&i()},n.onerror=function(e){i&&i(e)},e.document.head.appendChild(n)}function me(e){return"https:"===window.location.protocol&&e.get("scrmf")}function ye(e){return btoa(unescape(encodeURIComponent(m(e)))).replace(/\//g,"_").replace(/\+/g,"-")}function ge(e){if(e)try{if(e.eventData){var t=m(e.eventData),i=t.match(s.a.codesMatcher);if(i&&i[0])return parseInt(i[0]);if(t.toLowerCase().match(s.a.noAdsMatcher))return s.a.schemaValidationError;if(t.toLowerCase().match("timeout"))return s.a.timeout}}catch(e){}return s.a.undefinedError}var be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function _e(e,t){ee("secure_player",e,t,X)}function ke(e){var t,i,n;return e.isResolved||(n=i=!(t=!0),(e=e.then(function(e){return t=!(n=!0),e},function(e){throw t=!(i=!0),e})).isFulfilled=function(){return n},e.isPending=function(){return t},e.isRejected=function(){return i}),e}function we(e,t){if(!e)return{};try{return new Q(e,X).fetchResults()}catch(e){return t&&t(e),{}}}function r(e){return-1<e.search(/px$/g)?e:"".concat(e,"px")}function Ae(e){return/\.mpg$/.test(e)||/\.mpeg$/.test(e)}function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,s,o,a=[],d=!0,l=!1;try{if(s=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;d=!1}else for(;!(d=(n=s.call(i)).done)&&(a.push(n.value),a.length!==t);d=!0);}catch(e){l=!0,r=e}finally{try{if(!d&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw r}}return a}}(e,t)||function(e,t){var i;if(e)return"string"==typeof e?Se(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Se(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Pe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Te(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Te(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Te(e)?e:String(e)}(n.key),n)}}var Ve=e(7),Ce=function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");Ve.mixin(this),this._maxListeners=100,this.data={},Object.assign(this.data,e);t=(this.data.full_player_version="15.0.9").replace(/\./g,""),t=parseInt(t),this.data.debugLevels=e.debug||"",this.data.debug=-1!=e.debug.indexOf("*"),this.data.playerVersion=this.data.player_version=t,this.data.isInApp=void 0!==window.taboolaMobile;var t="",i="",n="";try{i=e.unit_name,t=e.abTest,n=e.unit_main_version}catch(e){}this.data.ab_test=t,this.data.unit_type=i,this.data.unit_version=n,this.data.session_started=Date.now(),this.data.secured_protocol="https:"===(window&&window.location&&window.location.protocol),window.cmTag&&window.cmTag.config&&window.cmTag.config.contentClickUrl&&(this.data.contentClickUrl=window.cmTag.config.contentClickUrl),X=this}var e,t,i;return e=r,(t=[{key:"incr",value:function(e){n.exists(e,this.data)||n.set(e,0,this.data);var t=n.get(e,!0,this.data)||0;if("number"==typeof t)return n.set(e,t+1,this.data),n.get(e,!1,this.data)}},{key:"decr",value:function(e){var t=n.get(e,!1,this.data);if("number"==typeof t)return n.set(e,t-1,this.data),n.get(e,!1,this.data)}},{key:"get",value:function(e){return-1===(e=e.toString()).indexOf(".")?this.data[e]:n.get(e,!1,this.data)}},{key:"getByTech",value:function(e,t){var i=this.get("dsm")||{};return i&&i.hasOwnProperty(t)&&i[t].hasOwnProperty(e)?i[t][e]:null}},{key:"getByAdInline",value:function(e,t){for(var i=this.get("dsm")||{},n=0;n<e.length;n++)for(var r=e[n],s=0,o=Object.entries(i);s<o.length;s++){var a=Ee(o[s],2),d=a[0],a=a[1],l=new RegExp(d,"ig");if(l.test(r.as)||l.test(r.at))return i[d];if(a.pvpdJs&&a.pvpdJsUrl&&t&&new RegExp(a.pvpdJsUrl,"i").test(t.textContent))return i[d]}return this.get("adstngs")}},{key:"set",value:function(e,t){e=e.toString(),n.set(e,t,this.data)}},{key:"getWfData",value:function(){var e,t=this.get("dsm")||{},i=[];for(e in t)/^\d+$/.test(e)&&t[e]&&t[e].hasOwnProperty("ftchVst")&&i.push({id:e,fv:t[e].ftchVst});return i}}])&&Pe(e.prototype,t),i&&Pe(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}(),n={set:function(e,t,i){var e=e.split("."),n=e.pop(),e=Ie(e,!0,i);return e&&n?e[n]=t:void 0},get:function(e,t,i){return Ie(e.split("."),t,i)},exists:function(e,t){return void 0!==this.get(e,!1,t)}};function Ie(e,t,i){for(var n,r=i||data,s=0;r&&(n=e[s]);s++)r=n in r?r[n]:t?r[n]={}:void 0;return r}var Oe={wirewax:{adtnlscrpts:[{src:"//edge-player.wirewax.com/ww4release/javascripts/wirewax-iframe-api.js",clbk:function(){try{for(var e in this.adUnit.unsubscribe(this.vpaidEvents.AdImpression,"*"),this.adUnit.unsubscribe(this.vpaidEvents.AdVideoComplete,"*"),this.adUnit._iframe.contentWindow.wirewax.events.listeners)this.adUnit._iframe.contentWindow.wirewax.addEventListener(this.adUnit._iframe.contentWindow.wirewax.events.listeners[e],this.onIframeEvent)}catch(e){}}}],ifrmevts:{playerReady:"AdImpression",videoEnd:"AdVideoComplete"},hdtrgt:!0,wtfradpsdbfrrsmad:!0,prvnterlyadimpopp:!0,onrsm:function(){this.adUnit._iframe.contentWindow.wirewax.playerId="wirewax-ad-iframe",this.adUnit._iframe.contentWindow.wirewax.triggerEvent(this.adUnit._iframe.contentWindow.wirewax.events.triggers.CLOSE_WIDGET)}},"the trade desk":{extwnprc:!0,wnprcfld:"wp",pvpdJs:!0},dbm:{extwnprc:!0,wnprcfld:"pr"},doubleVerify:{pvpdJs:!0,pvpdJsUrl:"doubleverify"},moat:{pvpdJs:!0,pvpdJsUrl:"moatads"},ias_ad:{pvpdJs:!0}};function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==De(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==De(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===De(e)?e:String(e)}(n.key),n)}}var Me=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.store=e,this._loadDSM()}var e,i,n;return e=t,(i=[{key:"_loadDSM",value:function(){this.stopped||this.store.set("dsm",Oe)}},{key:"destroy",value:function(){this.stopped||(this.stopped=!0,this.store=void 0)}}])&&xe(e.prototype,i),n&&xe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),y=e(2);function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Re(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Re(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Re(e)?e:String(e)}(n.key),n)}}var Fe=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.store=e,this.fireLowNetworkDownlinkPixel=$(parseInt(this.store.get("frdwnlnkpxls"))),this.effectiveTypes={"slow-2g":1,"2g":2,"3g":3,"4g":4},this.types={bluetooth:1,cellular:2,ethernet:3,none:4,wifi:5,wimax:6,other:7,unknown:8},this.navigatorConnection={},this._detectConnectionType()}var e,i,n;return e=t,(i=[{key:"_detectConnectionType",value:function(){var n=this,e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?(e.onchange=function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t=e.effectiveType||"",i=e.type||"";n.navigatorConnection={browserSupport:!0,downlink:e.downlink||0,effectiveType:t,type:i,effectiveTypeId:n.effectiveTypes.hasOwnProperty(t)?n.effectiveTypes[t]:0,typeId:n.types.hasOwnProperty(i)?n.types[i]:0,rtt:e.rtt||0,saveData:e.saveData||!1},n.store.set("navigatorConnection",n.navigatorConnection),n.store.emit("navigatorConnectionChange",n.navigatorConnection),n._sendPixelIfDownlinkLow()})():(this.navigatorConnection={browserSupport:!1},this.store.set("navigatorConnection",this.navigatorConnection))}},{key:"_sendPixelIfDownlinkLow",value:function(){var e;this.fireLowNetworkDownlinkPixel&&this.navigatorConnection&&void 0!==(e=this.navigatorConnection.downlink)&&e<this.store.get("dwnlnktrshld")&&h(u(y.lowNetworkDownlink,this.store))}}])&&Le(e.prototype,i),n&&Le(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Be(e){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t,i){(t=function(e){e=function(e,t){if("object"!==Be(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Be(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Be(e)?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}var p="iOS",We="Android",Ue="Fire OS",Ne="Firefox",He="Safari",qe="IE",ze="Edge",Qe=(je(t={},We,(je(i={"Chrome Mobile":53,Chromium:53,"Firefox Mobile":49,"Firefox Focus":49,Android:7,"Android Webkit":7,"Amazon Silk Browser":71,"Facebook on Android":void 0,"Opera Mobile":void 0,"Opera Mini":void 0,"MIUI Browser":void 0,"Yandex browser":void 0,"UC Browser":void 0,"Samsung Browser":void 0},ze,void 0),je(i,"Opera",void 0),i)),je(t,p,{"Firefox on iOS":7}),je(t,Ue,{"Amazon Silk Browser":71}),t);function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Ge(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Ge(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Ge(e)?e:String(e)}(n.key),n)}}var Je=function(){function i(e){var t=this;if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.store=e,this.browser=this.store.get("wurfl.browser.name"),this.browserMajorVersion=this.store.get("wurfl.browser.version"),this._detectPrivateMode(function(e){t.store.set("isPrivateBrowsing",void 0===e?"cannot detect":e?"private":"not private")})}var e,t,n;return e=i,(t=[{key:"_detectPrivateMode",value:function(t){var i,n;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){i=!1},function(e){i=!0});else if(window.indexedDB&&this.browser===Ne){try{n=window.indexedDB.open("test")}catch(e){i=!0}void 0===i&&this._retry(function(){return"done"===n.readyState},function(e){e||(i=!n.result)})}else if(this._isIE10OrLater()){i=!1;try{window.indexedDB||(i=!0)}catch(e){i=!0}}else if(this.browser===He)if(this.browserMajorVersion<11)try{i=(localStorage.length||(localStorage.x=1,localStorage.removeItem("x")),!1)}catch(e){i=!!navigator.cookieEnabled}else try{window.openDatabase(null,null,null,null),i=!1}catch(e){i=!0}this._retry(function(){return void 0!==i},function(e){t(i)})}},{key:"_isIE10OrLater",value:function(){return this.browser===qe&&10<=this.browserMajorVersion||this.browser===ze}},{key:"_retry",value:function(e,t){var i=0,n=!1,r=window.setInterval(function(){e()&&(window.clearInterval(r),t(n)),50<i++&&(window.clearInterval(r),t(n=!0))},10)}}])&&Ke(e.prototype,t),n&&Ke(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(),Xe={1:"dialup",2:"wired",3:"wifi",4:"mobile",5:"satellite"};function Ye(e,t,i,n,r,s,o,a,d,l){var f=6<arguments.length&&void 0!==o&&o,o=7<arguments.length&&void 0!==a?a:5e3,v=8<arguments.length&&void 0!==d?d:"application/x-www-form-urlencoded",m=!(!(9<arguments.length&&void 0!==l)||l),y=[];function g(d,l,u,c,h,e,p){var t,i;d&&(l=l||"",t=new XMLHttpRequest,i=l?"POST":"GET",t.open(i,d,!0),!(t.withCredentials=!0)===e&&(t.withCredentials=!1),t.setRequestHeader("Content-type",v),t.async=null==h||h,t.callback="function"==typeof u?u:function(){},t.fallback="function"==typeof c?c:function(){},t.timeout=p,t.gotResponse=!1,t.addEventListener("error",function(e){this.gotResponse||(this.gotResponse=!0,t.fallback())}),t.addEventListener("load",function(e){this.gotResponse||(this.gotResponse=!0,t.fallback())}),t.addEventListener("abort",function(e){this.gotResponse||(this.gotResponse=!0,t.fallback())}),t.addEventListener("timeout",function(e){this.gotResponse||(this.gotResponse=!0,t.fallback())}),t.addEventListener("readystatechange",function(e){if(4==this.readyState&&!this.gotResponse)switch(this.gotResponse=!0,this.status+""){case"200":case"204":case"460":this.callback(this.responseText,y,d);break;default:var t,i,n,r,s,o,a;if(!m)return y.push(this.status),t=d,i=l,n=u,r=c,s=h,o=p,a=this.status,m=!0,f&&(t+="".concat(-1<t.indexOf("?")?"&":"?","rt=1&prst=").concat(a||"")),void g(t,i,n,r,s,!1,o);y.push(this.status),this.fallback(y,d)}}),t.send(l))}g(e,t,i,n,r,s,o)}function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==$e(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==$e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===$e(e)?e:String(e)}(n.key),n)}}var et=function(){function i(e,t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.store=e,this.debugTracker=new o("OpportunityAggregator"),this.opps=[];e=this.store.get("non_bllb_opps_base_path")||this.store.get("opps_base_path")||t.CM_DOMAIN,this.url=ae(e)+(/.*\/$/g.test(e)?"":"/")+"OpportunityServlet",this.postHeaders=this.store.get("psthdrs")||"application/json",this.onFail=this._onFail.bind(this),this.onSuccess=this._onSuccess.bind(this),t=this._sendTicker.bind(this);setInterval(t,this.store.get("timbtopps")),this.store.on("sendOpps",t),this.store.on("beforeunload",t)}var e,t,n;return e=i,(t=[{key:"send",value:function(e){this.opps.push(e)}},{key:"_sendTicker",value:function(){0<this.opps.length&&Ye(this.url,m(this.opps),this.onSuccess,this.onFail,void 0,!1,!1,5e3,this.postHeaders,!1),this.opps=[]}},{key:"_onSuccess",value:function(e){}},{key:"_onFail",value:function(e){this.debugTracker.warn("Error Firing Opps",e)}}])&&Ze(e.prototype,t),n&&Ze(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(),i=e(0),f=e.n(i),t=e(9),tt=e.n(t),i=e(1),v=e.n(i);function it(e){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==it(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==it(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===it(e)?e:String(e)}(n.key),n)}}var rt=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.store=e,this.event="queueStatusChanged",this.backfillPriority=this.store.get("mxbckflldlyitms")?this.store.get("bfprty"):void 0,this.previousQueue=[],this._initQueueStatus()}var e,i,n;return e=t,(i=[{key:"_initQueueStatus",value:function(){this.queueStatus={requiredViewabilityCount:0,nonRVCount:0,adLoadedCount:0,adxCard:!1,size:0,singleAd:!1,items:[],previousQueue:[],adjacencyAd:!1}}},{key:"onItemRemovedFromQueue",value:function(e){var t=this._getItemFromQueue(e);t&&((t=Object.assign({},t)).vw=e.vpaidWrapper?e.vpaidWrapper.getVpaidStatus():{},this.previousQueue.push(Object.assign({},t)))}},{key:"_getItemFromQueue",value:function(e){for(var t=0;t<this.queueStatus.items.length;t++){var i=this.queueStatus.items[t];if(e.wfIndex===i.seq&&parseInt(e.waterfallTagId)===i.wti)return i}return!1}},{key:"onScheduleChange",value:function(e,t,i){this._initQueueStatus(),this.queueStatus.size=e.length,this.queueStatus.adxCard=t,this.queueStatus.previousQueue=this.previousQueue;for(var n=0;n<e.length;n++){var r=e[n];r.requiredViewability?this.queueStatus.requiredViewabilityCount++:this.queueStatus.nonRVCount++,r.vpaidWrapper.adLoadedFired&&this.queueStatus.adLoadedCount++,r.singleAd&&(this.queueStatus.singleAd=!0),r.adjacencyAd&&(this.queueStatus.adjacencyAd=!0),this.queueStatus.items.push(this._getItemStatus(r))}this.emit(i)}},{key:"_getItemStatus",value:function(e){return{aid:e.advId,bf:e.priority===this.backfillPriority,br:e.brand,cmpid:e.campaignId,crid:e.creativeId,cstmdl:e.cstmdl,dp:e.dp,t:e.itemType,li:e.lineItemId,pid:e.pubId,rv:e.requiredViewability,pr:e.vpaidWrapper?e.vpaidWrapper.getPrice(!0):"",sa:e.singleAd,seq:e.wfIndex,wti:parseInt(e.waterfallTagId),vw:e.vpaidWrapper?e.vpaidWrapper.getVpaidStatus():{},mt:e.vpaidWrapper?e.vpaidWrapper.type:"",ves:e.vpaidWrapper?e.vpaidWrapper.earlySrcVPAID:void 0,adjc:e.adjacencyAd,hip:!!e.hip,alwsldr:1===e.alwsldr}}},{key:"emit",value:function(e){this.store.emit(e||this.event,this.queueStatus)}}])&&nt(e.prototype,i),n&&nt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ot(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==st(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==st(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===st(e)?e:String(e)}(n.key),n)}}var at=null,dt=function(){function s(e){if(!(this instanceof s))throw new TypeError("Cannot call a class as a function");if(!at){this.costModels={};var t,i=e.get("cpcvcmpgntps"),n=e.get("cstmdltps");for(t in n){var r=n[t];this.costModels[r]={costModel:r,type:t,isCPCV:-1<i.indexOf(r)}}at=this}return at}var e,t,i;return e=s,(t=[{key:"isCPCV",value:function(e){return this.costModels.hasOwnProperty(e)&&this.costModels[e].isCPCV}}])&&ot(e.prototype,t),i&&ot(e,i),Object.defineProperty(e,"prototype",{writable:!1}),s}(),g=e(6);function lt(e){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==lt(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==lt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===lt(e)?e:String(e)}(n.key),n)}}function ct(e,t,i,n,r){var s,o,a=document.createElement("script"),d=[];t={adData:{ids:t,duration:i,url:r},dispatchEvent:function(e){this.sendEvent?(d&&(d.push(e),e=d,d=!1),this.sendEvent(e)):d.push(e)}},i="_moatApi"+Math.floor(1e8*Math.random());try{o=(s=e.ownerDocument).defaultView||s.parentWindow}catch(e){s=document,o=window}return o[i]=t,a.type="text/javascript",e&&e.insertBefore(a,e.childNodes[0]||null),a.src="https://z.moatads.com/"+n+"/moatvideo.js#"+i,t}var ht=function(){function i(e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.options=e,this.moatAbTest=this.options.tag.getValueByKey("mttst"),this.moatAbTest&&(this.moatAbTest+="_"),this.moatAbTest="".concat(this.moatAbTest).concat(this.options.store.get("unit_type")||"").concat(this.options.store.get("isMobile")?"_Mobile":"");var e=this._createLevels(),t=this.options.moatTag?new Function(this.options.moatTag):ct;this.moatApiReference=t(this.options.container||document.body,e,this.options.duration||0,this.options.moatPartnerCode,this.options.url),c(this.options.vpaidLog,"moatTracker",{}),this.debugTracker=this.options.debugTracker,this.events=[f.a.AdLoaded,f.a.AdStarted,f.a.AdImpression,f.a.AdVideoStart,f.a.AdClickThru,f.a.AdStopped,f.a.AdPlaying,f.a.AdPaused,f.a.AdVideoFirstQuartile,f.a.AdVideoMidpoint,f.a.AdVideoThirdQuartile,f.a.AdVideoComplete,f.a.AdVolumeChange],this.stopped=!1}var e,t,n;return e=i,(t=[{key:"_createLevels",value:function(){if(this.options.moatTag)return{};if(!this.options.tag)return{level1:"",level2:"",level3:"",level4:"",slicer1:"",slicer2:""};this._convertOppFieldsToZMoat();var e={level1:this.moatAbTest,level2:this.options.tag.advId,level3:this.options.tag.lineItemId,level4:this.options.store.get("domain")||"",slicer1:this.options.url,slicer2:this.options.tag.tagId,zMoataucdast:this.options.store.get("auc_dast"),zMoatdast:this.options.tag.vidDast,zMoatabt:"".concat(this.options.store.get("ab_test")).concat(ie(this.options.tag,this.options.store)),zMoatpdast:this.options.playerDast,zMoatframetype:this.options.store.get("frameType"),zMoatsubunittypeid:this.options.store.get("subUnitType"),zMoatos:+this.options.tag.waterfallTagId+1,zMoatrv:this.options.tag.requiredViewability},e=Object.assign(e,this.options.zMoat),t=this.options.store.get("dast");return t.hasOwnProperty("cisid")&&(e.zMoatimprid=t.cisid),e}},{key:"_convertOppFieldsToZMoat",value:function(){for(var e in this.options.zMoat)this.options.zMoat["".concat("zMoat").concat(e.replace("-","").replace("_",""))]=this.options.zMoat[e],delete this.options.zMoat[e]}},{key:"dispatch",value:function(e){this.stopped||-1<this.events.indexOf(e.type)&&(this.moatApiReference.dispatchEvent(e),this.debugTracker.info("Moat dispatching event:".concat(e.type),e))}},{key:"dispose",value:function(){this.stopped=!0,this.moatApiReference=this.events=this.options=void 0}}])&&ut(e.prototype,t),n&&ut(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(),t=e(12),pt=e.n(t);function ft(e){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==ft(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==ft(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===ft(e)?e:String(e)}(n.key),n)}}var mt=e(7),yt="show",gt="hide",bt=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");mt.mixin(this),this.store=e.store,this.video=e.video,this.target=e.video.parentElement||e.target,this.disclosureText=this.store.get("disctxt"),this.defaultVolume=this.store.get("dfltvlm"),this.showAdMuteButton=this.store.get("shwadmtebtn"),this.hideProgressBar=this.store.get("hdprgrsbr"),this.canOptOut=this.store.get("can_opt_out"),this.showAdsPlayPauseButton=this.store.get("shwadsplypusbtn"),this.disableProgressBarClicks=this.store.get("disprgrbrclk"),this.initProgressBarBackground=!1,this.eventsToEmitOnce=[],this.state={},this.vpaidHandler=e.handler,this._initElements(),this._setInitialState()}var e,i,n;return e=t,(i=[{key:"_initElements",value:function(){}},{key:"_setInitialState",value:function(){var e={volume:0,adDuration:0,adCurrentTime:0,adLastTickTime:0,isMuted:0===this.store.get("volume")||this.isMobile,isPaused:!1,vidDuration:30,vidCurrentTime:0,isVisible:!1};this.setState(e)}},{key:"setState",value:function(e){!this.stopped&&e&&0!==Object.keys(e).length&&(this.state=Object.assign(this.state,e),this._render())}},{key:"getFromState",value:function(e){return null!=(e=this.state[e])?e:void 0}},{key:"_stopPropagation",value:function(e){e.stopPropagation()}},{key:"_setSoundButtonDisplay",value:function(){var e=this;requestAnimationFrame(function(){e.stopped||(d(e.soundElement,gt),d(e.soundElement,yt),a(e.soundElement,e.showAdMuteButton?yt:gt))})}},{key:"_setPlayPauseButton",value:function(){var e=this;requestAnimationFrame(function(){e.stopped||e.showAdsPlayPauseButton!==yt&&e.playPauseArea.classList.add(gt)})}},{key:"_render",value:function(){this._renderVolumeControls(),this._renderProgressBar(),this._renderControlsVisibility(),this._renderSoundButton(),this._renderPlayPause()}},{key:"_renderVolumeControls",value:function(){this._onVolumeChange(),this._triggerVolumeChangeOnVpaid(),this._onSoundChangeCallback&&this._onSoundChangeCallback()}},{key:"_onVolumeChange",value:function(){this.state.isMuted?this._mute():this._unmute()}},{key:"_mute",value:function(){this.state.volume=0}},{key:"_unmute",value:function(){this.state.volume=this.defaultVolume}},{key:"_triggerVolumeChangeOnVpaid",value:function(){this.emit(b.VOLUME_CHANGE,this.state.volume,!0)}},{key:"setOnSoundChangeCallback",value:function(e){this._onSoundChangeCallback=e}},{key:"_renderProgressBar",value:function(){this.state.preventAdTicker?this._emitOnce(b.TIMEUPDATE_REGISTER):(this.adStartTime=Date.now(),this.adTickerId||(this.adTickerId=setInterval(this._onAdTicks.bind(this),250))),this._advanceProgressBar()}},{key:"_emitOnce",value:function(e){-1<this.eventsToEmitOnce.indexOf(e)||(this.eventsToEmitOnce.push(e),this.emit(e))}},{key:"_onAdTicks",value:function(){var e,t;this.stopped||(e=Date.now(),t={},this.state.isPaused?0!=this.state.adLastTickTime&&(this.adStartTime+=e-this.state.adLastTickTime):(t.adCurrentTime=(e-this.adStartTime)/1e3,t.adCurrentTime>this.state.adDuration&&(t.adCurrentTime=0<this.adStartTime?this.state.adDuration:0),t.vidDuration=t.adDuration,t.vidCurrentTime=t.adCurrentTime),t.adLastTickTime=e,this.setState(t))}},{key:"_advanceProgressBar",value:function(){var i=this;requestAnimationFrame(function(){var e,t;i.stopped||(e=100-(i.state.vidDuration-i.state.vidCurrentTime)/i.state.vidDuration*100,t="".concat(e,"%"),i.progressBarPercentager.style.width!==t&&(i._initializeProgressBarIfNeeded(e),i.progressBarPercentager.style.width=t))})}},{key:"_initializeProgressBarIfNeeded",value:function(e){var t=parseInt(this.progressBarPercentager.style.width);isNaN(t)||parseInt(e)<t?this.initProgressBarBackground||(this.initProgressBarBackground=!0,a(this.progressBarPercentager,"init_bg")):this.initProgressBarBackground&&(this.initProgressBarBackground=!1,d(this.progressBarPercentager,"init_bg"))}},{key:"_renderControlsVisibility",value:function(){var i=this;requestAnimationFrame(function(){var e,t;i.stopped||(t=i.state.isVisible?(e=gt,yt):(e=yt,gt),d(i.element,e),a(i.element,t))})}},{key:"_onPlayPauseClicked",value:function(e){var t;this.video&&((t=this.state.isPaused)?this.vpaidHandler.resumeAd():this.vpaidHandler.pauseAd(),this.setState({isPaused:!t}),this._stopPropagation(e))}},{key:"resetAdControls",value:function(){}},{key:"destroy",value:function(){}},{key:"_renderSoundButton",value:function(){}},{key:"_renderPlayPause",value:function(){}}])&&vt(e.prototype,i),n&&vt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),b={VOLUME_CHANGE:"volumeChange",TIMEUPDATE_REGISTER:"timeupdateRegister",GET_AD_DURATION:"getAdDuration",RESET_CONTROLS:"resetControls"};function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==_t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==_t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===_t(e)?e:String(e)}(n.key),n)}}function wt(e,t){return(wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function At(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=Tt(i),t=(e=n?(e=Tt(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===_t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Et=function(){var e=r,t=bt;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wt(e,t);var i,n=At(r);function r(e){if(this instanceof r)return n.call(this,e);throw new TypeError("Cannot call a class as a function")}return e=r,(t=[{key:"_initElements",value:function(){this._renderElements(),this.mainArea=this.element.children[0],this.optOutElement=this.mainArea.children[0],this.progressBarArea=this.mainArea.children[1],this.progressBarBackground=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1],this.soundElement=this.mainArea.children[2],this.playPauseArea=this.mainArea.children[3],this.pauseBtn=this.playPauseArea.children[0],this.playBtn=this.playPauseArea.children[1],this._setProgressBarClickAbility(),this._setSoundButtonDisplay(),this._setPlayPauseButton(),this._addEventListeners(),this._hideProgressBarIfNeeded(),this._hideOptOutIfNeeded()}},{key:"_hideProgressBarIfNeeded",value:function(){this.hideProgressBar&&this.progressBarArea&&(this.progressBarArea.style.display="none")}},{key:"_hideOptOutIfNeeded",value:function(){this.canOptOut||a(this.optOutElement,"opt-out-hidden")}},{key:"_renderElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls hide",this.element.innerHTML="<div class='video_controls video_controls_main_area'>\n                <div class='title text'>".concat(this.disclosureText,"</div>\n                <div class='cm_video_controls_progressbar_area'>\n                    <div class='cm_video_controls_progressbar_bg white_bg'></div>\n                    <div class='cm_video_controls_progressbar blue_bg'></div>\n                </div>\n                <div class='cm_video_controls_mute interactive display_mute'></div>\n                <div class='cm_video_controls_playpause interactive'>\n                    <div class='pause hide'></div>\n                    <div class='play hide'></div>\n                </div>\n            </div>"),this.target.appendChild(this.element)}},{key:"_addEventListeners",value:function(){this.element.addEventListener("click",this._stopPropagation),this._bindedOnMuteClicked=this._onMuteClicked.bind(this),this.soundElement.addEventListener("click",this._bindedOnMuteClicked),this._bindedOnPlayPauseClicked=this._onPlayPauseClicked.bind(this),this.playBtn.addEventListener("click",this._bindedOnPlayPauseClicked),this.pauseBtn.addEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_onMuteClicked",value:function(e){var t;this.showAdMuteButton&&(0===this.state.volume&&this.emit(b.VOLUME_CHANGE,this.defaultVolume,!0),t={},this.store.set("forceMute",!this.state.isMuted),t.volume=this.state.isMuted?this.defaultVolume:0,t.isMuted=0===t.volume,this.setState(t),this._stopPropagation(e))}},{key:"resetAdControls",value:function(){this.emit(b.RESET_CONTROLS)}},{key:"_renderSoundButton",value:function(){this.state.isMuted?(d(this.soundElement,"display_unmute"),a(this.soundElement,"display_mute")):(d(this.soundElement,"display_mute"),a(this.soundElement,"display_unmute"))}},{key:"_renderPlayPause",value:function(){var e=this.state.isPaused?this.playBtn:this.pauseBtn,t=this.state.isPaused?this.pauseBtn:this.playBtn;t.classList.remove(yt),t.classList.add(gt),e.classList.remove(gt),e.classList.add(yt)}},{key:"destroy",value:function(){this.stopped=!0,this.adTickerId=clearInterval(this.adTickerId),this.element.removeEventListener("click",this._stopPropagation),this.soundElement.removeEventListener("click",this._bindedOnMuteClicked),this._bindedOnMuteClicked=this.mainArea=this.optOutElement=this.progressBarArea=this.progressBarBackground=this.progressBarPercentager=this.soundElement=void 0}},{key:"_setProgressBarClickAbility",value:function(){this.disableProgressBarClicks&&this.progressBarArea.classList.add("interactive")}}])&&kt(e.prototype,t),i&&kt(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function St(e){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==St(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==St(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===St(e)?e:String(e)}(n.key),n)}}function Vt(e,t){return(Vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Ct(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=It(i),t=(e=n?(e=It(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===St(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function It(e){return(It=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ot=function(){var e=r,t=bt;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vt(e,t);var i,n=Ct(r);function r(e){if(this instanceof r)return n.call(this,e);throw new TypeError("Cannot call a class as a function")}return e=r,(t=[{key:"_initElements",value:function(){this._renderElements(),this.playPauseArea=this.element.children[0],this.soundElement=this.element.children[1],this.progressBarArea=this.element.children[2],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1],this._setProgressBarClickAbility(),this._setSoundButtonDisplay(),this._setPlayPauseButton(),this._addEventListeners()}},{key:"_renderElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls_mobile",this.element.innerHTML='<div class="mc-pause" style="pointer-events: all;"></div>\n            <div class="speaker mute" style="pointer-events: all;"></div>\n            <div class="mc-progressbar_area">\n                <div class=\'mc-progressbar_bg white_bg\'></div>\n                <div class=\'mc-progressbar_bg blue_bg\'></div>\n            </div>\n            <div class="tbl-text">'.concat(this.disclosureText,"</div>"),this.target.appendChild(this.element)}},{key:"_addEventListeners",value:function(){this._bindedOnMuteClicked=this._onMuteClicked.bind(this),this.soundElement.addEventListener("click",this._bindedOnMuteClicked),this._bindedOnPlayPauseClicked=this._onPlayPauseClicked.bind(this),this.playPauseArea.addEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_onMuteClicked",value:function(e){this.showAdMuteButton&&(0===this.state.volume&&this.emit(b.VOLUME_CHANGE,this.defaultVolume,!0),this.video.muteButtonClicked&&this.video.muteButtonClicked(),this.setState({isMuted:!this.state.isMuted}),this._stopPropagation(e))}},{key:"_renderSoundButton",value:function(){var e=this;requestAnimationFrame(function(){e.stopped||(e.state.isMuted?a:d)(e.soundElement,"mute")})}},{key:"_renderPlayPause",value:function(){var e=this;requestAnimationFrame(function(){e.state.isPaused?(d(e.playPauseArea,"mc-pause"),a(e.playPauseArea,"mc-play")):(d(e.playPauseArea,"mc-play"),a(e.playPauseArea,"mc-pause"))})}},{key:"destroy",value:function(){this.stopped=!0,this.adTickerId=clearInterval(this.adTickerId),this.soundElement.removeEventListener("click",this._bindedOnMuteClicked),this._bindedOnMuteClicked=this.soundElement=this.progressBarArea=this.progressBarBg=this.progressBarPercentager=void 0}},{key:"_setProgressBarClickAbility",value:function(){this.disableProgressBarClicks&&(this.progressBarArea.style="pointer-events: all;")}}])&&Pt(e.prototype,t),i&&Pt(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}(),Dt=function(e,t){return new(e?Ot:Et)(t)};function xt(e){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==xt(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==xt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===xt(e)?e:String(e)}(n.key),n)}}var Rt={vastDuration:"vdr",videoElementDuration:"edr",vastWidth:"vwd",videoElementWidth:"ewd",vastHeight:"vht",videoElementHeight:"eht",vastBitrate:"vbr",videoElementUrl:"vu",videoElementType:"vt",vastOriginalType:"ot",vastSubType:"st",effectiveConnectionType:"ect",connectionType:"ct",vasts:"vst",videoUrlChanged:"vuc",winningPrice:"wp",vpaidUrl:"vpu"},Lt=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.store=e,this.hadImpression=!1,this.onNavigatorConnectionChange=this._onNavigatorConnectionChange.bind(this),this.store.on("navigatorConnectionChange",this.onNavigatorConnectionChange);e=this.store.get("navigatorConnection")||{};this.dast={vdr:void 0,edr:void 0,vwd:void 0,ewd:void 0,vht:void 0,eht:void 0,vbr:void 0,vu:void 0,vt:void 0,ot:void 0,st:void 0,ect:e.effectiveTypeId,ct:e.typeId,vst:[],vuc:!1,wp:void 0}}var e,i,n;return e=t,(i=[{key:"set",value:function(e){this.stopped||(e.hasOwnProperty("vu")&&""!==e.vu&&(e.vt=this._getVideoTypeFromUrl(e.vu),this.hadImpression)&&e.vu!==this.dast.vu&&(this.dast.vuc=!0),this.dast=Object.assign(this.dast,e))}},{key:"_getVideoTypeFromUrl",value:function(e){var t=void 0,e=e.match(/\.([^\/#?]+)([#?][^\/]*)?$/);return t=e&&1<e.length?e[1]:t}},{key:"addWrapper",value:function(e){this.stopped||(e.hasOwnProperty("wu")&&""!==e.wu&&(e.wu=this._getHostnameFromWrapperUrl(e.wu)),this.dast.vst.push(e))}},{key:"_getHostnameFromWrapperUrl",value:function(e){var t=document.createElement("a");return t.href=e,e=t.hostname,t=null,e}},{key:"_onNavigatorConnectionChange",value:function(e){this.stopped||(this.dast.ect=e.effectiveTypeId,this.dast.ct=e.typeId)}},{key:"get",value:function(){if(!this.stopped)return ye(this.dast)}},{key:"getByKey",value:function(e){return this.dast[Rt[e]||e]}},{key:"destroy",value:function(){this.stopped=!0,this.store.off("navigatorConnectionChange",this.onNavigatorConnectionChange),this.store=this.onNavigatorConnectionChange=this.dast=void 0}},{key:"onImpression",value:function(){this.hadImpression=!0}},{key:"getWrappers",value:function(){return this.dast.vst}}])&&Mt(e.prototype,i),n&&Mt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),i=e(10),Ft=e.n(i),_={VPAID:"javascript",VIDEO:"video"};function Bt(e){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Bt(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Bt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Bt(e)?e:String(e)}(n.key),n)}}var Wt=e(7),Ut=function(){function n(e,t,i){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");Wt.mixin(this),this.watchVideoInterval=i.get("wtchvdointrvl"),this.unitPredictorsInterval=i.get("rprtvidsttsintrvl"),this.newCompletionByVideoProgress=i.get("q5byprgrss"),this.isMobile=i.get("isMobile")||!1,this.timeoutLengthToAdCompletion=e.tag.getValueByKey("".concat(this.isMobile?"mbl":"dsk","tmouttoadcmpltn")),this.newCompletionByVideoProgressFired=!1,this.reportWatchTimeInterval=e.tag.getValueByKey("wtchprgrssopp"),this.isDirectDemand=e.tag.isDirectDemand,this.bufferingEventsToReport=e.tag.getValueByKey("rprtbuffrng"),this.bufferingDetected=!1,this.lastPlayPos=0,this.bufferingCounter=0,this.wrapperIndex=e.wrapperIndex,this.debugTracker=e.debugTracker,this.stopped=!1,this.frameType=i.get("frameType"),this.maxDurationLimit=i.get("prftchmxlngth"),this.viewabilityCalcFallbackEnabled=e.tag.getValueByKey("vwclcflbkenbld")}var e,t,i;return e=n,(t=[{key:"prefetchVideo",value:function(e,t){var i=this;e===_.VPAID||e===_.VIDEO&&this.isIOS?this.video.addEventListener("loadedmetadata",function(){return i._onPrefetchVideoMetaData(t)}):(this.video.buffering=!0,this.playPromise=this.video.play(),null!=this.playPromise&&(this.playPromise=ke(this.playPromise),this.debugTracker.info("Vpaid.video.play()"),this.playPromise.catch(function(e){i.stopped||i.debugTracker&&i.debugTracker.info("buffering video error:".concat(e))})))}},{key:"_onPrefetchVideoMetaData",value:function(e){this.video.duration<this.maxDurationLimit&&this._prefetchOverTempVideo(e)}},{key:"_prefetchOverTempVideo",value:function(e){var t,i=this;this.debugTracker.info("Vpaid._prefetchOverTempVideo()"),0!==this.frameType&&1!==this.frameType||(t=function(){var e=window;try{for(;e.document!==e.top.document;)e=e.top;return e}catch(e){return window}}())&&t.document&&t.document.body&&(this._createBufferingVideo(t,e),this.fakePlayPromise=this.bufferingVideo.play(),null!=this.fakePlayPromise)&&(this.fakePlayPromise=ke(this.fakePlayPromise),this.fakePlayPromise.catch(function(e){i.stopped||i.debugTracker&&i.debugTracker.info("buffering video error:".concat(e))}))}},{key:"_createBufferingVideo",value:function(e,t){this.bufferingVideo=e.document.createElement("video"),this.bufferingVideo.id="prefetchWrapper".concat(this.wrapperIndex),this.bufferingVideo.src=t||this.playingMediaFile.mediaUrl,this.bufferingVideo.muted=!0,this.bufferingVideo.setAttribute("muted",""),this.bufferingVideo.setAttribute("playsinline",""),a(this.bufferingVideo,"buff-vid"),this.bufferingVideo.style.top="".concat(+this.wrapperIndex,"px"),e.document.body.appendChild(this.bufferingVideo)}},{key:"pausePrefetchVideo",value:function(){this.bufferingVideo&&(this.bufferingVideo.pause(),this.debugTracker.info("Vpaid.pausePrefetchVideo()"))}},{key:"_destroyPrefetchVideo",value:function(){this.bufferingVideo&&this.bufferingVideo.parentElement&&(this.bufferingVideo.pause(),this.bufferingVideo.removeAttribute("src"),this.bufferingVideo.load(),this.bufferingVideo.parentElement.removeChild(this.bufferingVideo),this.debugTracker.info("Vpaid._destroyPrefetchVideo()"))}},{key:"resumeAd",value:function(){this.stopped||(this.activeVideoElement&&this.watchVideoInterval&&this.activeVideoElement.duration?(this._emitCurrentTime(this.activeVideoElement.currentTime,this.activeVideoElement.duration),this.watchActiveVideoElement(),this._checkVideoProgress()):this._manuallyReportTimeProgress())}},{key:"_checkVideoProgress",value:function(){var e=this;setTimeout(function(){e.stopped||!e.activeVideoElement&&0!==e.activeVideoElement.currentTime||(e.manualCurrentVideoTime||(e.manualCurrentVideoTime=.05,e._emitCurrentTime(e.manualCurrentVideoTime)),e._manuallyReportTimeProgress())},50)}},{key:"_manuallyReportTimeProgress",value:function(){var e=this;this.stopped||!this.viewabilityCalcFallbackEnabled||this.manualTimeReportingInterval||(void 0===this.manualCurrentVideoTime&&(this.manualCurrentVideoTime=0,this._emitCurrentTime(this.manualCurrentVideoTime)),this.manualTimeReportingInterval=setInterval(function(){e.stopped||(e._emitCurrentTime(e.manualCurrentVideoTime),e.manualCurrentVideoTime+=.05)},50))}},{key:"_emitCurrentTime",value:function(e,t){e={currentTime:e.toFixed(3)};t&&(e.duration=t.toFixed(3)),this.emit("activeAdCurrentTime",e)}},{key:"pauseAd",value:function(){this.activeVideoElement&&this.watchVideoInterval?this.unwatchActiveVideoElement():this._stopManualTimeReportingInterval()}},{key:"stopAd",value:function(){this.stopped||(this.debugTracker.info("Vpaid -> stopAd()"),this.activeVideoElement&&this.watchVideoInterval&&this.unwatchActiveVideoElement(),this._stopManualTimeReportingInterval(),this.bufferingVideo&&(this.debugTracker.info("Vpaid -> stopAd() -> _destroyPrefetchVideo()"),this._destroyPrefetchVideo()))}},{key:"_fireAdImpression",value:function(){this._onAdImpression()}},{key:"_onAdImpression",value:function(){this.stopped||(this.activeVideoElement=this.getActiveVideoElement())}},{key:"watchActiveVideoElement",value:function(){this._sampleVideoCurrentTimeIntervalId||(this._sampleVideoCurrentTimeIntervalId=setInterval(this._sampleVideoCurrentTimeHandler.bind(this),50))}},{key:"unwatchActiveVideoElement",value:function(){this._sampleVideoCurrentTimeIntervalId&&(clearInterval(this._sampleVideoCurrentTimeIntervalId),this._sampleVideoCurrentTimeIntervalId=void 0)}},{key:"_sampleVideoCurrentTimeHandler",value:function(){this.reportCurrentTimeToUnitPredictors(),this.testNewCompletion(),this.reportWatchTime(),this.checkBuffering()}},{key:"reportCurrentTimeToUnitPredictors",value:function(){var e;this.unitPredictorsInterval&&this.activeVideoElement.currentTime&&this.activeVideoElement.duration&&(e=Math.floor(1e3*this.activeVideoElement.currentTime/this.unitPredictorsInterval))&&this._currentIntervalMultiplier!==e&&(this._currentIntervalMultiplier=e,this._emitCurrentTime(this.activeVideoElement.currentTime,this.activeVideoElement.duration))}},{key:"testNewCompletion",value:function(){this.newCompletionByVideoProgress&&!this.newCompletionByVideoProgressFired&&1e3*this.activeVideoElement.currentTime>this.timeoutLengthToAdCompletion&&(this.emit(g.outer.NewCompletion),this.newCompletionByVideoProgressFired=!0)}},{key:"checkBuffering",value:function(){var e;this.bufferingEventsToReport&&this.bufferingCounter<this.bufferingEventsToReport&&(e=this.activeVideoElement.currentTime,this.bufferingDetected?e>this.lastPlayPos+.03&&(this.bufferingDetected=!1,this.emit("bufferingEnded"),this.bufferingCounter++):e<this.lastPlayPos+.03&&(this.bufferingDetected=!0,this.emit("buffering")),this.lastPlayPos=e)}},{key:"reportWatchTime",value:function(){var e;this.reportWatchTimeInterval&&this.isDirectDemand&&0<(e=Math.floor(this.activeVideoElement.currentTime))&&this._currentTimeFloored!==e&&e%this.reportWatchTimeInterval==0&&(this._currentTimeFloored=e,this.emit("watchProgress",{currentTime:e}))}},{key:"getActiveVideoElementDuration",value:function(){return this.activeVideoElement?this.activeVideoElement.duration:null}},{key:"onComplete",value:function(){this._stopManualTimeReportingInterval(),this._destroyPrefetchVideo()}},{key:"_stopManualTimeReportingInterval",value:function(){this.manualTimeReportingInterval&&(this.manualTimeReportingInterval=clearInterval(this.manualTimeReportingInterval))}},{key:"reportBufferToDebugTracker",value:function(){this.bufferingVideo&&this.video&&this.video.buffered&&0<this.video.buffered.length&&this.video.buffered.end(0)&&this.debugTracker.info("startAd() - video currentTime:".concat(this.video.currentTime,"; buffered:").concat(0<this.video.buffered.length?this.video.buffered.end(0):0," sec"))}}])&&jt(e.prototype,t),i&&jt(e,i),Object.defineProperty(e,"prototype",{writable:!1}),n}();function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Nt(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Nt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Nt(e)?e:String(e)}(n.key),n)}}function qt(){return(qt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function zt(e,t){return(zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Qt(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=k(i),t=(e=n?(e=k(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===Nt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Gt=function(){var e=s,t=Ut;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zt(e,t);var i,r=Qt(s);function s(e,t,i){var n;if(this instanceof s)return(n=r.call(this,e,t,i)).vpaidLog=t,n.store=i,n.target=e.slot,n.video=e.videoSlot,n.mediaFiles=e.vpaidFiles,n.mediaFile,n.mediaUrl,n.playerWidth=0,n.playerhHeight=0,n.adVolume=0,n.skipTime=60,n.eventsToFire={adLoaded:!1,adImpression:!1},n.adPaused=!0,n.playerReady=!1,n.videoLength=0,n.vpaidEvents=Object.assign({},f.a),n._createBindedCallback(),n.playerDAST=e.playerDAST,n.tag=e.tag,0<e.trackingPixels.progress.length&&(n.progressEvents=e.trackingPixels.progress),n.store.on("stop",function(){n.stopAd()}),n.firstPauseAd=!0,n;throw new TypeError("Cannot call a class as a function")}return e=s,(t=[{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&void 0!==e&&this.off(t,e)}},{key:"handshakeVersion",value:function(){return"1.1"}},{key:"initAd",value:function(e,t,i){this.stopped||(this.resizeAd(e,t,i),this._prepareVideoTag())}},{key:"resizeAd",value:function(e,t,i,n){this.stopped||(this.playerWidth=parseInt(e),this.playerhHeight=parseInt(t),this.video.style.width=this.playerWidth+"px",this.target.style.width=this.playerWidth+"px",this.video.style.height=this.playerhHeight+"px",this.target.style.height=this.playerhHeight+"px",this.video.setAttribute("width",this.playerWidth),this.target.setAttribute("width",this.playerWidth),this.video.setAttribute("height",this.playerhHeight),this.target.setAttribute("height",this.playerhHeight),this._resizeAd(this.playerWidth,this.playerhHeight,i,n))}},{key:"startAd",value:function(){this._bindedOnPlay(),this.startAdFired=!0}},{key:"_onStartAd",value:function(){this.debugTracker.info("VideoVpaid -> startAd()"),this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> startad() -> _fireAdImpression()")}},{key:"pauseAd",value:function(){this.debugTracker.info("VideoVpaid -> pauseAd()"),qt(k(s.prototype),"pauseAd",this).call(this),this.stopped||(this.video.pause(),this.firstPauseAd&&(this.debugTracker.info("VideoVpaid -> pauseAd() - reset currentTime"),this.video.currentTime=0,this.firstPauseAd=!1,this.video.buffering=!1))}},{key:"resumeAd",value:function(){var e;qt(k(s.prototype),"resumeAd",this).call(this),this.stopped||(this._sendAdPlayingOnProgress=!0,this.video.play(),this.store.get("ads_started_fired"))||(e=new Event("AdResume"),dispatchEvent(e),this.emit(this.vpaidEvents.AdVideoResume))}},{key:"stopAd",value:function(){qt(k(s.prototype),"stopAd",this).call(this),this.stopped||(this.stopped=!0,this.video.destroy(),this._disconnectFromVideoTag(),this.vpaidLog=this.store=this.mediaFiles=this.target=this.video=this._onError=this.isReplayable=this.eventsToFire=this.progressEvents=void 0,setTimeout(this.onAfterStop,50))}},{key:"restartAd",value:function(){}},{key:"skipAd",value:function(){this.stopped||this.getAdSkippableState()&&(this.emit(this.vpaidEvents.AdSkipped),this.stopAd())}},{key:"expandAd",value:function(){}},{key:"collapseAd",value:function(){}},{key:"getAdVolume",value:function(e){e&&e(null,this.adVolume)}},{key:"getAdDuration",value:function(){return this.video&&this.video.duration||this.videoLength}},{key:"getAdSkippableState",value:function(){return 0==this.getAdSkippableRemainingTime()}},{key:"getAdSkippableRemainingTime",value:function(){var e=this.getAdRemainingTime()-this.skipTime;return 0<e?e:0}},{key:"getAdRemainingTime",value:function(){return this.stopped?0:this.video.remainingTime}},{key:"getAdWidth",value:function(){return this.video.videoWidth}},{key:"getAdHeight",value:function(){return this.video.videoHeight}},{key:"getAdIcons",value:function(){return[]}},{key:"getAdCompanions",value:function(){return[]}},{key:"getAdExpanded",value:function(){return!0}},{key:"getAdLinear",value:function(){return!0}},{key:"setAdVolume",value:function(e){this.stopped||(this.video.volume=this.adVolume=parseFloat(e)<=1?e:parseInt(e)/100,this.video.muted=0==e)}},{key:"_connectToVideoTag",value:function(){this.stopped||(this.video.addEventListener("canplay",this._bindedOnCanPlay,!0),this.video.addEventListener("durationchange",this._bindedOnDurationChange,!0))}},{key:"_connectVideoEvents",value:function(){this.stopped||(this.video.addEventListener("play",this._bindedOnPlay,!0),this.video.addEventListener("playing",this._bindedOnPlaying,!0),this.video.addEventListener("pause",this._bindedOnPause,!0),this.video.addEventListener("ended",this._bindedOnComplete,!0),this.video.addEventListener("error",this._bindedOnPlayerError,!0),this.video.addEventListener("click",this._bindedOnClickThru,!0),this.video.addEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.addEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.addEventListener("ticking",this._bindedOnTicking,!0),this.video.addEventListener("firstQuartile",this._bindedOnProgress,!0),this.video.addEventListener("midpoint",this._bindedOnProgress,!0),this.video.addEventListener("thirdQuartile",this._bindedOnProgress,!0),this.video.addEventListener("timeProgress",this._bindedOnProgress,!0),this.video.addEventListener("waiting",this._bindedOnWaiting,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("canplay",this._bindedOnCanPlay,!0),this.video.removeEventListener("play",this._bindedOnPlay,!0),this.video.removeEventListener("playing",this._bindedOnPlaying,!0),this.video.removeEventListener("pause",this._bindedOnPause,!0),this.video.removeEventListener("ended",this._bindedOnComplete,!0),this.video.removeEventListener("error",this._bindedOnPlayerError,!0),this.video.removeEventListener("click",this._bindedOnClickThru,!0),this.video.removeEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.removeEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.removeEventListener("ticking",this._bindedOnTicking,!0),this.video.removeEventListener("firstQuartile",this._bindedOnProgress,!0),this.video.removeEventListener("midpoint",this._bindedOnProgress,!0),this.video.removeEventListener("thirdQuartile",this._bindedOnProgress,!0),this.video.removeEventListener("timeProgress",this._bindedOnProgress,!0),this.video.removeEventListener("durationchange",this._bindedOnDurationChange,!0),this.video.removeEventListener("waiting",this._bindedOnWaiting,!0),this._bindedOnCanPlay=this._bindedOnPlay=this._bindedOnPause=this._bindedOnComplete=this._bindedOnPlayerError=this._bindedOnVolumeChange=this._bindedOnTimeUpdate=this._bindedOnTicking=this._bindedOnProgress=this._bindedOnDurationChange=this._bindedOnWaiting=this._bindedOnPlaying=this._bindedOnPlaying=this._bindedOnClickThru=void 0}},{key:"_loadVideoTagSources",value:function(){this.stopped||(this.playingMediaFile=this.video.appendVideoSources(this.mediaFiles),this.playingMediaFile&&(this.mediaUrl=this.playingMediaFile.mediaUrl,this.debugTracker.time("[VpaidWrapper".concat(this.wrapperIndex,"] video.src->onCanPlay")),this.playerDAST.set({vu:this.playingMediaFile.mediaUrl,vbr:this.playingMediaFile.bitrate,vwd:this.playingMediaFile.width,vht:this.playingMediaFile.height,ot:this.playingMediaFile.originalType,st:this.playingMediaFile.subType})))}},{key:"_createBindedCallback",value:function(){this._bindedOnCanPlay=this._onCanPlay.bind(this),this._bindedOnPause=this._onPause.bind(this),this._bindedOnComplete=this._onComplete.bind(this),this._bindedOnPlayerError=this._onPlayerError.bind(this),this._bindedOnVolumeChange=this._onVolumeChange.bind(this),this._bindedOnTimeUpdate=this._onTimeUpdate.bind(this),this._bindedOnTicking=this._onTicking.bind(this),this._bindedOnProgress=this._onProgress.bind(this),this._bindedOnDurationChange=this._onDurationChange.bind(this),this._bindedOnWaiting=this._onWaiting.bind(this),this._bindedOnPlay=this._onPlay.bind(this),this._bindedOnPlaying=this._onPlaying.bind(this),this._bindedOnClickThru=this._onClickThru.bind(this)}},{key:"_onCanPlay",value:function(){this.stopped||(this.videoLength=this.video.duration,c(this.vpaidLog,"canplay",{videoCanPlay:!0}),this.logVideoBuffer("Canplay"),this.playerReady)||(this.playerReady=!0,this.debugTracker.info("VideoVpaid -> onCanPlay() -> _fireAdLoaded()"),this._fireAdLoaded(),this.debugTracker.timeEnd("[VpaidWrapper".concat(this.wrapperIndex,"] video.src->onCanPlay")),this.adPaused)||(this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> onCanPlay() -> _fireAdImpression() because !adPaused"))}},{key:"_onPlay",value:function(e,t){this.debugTracker.info("VideoVpaid -> onPlay()"),this.stopped||(this.adPaused?(this.adPaused=!1,e&&(this.debugTracker.info("VideoVpaid -> onPlay() -> before setTimeout(_fireAdImpression()) in ".concat(t," ms")),setTimeout(function(){this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> onPlay() -> setTimeout(_fireAdImpression())")}.bind(this),t))):this._sendAdPlayingOnProgress=!0)}},{key:"_onPlaying",value:function(e){this._conditionalDispatchAdPlaying()}},{key:"_conditionalDispatchAdPlaying",value:function(){this._sendAdPlayingOnProgress&&(this.emit(this.vpaidEvents.AdPlaying),this._sendAdPlayingOnProgress=!1)}},{key:"_onPause",value:function(){this.stopped||(this.adPaused=!0,parseInt(this.video.currentTime)<parseInt(this.video.duration)&&this.emit(this.vpaidEvents.AdPaused))}},{key:"_onComplete",value:function(){this.stopped||(this.emit(this.vpaidEvents.AdVideoComplete),this.stayAlive||this.emit(this.vpaidEvents.AdStopped),qt(k(s.prototype),"onComplete",this).call(this))}},{key:"_onPlayerError",value:function(){this.stopped||0<--this.video.relevantSources||this.emit(this.vpaidEvents.AdError)}},{key:"_onVolumeChange",value:function(){this.stopped||this.emit(this.vpaidEvents.AdVolumeChange,{eventData:{volume:this.video.volume}})}},{key:"_onTimeUpdate",value:function(){this.stopped||(this.videoLength=this.getAdDuration(),this.videoLength&&this._conditionalDispatchAdPlaying())}},{key:"_onTicking",value:function(e){this.emit(this.vpaidEvents.TimeUpdated,{eventData:e.data})}},{key:"_onDurationChange",value:function(){this.stopped||this.emit(this.vpaidEvents.AdDurationChange)}},{key:"_onWaiting",value:function(){c(this.vpaidLog,"waiting",{videoCurrentTime:this.video.currentTime})}},{key:"_onClickThru",value:function(e){e?(this._sendAdPlayingOnProgress=!0,this.video.play()):(this.emit(this.vpaidEvents.AdClickThru,{eventData:{playerHandles:!0}}),this.video.pause())}},{key:"_registerToProgressEvent",value:function(){this.progressEvents&&this.video.registerProgressEvents(this.progressEvents)}},{key:"_registerToTickingEvent",value:function(){var e=this.tag.getValueByKey("vdtck")||0;0<e&&this.video.registerTickingEvents(e)}},{key:"_fireAdLoaded",value:function(){this.eventsToFire.adLoaded||this.emit(this.vpaidEvents.AdLoaded),this.eventsToFire.adLoaded=!0}},{key:"_fireAdImpression",value:function(){qt(k(s.prototype),"_fireAdImpression",this).call(this),this.stopped||this.eventsToFire.adImpression||(this.emit(this.vpaidEvents.AdVideoStart),this.emit(this.vpaidEvents.AdImpression),this.debugTracker.timeEnd("[VpaidWrapper".concat(this.wrapperIndex,"] startAd->impression")),this.eventsToFire.adImpression=!0,this.adPaused=!1,this._registerToProgressEvent(),this._registerToTickingEvent())}},{key:"_onProgress",value:function(e){"firstQuartile"===e.type?this.emit(this.vpaidEvents.AdVideoFirstQuartile):"midpoint"===e.type?this.emit(this.vpaidEvents.AdVideoMidpoint):"thirdQuartile"===e.type?this.emit(this.vpaidEvents.AdVideoThirdQuartile):"timeProgress"===e.type&&this._onTimeProgressEvent(e.data)}},{key:"_onTimeProgressEvent",value:function(e){for(var t=0;t<this.progressEvents.length;t++)this.progressEvents[t].fired||this.progressEvents[t].offset<=("time"===this.progressEvents[t].offsetType?e.time:e.pre)&&(this.progressEvents[t].fired=!0,this.emit(this.vpaidEvents.Progress,{eventData:this.progressEvents[t]}),this.progressEvents.splice(t,1))}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVideoUrl",value:function(){return this.stopped?"":this.video.getSrc()}},{key:"dontDie",value:function(){this.stayAlive=!0}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"logVideoBuffer",value:function(e){void 0!==this.video.bufferSize&&c(this.vpaidLog,"videoBuffer",{status:e,buffered:this.video.bufferSize},!1,!1)}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_resizeAd",value:function(e,t,i,n){}},{key:"getActiveVideoElement",value:function(){return this.video}}])&&Ht(e.prototype,t),i&&Ht(e,i),Object.defineProperty(e,"prototype",{writable:!1}),s}();function Kt(e){return(Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Kt(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Kt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Kt(e)?e:String(e)}(n.key),n)}}function Xt(){return(Xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function Yt(e,t){return(Yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function $t(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=w(i),t=(e=n?(e=w(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===Kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Zt=function(){var e=r,t=Gt;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yt(e,t);var i,n=$t(r);function r(e,t,i){if(this instanceof r)return t=n.call(this,e,t,i),window.setTimeout(e.onReady,0),t;throw new TypeError("Cannot call a class as a function")}return e=r,(t=[{key:"startAd",value:function(){this.video.play(),Xt(w(r.prototype),"startAd",this).call(this)}},{key:"_onCanPlay",value:function(){this.playerReady||this.video.pause(),Xt(w(r.prototype),"_onCanPlay",this).call(this)}},{key:"_onPlay",value:function(){this.startAdFired&&Xt(w(r.prototype),"_onPlay",this).call(this,this.playerReady,200)}},{key:"_onClickThru",value:function(){this.stopped||(this.store.set("forcePause",!1),Xt(w(r.prototype),"_onClickThru",this).call(this,this.adPaused))}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.debugTracker.info("VideoVpaidDesk -> _prepareVideoTag()"),this.video.removeAttribute("controls"),this._connectToVideoTag(),this._connectVideoEvents(),this._loadVideoTagSources())}},{key:"isReplayable",value:function(){return!0}},{key:"dontDie",value:function(){this.stayAlive=!0}}])&&Jt(e.prototype,t),i&&Jt(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==ei(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==ei(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===ei(e)?e:String(e)}(n.key),n)}}function A(){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function ii(e,t){return(ii=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ni(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=T(i),t=(e=n?(e=T(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===ei(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ri=function(){var e=r,t=Gt;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ii(e,t);var i,n=ni(r);function r(e,t,i){if(this instanceof r)return(t=n.call(this,e,t,i)).firstResumeAd=!0,t._initVpaid(e),window.setTimeout(e.onReady,0),t;throw new TypeError("Cannot call a class as a function")}return e=r,(t=[{key:"initAd",value:function(e,t,i){A(T(r.prototype),"initAd",this).call(this,e,t,i)}},{key:"startAd",value:function(){this.debugTracker.info("VideoVpaidMob -> startAd()"),this.debugTracker.time("[VpaidWrapper".concat(this.wrapperIndex,"] startAd->impression")),this._onStartAd(this)}},{key:"resizeAd",value:function(e,t,i,n){A(T(r.prototype),"resizeAd",this).call(this,e,t,i,n),this.video.resize&&this.video.resize(e,t,n)}},{key:"stopAd",value:function(){this.stopped||(this.timeUpdateInterval=clearTimeout(this.timeUpdateInterval),A(T(r.prototype),"stopAd",this).call(this))}},{key:"_createBindedCallback",value:function(){A(T(r.prototype),"_createBindedCallback",this).call(this),this._bindedOnPlaying=this._onPlaying.bind(this)}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.video.removeAttribute("controls"),this._connectToVideoTag(),this._loadVideoTagSources(),this.prefetchVideo("video",this.mediaUrl),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.isIOS&&this.video.load())}},{key:"_connectToVideoTag",value:function(){this.stopped||(0<this.slowConnectionLength&&(this.slowConnectionTimeout=setTimeout(this._onSlowConnecionDetected.bind(this),1e3*this.slowConnectionLength)),A(T(r.prototype),"_connectToVideoTag",this).call(this),this.video.addEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.addEventListener("click",this._bindedOnClickThru,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.removeEventListener("click",this._bindedOnClickThru,!0)}},{key:"_loadVideoTagSources",value:function(){this.stopped||(this._sortMediaFiles(),A(T(r.prototype),"_loadVideoTagSources",this).call(this))}},{key:"_onPlaying",value:function(){this.stopped||(this.eventsToFire.adImpression&&(this.adPaused=!1),c(this.vpaidLog,"videoPlaying",{vidCurrentTime:this.video.currentTime}))}},{key:"_onPlay",value:function(){var e=this;if(!this.stopped){if(this.debugTracker.info("VideoVpaidMob -> onPlay()"),this.video.play(),this.startAdFired)return this.emit(this.vpaidEvents.AdPlaying),!0;this.emit(this.vpaidEvents.AdVideoStart),A(T(r.prototype),"_onPlay",this).call(this,!0,2e3),this.timeUpdateInterval=setInterval(function(){e.stopped||e._onTimeUpdate()},250)}}},{key:"_onPlayerError",value:function(){A(T(r.prototype),"_onPlayerError",this).call(this)}},{key:"_onClickThru",value:function(e){if(e.preventDefault(),e.stopPropagation(),!this.stopped){if(this.isIOS){e=(new Date).getTime();if(null!==this.lastClickTime&&e-this.lastClickTime<=100)return;this.lastClickTime=e}A(T(r.prototype),"_onClickThru",this).call(this,this.adPaused)}}},{key:"_onCanPlay",value:function(){this.stopped||(this.slowConnectionTimeout=clearTimeout(this.slowConnectionTimeout),this._preventAdLoadIfVideoBufferTooShort())||A(T(r.prototype),"_onCanPlay",this).call(this)}},{key:"isReplayable",value:function(){return!0}},{key:"_initVpaid",value:function(e){this.videoLength=e.extra.duration||30,this.clickableTarget=e.clickableTarget||null,this.tag=e.tag,this.lastClickTime=null,this.isIOS=this.store.get("wurfl.os.name")===p,this.isIOS&&(this.slowConnectionLength=this.store.get("slwcnctlngt")||0,this.minBufferSize=this.store.get("mnbfrsz")||1)}},{key:"_sortMediaFiles",value:function(){var i=this.playerWidth;this.mediaFiles.sort(function(e,t){return Math.abs(i-e.width)-Math.abs(i-t.width)}).sort(function(e,t){return e.bitRate-t.bitRate})}},{key:"_resizeAd",value:function(e,t){this.newVidCreated&&this.newVid&&(this.newVid.style.width="".concat(e,"px"),this.newVid.style.height="".concat(t,"px"))}},{key:"resumeAd",value:function(){this.debugTracker.info("VideoVpaidMob -> resumeAd()"),this.firstResumeAd&&(this.debugTracker.info("VideoVpaidMob -> first resumeAd()"),this.isIOS?this._handleIOSFirstResumeAd():this._handleAndroidFirstResumeAd(),this._connectVideoEvents(),this.firstResumeAd=!1),A(T(r.prototype),"resumeAd",this).call(this)}},{key:"_handleIOSFirstResumeAd",value:function(){this.pausePrefetchVideo(),this.reportBufferToDebugTracker()}},{key:"_handleAndroidFirstResumeAd",value:function(){this.video.buffered&&0<this.video.buffered.length&&this.video.buffered.end(0)&&this.debugTracker.info("VideoVpaidMob -> startAd() - video currentTime:".concat(this.video.currentTime,"; buffered:").concat(this.video.buffered.end(0)," sec")),this.video.currentTime=0}},{key:"_onSlowConnecionDetected",value:function(){this.stopped||(this.slowConnectionDetected=!0,this.emit(this.vpaidEvents.SlowConnection),this.emit(this.vpaidEvents.AdStopped))}},{key:"_preventAdLoadIfVideoBufferTooShort",value:function(){return!!this._isBufferTooShort()&&(this._onSlowConnecionDetected(),!0)}},{key:"_isBufferTooShort",value:function(){var e=0<this.slowConnectionLength,t=this.video.buffered&&0<this.video.buffered.length;return e&&t&&this.video.buffered.end(0)<this.minBufferSize}}])&&ti(e.prototype,t),i&&ti(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function si(e){return(si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==si(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==si(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===si(e)?e:String(e)}(n.key),n)}}function ai(){return(ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function di(e,t){return(di=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function li(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=E(i),t=(e=n?(e=E(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===si(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ui=e(23),ci=function(){var e=s,t=Ut;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&di(e,t);var i,r=li(s);function s(e,t,i){var n;if(this instanceof s)return(n=r.call(this,e,t,i)).vpaidLog=t,n.store=i,n.stopped=!1,n.target=e.slot,n.video=e.videoSlot,n.mediaFiles=e.vpaidFiles,n.mediaUrl,n.debugTracker=new o("JsVpaid"),n.baseUrl=n.store.get("base_url"),n._onError=e.onError,n.vpaidEvents=Object.assign({},f.a),n.volume=0,n.isMuted=!0,n.pauseVideoProtection=n.store.get("pusvidprtctn"),n.vpaidResourcesHandler=e.vpaidResourcesHandler,n.playerDAST=e.playerDAST,n.adSettings=e.adSettings,n.vpaidInit={},n.secureMediaFile=me(i),n.tag=e.tag,n.logVpaidTextElements=n.store.get("lgvpdtxtelmnts"),n.countdownRegex=n.store.get("cntdwnrgx"),n.countdownRegex&&(n.countdownRegex=new RegExp(n.countdownRegex,"ig")),n.store.on("stop",function(){n.stopAd()}),n.minValidVideoDuration=n.store.get("mnvlddrtn"),n.adImpressionEvent=n.tag.getValueByKey("adimpevt"),n;throw new TypeError("Cannot call a class as a function")}return e=s,(t=[{key:"initAd",value:function(e,t,i,n,r,s){var o=this.mediaFiles[0],o=(this.secureMediaFile&&(c(this.vpaidLog,"shouldSecureUrl",{replacedProtocol:-1<o.url.indexOf("http:")},!1,!1),o.url=o.url.replace("http:","https:")),this.playerDAST.set({vbr:o.bitrate,vwd:o.width,vht:o.height,ot:o.originalType,st:o.subType,vpu:o.url}),this.mediaUrl=o.url,this.debugTracker.info("Loading","Iframe was loaded!"),this._shouldHideTarget()&&(this.target.style.display="none"),this.tag.getValueByKey("aduntladtmt")||1e4),o=new ui(this.target,this.video,{extraOptions:{zIndex:"1"}},{timeout:o},this.store);this.vpaid=o,this.vpaidInit={width:e,height:t,viewMode:i,bitRate:n,creativeData:r,environmentVars:s},o.loadAdUnit(this.mediaUrl,this._onLoadAdUnit.bind(this))}},{key:"handshakeVersion",value:function(e){return"2.0"}},{key:"resizeAd",value:function(e,t,i,n){this.stopped||(this.target.style.width=e+"px",this.target.style.height=t+"px",this.target.setAttribute("width",e),this.target.setAttribute("height",t),this._safeCall("resizeAd",[e,t,i]),this._resizeAd([e,t,n]))}},{key:"stopAd",value:function(){this._safeCall("stopAd",[]),window.setTimeout(this._stopAd.bind(this),1)}},{key:"pauseAd",value:function(){var e=this,t=(ai(E(s.prototype),"pauseAd",this).call(this),function(){});(this.pauseVideoProtection||this.adRestarted)&&(t=function(){e.stopped||!e.video||(c(e.vpaidLog,"pauseAdProtection",{paused:e.video.paused,adRestarted:e.adRestarted}),e.video.paused)||e.video.pause()}),this.video.resumeInvoked=!1,this._safeCall("pauseAd",[t])}},{key:"resumeAd",value:function(e){var t=this,i=(ai(E(s.prototype),"resumeAd",this).call(this),function(){});e&&(i=function(){t.video.play()}),this.adSettings&&this.adSettings.hasOwnProperty("onrsm")&&this.adSettings.onrsm&&(i=this.adSettings.onrsm.bind(this)),this.video.resumeInvoked=!0,this._safeCall("resumeAd",[i])}},{key:"skipAd",value:function(){this._safeCall("skipAd",[])}},{key:"startAd",value:function(){this._safeCall("startAd",[])}},{key:"expandAd",value:function(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function(){this._safeCall("collapseAd",[])}},{key:"restartAd",value:function(e,t){this.stopped||(this.clickThruUrl=t,""===this._getVideoSrc(this.video)?e&&(this.video.src=e,this._bindedOnRestartVideoLoad=this._onRestartVideoLoad.bind(this),this.video.addEventListener("canplay",this._bindedOnRestartVideoLoad),this.video.load()):this._onRestartVideoLoad())}},{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.off(t,e)}},{key:"getAdWidth",value:function(){return this._activeVideoElement?this._activeVideoElement.videoWidth:this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function(){return this._activeVideoElement?this._activeVideoElement.videoHeight:this._safeCall("getAdHeight",[])}},{key:"getAdSkippableRemainingTime",value:function(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function(e){return this._safeCall("getAdRemainingTime",[e])}},{key:"getAdDuration",value:function(e){return this._safeCall("getAdDuration",[e])}},{key:"getAdSkippableState",value:function(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function(e){return this._safeCall("getAdVolume",[e])}},{key:"getAdIcons",value:function(e){this._safeCall("getAdIcons",[e])}},{key:"getAdCompanions",value:function(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function(){return this._safeCall("getAdLinear",[])}},{key:"setAdVolume",value:function(e){var t=this;this.volume=e,this.video.muted=this.isMuted=0===this.volume,this._safeCall("setAdVolume",[e,function(){t.adRestarted&&(t.video.volume=e,t.video.muted=0===e)}])}},{key:"isReplayable",value:function(){return this.video&&""!==this._getVideoSrc(this.video)}},{key:"getDOMContainer",value:function(){return this.target}},{key:"checkUnfriendlyIframe",value:function(){var t=function(e){if(!e)return null;for(var t=e.querySelector("iframe");t;)try{t=t.contentDocument.querySelector("iframe")}catch(e){break}return t}(this.target);try{return t&&t.contentDocument,!1}catch(e){return t=t.src,c(this.vpaidLog,"unfriendlyIframe",{src:t}),!0}}},{key:"getVideoUrl",value:function(){var e;return!this.stopped&&(e=this.getActiveVideoElement())?this._getVideoSrc(e):""}},{key:"getVPAIDVideoElement",value:function(){return this._activeVideoElement||null}},{key:"logVideoUrl",value:function(){var e=this.getVideoUrl();e&&(c(this.vpaidLog,"jsVpaidVideoUrl",{videoUrl:e}),this.vpaidLog.friendlyVideoUrl=!0)}},{key:"toggleIframeContentDisplay",value:function(e){try{var t="none";"hide"===e?t="hidden":"show"===e&&(t="visible"),this.adUnit._iframe.contentWindow.document.body.style.visibility=t}catch(e){c(this.vpaidLog,"toggleIframeContentDisplayFail",{ex:e})}}},{key:"setCompletionOnAdStoppedTimeout",value:function(){var e=this,t=this.tag.getValueByKey("cmpltonstpdms");0<t&&(this.completionOnAdStoppedTimeout||(this.completionOnAdStoppedTimeout=setTimeout(function(){e.stopped||e.emit(e.vpaidEvents.AdStopped)},t)))}},{key:"handleVpaidContent",value:function(){var e=this;this.adUnit._iframe&&(this.logVpaidTextElements||this.countdownRegex)&&setTimeout(function(){e.vpaidTextElements={},e._getAndHandleVpaidContent(e.adUnit._iframe),0<Object.keys(e.vpaidTextElements).length&&c(e.vpaidLog,"vpaidTextElements",e.vpaidTextElements)},1)}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"_onLoadAdUnit",value:function(e,t){try{this.stopped||(e?this._onLoadAdUnitError(e):(c(this.vpaidLog,"loadVPAIDJSScript",{scriptLoaded:!0}),this.adUnit=t,this.store.get("imapihok")&&this._hookIMA(),this._bindIframe(t),this._bindAdUnitEvents(t),t.handshakeVersion("2.0",this._onHandshake.bind(this)),this._handleCompleteOnAdStopped()))}catch(e){c(this.vpaidLog,"loadVPAIDJSScriptErr",{err:e.message})}}},{key:"_onLoadAdUnitError",value:function(e){c(this.vpaidLog,"loadVPAIDJSScript",{scriptLoadedError:!0}),this.store&&this.store.get("aduntldflbfruntld")?this._onError(e,"adUnitLoadFailed"):this._onError()}},{key:"_onHandshake",value:function(){this.adUnit.initAd(this.vpaidInit.width,this.vpaidInit.height,this.vpaidInit.viewMode,-1,this.vpaidInit.creativeData,{})}},{key:"_handleCompleteOnAdStopped",value:function(){var e=this.store.get("cmpltonstpddmn");e&&0<e.length&&-1!=this.mediaUrl.search(new RegExp(e.join("|"),"i"))&&(this.completeOnAdStop=!0)}},{key:"_bindIframe",value:function(e){e=e._iframe;this.vpaidResourcesHandler.inject(e,this),this._onBindIframe(e),this._loadAdditionalScripts()}},{key:"_bindAdUnitEvents",value:function(e){var t,i=this;for(t in this.vpaidEvents)!function(t){e.subscribe(t,function(e){i._allEventsHandler(t,e)})}(t)}},{key:"_allEventsHandler",value:function(e,t){if(!this.stopped){if(this._shouldHideTarget()&&"block"!==this.target.style.display&&(this.target.style.display="block"),this.adImpressionEvent){if(e===this.vpaidEvents.AdImpression)return;e===this.adImpressionEvent&&(this.adImpressionEvent=void 0,this._allEventsHandler(this.vpaidEvents.AdImpression))}e===this.vpaidEvents.AdStopped?(this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout),this.onComplete()):e===this.vpaidEvents.AdLoaded?this.adLoaded=!0:e===this.vpaidEvents.AdImpression?this._onAdImpression():e===this.vpaidEvents.AdError&&this._onAdError(),this.emit(e,{eventData:t})}}},{key:"_onAdImpression",value:function(){ai(E(s.prototype),"_onAdImpression",this).call(this);var e=this.video.src;e&&c(this.vpaidLog,"videoUrl",{url:e}),this.pauseVideoProtection&&this.video&&this.video.protectPause(),this._registerToTickingEvent()}},{key:"_dispatchAdImpression",value:function(){return!0}},{key:"_safeCall",value:function(t,i){if(!this.stopped&&this.adUnit){"resizeAd"===t&&this._resizeAd(i);try{return this.adUnit[t].apply(this.adUnit,i)}catch(e){return c(this.vpaidLog,"initJsError",{err:e.message,funcName:t,args:i,stack:e.stack}),this._onSafeCallAdError(e),!1}}}},{key:"_resizeAd",value:function(e,t,i,n){}},{key:"_onSafeCallAdError",value:function(e){}},{key:"_getVideoSrc",value:function(e){if(!this.stopped)return e.getSrc?e.getSrc():e.src||e.currentSrc||""}},{key:"_stopAd",value:function(){ai(E(s.prototype),"stopAd",this).call(this),this.stopped||(this.adUnit&&this._destroyAdUnit(),this._bindedOnTicking&&(this.video.removeEventListener("ticking",this._bindedOnTicking),this._bindedOnTicking=void 0),this.stopped=!0,this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout),this.iframe=this.vpaid=this.imaApi=this.callIMAApi=this.adUnit=this.mediaFiles=this.video=this.vpaidEvents=this.target=this.debugTracker=this.vpaidLog=this.store=this.tag=this.registerAnalyticsToVpaidLog=void 0,this.onAfterStop())}},{key:"_destroyAdUnit",value:function(){if(this.vpaidLog.saveToDbWithoutReport(),this.vpaidResourcesHandler.destroy(this.adUnit._iframe),this.adUnit._iframe&&this.adUnit._iframe.contentWindow&&this.additionalScripts&&0<this.additionalScripts.length)try{for(var e=0;e<this.additionalScripts.length;e++)this.adUnit._iframe.contentDocument.head.removeChild(this.additionalScripts[e]);this.onIframeEvent=void 0}catch(e){}this.adUnit._destroy()}},{key:"_onRestartVideoLoad",value:function(){var t=this,i=(this.adRestarted=!0,this._bindedOnRestartVideoLoad&&(this.video.removeEventListener("canplay",this._bindedOnRestartVideoLoad),this._bindedOnRestartVideoLoad=void 0),this.video.currentTime=0,this._resizeVideotoParentSize(),this.video.play(),function(){t.clickThruUrl&&t.emit(t.vpaidEvents.AdClickThru,{eventData:{url:t.clickThruUrl,playerHandles:!0}})});this.video.addEventListener("ended",function e(){t.video.removeEventListener("ended",e),t.video.removeEventListener("click",i),t._allEventsHandler(t.vpaidEvents.AdStopped,{}),t._allEventsHandler(t.vpaidEvents.AdVideoComplete,{})}),this.video.addEventListener("click",i)}},{key:"_resizeVideotoParentSize",value:function(){this.video.style.width=this.target.style.width,this.video.style.height=this.target.style.height}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_getActiveVideoInIframes",value:function(e){var t=this,i=null;if(e&&0!==e.length)try{le(e[0],"iframe",function(e){e.forEach(function(e){i||(!t.minValidVideoDuration||e.duration&&e.duration>t.minValidVideoDuration)&&(i=e)})},"video",this.store.get("debug"))}catch(e){}return i}},{key:"_getAndHandleVpaidContent",value:function(e){try{for(var t=e.contentWindow.document.body.getElementsByTagName("*")||[],i=0;i<t.length;i++){var n,r=t[i],s=r.nodeName.toLowerCase();"script"!==s&&("iframe"===s?this._getAndHandleVpaidContent(r):(n=r.textContent?r.textContent.trim():"")&&this._logVpaidTextElements(r,s,n))}}catch(e){}}},{key:"_logVpaidTextElements",value:function(e,t,i){this.logVpaidTextElements&&(this.vpaidTextElements[t]=this.vpaidTextElements[t]||[],this.vpaidTextElements[t].push({id:e.id,className:e.className,text:i}))}},{key:"_loadAdditionalScripts",value:function(){if(this.adSettings&&this.adSettings.hasOwnProperty("adtnlscrpts")&&this.adSettings.adtnlscrpts){this.additionalScripts=[],this.onIframeEvent=this._onIframeEvent.bind(this);try{for(var e=0;e<this.adSettings.adtnlscrpts.length;e++){var t=this.adUnit._iframe.contentDocument.createElement("script");t.src=this.adSettings.adtnlscrpts[e].src,t.type="text/javascript",t.onload=this.adSettings.adtnlscrpts[e].clbk.bind(this),this.adUnit._iframe.contentDocument.head.appendChild(t),this.additionalScripts.push(t)}}catch(e){}}}},{key:"_onIframeEvent",value:function(e){this.stopped||this._shouldListenToIframeEvents()&&this.adSettings.ifrmevts.hasOwnProperty(e.name)&&this.vpaidEvents.hasOwnProperty(this.adSettings.ifrmevts[e.name])&&this._allEventsHandler(this.adSettings.ifrmevts[e.name],{})}},{key:"_shouldListenToIframeEvents",value:function(){return this.adSettings&&this.adSettings.hasOwnProperty("ifrmevts")&&this.adSettings.ifrmevts}},{key:"_onAdError",value:function(){}},{key:"_shouldHideTarget",value:function(){return this.adSettings.hasOwnProperty("hdtrgt")&&this.adSettings.hdtrgt}},{key:"_onTicking",value:function(e){this.emit(this.vpaidEvents.TimeUpdated,{eventData:e.data})}},{key:"_registerToTickingEvent",value:function(){var e=this.tag.getValueByKey("vdtck")||0;0<e&&(this._bindedOnTicking=this._onTicking.bind(this),this.video.addEventListener("ticking",this._bindedOnTicking),this.video.registerTickingEvents(e))}},{key:"getActiveVideoElement",value:function(){if(!this.stopped)return this._activeVideoElement||(this._getVideoSrc(this.video)?(this._activeVideoElement=this.video,c(this.vpaidLog,"jsVpaidVideo",{videoType:"local"})):(this._activeVideoElement=this._getActiveVideoInIframes(this.target.querySelectorAll("iframe")),this._activeVideoElement?c(this.vpaidLog,"jsVpaidVideo",{videoType:"friendlyIframe"}):c(this.vpaidLog,"jsVpaidVideo",{videoType:"unfriendlyIframe"}))),this._activeVideoElement}}])&&oi(e.prototype,t),i&&oi(e,i),Object.defineProperty(e,"prototype",{writable:!1}),s}();function hi(e){return(hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==hi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==hi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===hi(e)?e:String(e)}(n.key),n)}}var fi=function(){function n(e,t,i){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.iframe=e,this.channel=void 0,this.sid=void 0,this.store=t,this.vpaidLog=i,this.protocol=this.store.get("httpsOverride")?"https:":window.location.protocol||"http:"}var e,t,i;return e=n,(t=[{key:"listenToMessages",value:function(){this.iframe.contentWindow.addEventListener("message",this.onmessage.bind(this))}},{key:"removeMessagesListener",value:function(){this.iframe.contentWindow.removeEventListener("message",this.onmessage.bind(this))}},{key:"onmessage",value:function(e){if(e){var t={};try{t=JSON.parse(e.data.replace("ima://",""))}catch(e){return}"viewabilityMeasurement"!==t.type&&(void 0!==t.channel&&void 0===this.channel&&(this.channel=t.channel),void 0!==t.sid)&&"*"!==t.sid&&void 0===this.sid&&(this.sid=t.sid),void 0!==this.channel&&void 0!==this.sid&&this.removeMessagesListener()}}},{key:"callApi",value:function(e,t){var i;this.channel&&this.sid&&this.iframe&&(i={name:"adsManager",type:e.replace("Ad",""),sid:this.sid,channel:this.channel},"volume"==e&&(i.data={volume:t}),e="\n                    var ifrms = document.querySelectorAll('iframe');\n\n                    ifrms.forEach(ifrm => {\n                        if (ifrm.src.indexOf('imasdk.googleapis.com') > -1 && ifrm.src.indexOf('bridge') > -1 && (ifrm.src.indexOf('#".concat(this.sid,"') > -1 || ifrm.src.indexOf('#").concat(this.channel,"') > -1)) {\n                            ifrm.contentWindow.postMessage('ima://").concat(m(i),"', '").concat(this.protocol,"//imasdk.googleapis.com');\n                        }\n                    });\n                "),ve(this.iframe.contentWindow,e))}}])&&pi(e.prototype,t),i&&pi(e,i),Object.defineProperty(e,"prototype",{writable:!1}),n}();function vi(e){return(vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==vi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==vi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===vi(e)?e:String(e)}(n.key),n)}}function yi(){return(yi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_i(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function gi(e,t){return(gi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function bi(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=_i(i),t=(e=n?(e=_i(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===vi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function _i(e){return(_i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ki=function(){var e=r,t=ci;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gi(e,t);var i,n=bi(r);function r(e,t,i){if(this instanceof r)return(t=n.call(this,e,t,i))._initVpaid(e),setTimeout(e.onReady,2),t;throw new TypeError("Cannot call a class as a function")}return e=r,(t=[{key:"resumeAd",value:function(){yi(_i(r.prototype),"resumeAd",this).call(this,this.adRestarted)}},{key:"setAdVolume",value:function(e){this.store.get("frcvlm")&&(this.video.volume=e,this.emit(this.vpaidEvents.AdVolumeChange,{eventData:{dispatcher:this}})),yi(_i(r.prototype),"setAdVolume",this).call(this,e)}},{key:"onMuteChanged",value:function(e){this.isMuted=e}},{key:"_initVpaid",value:function(e){this.pauseVideoProtection=this.store.get("pusvidprtctn"),this.adLoaded=!1,this.callIMAApi=void 0}},{key:"_hookIMA",value:function(){this.imaApi=new fi(this.adUnit._iframe,this.store,this.vpaidLog),this.imaApi.listenToMessages(),this.callIMAApi=this.imaApi.callApi.bind(this.imaApi)}},{key:"_onBindIframe",value:function(e){this._soundProtection(this.video),this._blockDOMObjectInWin(e.contentWindow)}},{key:"_soundProtection",value:function(e){var t=this;e.addEventListener("volumechange",function(){t.adLoaded&&t.isMuted&&0!=e.volume&&t.emit(t.vpaidEvents.SoundViolation,{eventData:{vol:e.volume}}),e.volume!==t.volume&&(c(this.vpaidLog,"soundProtection",{selfSound:t.volume,videoSound:e.volume}),e.volume=t.volume)})}},{key:"_blockDOMObjectInWin",value:function(e){var t="\n        ".concat(this.store.get("jsnoflshdtct")?"window.navigator.__defineGetter__('plugins', function () { return []; });":"",'\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "_data",\n            Object.getOwnPropertyDescriptor(\n                HTMLObjectElement.prototype,\n                "data"\n            )\n        );\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "data", {\n                set : function(val){\n                    console.log(\'HTMLObjectElement block\');\n                    return;\n                }\n            }\n        );');try{ve(e,t)}catch(e){console.log(e)}}},{key:"_onSafeCallAdError",value:function(e){this._onAdError(e)}}])&&mi(e.prototype,t),i&&mi(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function wi(e){return(wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ai(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==wi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==wi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===wi(e)?e:String(e)}(n.key),n)}}function S(){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function Ti(e,t){return(Ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Ei(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=P(i),t=(e=n?(e=P(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===wi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Si=function(){var e=o,t=ci;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ti(e,t);var i,n=Ei(o);function o(e,t,i){if(this instanceof o)return(t=n.call(this,e,t,i))._initVpaid(e),setTimeout(e.onReady,2),t;throw new TypeError("Cannot call a class as a function")}return e=o,(t=[{key:"initAd",value:function(e,t,i,n,r,s){this.isIOS&&this.slowConnectionLength&&(this.slowConnectionTimeout=setTimeout(this._onSlowConnecionDetected.bind(this),1e3*this.slowConnectionLength)),S(P(o.prototype),"initAd",this).call(this,e,t,i,n,r,s)}},{key:"resumeAd",value:function(){S(P(o.prototype),"resumeAd",this).call(this,this.video.useResumeCallback&&this.video.useResumeCallback()||this.adRestarted)}},{key:"startAd",value:function(){this.video.emitStartAd&&this.video.emitStartAd(),this.pausePrefetchVideo(),this.reportBufferToDebugTracker(),S(P(o.prototype),"startAd",this).call(this)}},{key:"setAdVolume",value:function(e,t){this.video.mutedChangeByUserGesture=t,S(P(o.prototype),"setAdVolume",this).call(this,e)}},{key:"isReplayable",value:function(){return this.video&&""!==this._getVideoSrc(this.video)}},{key:"removeClickableTarget",value:function(){this.isIOS&&this.clickableTarget&&this.clickableTarget.parentNode.removeChild(this.clickableTarget)}},{key:"_initVpaid",value:function(e){this.pauseVideoProtection=this.store.get("pusvidprtctn"),this.isIOS=this.store.get("wurfl.os.name")===p,this.clickableTarget=e.clickableTarget,this.store.get("sprssviderr")&&this.video.supressErrorEvents(),this.isIOS&&(this.slowConnectionLength=this.store.get("slwcnctlngt")||0,this.minBufferSize=this.store.get("mnbfrsz")||1)}},{key:"_onBindIframe",value:function(e){this._unmuteHook()}},{key:"_unmuteHook",value:function(){this.store.get("mtdhkactv")&&this.video.hookMutedProperty()}},{key:"_resizeAd",value:function(e){this.stopped||this.video.resize&&this.video.resize(e)}},{key:"_stopAd",value:function(){this.stopped||(this.video.destroy(),this.onComplete(),S(P(o.prototype),"_stopAd",this).call(this))}},{key:"prefetchVideo",value:function(e,t){this.debugTracker.info("JsVpaidMob -> prefetchVideo() -> super.prefetchVideo();"),S(P(o.prototype),"prefetchVideo",this).call(this,e,t)}},{key:"_onSlowConnecionDetected",value:function(){this.stopped||(this.slowConnectionDetected=!0,this.emit(this.vpaidEvents.SlowConnection),this.emit(this.vpaidEvents.AdStopped))}},{key:"_allEventsHandler",value:function(e,t){this.stopped||e===this.vpaidEvents.AdLoaded&&(this.slowConnectionTimeout=clearTimeout(this.slowConnectionTimeout),this._preventAdLoadIfVideoBufferTooShort())||S(P(o.prototype),"_allEventsHandler",this).call(this,e,t)}},{key:"_preventAdLoadIfVideoBufferTooShort",value:function(){return!!this._isBufferTooShort()&&(this._onSlowConnecionDetected(),!0)}},{key:"_isBufferTooShort",value:function(){var e=0<this.slowConnectionLength,t=this.video&&this.video.getSrc(),i=this.video.buffered&&0<this.video.buffered.length;return e&&t&&i&&this.video.buffered.end(0)<this.minBufferSize}}])&&Ai(e.prototype,t),i&&Ai(e,i),Object.defineProperty(e,"prototype",{writable:!1}),o}(),t=e(13),Pi=e.n(t);function Vi(e){return(Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ci(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,s,o,a=[],d=!0,l=!1;try{if(s=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;d=!1}else for(;!(d=(n=s.call(i)).done)&&(a.push(n.value),a.length!==t);d=!0);}catch(e){l=!0,r=e}finally{try{if(!d&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw r}}return a}}(e,t)||function(e,t){var i;if(e)return"string"==typeof e?Ii(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ii(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ii(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Oi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Vi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Vi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Vi(e)?e:String(e)}(n.key),n)}}function Di(){return(Di="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ri(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function xi(e,t){return(xi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Mi(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=Ri(i),t=(e=n?(e=Ri(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===Vi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function Ri(e){return(Ri=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Li=function(){var e=s,t=Ut;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xi(e,t);var i,r=Mi(s);function s(e,t,i){var n;if(this instanceof s)return(n=r.call(this,e,t,i)).adContainer=e.slot,n.videoElement=document.querySelector("._cm-content-video")||e.videoSlot,n.tag=e.tag,n.vpaidEvents=Object.assign({},f.a),n.imaEvents=Object.assign({},Pi.a),n.onReadyEvent=e.onReady,n.vpaidLog=t,n.store=i,n._initializeIMA(),n;throw new TypeError("Cannot call a class as a function")}return e=s,(t=[{key:"_initializeIMA",value:function(){var e;this.store.get("isImaScriptLoaded")?this._onImaLoad():((e=document.createElement("script")).onload=this._onImaLoad.bind(this),e.src=this.store.get("imscrptsrc"),document.getElementsByTagName("head")[0].appendChild(e))}},{key:"_onImaLoad",value:function(){this.store.set("isImaScriptLoaded",!0),this.tag.url+="&description_url="+encodeURIComponent(this.store.get("cirf")),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainer,this.videoElement),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsRequest=new google.ima.AdsRequest,this._bindImaVpaidLoadEvents(),setTimeout(this.onReadyEvent,0)}},{key:"_bindImaVpaidLoadEvents",value:function(){var t=this;this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){t._allEventsHandler(e)},!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){t._allEventsHandler(e)},!1)}},{key:"initAd",value:function(e,t,i,n,r,s){this.adDisplayContainer.initialize(),this.adsRequest.adTagUrl=this.tag.url,this.adsRequest.linearAdSlotWidth=e,this.adsRequest.linearAdSlotHeight=t,this.adsRequest.nonLinearAdSlotWidth=e,this.adsRequest.nonLinearAdSlotHeight=t,this.adsRequest.vastLoadTimeout=1e4,this.adsRequest.videoPlayActivation="click",this.adsRequest.videoPlayMuted="muted",this.adsRequest.setAdWillAutoPlay(!0),this.adsRequest.setAdWillPlayMuted(!0),this.adsRequest.setContinuousPlayback(!0),this.adsLoader.requestAds(this.adsRequest)}},{key:"startAd",value:function(){this.width=this.adContainer.width||this.adContainer.getClientRects()[0].width,this.height=this.adContainer.height||this.adContainer.getClientRects()[0].height;try{this.adsManager.init(this.width,this.height,google.ima.ViewMode.NORMAL),this.adsManager.start()}catch(e){var t=this.imaEvents.adError;this.emit(t,{eventData:e})}}},{key:"_allEventsHandler",value:function(e){var t=e.type,t=this.imaEvents[t];if(t){if(t===this.imaEvents.adsManagerLoaded)this.adsManager=e.getAdsManager(this.videoElement),this._bindAdManagerEvents(),t=this.imaEvents.loaded;else if(t===this.imaEvents.adError)this.stopAd();else{if(t===this.imaEvents.loaded)return void(this.ad=e.getAd());t===this.imaEvents.click&&(this.clickThroughUrl=this._getAdProp("clickThroughUrl"),e.url=this.clickThroughUrl,e.playerHandles=!0)}e="adError"===e.type?this._findErrorData(e):e;this.emit(t,{eventData:e})}}},{key:"_findErrorData",value:function(e){for(var t="",i=0,n=Object.entries(e);i<n.length;i++){var r=Ci(n[i],2),r=(r[0],r[1]);r&&r.stack&&(t=r)}return JSON.stringify(t)}},{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.off(t,e)}},{key:"handshakeVersion",value:function(){return"2.0"}},{key:"resizeAd",value:function(e,t,i,n){this.stopped||this.adsManager&&(this.height=t,this.width=e,this.adsManager.resize(e,t,google.ima.ViewMode.NORMAL))}},{key:"pauseAd",value:function(){this.adsManager.pause()}},{key:"resumeAd",value:function(e){this.adsManager.resume()}},{key:"stopAd",value:function(){this.adsManager&&this.adsManager.stop(),window.setTimeout(this._stopAd.bind(this),1)}},{key:"onComplete",value:function(){this.stopped||(this.emit(this.imaEvents.complete),Di(Ri(s.prototype),"onComplete",this).call(this))}},{key:"_bindAdManagerEvents",value:function(){var e,t=[google.ima.AdErrorEvent.Type.AD_ERROR,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.DURATION_CHANGE,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.VOLUME_CHANGED,google.ima.AdEvent.Type.VOLUME_MUTED,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,google.ima.AdEvent.Type.LINEAR_CHANGED,google.ima.AdEvent.Type.INTERACTION,google.ima.AdEvent.Type.AD_PROGRESS];for(e in t)this.adsManager.addEventListener(t[e],this._allEventsHandler,!1,this)}},{key:"_getAdProp",value:function(e){for(var t in this.ad){t=this.ad[t][e];if(null!=t)return t}return null}},{key:"_getMediaUrl",value:function(){if(this.ad)return this.ad.getMediaUrl()}},{key:"isReplayable",value:function(){return!1}},{key:"getAdWidth",value:function(){if(this.ad)return this.ad.getWidth()}},{key:"getAdHeight",value:function(){if(this.ad)return this.ad.getHeight()}},{key:"getAdRemainingTime",value:function(){return this.adsManager.getRemainingTime()}},{key:"getAdDuration",value:function(e){if(this.ad)return e.apply(this.ad,[null,this.ad.getDuration()])}},{key:"getAdSkippableState",value:function(){return this.adsManager.getAdSkippableState()}},{key:"getAdVolume",value:function(){return this.adsManager.getVolume()}},{key:"getAdCompanions",value:function(){this.ad&&this.ad.getCompanionAds(this.width,this.height)}},{key:"getAdExpanded",value:function(){this.ad&&this.ad.expand()}},{key:"getAdLinear",value:function(){if(this.ad)return this.ad.isLinear()}},{key:"getAdSkippableRemainingTime",value:function(){this.ad&&this.ad.getSkipTimeOffset()}},{key:"getDOMContainer",value:function(){return this.adContainer}},{key:"setAdVolume",value:function(e){var t;null!=(t=this.adsManager)&&t.setVolume(e)}},{key:"skipAd",value:function(){this.stopped||this.ad&&this.ad.isSkippable()&&(this.emit(this.imaEvents.skip),this.adsManager.skip(),this.stopAd())}},{key:"collapseAd",value:function(){this.adsManager.collapse()}},{key:"expandAd",value:function(){this.adsManager.expand()}},{key:"checkUnfriendlyIframe",value:function(){return!0}},{key:"_stopAd",value:function(){Di(Ri(s.prototype),"stopAd",this).call(this),this.stopped||(this.stopped=!0,this.iframe=this.vpaid=this.callIMAApi=this.video=this.vpaidEvents=this.target=this.vpaidLog=this.store=this.tag=void 0,this.adsManager&&this.adsManager.destroy(),this.adsLoader&&this.adsLoader.destroy(),this.adDisplayContainer&&this.adDisplayContainer.destroy(),this.emit(this.imaEvents.AdStopped),this.onAfterStop())}},{key:"removeClickableTarget",value:function(){}},{key:"onAfterStop",value:function(){}},{key:"restartAd",value:function(e,t){}},{key:"setCompletionOnAdStoppedTimeout",value:function(){}},{key:"toggleIframeContentDisplay",value:function(){}}])&&Oi(e.prototype,t),i&&Oi(e,i),Object.defineProperty(e,"prototype",{writable:!1}),s}();function Fi(e){return(Fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Fi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Fi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Fi(e)?e:String(e)}(n.key),n)}}var ji=function(){function i(e,t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.vpaidLog=e,this.store=t,this.isMobile=this.store.get("isMobile"),this.handlers={video:{handlerType:"VideoVpaid".concat(this.isMobile?"Mobile":""),handler:this.isMobile?ri:Zt,filterVpaidFiles:function(e){return e.vpaidFiles.video}},javascript:{handlerType:"JsVpaid".concat(this.isMobile?"Mobile":""),handler:this.isMobile?Si:ki,filterVpaidFiles:function(e){return e.vpaidFiles.vpaid.javascript}},ima:{handlerType:"ima",handler:Li}}}var e,t,n;return e=i,(t=[{key:"create",value:function(e,t){var i;if(!this.stopped)return this.handlers.hasOwnProperty(e)?(i=this.handlers[e].handler,this.handlers[e].hasOwnProperty("filterVpaidFiles")&&(t.vpaidFiles=this.handlers[e].filterVpaidFiles(t)),c(this.vpaidLog,"creatingVpaidHandler",{type:this.handlers[e].handlerType}),new i(t,this.vpaidLog,this.store)):(c(this.vpaidLog,"creatingVpaidHandler",{error:"typeNotFound",type:e}),null)}},{key:"destroy",value:function(){this.stopped=!0,this.vpaidLog=this.store=this.handlers=void 0}}])&&Bi(e.prototype,t),n&&Bi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();function Wi(e){return(Wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ui(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Wi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Wi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Wi(e)?e:String(e)}(n.key),n)}}var Ni=void 0,Hi=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");if(Ni)return Ni;this.debugTracker=new o("ClickThroughHandler"),this.store=e,this.isMultiAdsActive=this.store.get("mltads"),Ni=this}var e,i,n;return e=t,(i=[{key:"invokeClick",value:function(e){this.isMultiAdsActive||this.store.set("forcePause",!1),e&&e.url&&(this.store.emit(f.a.AdClickThru,e.url),e.playerHandles)&&e.url&&this._openClickThroughUrl(e.url)}},{key:"_openClickThroughUrl",value:function(e){this.debugTracker.info("Opening Url","Opening url: ".concat(e)),e=fe(e,this.store),this.store.get("isInApp")&&window.taboolaMobile&&window.taboolaMobile.getSupportedFeatures&&window.taboolaMobile.getSupportedFeatures().VideoClick?window.taboolaBridge.emit("videoClick",e):window.open(e)}}])&&Ui(e.prototype,i),n&&Ui(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qi(e){return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==qi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==qi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===qi(e)?e:String(e)}(n.key),n)}}function Qi(e,t,i){return function(){window.reportResourceEvent||(window.reportResourceEvent=function(e){window.parent.postMessage({type:"resourceEvent",eventData:e},"*")});var e="__DEBUG__";function s(e){return!!r.length&&a.test(e)}function o(e,t){e?window.reportResourceEvent({event:"maliciousUrl",url:t.url,isEarly:t.isEarly}):debug||window.reportResourceEvent({event:"maliciousAction",action:t.action})}function t(){function i(e){var i;s(e)?o(!0,{url:e,isEarly:!1}):(window.analyticsReporter.analyticsOptions.withIframes&&window.analyticsReporter.pushUrl("iframes",e,this),e&&"undefined"===e.substr(0,9)&&window.reportResourceEvent({event:"undefinedIframeSrc",url:e}),i=this,window.vpaidCrawlerFunc&&i.addEventListener("load",function e(){try{i.removeEventListener("load",e);var t=i.contentWindow.document.createElement("script");t.type="text/javascript",i.contentWindow.vpaidCrawlerFunc=t.innerHTML=window.vpaidCrawlerFunc,i.contentWindow.analyticsReporter=window.analyticsReporter,i.contentWindow.reportResourceEvent=window.reportResourceEvent,i.contentWindow.document.head.appendChild(t)}catch(e){}}))}HTMLIFrameElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLIFrameElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"src")),Object.defineProperty(HTMLIFrameElement.prototype,"src",{get:function(){return this._src},set:function(e){i.call(this,e),this._src=e}})),HTMLIFrameElement.prototype.hasOwnProperty("_setAttribute")||(HTMLIFrameElement.prototype._setAttribute=HTMLIFrameElement.prototype.setAttribute,HTMLIFrameElement.prototype.setAttribute=function(e,t){"src"==e.toLowerCase()&&i.call(this,t),this._setAttribute(e,t)})}function i(e){if(e.src)return e.src;if(e.childNodes.length)for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t]&&e.childNodes[t].src)return e.childNodes[t].src;return e.outerHTML}function n(){function i(e){s(e)?o(!0,{url:e,isEarly:!1}):window.analyticsReporter.analyticsOptions.withScripts&&window.analyticsReporter.pushUrl("scripts",e,this)}HTMLScriptElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLScriptElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src")),Object.defineProperty(HTMLScriptElement.prototype,"src",{get:function(){return this._src},set:function(e){i.call(this,e),this._src=e}})),HTMLScriptElement.prototype.hasOwnProperty("_setAttribute")||(HTMLScriptElement.prototype._setAttribute=HTMLScriptElement.prototype.setAttribute,HTMLScriptElement.prototype.setAttribute=function(e,t){"src"==e.toLowerCase()&&i.call(this,t),this._setAttribute(e,t)})}var r="__BLACKLIST__",a=new RegExp(r.map(function(t){try{return atob(t)}catch(e){return t}}).join("|"),"i");function d(e){var n=this;this.report={scripts:[],XHRUrls:[],iframes:[],firstCount:0,totalRequests:[],totalRequestsCounter:0,latencies:[],averageLatency:0,averageIntLatency:0},this.networkCallCounter=0,this.analyticsOptions=e,this.networkCallsLimitExceeded=!1,this.isVideoUrlPublic=void 0,this.requestId=0,this.requestStartTimes={},this.getReport=function(){if(n.stopped)return{};var e,t={};for(e in n.report)Array.isArray(n.report[e])?t[e]=n.report[e].slice():t[e]=n.report[e];t.totalRequests=t.totalRequests.concat(t.scripts),t.totalRequests=t.totalRequests.concat(t.XHRUrls),t.totalRequests=t.totalRequests.concat(t.iframes),t.totalRequestsCounter=t.totalRequests.length;var i=t.latencies.reduce(function(e,t){return e+t},0);return t.averageLatency=t.latencies.length?i/t.latencies.length:0,t.averageIntLatency=parseInt(t.averageLatency),t}}d.prototype.pushUrl=function(e,t,i){this.report[e].push(t),i._id=this.requestId++,this.requestStartTimes[i._id]=Date.now();var n=this;i.addEventListener("load",function e(){n.requestStartTimes.hasOwnProperty(this._id)&&(n.report.latencies.push(Date.now()-n.requestStartTimes[this._id]),delete n.requestStartTimes[this._id]),this.removeEventListener("load",e)}),"iframes"!==e||void 0===this.isVideoUrlPublic?this.networkCallCounter++:this.networkCallCounter+=this.getIframeWeight(t),this.isMaxNetworkCallsLimitExceeded()&&this.onNetworkCallsLimitExceeded()},d.prototype.getIframeWeight=function(e){return-1<e.indexOf("imasdk")?this.analyticsOptions.iframesWeights.ggl:this.isVideoUrlPublic?this.analyticsOptions.iframesWeights.pxls:this.analyticsOptions.iframesWeights.gen},d.prototype.isMaxNetworkCallsLimitExceeded=function(){return this.networkCallsLimitExceeded||this.analyticsOptions.maxNetworkCalls&&this.networkCallCounter>=this.analyticsOptions.maxNetworkCalls},d.prototype.onNetworkCallsLimitExceeded=function(){this.networkCallsLimitExceeded||this.stopped||(this.networkCallsLimitExceeded=!0,window.reportResourceEvent({event:"maxNetworkCalls"}))},d.prototype.unhook=function(){var e=Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"_src"),t=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"_src");e&&(Object.defineProperty(HTMLIFrameElement.prototype,"src",e),HTMLIFrameElement.prototype.setAttribute=HTMLIFrameElement.prototype._setAttribute),t&&(Object.defineProperty(HTMLIFrameElement.prototype,"src",t),HTMLScriptElement.prototype.setAttribute=HTMLScriptElement.prototype._setAttribute),window.XMLHttpRequest.prototype._open&&(window.XMLHttpRequest.prototype.open=window.XMLHttpRequest.prototype._open)},d.prototype.destroy=function(){this.stopped||(this.unhook(),this.stopped=!0,this.report=this.analyticsOptions=this.requestStartTimes=this.getReport=window.analyticsReporter=void 0)},window.destroyCrawler=function(){window.reportResourceEvent=window.vpaidCrawlerFunc=void 0};try{window.analyticsReporter=window.analyticsReporter||new d("__OPTIONS__");for(var l=document.scripts||[],u="",c=0;c<l.length;c++)window.analyticsReporter.report.scripts.push(l[c].src),l[c].src&&s(l[c].src)&&(u=l[c].src);for(var h=document.querySelectorAll("iframe")||[],p=0;p<h.length;p++)window.analyticsReporter.report.iframes.push(h[p].src),h[p].src&&s(h[p].src)&&(u=h[p].src);if(window.analyticsReporter.report.firstCount=window.analyticsReporter.report.scripts.length+window.analyticsReporter.report.iframes.length,u&&o(!0,{url:u,isEarly:!0}),t(),HTMLElement.prototype.hasOwnProperty("_insertBefore")||(HTMLElement.prototype._insertBefore=HTMLElement.prototype.insertBefore,HTMLElement.prototype.insertBefore=function(e,t){if(!s(e.outerHTML))return this._insertBefore(e,t);o(!0,{url:i(e),isEarly:!1})}),HTMLElement.prototype.hasOwnProperty("_appendChild")||(HTMLElement.prototype._appendChild=HTMLElement.prototype.appendChild,HTMLElement.prototype.appendChild=function(e){if(!s(e.outerHTML))return this._appendChild(e);o(!0,{url:i(e),isEarly:!1})}),n(),HTMLObjectElement.prototype._scrollIntoView=HTMLObjectElement.prototype.scrollIntoView,HTMLObjectElement.prototype.scrollIntoView=function(){return o(!1,{action:"scrollIntoView-object"}),!1},HTMLDivElement.prototype._scrollIntoView=HTMLDivElement.prototype.scrollIntoView,HTMLDivElement.prototype.scrollIntoView=function(){return o(!1,{action:"scrollIntoView-div"}),!1},XMLHttpRequest.prototype.hasOwnProperty("_open")||(XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e,t,i,n,r){s(t)?o(!0,{url:t,isEarly:!1}):(window.analyticsReporter.analyticsOptions.withXHR&&window.analyticsReporter.pushUrl("XHRUrls",t,this),this._open.apply(this,arguments))}),HTMLElement.prototype._click=HTMLElement.prototype.click,HTMLElement.prototype.click=function(){this.hasAttribute("download")?o(!1,{action:"download"}):this._click()},e||(window.onerror=function(e){return!0}),!e){console=console||{};for(var f=function(){},v=["debug","error","info","log","warn"],m=0;m<v.length;m++)console[v[m]]&&(console[v[m]]=f)}}catch(e){}}.toString().replace('"__DEBUG__"',e).replace('"__BLACKLIST__"',m(t)).replace('"__OPTIONS__"',m(i))}function Gi(){return"(".concat(Qi(0<arguments.length&&void 0!==arguments[0]&&arguments[0],1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}),")();")}var Ki=e(7),Ji=function(){function n(e,t,i){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");Ki.mixin(this),this.creativeExtensions=e,this.target=t,this.vpaidLog=i,this.stopped=!1,this.debugTracker=new o("CreativeExtensionsHandler")}var e,t,i;return e=n,(t=[{key:"handleExternalScripts",value:function(){if(!this.stopped)for(var e,t=0;t<this.creativeExtensions.length;t++)this.creativeExtensions[t].attributes?(e=this.creativeExtensions[t].attributes.type&&this.creativeExtensions[t].attributes.type.value?this.creativeExtensions[t].attributes.type.value.toLowerCase():null)&&(e=e.toLowerCase(),c(this.vpaidLog,"creativeExtensions",{type:e,src:this.creativeExtensions[t].element}),"gdn"===e||"ias"===e?this._appendExternalScripts(this.creativeExtensions[t].element):"moat"===e&&this._pushExternalMoatTracker(this.creativeExtensions[t].element)):(this._appendExternalScripts(this.creativeExtensions[t]),this.debugTracker.info("jsTrackers scripts was loaded",{script:this.creativeExtensions[t]}))}},{key:"_appendExternalScripts",value:function(e){for(var t=(new DOMParser).parseFromString(e,"text/html").getElementsByTagName("script"),i=0;i<t.length;i++)this.target.appendChild(this._generateScriptElement(t[i]))}},{key:"_generateScriptElement",value:function(e){for(var t=document.createElement("script"),i=0;i<e.attributes.length;i++)t.setAttribute(e.attributes[i].name,e.attributes[i].value);return t.innerHTML=e.innerHTML,t}},{key:"_pushExternalMoatTracker",value:function(e){this.emit("externalMoat",e)}},{key:"destroy",value:function(){this.stopped=!0,this.creativeExtensions=this.target=this.vpaidLog=void 0}}])&&zi(e.prototype,t),i&&zi(e,i),Object.defineProperty(e,"prototype",{writable:!1}),n}();function Xi(e){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Xi(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Xi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Xi(e)?e:String(e)}(n.key),n)}}var $i,Zi=e(7),en=function(){function n(e,t,i){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");Zi.mixin(this),this.store=e,this.tag=t,this.vpaidLog=i,this.vpaidCrawler=Gi,this.onVpaidResourceEvent=this._onVpaidResourceEvent.bind(this)}var e,t,i;return e=n,(t=[{key:"inject",value:function(e){e&&this._injectVpaidCrawler(e)}},{key:"_injectVpaidCrawler",value:function(t){this._getVpaidAnalyticsOptions().deepIframes&&(t.contentWindow.vpaidCrawlerFunc=this.vpaidCrawler),this.onResourceMessage=this._onResourceMessage.bind(this),window.addEventListener("message",this.onResourceMessage),ve(t.contentWindow,this.vpaidCrawler(this.store.get("debug"),this._getBlacklistDomains(),this._getVpaidAnalyticsOptions())),this.vpaidLog.getVpaidAnalyticsReport=t.contentWindow.analyticsReporter.getReport,this.setVpaidAnalyticsIsVideoUrlPublic=function(e){t.contentWindow.analyticsReporter.isVideoUrlPublic=e}}},{key:"_getBlacklistDomains",value:function(){var e;if(!this.stopped)return(e=this.store.get("hjkbldomsencdd"))&&0!==e.length?e:this.store.get("hjkbldoms")}},{key:"_onResourceMessage",value:function(e){var t;!this.stopped&&e.data&&"resourceEvent"===e.data.type&&(c(this.vpaidLog,"resourceEvent",e.data.eventData,!1,!1),-1<(t=e.data.eventData.event).indexOf("malicious")?this._onCrawlerHijackAttempt(t,e.data.eventData):"undefinedIframeSrc"===t?this._onUndefinedRelativeIframeSrcError(e.data.eventData.url):"maxNetworkCalls"===t&&this._onNetworkCallsLimitExceeded())}},{key:"_getVpaidAnalyticsOptions",value:function(){var e=this.store.get("anltcsOptions"),t=this.tag.getValueByKey("mxntwrkclls")||0,i=this.store.get("ifrmswghts");return t&&(e.maxNetworkCalls=t),i&&(e.iframesWeights=i),e}},{key:"_onVpaidResourceEvent",value:function(e,t){this.emit("vpaidResourceEvent",{event:e,data:t})}},{key:"_onCrawlerHijackAttempt",value:function(e,t){this._onVpaidResourceEvent("hijackAttempt",{type:e,data:t})}},{key:"_onUndefinedRelativeIframeSrcError",value:function(e){this._onVpaidResourceEvent("undefinedIframeSrc",{url:e})}},{key:"_onNetworkCallsLimitExceeded",value:function(){this._onVpaidResourceEvent("maxNetworkCalls",{maxNetworkCalls:this.tag.getValueByKey("mxntwrkclls")})}},{key:"destroy",value:function(e){this.stopped||(this.stopped=!0,e&&e.contentWindow&&this._destroyVpaidCrawler(e))}},{key:"_destroyVpaidCrawler",value:function(e){window.removeEventListener("message",this.onResourceMessage),e.contentWindow.analyticsReporter.destroy(),e.contentWindow.destroyCrawler(),this.vpaidLog.getVpaidAnalyticsReport=null}}])&&Yi(e.prototype,t),i&&Yi(e,i),Object.defineProperty(e,"prototype",{writable:!1}),n}(),i=e(5),V=e.n(i),tn={type:"ima",id:27};function nn(e){return(nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==nn(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==nn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===nn(e)?e:String(e)}(n.key),n)}}var sn=function(){function n(e,t,i){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.store=e,this.omidElements=t.omid,this.target=t.slot,this.vpaidLog=i,this.video=t.videoSlot,this.debugTracker=t.debugTracker,this.eventsQueue=[],this.stopped=!1,this.omidAdSession=$i}var e,t,i;return e=n,(t=[{key:"getOmidResources",value:function(){return this.omidElements.map(function(e){return{viewabilityTag:e.scriptUrl,vendor:e.vendor,params:e.verificationParameters}})}},{key:"setOmidSessionStarted",value:function(e){this.omidSessionStarted=!0,this.omidAdSessionId=$i=e,this._fireDelayedEvents(),c(this.vpaidLog,"OMID",{sessionStart:!0})}},{key:"onOmidSessionError",value:function(){c(this.vpaidLog,"OMID",{sessionFinish:!0}),this.omidSessionStarted=!1,this.omidAdSession=void 0}},{key:"setOmidSessionFinish",value:function(){c(this.vpaidLog,"OMID",{sessionFinish:!0}),this.omidSessionStarted=!1,this.omidAdSession=void 0}},{key:"_fireDelayedEvents",value:function(){var t=this;this.eventsQueue.length&&this.eventsQueue.forEach(function(e){t._fireOmidEvents(e)})}},{key:"getActiveVideoElement",value:function(){return this.video}},{key:"_fireOmidEvents",value:function(e){}},{key:"_handleOmidStop",value:function(){}},{key:"dispose",value:function(){this.stopped=!0,this._handleOmidStop(),this.events=this.options=this.omidSessionStarted=void 0}}])&&rn(e.prototype,t),i&&rn(e,i),Object.defineProperty(e,"prototype",{writable:!1}),n}();function on(e){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,i){(t=function(e){e=function(e,t){if("object"!==on(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==on(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===on(e)?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}var I={VIDEO_EVENT:(C(t={INIT:"videoOmsdkInit"},f.a.AdLoaded,"videoAdEvent"),C(t,f.a.AdVideoStart,"AdVideoStart"),C(t,f.a.AdImpression,"videoAdEvent"),C(t,"PLAYBACK_PROGRESS","playbackProgressEvent"),C(t,"INIT_ACK","OmsdkInitAck"),C(t,"INIT_FAIL","OmsdkInitFailure"),C(t,"SESSION_NOT_VALID","sessionIsNotValid"),t),EVENT_TYPE:(C(i={SESSION_START:"sessionStart",SESSION_ERROR:"sessionError",SESSION_FINISH:"sessionFinish"},f.a.AdImpression,"impression"),C(i,f.a.AdLoaded,"loaded"),C(i,f.a.AdVideoStart,"start"),C(i,f.a.AdVideoFirstQuartile,"firstQuartile"),C(i,f.a.AdVideoMidpoint,"midpoint"),C(i,f.a.AdVideoThirdQuartile,"thirdQuartile"),C(i,f.a.AdVideoComplete,"complete"),C(i,f.a.AdPaused,"pause"),C(i,f.a.AdPlaying,"resume"),C(i,f.a.AdSkipped,"skipped"),C(i,f.a.AdVolumeChange,"volumeChange"),C(i,f.a.AdClickThru,"adUserInteraction"),i)};function an(e){return(an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==an(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==an(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===an(e)?e:String(e)}(n.key),n)}}function ln(e,t){return(ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function un(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=cn(i),t=(e=n?(e=cn(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===an(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var hn,pn,fn,vn,mn,yn,gn=function(){var e=r,t=sn;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ln(e,t);var i,n=un(r);function r(e,t,i){if(this instanceof r)return(e=n.call(this,e,t,i))._startOmsdkSession(),e;throw new TypeError("Cannot call a class as a function")}return e=r,(t=[{key:"_startOmsdkSession",value:function(){this._emitSdkEvent(I.VIDEO_EVENT.INIT,{selectorPattern:"#".concat(this.target.id," .cm-ad-player"),measurementResources:this.getOmidResources()}),this._bindSessionEvents()}},{key:"_bindSessionEvents",value:function(){window.taboolaBridge.on(I.VIDEO_EVENT.INIT_ACK,this.setOmidSessionStarted.bind(this)),window.taboolaBridge.on(I.VIDEO_EVENT.INIT_FAIL,this.onOmidSessionError.bind(this)),window.taboolaBridge.on(I.VIDEO_EVENT.SESSION_NOT_VALID,this.onOmidSessionError.bind(this)),window.taboolaBridge.on(I.EVENT_TYPE.SESSION_FINISH,this._handleOmidStop.bind(this))}},{key:"fireEvent",value:function(e){var t=e.type;switch(e.type=I.VIDEO_EVENT[t],t){case"AdVideoStart":this._emitSdkEvent(I.VIDEO_EVENT.PLAYBACK_PROGRESS,{sessionId:this.omidAdSessionId,type:I.EVENT_TYPE[t],params:{duration:e.duration||this.video.duration,adVolume:e.adVolume}});break;case"AdLoaded":case"AdImpression":this._emitSdkEvent(I.VIDEO_EVENT[t],{sessionId:this.omidAdSessionId,type:I.EVENT_TYPE[t]});break;case"AdVolumeChange":this._emitSdkEvent(I.VIDEO_EVENT.PLAYBACK_PROGRESS,{sessionId:this.omidAdSessionId,type:I.EVENT_TYPE[t],params:{adVolume:e.adVolume}});break;default:this._emitSdkEvent(I.VIDEO_EVENT.PLAYBACK_PROGRESS,{sessionId:this.omidAdSessionId,type:I.EVENT_TYPE[t]})}}},{key:"_emitSdkEvent",value:function(e,t){window.taboolaBridge.emit(e,t)}},{key:"_fireOmidEvents",value:function(e){this.fireEvent(e),this.debugTracker.info("OMID fired event:".concat(I.EVENT_TYPE[e.type],", sessionID:").concat(this.omidAdSessionId),e)}},{key:"dispatch",value:function(e){I.EVENT_TYPE[e.type]&&(this.omidSessionStarted?this._fireOmidEvents(e):this.eventsQueue.push(e))}},{key:"_handleOmidStop",value:function(){this.omidAdSession&&this._emitSdkEvent(I.EVENT_TYPE.SESSION_FINISH)}}])&&dn(e.prototype,t),i&&dn(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function bn(e){return(bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t,i){(t=kn(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}function _n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kn(n.key),n)}}function kn(e){e=function(e,t){if("object"!==bn(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==bn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===bn(e)?e:String(e)}function wn(e,t){return(wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function An(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=Tn(i),t=(e=n?(e=Tn(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===bn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function Tn(e){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var En=["limited","domain","full"],Sn=function(){var e=r,t=sn;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wn(e,t);var i,n=An(r);function r(e,t,i){if(this instanceof r)return(e=n.call(this,e,t,i)).events=(O(t={},f.a.AdLoaded,"loaded"),O(t,f.a.AdVideoStart,"start"),O(t,f.a.AdImpression,"impressionOccured"),O(t,f.a.AdClickThru,"adUserInteraction"),O(t,f.a.AdPaused,"pause"),O(t,f.a.AdPlaying,"resume"),O(t,f.a.AdSkipped,"skipped"),O(t,f.a.AdVideoFirstQuartile,"firstQuartile"),O(t,f.a.AdVideoMidpoint,"midpoint"),O(t,f.a.AdVideoThirdQuartile,"thirdQuartile"),O(t,f.a.AdVideoComplete,"complete"),O(t,f.a.AdVolumeChange,"volumeChange"),t),e._init(),e;throw new TypeError("Cannot call a class as a function")}return e=r,(t=[{key:"_init",value:function(){this.store.get("omidScriptsInjected")?this._handleOmidLoaded():this._loadOmidScripts()}},{key:"_loadScript",value:function(n){var r=this;return new Promise(function(e,t){var i=document.createElement("script");i.type="text/javascript",i.src=n,i.async=!0,i.onload=function(){e()},i.onerror=function(){t(n)},r.target.appendChild(i)})}},{key:"_loadOmidScripts",value:function(){var t=this,i=[];[this.store.get("omidWebUrl"),this.store.get("omidSessionUrl")].forEach(function(e){i.push(t._loadScript(e))}),Promise.all(i).then(function(){t.store.set("omidScriptsInjected",!0),t._handleOmidLoaded()}).catch(function(e){t.debugTracker&&t.debugTracker.error("Error loading OMID script ".concat(e))})}},{key:"_handleOmidLoaded",value:function(){var e;this._loadOmidSessionClient()&&(e=this._createOmidPartner(),e=this._createOmidContext(e))&&this._createAdSession(e)}},{key:"_loadOmidSessionClient",value:function(){if(!this.omidSesiontLoaded&&!hn){var e;try{e=window.OmidSessionClient&&window.OmidSessionClient[this.store.get("omidVerificationScriptVersion")]}catch(e){return c(this.vpaidLog,"OMID",{sessionError:!0}),!1}if(!e)return c(this.vpaidLog,"OMID",{sessionError:!0}),!1;this.omidSesiontLoaded=!0,this._ObtainSessionClientClasses(e)}return!0}},{key:"_ObtainSessionClientClasses",value:function(e){hn=e.AdSession,pn=e.Partner,fn=e.Context,vn=e.VerificationScriptResource,mn=e.AdEvents,yn=e.MediaEvents}},{key:"_createOmidPartner",value:function(){var e=this.store.get("omidVerificationScriptVersion");return new pn("Taboola",e)}},{key:"_createOmidContext",value:function(e){var t;try{t=window.top}catch(e){return c(this.vpaidLog,"OMID",{sessionError:!0}),!1}var i=this.store.get("domain"),n=this._getOmidAccessMode(),r=this.omidElements.map(function(e){return new vn(e.scriptUrl,e.vendor,e.verificationParameters,n)}),e=(this.debugTracker.info("OMID accessMode",n),new fn(e,r,i));return e.setServiceWindow(t),e.setVideoElement(this.getActiveVideoElement()),e}},{key:"_getOmidAccessMode",value:function(){return-1<En.indexOf(this.store.get("omidaccsmd"))?this.store.get("omidaccsmd"):"full"}},{key:"_createAdSession",value:function(e){var t=this;this.omidAdSession||(this.omidAdSession=new hn(e),this._trackOmidEvents(),this.omidAdSession.setCreativeType("video"),this.omidAdSession.setImpressionType("beginToRender"),this.omidAdSession.registerSessionObserver(function(e){switch(t.debugTracker.info("OMID fired event:".concat(e.type),e),e.type){case"sessionStart":t.setOmidSessionStarted(e.adSessionId);break;case"sessionError":t.onOmidSessionError();break;case"sessionFinish":t.setOmidSessionFinish();break;default:c(t.vpaidLog,"OMID",{unknownEventType:!0})}}),this.omidAdSession.start(),this.debugTracker.info("OMID session started"))}},{key:"_trackOmidEvents",value:function(){this.sessionAdEvents=new mn(this.omidAdSession),this.mediaEvents=new yn(this.omidAdSession)}},{key:"fireEvent",value:function(e){switch(e.type){case"AdLoaded":this.sessionAdEvents.loaded();break;case"AdVideoStart":this.mediaEvents.start(e.duration,e.adVolume);break;case"AdImpression":this.sessionAdEvents.impressionOccurred();break;case"AdClickThru":this.mediaEvents.adUserInteraction("click");break;case"AdVolumeChange":this.mediaEvents.volumeChange(e.adVolume);break;case"AdPlaying":this.mediaEvents.resume();break;default:this.mediaEvents[this.events[e.type]]()}}},{key:"_handleOmidStop",value:function(){var e;null!=(e=this.omidAdSession)&&e.finish()}},{key:"_fireOmidEvents",value:function(e){this.fireEvent(e),this.debugTracker.info("OMID fired event:".concat(this.events[e.type],", sessionID:").concat(this.omidAdSessionId),e)}},{key:"dispatch",value:function(e){this.omidAdSession||this._handleOmidLoaded(),this.events[e.type]&&(this.sessionAdEvents&&this.omidSessionStarted?this._fireOmidEvents(e):this.eventsQueue.push(e))}}])&&_n(e.prototype,t),i&&_n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function Pn(e){return void 0===e}function Vn(e){return(Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Vn(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Vn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Vn(e)?e:String(e)}(n.key),n)}}var In=e(7),On=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");In.mixin(this),this.store=e,this.userAgent=this.store.get("wurfl")}var e,i,n;return e=t,(i=[{key:"isAutoplaySupported",value:function(){var e=this._isAutoplaySupportedByOS();this._emitDetectionResult(e)}},{key:"_isAutoplaySupportedByOS",value:function(){return this.userAgent.os.name===We?this._isAutoplaySupportedAndroid():this.userAgent.os.name===Ue?this._isAutoplaySupportedFireOS():this.userAgent.os.name===p&&this._isAutoplaySupportedIOS()}},{key:"_isAutoplaySupportedIOS",value:function(){var e;return!(this.userAgent.os.version<10)&&(!!Pn(e=this._isAutoplaySupportedOnBrowser(Qe[p]))||e)}},{key:"_isAutoplaySupportedOnBrowser",value:function(e){if(e.hasOwnProperty(this.userAgent.browser.name))return Pn(e[this.userAgent.browser.name])||this.userAgent.browser.version>=e[this.userAgent.browser.name]}},{key:"_isAutoplaySupportedAndroid",value:function(){var e=this._isAutoplaySupportedOnBrowser(Qe[We]);return!Pn(e)&&e}},{key:"_isAutoplaySupportedFireOS",value:function(){var e=this._isAutoplaySupportedOnBrowser(Qe[Ue]);return!Pn(e)&&e}},{key:"_emitDetectionResult",value:function(e){this.emit("detectIsAutoplaySupported",e)}}])&&Cn(e.prototype,i),n&&Cn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Dn="ad",xn="content";function Mn(e){return(Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Mn(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Mn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Mn(e)?e:String(e)}(n.key),n)}}var Ln=function(){function t(e){if(this instanceof t)return this.video=document.createElement("video"),this.store=e,this.isMobile=this.store.get("isMobile"),this.userAgent=this.store.get("wurfl"),this._addVideoTagMethods(),this._addVideoTagProperties(),this._addVideoTagAttributes(),this.video;throw new TypeError("Cannot call a class as a function")}var e,i,n;return e=t,(i=[{key:"_addVideoTagMethods",value:function(){this._addClearVideoSourcesMethod(),this._addAppendSourceMethod(),this._addAppendVideoSourcesMethod(),this._addProtectVideoPauseMethod(),this._addGetSrcMethod(),this._addHookMutedPropertyMethod(),this._addSupressErrorEventsMethod(),this._addDispatchEventMethod()}},{key:"_addClearVideoSourcesMethod",value:function(){this.video.clearVideoSources=function(){for(;this.childNodes.length;)this.removeChild(this.childNodes[0])}}},{key:"_addAppendSourceMethod",value:function(){this.video.appendSource=function(e,t){var i=document.createElement("source");i.src=e,i.setAttribute("type",t),this.appendChild(i),this.relevantSources++}}},{key:"_addAppendVideoSourcesMethod",value:function(){var s=this;this.video.appendVideoSources=function(e){var t=null;s.video.clearVideoSources();for(var i=0;i<e.length;i++){var n=e[i],r=n.url;s.video.canPlayType(n.originalType)&&(s.store.get("dcdvdurl")&&(r=decodeURI(r)),s.store.get("scrmf")&&"https:"===window.location.protocol&&(r=r.replace("http:","https:")),t||((t=n).mediaUrl=r),s.video.appendSource(r,n.originalType))}return t}}},{key:"_addProtectVideoPauseMethod",value:function(){this.video.protectPause=function(){this._play=this.play,this.play=function(){this.resumeInvoked&&this._play()}}}},{key:"_addGetSrcMethod",value:function(){this.video.getSrc=function(){return this.src||this.currentSrc||""}}},{key:"_addHookMutedPropertyMethod",value:function(){this.isMobile&&(this.video.hookMutedProperty=function(){this.__defineSetter__("_muted",this.__lookupSetter__("muted")),this.__defineSetter__("muted",function(e){this.mutedChangeByUserGesture?(this._muted=e,this.__defineSetter__("muted",this.__lookupSetter__("_muted"))):this._muted=!0})})}},{key:"_addSupressErrorEventsMethod",value:function(){this.video.supressErrorEvents=function(){this.__addEventListener=this.addEventListener,this.addEventListener=function(e,t){"error"!==e&&this.__addEventListener(e,t)}}}},{key:"_addDispatchEventMethod",value:function(){this.video._dispatchEvent=function(e,t){var i=document.createEvent("Event");i.initEvent(e,!0,!0),i.data=t||{},this.dispatchEvent(i)}}},{key:"_addVideoTagProperties",value:function(){this._addProgressPrecentageProperty(),this._addRemainingTimeProperty(),this._addRelevantSourcesProperty(),this._addBufferSizeProperty(),this._addResumeInvokedProperty(),this._addMutedChangeByUserGestureProperty(),this._hookSrcProperty()}},{key:"_addProgressPrecentageProperty",value:function(){Object.defineProperty(this.video,"progressPrecentage",{get:function(){return this.currentTime/this.duration}})}},{key:"_addRemainingTimeProperty",value:function(){Object.defineProperty(this.video,"remainingTime",{get:function(){return this.duration-this.currentTime}})}},{key:"_addRelevantSourcesProperty",value:function(){Object.defineProperty(this.video,"relevantSources",{get:function(){return this._relevantSources||0},set:function(e){this._relevantSources=e}})}},{key:"_addBufferSizeProperty",value:function(){Object.defineProperty(this.video,"bufferSize",{get:function(){if(this.buffered)return 0===this.buffered.length||0!==this.buffered.start(0)?0:this.buffered.end(0)-this.buffered.start(0)}})}},{key:"_addResumeInvokedProperty",value:function(){Object.defineProperty(this.video,"resumeInvoked",{get:function(){return this._resumeInvoked||!1},set:function(e){this._resumeInvoked=e}})}},{key:"_addMutedChangeByUserGestureProperty",value:function(){this.isMobile&&Object.defineProperty(this.video,"mutedChangeByUserGesture",{get:function(){return this._mutedChangeByUserGesture||!1},set:function(e){this._mutedChangeByUserGesture=e}})}},{key:"_hookSrcProperty",value:function(){var t,i,e,n,r,s=this;t=this.video,e=null,n=function(e){return!(""==e&&!s.video.removeSrc)},r="alt_"+(i="src"),t.hasOwnProperty(r)||(t[r]="",Object.defineProperty(t,i,{get:function(){return e?e():this[r]},set:function(e){this[r]=e,n&&n(e)&&t.setAttribute(i,e)}}))}},{key:"_addVideoTagAttributes",value:function(){this.isMobile&&(this.video.muted=!0,this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.userAgent.os.name===p)&&(this.store.get("atplyhk")?(this.video.setAttribute("autoPlay",""),this.video.setAttribute("autoplay",""),this.video.setAttribute("webkit-playsinline",""),this.video.style.willChange="transform",this.video.volume=0):this.video.removeAttribute("autoplay",""))}}])&&Rn(e.prototype,i),n&&Rn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Fn(e){return(Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Fn(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Fn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Fn(e)?e:String(e)}(n.key),n)}}var jn=function(){function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:xn,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},n=this,r=s;if(n instanceof r)return this.store=e,this.videoState=t,this.logToBI=i,this.isMobile=this.store.get("isMobile"),this.video=new Ln(this.store),this._overrideVideoAddEventListener(),this._initVideoMobileParams(),this._addVideoElementProperties(),this._addVideoElementMethods(),this._addTimeupdateEvents(),this._loopThroughMediaSources(),this.video.videoState=this.videoState,this.video;throw new TypeError("Cannot call a class as a function")}var e,t,i;return e=s,(t=[{key:"_initVideoMobileParams",value:function(){this._shouldDetectAutoplay()&&this._detectAutoplay()}},{key:"_shouldDetectAutoplay",value:function(){return this.isMobile}},{key:"_detectAutoplay",value:function(){var e=new On(this.store);e.on("detectIsAutoplaySupported",this._onIsAutoplaySupportedDetected.bind(this)),e.isAutoplaySupported()}},{key:"_onIsAutoplaySupportedDetected",value:function(e){this.logToBI("videoElement",{isAutoplaySupported:e},!1,!1)}},{key:"_overrideVideoAddEventListener",value:function(){this.eventsCb={};var n=this;this.video._addEventListener=this.video.addEventListener,this.video.addEventListener=function(e,t,i){n._addEventCb(e,t),this._addEventListener(e,t,i)}}},{key:"_addEventCb",value:function(e,t){this.eventsCb[e]=this.eventsCb[e]||[],this.eventsCb[e].push(t)}},{key:"_addVideoElementProperties",value:function(){this._addVideoStateProperty(),this._addBufferingProperty()}},{key:"_addVideoStateProperty",value:function(){Object.defineProperty(this.video,"videoState",{get:function(){return this._videoState||xn},set:function(e){this._videoState=e}})}},{key:"_addBufferingProperty",value:function(){var e;this.isMobile&&(e=this.video.buffering||!1,Object.defineProperty(this.video,"buffering",{get:function(){return this._buffering||e},set:function(e){this._buffering=e}}))}},{key:"_addVideoElementMethods",value:function(){this._addRegisterProgressEventsMethod(),this._addRegisterTickingEventsMethod(),this._addDestroyMethod()}},{key:"_addRegisterProgressEventsMethod",value:function(){var n=this;this.video.registerProgressEvents=function(e){n._progressEvents={};for(var t=0;t<e.length;t++){var i="precentage"===e[t].offsetType?e[t].offset:e[t].offset/n.video.duration;n._progressEvents[i]={offset:i,fired:!1}}}}},{key:"_addRegisterTickingEventsMethod",value:function(){var t=this;this.video.registerTickingEvents=function(e){t._ticker=e}}},{key:"_addDestroyMethod",value:function(){var e=this;this.video.destroy=function(){e.video.pause(),e.video.clearVideoSources(),e._cleanVideoSrcProp()}}},{key:"_cleanVideoSrcProp",value:function(){this.video.removeSrc=!0,this.video.src=""}},{key:"_addTimeupdateEvents",value:function(){this.quartiles={q1:!1,q2:!1,q3:!1};var r=this;this.video.addEventListener("timeupdate",function e(){if(!this._buffering){.75<=this.progressPrecentage&&!r.quartiles.q3?(r.quartiles.q3=!0,this._dispatchEvent("thirdQuartile")):.5<=this.progressPrecentage&&!r.quartiles.q2?(r.quartiles.q2=!0,this._dispatchEvent("midpoint")):.25<=this.progressPrecentage&&!r.quartiles.q1&&(r.quartiles.q1=!0,this._dispatchEvent("firstQuartile"));var t,i,n=!0;for(t in r._progressEvents)r._progressEvents[t].fired||(r._progressEvents[t].offset<=this.progressPrecentage?(r._progressEvents[t].fired=!0,this._dispatchEvent("timeProgress",{pre:this.progressPrecentage,time:this.currentTime})):n=!1);r._ticker&&(i=Math.floor(this.currentTime),this._currentTimeFloored!==i)&&i%r._ticker==0&&(this._currentTimeFloored=i,this._dispatchEvent("ticking",{time:i})),n&&r.quartiles.q3&&!r._ticker&&this.removeEventListener("timeupdate",e,!0)}})}},{key:"_loopThroughMediaSources",value:function(){var t=this;this.video.addEventListener("ended",function(){var e;t._isPlayingContent()&&1<t.video.childNodes.length&&(e=t.video.removeChild(t.childNodes[0]),t.video.appendChild(e),t.video.load(),t.video.play())})}},{key:"_isPlayingContent",value:function(){return this.video.videoState===xn}}])&&Bn(e.prototype,t),i&&Bn(e,i),Object.defineProperty(e,"prototype",{writable:!1}),s}();function Wn(e){return(Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Un(e,t){var i,n,r,s,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(i=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){n=!0,r=e},f:function(){try{i||null==o.return||o.return()}finally{if(n)throw r}}};if(Array.isArray(e)||(o=function(e,t){var i;if(e)return"string"==typeof e?Nn(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Nn(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),s=0,{s:t=function(){},n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Hn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Wn(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Wn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Wn(e)?e:String(e)}(n.key),n)}}var qn=e(7),zn=e(27),Qn=0,Gn=0,Kn=function(){function r(e){var t=this;if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");qn.mixin(this),this.store=e.store,this.target=e.target,this.oppsToFireOnce=[],this.created=Date.now(),this.loadedEvent="",this.manager=e.manager,this.clickThoughHandler=new Hi(this.store),this.index=++Qn,this.vpaidWrapperIndex="VpaidWrapper".concat(this.index),this.tagid=e.tagid,this.tag=Object.assign({},e.tag),this.isOmidActive=this.tag.getValueByKey("enblomid")||this.store.get("omid.isActive"),this.tag.vpaidWrapperData={},this.error="",this.readyInMS=0,this.isMultiAdsActive=this.store.get("mltads"),this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit"),this.isAdErrorBeforeAdLoadedActive=this.store.get("aderrbfradlddopactv"),this.adLoadedFired=!1,this.hijackFired=!1,this.blockBringToFront=this.isMultiVpaidUnit&&this.store.get("blckbrngtofrnt"),this.toggleIframeContentDisplayActive=this.store.get("tglifrmcntndsplyactv"),this.waitForAdPausedBeforeResumeAd=this.store.get("wtfradpsdbfrrsmad"),this.externalPlayerItem=this.tag.externalPlayerItem,this.defaultTagPrice=this.store.get("dftgprc"),this.moatTrackers=[],this.bfPriority=this.store.get("bfprty"),this.isVerticalVideoSupported=this.tag.getValueByKey("spprtvrtclvd"),this.targetCSS=this.store.get("adtrgtcss")?this.tag.getValueByKey("trgtcss"):void 0,this.playerDAST=new Lt(this.store),this.vpaidStatuses=Ft.a.Statuses,this.vpaidStatus=new Ft.a.VpaidStatus,this.creatives={},this.stayAlive=!1,this.oldStatus="",this.stopReason="",this.config={},this.vast=[],this.iconsPrograms=[],this.isMobile=this.store.get("isMobile")||!1,this.isIOS=!1,this.isMobile&&(this.isIOS=this.store.get("wurfl.os.name")===p),this.timeoutLengthToAdCompletion=this.tag.getValueByKey("".concat(this.isMobile?"mbl":"dsk","tmouttoadcmpltn")),this.newCompletionByVideoProgress=this.store.get("q5byprgrss"),this.validateViewabilityFiredBeforeCompletion=this.tag.getValueByKey("vldtvwbfrcmp")||!1,this.fireNewCompletionPixel=0<this.timeoutLengthToAdCompletion,this.fireNewCompletionPixel&&(this.timeoutLengthToAdCompletion=he(this.timeoutLengthToAdCompletion)),this.timeoutToAdCompletion=null,this.timeoutToAdCompletionStartTime=0,this.globalAdTimeout=null,this.globalAdTimeoutStartTime=0,this.globalAdTimeoutLength=this.tag.getValueByKey("global_ad_timeout"),this.globalAdTimeoutLength&&0<this.globalAdTimeoutLength&&(this.globalAdTimeoutLength=he(this.globalAdTimeoutLength)),this.externalDelayedEvents=this.store.get("externalDelayedEvents")||[],this.store.get("dbncadvltm")?this.setAdVolume=zn(this._setAdVolume,this.store.get("dbncadvltm")):this.setAdVolume=this._setAdVolume,this.tag.moatSampling=this._decideMoat(),this.tag.moatSampling||(this.delayVideoVpaidImpressionForNonMoatRV=this.tag.getValueByKey("dlyimpnonmoatrv")),this.vpaidLog=e.vpaidLog,c(this.vpaidLog,"tbCompletion",{enabled:!0,length:this.timeoutLengthToAdCompletion||-1,byProgress:this.newCompletionByVideoProgress||!1}),this.pwov=this._getPlayWhenOutOfViewValue(),c(this.vpaidLog,"playWhenOutOfViewData",{playWhenOutOfViewValue:this.pwov,costModel:this.tag.cstmdl}),this._copyFromStoreToBi("connectionType",!1);var i=this.store.get("navigatorConnection");if(c(this.vpaidLog,"navigatorConnection",i,!1,!1),this.store.on("navigatorConnectionChange",this._onNavigatorConnectionChange.bind(this)),this._wfStats=e.wfStats,this._wfStats.increaseVpaidsCount(),this.oppsID=v.a,this.shouldMuteVid=this.store.get("dskVidMuted")&&!this.store.get("isMobile"),this.opportunityManager=e.opportunityManager,this.vpaidEventToPixelId={},this.vpaidEventToPixelId[f.a.AdVideoFirstQuartile]=this.oppsID.videoFirstQuartile,this.vpaidEventToPixelId[f.a.AdVideoMidpoint]=this.oppsID.videoMidpoint,this.vpaidEventToPixelId[f.a.AdVideoThirdQuartile]=this.oppsID.videoThirdQuartile,this.vpaidEventToPixelId[f.a.AdVideoComplete]=this.oppsID.videoComplete,this._sendOpp(this.oppsID.tagStarted),this.unloadCallback=function(e){t._sendOpp(t.oppsID.unloadPage)},this.opportunityManager.isRegisterAvailable("unloadCallbacks",this.unloadCallback,!0),this.debugTracker=new o(this.vpaidWrapperIndex),this.pixelManager=e.pixelManager,this.vpaidResourcesHandler=new en(this.store,this.tag,this.vpaidLog),this.onVpaidResourceEvent=this._onVpaidResourceEvent.bind(this),this.vpaidResourcesHandler.on("vpaidResourceEvent",this.onVpaidResourceEvent),e.creatives)for(var n in e.creatives)this.creatives[n]=e.creatives[n];if(e.config)for(var n in e.config)this.config[n]=e.config[n];this.adVolume=l(parseInt(this.config.VOLUME)?parseInt(this.config.VOLUME):0),this.vpaidEvents=f.a,this.delayedQuartilesOpps=[],this.placement=this.createPlacement(),this.localTarget=this.placement.localTarget,this.adTarget=this.placement.adTarget,this.vpaidHandlersFactory=new ji(this.vpaidLog,this.store),this.handlerOptions={applyBypass:!!this.creatives.AFBP,slot:this.localTarget,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay,protection:this.config.vpaid_protect_path,tag:this.tag,onReady:this._onVpaidReady.bind(this),onError:this._onHandlerError.bind(this),playerDAST:this.playerDAST,vpaidResourcesHandler:this.vpaidResourcesHandler,wrapperIndex:this.index,debugTracker:this.debugTracker,extra:{}},this.externalPlayerItem?this._setNonVideoVpaid():this.nonVideoVpaid?(this._setNonVideoVpaid(),this._createHandler({type:this.nonVideoVpaidType,handlerOptions:this.handlerOptions,vastOptions:{}})):(this.store.get("vpdcntrcstmcss")&&((this.adTarget||this.localTarget).style.cssText+=this.store.get("vpdcntrcstmcss")),this.isIOS&&(this.clickableTarget=this._createClickableTarget(this.localTarget)),this.localVideo=this._createLocalVideo(this.localTarget),this.handlerOptions.videoSlot=this.localVideo,this.handlerOptions.clickableTarget=this.clickableTarget||null,this.parser=e.vastParser,this._createBindedFuncitons(),this._registerToVastParserEvents(),this.adFoundDispatched=!1,this.vpaidHandler=!1,this.stopped=!1,this._handleWfItemByType(),c(this.vpaidLog,"vForce",{vForceIsActive:!0},!1,!1),this.reportVideoStatusToUnitInterval=this.store.get("rprtvidsttsintrvl"),this._initTimers(),this.handelsEarlyAI=this.store.get("erlyai"),this.store.get("debug")&&this._addCopyToClipboardBtn(),this.isReplayable=!1,this._onGotAdIconsBinded=this._onGotAdIcons.bind(this),this._appendVpaidCSS(),this._sendTimeupdateToWrapper=this.tag.getValueByKey("sndvptmrst"),this._reportBuffering=this.tag.getValueByKey("rprtbuffrng"))}var e,t,i;return e=r,(t=[{key:"_getPlayWhenOutOfViewValue",value:function(){var e=this.tag.getValueByKey("optpwov"),t=this.tag.isCPCV?0:100;return t=t,null==(e=e)?t:e}},{key:"_createVideoControls",value:function(e){this.store.get("useVideoControls")&&!1!==this.tag.getValueByKey("ad_controls")&&(this.videoControls=new Dt(this.store.get("isMobile"),{video:this.localVideo,store:this.store,target:this.localTarget,handler:e}),this.videoControls.setOnSoundChangeCallback(this._onSoundChange.bind(this)),this.videoControls.on(b.VOLUME_CHANGE,this.setAdVolume.bind(this)),this.videoControls.on(b.TIMEUPDATE_REGISTER,this.registerToVPAIDVideoTimeupdateEvent.bind(this)),this.videoControls.on(b.GET_AD_DURATION,this.getAdDuration.bind(this)),this.videoControls.on(b.RESET_CONTROLS,this._resetVideoControls.bind(this)))}},{key:"_createBindedFuncitons",value:function(){this.bindedOnVastFound=this._onVastFound.bind(this),this.bindedCreateHandler=this._createHandler.bind(this),this.bindedOnParserError=this._onParserError.bind(this),this.bindedOnNetworkError=this._onNetworkError.bind(this),this.bindedOnBuffering=this._onBuffering.bind(this),this.bindedOnBufferingEnd=this._onBufferingEnd.bind(this)}},{key:"_registerToVastParserEvents",value:function(){this.parser.on(V.a.VastFound,this.bindedOnVastFound),this.parser.on(V.a.VastData,this.bindedCreateHandler),this.parser.on(V.a.ParserError,this.bindedOnParserError),this.parser.on(V.a.NetworkFail,this.bindedOnNetworkError)}},{key:"_unregisterToVastParserEvents",value:function(){this.parser.off(V.a.VastFound,this.bindedOnVastFound),this.parser.off(V.a.VastData,this.bindedCreateHandler),this.parser.off(V.a.ParserError,this.bindedOnParserError),this.parser.off(V.a.NetworkFail,this.bindedOnNetworkError)}},{key:"_decideMoat",value:function(){return!(window.taboolaBridge||this.tag.getValueByKey("dsblmt")||!this.tag.requiredViewability)&&(!(!this.store.get("moat")&&!this.tag.getValueByKey("moat")&&!this.tag.isDirectOrPMP)||!!this.tag.isRTB&&this.store.get("rtbmtfctr")&&re(0,100)<=this.store.get("rtbmtfctr"))}},{key:"_setNonVideoVpaid",value:function(){this.vpaidHandler=!1,this.stopped=!1,this.isReplayable=!1}},{key:"_addCopyToClipboardBtn",value:function(){var e=this,t=document.createElement("div");t.className="playerSaveButton",t.style.zIndex=Gn+10,t.innerHTML="SAVE",this.localVideo.parentElement.appendChild(t),t.addEventListener("click",function(){pt()(e.vpaidLog.toString())})}},{key:"_handleWfItemByType",value:function(){this.tag.t===tn.id?this._createHandler():this.tag.isPrebid?this._handlePrebidItem():this._parseItem()}},{key:"_handlePrebidItem",value:function(){this.tag.prebidHandler.once("receivedBids",this._onPrebidResponse.bind(this)),this.tag.prebidHandler.once("noBids",this._onNoPebidBids.bind(this)),this.tag.prebidHandler.requestBids(this.tag.url,this.localTarget,this.vpaidLog)}},{key:"_onPrebidResponse",value:function(e){this.stopped||(this.tag.request=e.req,this.prebidAdapterSpec=e.spec,this.prebidConf=e.conf,this._sendOpp(this.oppsID.prebidWinResponses,{}),"GET"===this.tag.request.method&&this.tag.request.data&&(this.tag.request.url+="?".concat(function(t){try{return Object.keys(t).map(function(e){return"".concat(e,"=").concat(encodeURIComponent(t[e]))}).join("&")}catch(e){return""}}(this.tag.request.data))),this.tag.url=this.tag.request.url,this._parseItem())}},{key:"_onNoPebidBids",value:function(){this.stopped||(this._sendOpp(this.oppsID.prebidNoRequest,{}),this._handleVpaidEvents(this.vpaidEvents.AdError,{}))}},{key:"_parseItem",value:function(){this.parser.stopped||(this.tag.vast?this.parser.parseVastFromString(this.tag.vast):this.parser.parseVastFromUrl(this.tag.url,this.tag.request&&"GET"!==this.tag.request.method?this.tag.request.data:void 0))}},{key:"_initTimers",value:function(){this._waitForEvent(this.vpaidEvents.AdLoaded,this.tag.getValueByKey("altmot")||this.tag.ADTO,this._onAdLoadedEvent.bind(this),this._onAdLoadedTimeout.bind(this)),this._setTimers()}},{key:"_setTimers",value:function(){var e=this._initTimersStart?Date.now()-this._initTimersStart:0;this._initTimersStart=Date.now(),this._initTillAdstartTimeout(e),this._initAutoKillTimeOut(e)}},{key:"_initTillAdstartTimeout",value:function(e){var t=this,i=(this.tillAdstartTimeout&&clearTimeout(this.tillAdstartTimeout),this.type&&this.store.getByTech("adto",this.type)||this.tag.getValueByKey("adto")||this.tag.ADTO);0<(i-=e)&&(this.tillAdstartTimeout=setTimeout(function(){c(t.vpaidLog,"AdStopADTO",{}),t.error="adto",t._firePixel("AdError",{eventData:{iabErrorCode:s.a.timeout}}),t.stop(t.error,t.oppsID.adtoTimeout)},i))}},{key:"_initAutoKillTimeOut",value:function(e){var t=this,i=(this.autoKill&&clearTimeout(this.autoKill),this.type&&this.store.getByTech("vakll",this.type)||this.tag.getValueByKey("vakll")||9e4);0<(i-=e)&&(this.autoKill=setTimeout(function(){c(t.vpaidLog,"AutoKill",{timeout:i}),t.error="autoKill",t.emit(t.vpaidEvents.AdVideoComplete,{eventData:t}),t._firePixel("AdError",{eventData:{iabErrorCode:s.a.timeout}}),t.stop(t.error,t.oppsID.globalTimeout)},i))}},{key:"_killTimers",value:function(){if(clearTimeout(this.autoKill),clearTimeout(this.tillAdstartTimeout),clearTimeout(this.adloadedTimeout),this.pendingEvents)for(var e in this.pendingEvents)-1!=this.pendingEvents[e].timeoutId&&clearTimeout(this.pendingEvents[e].timeoutId);this.pendingEvents={}}},{key:"_createClickableTarget",value:function(e){var t,i,n;if(!this.stopped)return t=document.createElement("div"),i=this.store.get("width"),n=this.store.get("height"),t.className="cm-ad-click-target",t.style.cssText="width: ".concat(i,"px; height: ").concat(n,"px; cursor: pointer; position: absolute; top: 0px; left: 0px;"),t.style.display="",t.setAttribute("width",i),t.setAttribute("height",n),e.appendChild(t),t}},{key:"_createLocalVideo",value:function(e){var t,i,n,r=this;if(!this.stopped)return t=this.store.get("width"),i=this.store.get("height"),(n=new jn(this.store,Dn,c.bind(this,this.vpaidLog))).className="cm-ad-player",n.style.cssText="width: ".concat(t,"px; height: ").concat(i,"px;"),n.style.display="",!1===this.tag.getValueByKey("strch")?n.style.objectFit="contain":this.store.get("wurfl.browser.name")===qe&&a(n,"ie-black-edges"),n.volume=0,this.shouldMuteVid&&(n.muted=!0),n.setAttribute("width",t),n.setAttribute("height",i),n.addEventListener("timeupdate",function(e){r._onTimeupdate(n)}),this.config.videoSlotControls&&n.removeAttribute("controls"),this.store.get("addprld")&&n.setAttribute("preload","auto"),e.appendChild(n),n}},{key:"_onHandlerError",value:function(e,t){c(this.vpaidLog,"earlyError",{errMsg:e}),this.loadedEvent||(this.status="error",this.stopped)||(this.emit(this.vpaidEvents.AdError,{eventData:e}),"adUnitLoadFailed"===t&&(c(this.vpaidLog,"adUnitLoadFailed",{errMsg:e}),this._firePixel("AdError",{eventData:{iabErrorCode:s.a.timeout}}),this.stop("adUnitLoadFailed",v.a.adUnitLoadFailed)))}},{key:"_onVpaidReady",value:function(){this.stopped||(this.store.get("dlyastsld")&&!this.tag.requiredViewability?(this.delayAssetsLoad=!0,this.status="ready"):this._onHandlerCreated())}},{key:"_onHandlerCreated",value:function(){var e=this;this.stopped||(c(this.vpaidLog,"createdVpaidHandler",{}),this._connectToVpaidHandler(),this.vpaidHandler.handshakeVersion("2.0"),c(this.vpaidLog,"initAd",{}),this.on("unit::viewability",function(){e.unitVieawbility=!0,c(e.vpaidLog,"unitVieability",{isFired:!0})}),this.vpaidHandler.initAd(this.config.width,this.config.height,this.config.viewMode,this.config.bitrate,{AdParameters:this.creatives.AdParameters},{slot:this.localTarget,videoSlot:this.localVideo,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay}))}},{key:"_connectToVpaidHandler",value:function(){if(!this.stopped)for(var e in this.vpaidEvents)this.vpaidHandler.subscribe(this._handleVpaidEvents.bind(this,this.vpaidEvents[e]),this.vpaidEvents[e])}},{key:"_adLoadedHandler",value:function(e){this.stopped||(this.adLoadedFired=!0,this.debugTracker.time("[VpaidWrapper".concat(this.index,"] adLoaded->startAd()")),this.debugTracker.info("RequiredViewability:".concat(this.tag.requiredViewability)),this.loadedEvent=this.loadedEvent+" "+e,this.readyInMS=Date.now()-this.created,this.debugTracker.info("Ad loaded now => pause it srcEvent",e),this._sendOpp(v.a.adLoaded),this.vpaidStatus.setStatus(this.vpaidStatuses.adLoaded),this.status="ready",this._setIsUnpaused(!0),this.store.emit("vpaidReady",this),this.setAdVolume(this.adVolume),this.adFoundDispatched=!0,this.vpaidHandler.checkUnfriendlyIframe&&(this.isUnfriendlyIframe=this.vpaidHandler.checkUnfriendlyIframe()),this.type&&this.type==_.VPAID&&(this.logVpaidFamily(),this.earlySrcVPAID=!1,e=this._isVideoSrcExist())&&(this.earlySrcVPAID=!0,this.isMobile)&&this.vpaidHandler.prefetchVideo&&(this.vpaidHandler.prefetchVideo(_.VPAID,e),this.debugTracker.info("_adLoadedHandler() -> javascript vpaidHandler.prefetchVideo() src:".concat(e))),this.vpaidResourcesHandler&&this.vpaidResourcesHandler.setVpaidAnalyticsIsVideoUrlPublic&&this.vpaidResourcesHandler.setVpaidAnalyticsIsVideoUrlPublic(""!==this.getVideoUrl()),"any"!==(e=this.store.get("rvfrquesttsemttr"))&&this.tag.requiredViewability!==e)||this.store.emit(g.outer.EmitQueueStatus)}},{key:"startAd",value:function(e){var t=this;this.delayAssetsLoad?(this.startAdOptions=e,this._onHandlerCreated()):(e.getDebugData&&this.setDebugDataFunc(e.getDebugData),this.predictorId=e.predictId,this.getAdId=e.id,this.startTimestamp=new Date,this.adStarted=!0,this.debugTracker.timeEnd("[VpaidWrapper".concat(this.index,"] adLoaded->startAd()")),this.setAdVolume(this.adVolume),this._startForceAdVolumeInterval(),this.options=Object.assign(e||{},this.store.get("getAdData")),this.isStarted=!0,this.store.incr("ads_started"),this.vpaidStatus.setStatus(this.vpaidStatuses.startAd),this.type!==_.VIDEO?this._sendStartAdOpp():addEventListener("AdResume",this._sendStartAdOpp.bind(this),!1),c(this.vpaidLog,"adOptions",{count:this.options.count,getAdRetries:this.options.getAdRetries,requiredViewability:this.options.requiredViewability,predictorId:this.options.predictId},!1,!1),c(this.vpaidLog,"startAd",{}),this.earlyAdImpression||this._waitForEvent(this.vpaidEvents.AdImpression,this._getStartAdToAdImpressionTimeout(),this._onAdImpressionEvent.bind(this,e),this._onAdImpressionTimeout.bind(this)),this.isUnPaused?(this.debugTracker.info("startAd()"),this.vpaidHandler.startAd()):(this.debugTracker.info("resumeAd() from startAd()"),this.vpaidHandler.resumeAd()),clearTimeout(this.tillAdstartTimeout),this.working=!0,this.earlyAdImpression&&(this._onAdImpression(),this.manager)&&this.manager.cleanGetAdTimeout(e),this.nonVideoVpaid||this.externalPlayerItem||(this.vpaidHandler.on("activeAdCurrentTime",function(e){t.emit("activeAdCurrentTime",e)}),this.newCompletionByVideoProgress&&(this._newCompletionListener=function(){t._newCompletionHandler("timerEnded")},this.vpaidHandler.on(g.outer.NewCompletion,this._newCompletionListener)),this.tag.getValueByKey("wtchprgrssopp")&&this.tag.isDirectDemand&&this.vpaidHandler.on("watchProgress",function(e){t._onVpaidTimeupdated(e.currentTime)}),this._reportBuffering&&(this.vpaidHandler.on("buffering",this.bindedOnBuffering),this.vpaidHandler.on("bufferingEnded",this.bindedOnBufferingEnd))))}},{key:"_getStartAdToAdImpressionTimeout",value:function(){var e=this.store.get("rv1adimptmot"),t=this.store.get("ppdAdImpressionTimeoutInMS");return this.store.get("isPPD")?t:this.tag.requiredViewability&&0<e?e:this.store.get("adimptmot")||0}},{key:"_checkNativeAdSettingInTag",value:function(){this.tag&&this.tag.nas&&this._isOppEnabled(this.oppsID.nativeAdSettingsInWF)&&this._sendOpp(this.oppsID.nativeAdSettingsInWF)}},{key:"_sendStartAdOpp",value:function(){removeEventListener("AdResume",this._sendStartAdOpp),this._sendOpp(this.oppsID.startAd),this._dispatchToExternalExtensions("startAd"),this.store.set("ads_started_fired",!0)}},{key:"_startForceAdVolumeInterval",value:function(){var e,t,i=this;this.isMobile||this.nonVideoVpaid||this.externalPlayerItem||(e=this.store.get("frcadvlmtrvl"),!this.setAdVolumeInterval&&0<e&&(t=this.store.get("stpfrcvlevnt")||this.vpaidEvents.AdVideoFirstQuartile,this.vpaidHandler.subscribe(function(){i._stopForceAdVolumeInterval()},t),this.setAdVolumeInterval=setInterval(function(){i.vpaidHandler&&!i.vpaidHandler.stopped?i.setAdVolume(i.adVolume):clearInterval(i.setAdVolumeInterval)},e)))}},{key:"_stopForceAdVolumeInterval",value:function(){this.isMobile||(clearInterval(this.setAdVolumeInterval),this.setAdVolumeInterval=0)}},{key:"restartAd",value:function(){var e=this;this.isReplayable&&(this.opportunityManager.unpause(),this._sendOpp(this.oppsID.replayAd),this.opportunityManager.pause(),this.pixelManager.pause(),this.working=this.isStarted=this.adStarted=!0,this.store.incr("ads_started"),this._setClickThroughData(),this.vpaidHandler.restartAd(this.getVideoUrl(),this.clickThruUrl),setTimeout(function(){e.bringToFront()}))}},{key:"isReplayableVpaid",value:function(){return this.tag.getValueByKey("rplvpdactv")&&this.vpaidHandler&&this.vpaidHandler.isReplayable()}},{key:"dontDie",value:function(){this.tag&&(this.tag.singleAd||this.tag.adjacencyAd)&&(this.stayAlive=!0,this.vpaidHandler&&this.vpaidHandler.dontDie&&this.vpaidHandler.dontDie(),this._killTimers())}},{key:"_handleStopped",value:function(e){this.moveToBack(),this.stop(e.type,e.oppType),this.working=!1}},{key:"pauseAd",value:function(){!this.stopped&&this.isUnPaused&&(this.waitForAdPausedBeforeResumeAd&&(this.isUnPaused&&(this.adPausedFired=!1),this.resumeOnAdPaused)&&(this.resumeOnAdPaused=!1),this.pauseAdStartTime=Date.now(),this.working=!1,this.vpaidHandler.pauseAd(),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout())}},{key:"resumeAd",value:function(){this.stopped||!this.isMultiAdsActive&&this.store.get("forcePause")||(this.waitForAdPausedBeforeResumeAd&&!this.adPausedFired?this.resumeOnAdPaused=!0:(this.resumeOnAdPaused=!1,this.working=!0,this.vpaidHandler.resumeAd(),this.externalPlayerItem||a(this.localVideo,"cm-ad-player-active"),this.workingVpaid||(this._isDelayedVideoVpaidImpression()&&(this._fireNetworkAdImpression(),this.pixelManager.firePixel("AdVideoStart",{})),this._dispatchToExternalExtensions("AdVideoStart",!0,!0),this._dispatchToExternalExtensions("AdImpression",!0,!0)),!this.isMultiVpaidUnit||this.isVerticalVideoSupported&&this.isVertical||this.resizeAd(this.store.get("width"),this.store.get("height")),this.videoControls&&!this.workingVpaid&&(this.videoControls.resetAdControls(),this.isMobile)&&this._setVideoControlsState({playerState:Dn}),this.store.set("ad_controls",!1!==this.tag.getValueByKey("ad_controls")),this.workingVpaid=!0,this.nonVideoVpaid||this.externalPlayerItem||(this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this.vpaidHandler&&this.vpaidHandler.handleVpaidContent&&this.vpaidHandler.handleVpaidContent()),this._reportVideoProgress()))}},{key:"_reportVideoProgress",value:function(){var i=this;this.isVideoProgressingInterval||(this.videoProgressing=!0,this.isVideoProgressingInterval=setInterval(function(){i.vpaidHandler.getAdRemainingTime(function(e,t){i.isUnPaused&&(t=parseInt(t),!i.lastRemainingTime||t<i.lastRemainingTime?(i.lastRemainingTime=t,!i.videoProgressing):i.videoProgressing)&&(i.videoProgressing=!i.videoProgressing,c(i.vpaidLog,"videoProgress",{progress:i.videoProgressing,reaminingTime:t},!1,!1))})},1e3))}},{key:"_setGlobalAdTimeout",value:function(){var e=this;this.globalAdTimeoutLength&&0<this.globalAdTimeoutLength&&!this.globalAdTimeout&&(this.globalAdTimeoutStartTime=Date.now(),this.globalAdTimeout=setTimeout(function(){e.stopped||e.stop("global_ad_timeout",e.oppsID.globalAdTimeout)},this.globalAdTimeoutLength))}},{key:"_pauseGlobalAdTimeout",value:function(){this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this.globalAdTimeoutLength-=Date.now()-this.globalAdTimeoutStartTime)}},{key:"_setTimeoutToAdCompletion",value:function(){var e=this,t=this.newCompletionByVideoProgress&&null!=this.vpaidHandler.activeVideoElement;!this.timeoutToAdCompletion&&0<this.timeoutLengthToAdCompletion&&!this._isOppSent(this.oppsID.newCompletion)&&!t&&(this.timeoutToAdCompletionStartTime=Date.now(),this.timeoutToAdCompletion=setTimeout(function(){e.stopped||e._newCompletionHandler("timerEnded")},this.timeoutLengthToAdCompletion))}},{key:"_pauseAdTimeoutToCompletion",value:function(){this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.timeoutLengthToAdCompletion-=Date.now()-this.timeoutToAdCompletionStartTime)}},{key:"_fireNewCompletionEvent",value:function(){this._sendOppOnce(this.oppsID.newCompletion),this.vpaidStatus.setStatus(this.vpaidStatuses.adComplete),this.emit(g.outer.NewCompletion),this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion)),this.unsubscribe(this._newCompletionListener,g.outer.NewCompletion)}},{key:"getVideoUrl",value:function(){return this.videoUrl||(this.videoUrl=this.vpaidHandler.getVideoUrl?this.vpaidHandler.getVideoUrl():""),this.videoUrl}},{key:"_setVideoDataToPlayerDAST",value:function(){var e={vu:this.getVideoUrl()},t=this.localVideo;(t=this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement?this.vpaidHandler.getVPAIDVideoElement()||t:t)&&(e.edr=t.duration,e.ewd=parseInt(t.videoWidth),e.eht=parseInt(t.videoHeight)),this.playerDAST.set(e)}},{key:"_logVideoUrlCounter",value:function(){var e=(e=this.getVideoUrl())||"na",t=this.store.get("videoUrlsCounter")||{},e=(t[e]=t.hasOwnProperty(e)?++t[e]:1,c(this.vpaidLog,"videoUrlCounter",{videoUrl:e,counter:t[e]},!1,!1),Object.keys(t));c(this.vpaidLog,"sessionUniqueVideoUrls",{counter:e.length,urls:e},!0,!1),this.store.set("videoUrlsCounter",t)}},{key:"_dispatchToExternalExtensions",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];!1===t||"AdPaused"===e&&this._checkFirstAdPaused()||(this._dispatchMoatEvents(e,i),this._dispatchOmidEvents(e,i))}},{key:"_dispatchOmidEvents",value:function(e,t){"AdPlaying"==e&&this._checkFirstPlayEvent()||this._checkDelayEvents(e,t)||this.omidHandler&&this.omidHandler.dispatch({type:e,duration:this.vpaidHandler.getAdDuration(),adVolume:this.adVolume})}},{key:"_checkFirstPlayEvent",value:function(){return!!this.isFirstPlay&&!(this.isFirstPlay=!1)}},{key:"_dispatchMoatEvents",value:function(e,t){if(!this._isDelayedImpressionByMoat()||!this._checkDelayEvents(e,t)&&this.tag.moatSampling)for(var i=0;i<this.moatTrackers.length;i++)this.moatTrackers[i].dispatch({type:e,adVolume:this.adVolume})}},{key:"_checkDelayEvents",value:function(e,t){return-1<this.externalDelayedEvents.indexOf(e)&&!t}},{key:"_checkFirstAdPaused",value:function(){if(!this.isFirstAdPaused)return this.isFirstAdPaused=!0,this.isFirstPlay=!0}},{key:"_handleVpaidEvents",value:function(e,t){var i=this;if(this.vpaidEvents){if(this.type===_.VPAID&&(this.tag.getValueByKey("cmpltonstpd")||this._getAdSettingValue("cmpltonstpd")||this.vpaidHandler.completeOnAdStop)){if(e===this.vpaidEvents.AdVideoComplete)return void(this.vpaidHandler&&this.vpaidHandler.setCompletionOnAdStoppedTimeout&&this.vpaidHandler.setCompletionOnAdStoppedTimeout());e===this.vpaidEvents.AdStopped&&(e=this.vpaidEvents.AdVideoComplete)}!this.isFirstVpaidEvent&&this.vpaidHandler&&this.vpaidHandler._getMediaUrl()&&(this.isFirstVpaidEvent=!0,c(this.vpaidLog,"mediaUrl",{url:this.vpaidHandler._getMediaUrl()},!1,!1),this._checkIfGoogle());var n,r=!0;if(!this.stopped){switch(e!==this.vpaidEvents.AdStarted&&(n=this._firePixel(e,t)),e!==this.vpaidEvents.TimeUpdated&&this.debugTracker.info("VpaidHandler-event",e),this._dispatchToExternalExtensions(e,n),this._onEvent(e),e){case this.vpaidEvents.AdLoaded:this._adLoadedHandler(e),this.vpaidLog.getVpaidAnalyticsReport&&(s=this.vpaidLog.getVpaidAnalyticsReport(),c(this.vpaidLog,"vpaidAnalyticsUntilAdloaded",s)),this.vpaidHandler.getAdIcons&&this.vpaidHandler.getAdIcons(this._onGotAdIconsBinded);break;case this.vpaidEvents.AdImpression:if(this.store.emit("playContentAfterFirstAd"),this._setVideoDataToPlayerDAST(),r=this._onAdImpression(e),this._logVideoUrlCounter(),this._handleVerticalAd(parseInt(this.store.get("width")),parseInt(this.store.get("height"))),this.earlyAdImpression)return;break;case this.vpaidEvents.AdVideoStart:this.adVideoStartOppSent||(this._sendOpp(this.oppsID.adVideoStart),this.adVideoStartOppSent=!0),this.setAdVolume(this.adVolume),this.adFoundDispatched||(this.adFoundDispatched=!0,this.emit(this.vpaidEvents.AdFound)),this.pixelManager.firePixel(y.start,e),this._setIsUnpaused(!0),this.debugTracker.info("_handleVpaidEvents() -> AdStarted || AdVideoStart -> this.isUnPaused = true");break;case this.vpaidEvents.AdSkipped:this._fireNewCompletionEvent(),this._handleStopped({type:e,oppType:this.oppsID.adSkiped}),this.adStoppedHandler(e);break;case this.vpaidEvents.AdStopped:this.adStoppedHandler(e),this._handleStopped({type:e});break;case this.vpaidEvents.AdLog:this.debugTracker.info("VpaidHandler-Log",arguments);break;case this.vpaidEvents.AdError:this.vpaidStatus.setStatus(this.vpaidStatuses.adError);var s=this.oppsID.adError;this.isAdErrorBeforeAdLoadedActive&&!this.adLoadedFired&&(s=this.oppsID.adErrorBeforeLoad),this.type===_.VIDEO?this.stop("Mp4AdError",s):this.stop("AdError",s,t);break;case this.vpaidEvents.SoundViolation:this.store.get("sndvltopp")&&!this.alreadySentSoundViolation&&(this.alreadySentSoundViolation=!0,this._sendOpp(this.oppsID.soundViolation));break;case this.vpaidEvents.AdPaused:this.pauseAdStartTime=void 0,this.adPausedFired=!0,this.waitForAdPausedBeforeResumeAd&&this.resumeOnAdPaused&&this.resumeAd(),this._setIsUnpaused(!1),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout();break;case this.vpaidEvents.AdClickThru:this._fireNewCompletionEvent(),t=this._adClickThroughData(t),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout();break;case this.vpaidEvents.AdPlaying:this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this._fireAdPlaying();case this.vpaidEvents.AdStarted:this._sendOppOnce(this.oppsID.adStarted),this._setIsUnpaused(!0),this.pixelManager.firePixel(y.creativeView,this.vpaidEvents.AdStarted);break;case this.vpaidEvents.AdVolumeChange:t&&t.eventData&&t.eventData.volume&&(this.adVolume=l(t.eventData.volume),this._dispatchToExternalExtensions(e,!0===this.hadImpression));break;case this.vpaidEvents.TimeUpdated:c(this.vpaidLog,"videoTicking",{time:t.eventData.time}),this._onVpaidTimeupdated(t.eventData.time);break;case this.vpaidEvents.BlockingTagPassback:this._sendOpp(this.oppsID.blockingTagPassback);break;case this.vpaidEvents.SlowConnection:this._isOppEnabled(this.oppsID.slowConnection)&&this._sendOpp(this.oppsID.slowConnection);break;case this.vpaidEvents.OmidSessionStart:this._sendOpp(this.oppsID.omidSessionsStart);break;case this.vpaidEvents.OmidSessionFinish:this._sendOpp(this.oppsID.omidSessionsFinish)}this.emit(e,{type:e,data:t});var o=this.nonVideoVpaid?0:this.externalPlayerItem?this.getExternalAdCurrentTime():this.localVideo.currentTime;if(-1===["AdDurationChange","AdSizeChange","AdLinearChange","AdLog","AdSkippableStateChange","AdExpandedChange","AdInteraction","AdUserClose","AdSkipped","Progress","AdVolumeChange"].indexOf(e)&&c(this.vpaidLog,"event_"+e,{isViewable:!document.hidden,vidCurrentime:o,eventDataStr:t?m(t.eventData):null}),n&&this.vpaidEventToPixelId.hasOwnProperty(e)&&(this.hadImpression?this._sendOpp(this.vpaidEventToPixelId[e]):this.delayedQuartilesOpps.push(this.vpaidEventToPixelId[e])),this.vpaidEvents)if(e===this.vpaidEvents.AdClickThru)this.clickThruUrl=t&&t.eventData?t.eventData.url:"",this.isClicked=!0,this.clickThoughHandler.invokeClick(t.eventData);else if(e==this.vpaidEvents.AdVideoComplete){if(this.adCompleted=!0,this._newCompletionHandler(this.vpaidEvents.AdVideoComplete,n),this.stayAlive)return this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout)),void this.emit("end");this.vpaidHandler.stopAd(),setTimeout(function(){i.working=!1,i.workingVpaid=!1,i.stop("AdVideoComplete"),i.status="stopped"},2)}else e==this.vpaidEvents.AdLoaded&&this.delayAssetsLoad&&(this.delayAssetsLoad=!1,this.startAd(this.startAdOptions));this.manager&&r&&this.manager.trigger(e,this,t?t.eventData:null)}}}},{key:"_setIsUnpaused",value:function(e){this.isUnPaused=e,this._setVideoControlsState({isPaused:!e})}},{key:"_onVpaidTimeupdated",value:function(e){this._sendOpp(this.oppsID.vpaidProgress,{sdid:e})}},{key:"_onGotAdIcons",value:function(e,t){c(this.vpaidLog,"ad_choices",{vpaid:{error:e,result:t}},!1,!1)}},{key:"_newCompletionHandler",value:function(e,t){!this._isOppSent(this.oppsID.newCompletion)&&(this.timeoutToAdCompletion||this.fireNewCompletionPixel||this.newCompletionByVideoProgress)&&(this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion)),this._validateNewCompletionFiring(e,t)?this._fireNewCompletionEvent():c(this.vpaidLog,"fireNewCompletionPrevented",{reason:e},!1,!1))}},{key:"_validateNewCompletionFiring",value:function(e,t){return this.validateViewabilityFiredBeforeCompletion&&!this.unitVieawbility?(c(this.vpaidLog,"completionBeforeViewability",{videoTime:this.localVideo.currentTime||-1,newCompletionByVideoProgress:this.newCompletionByVideoProgress||!1,reason:e||"na",paused:this.localVideo.paused||!1,ended:this.localVideo.ended||!1}),!1):e===this.vpaidEvents.AdVideoComplete?t&&this.opportunityManager.alreadySent(this.tag,this.oppsID.videoComplete):"timerEnded"===e}},{key:"_setClickThroughData",value:function(){this.clickThruUrl=this.clickThruUrl||this.pixelManager.getClickThruUrl()}},{key:"_adClickThroughData",value:function(e){var t;return e&&e.eventData&&e.eventData.url||(t=this.pixelManager.getClickThruUrl())&&(t={url:t},e?e.eventData=Object.assign(e.eventData||{},t):e={eventData:t}),e}},{key:"_checkIfGoogle",value:function(){var e,t,i=this.localTarget.querySelector("iframe");if(i){e=i,t=this.store.get("debug");var n={current:e,hasNext:function(){try{return!t&&e.contentWindow.console.error&&(this.current.contentWindow.console.error=function(){}),this.current=this.current.contentDocument.querySelector("iframe"),!0}catch(e){return!1}}};for(this.isGoogleIframe=!1;!this.isGoogleIframe&&n.hasNext();)this._isGoogleIframe(n.current)&&(this.isGoogleIframe=!0)}}},{key:"_isGoogleIframe",value:function(e){return e&&-1<e.src.indexOf("imasdk.googleapis.com")&&-1<e.src.indexOf("bridge")}},{key:"_onAdImpression",value:function(){var e=!0,t=this.store.get("rstmrai");return this.fireViewTracking&&this.fireViewTracking(),t&&this._killTimers(),!this.adStarted&&this.handelsEarlyAI?(this.earlyAdImpression=!0,this._sendOpp(this.oppsID.earlyAdImpression),this.pauseAd(),this._setIsUnpaused(!1),c(this.vpaidLog,"earlyAdImpression",{early:!0}),clearTimeout(this.tillAdstartTimeout),this.tag.getValueByKey("prvnterlyadimpopp")||this.adSettings&&this.adSettings.prvnterlyadimpopp||this._shouldSkipEarlyAdImpression()||this._fireAdImpression(),!1):(this.hadImpression?e=!1:(t=this.store.get("conversionsCount")+1,this.store.set("conversionsCount",t),c(this.vpaidLog,"success",{count:t},!0,!1),this.setAdVolume(this.adVolume),this.emit(this.vpaidEvents.AdImpression),this._fireAdImpression(),this.adImpInMS=Date.now()-this.created,this.hadImpression=!0,this._wfStats.increaseSuccess(),this.vpaidHandler&&this.vpaidHandler.logVideoUrl&&this.vpaidHandler.logVideoUrl(),this.vpaidHandler&&!this.vpaidHandler.activeVideoElement&&this._sendOpp(this.oppsID.unfriendlyVideo),this.isReplayable=this.isReplayableVpaid(),c(this.vpaidLog,"restartAd",{isReplayable:this.isReplayable},!1,!1),this.playerDAST.onImpression()),this.earlyAdImpression&&this.manager&&this.manager.trigger("AdImpression",this,null),e)}},{key:"_shouldSkipEarlyAdImpression",value:function(){if(this.type===_.VPAID&&this.store.get("jsDsbleErlyai")&&this.tag.requiredViewability)return!0}},{key:"_firePixel",value:function(e,t){return!!("AdVideoComplete"===e&&!this.hadImpression||e===this.vpaidEvents.AdImpression&&this.hadImpression||this.asyncAdimpression)||!(-1<this.externalDelayedEvents.indexOf(e)&&this._isDelayedVideoVpaidImpression())&&("AdPaused"===e&&!this.ignoredFirstAdPausedPixel&&this._isDelayedVideoVpaidImpression()?this.ignoredFirstAdPausedPixel=!0:((t=t||{}).impressionId=this.parser?this.parser.startTime:"",t.adDuration=1e3*(this.externalPlayerItem?this.getExternalAdDuration():this.localVideo.duration||0),this.pixelManager.firePixel(e,t)))}},{key:"_fireAdImpression",value:function(){this.adimpFired||(this._isDelayedVideoVpaidImpression()?(this.vpaidStatus.setStatus(this.vpaidStatuses.adImpression),this._isOppEnabled(this.oppsID.delayedImpression)&&this._sendOpp(this.oppsID.delayedImpression)):(this.asyncAdimpression||(c(this.vpaidLog,"fireAsyncAdimpression",{end:!0}),this._fireNetworkAdImpression()),this.vpaidStatus.setStatus(this.vpaidStatuses.adImpression)))}},{key:"_isDelayedVideoVpaidImpression",value:function(){return this._isDelayedImpressionByMoat()||this._isDelayedImpressionByReadMore()}},{key:"_isDelayedImpressionByMoat",value:function(){return this.type===_.VIDEO&&(this.tag.moatSampling||"any"===this.delayVideoVpaidImpressionForNonMoatRV||this.tag.requiredViewability===this.delayVideoVpaidImpressionForNonMoatRV)}},{key:"_isDelayedImpressionByReadMore",value:function(){return this.store.get("isFireDelayImpReadMore")}},{key:"_fireNetworkAdImpression",value:function(){for(this._sendOpp(this.oppsID.tagImpression),this._checkNativeAdSettingInTag(),this.pixelManager.firePixel(this.vpaidEvents.AdImpression,{}),this.adimpFired=!0,this.store.get("isFirstImpression")&&(this.store.set("isFirstImpression",!1),this.fire99());this.delayedQuartilesOpps&&this.delayedQuartilesOpps.length;)this._sendOpp(this.delayedQuartilesOpps.shift())}},{key:"_fireAdPlaying",value:function(){this.hadImpression&&this.workingVpaid&&(this._sendOppOnce(this.oppsID.adPlaying),this.manager._terminatePPDFlow(this.tag.advType),this.vpaidStatus.setStatus(this.vpaidStatuses.adPlay))}},{key:"adStoppedHandler",value:function(e){var t=this;this.stop(),setTimeout(function(){t._cleanVpaid()},1e4)}},{key:"_setAdVolume",value:function(e,t){this.stopped||this.nonVideoVpaid||this.externalPlayerItem||(0===this.adVolume&&0<e&&this._sendOppOnce(this.oppsID.adUnmuted),t&&this.localTarget.querySelector(":hover")==this.localVideo&&this._sendOpp(this.oppsID.soundOnHover),e=l(e),this.adVolume=e,this.shouldMuteVid&&(this.localVideo.volume=e,this.localVideo.muted=0===e),0<this.adVolume&&this.setAdVolumeInterval&&this._stopForceAdVolumeInterval(),this.store.get("frcmtfrms")&&this._setVolumeInIframes(this.localTarget.getElementsByTagName("iframe"),e),this.vpaidHandler&&(this.vpaidHandler.setAdVolume(e,t),this.vpaidHandler.callIMAApi)&&this.vpaidHandler.callIMAApi("volume",e),0<e?this._firePixel(g.inner.Unmute,{}):this._firePixel(g.inner.Mute,{}))}},{key:"_setVolumeInIframes",value:function(e,t){var i=this;le(e[0],"iframe",function(e){e.forEach(function(e){i._overideVolumeInIframe(e),e.setAttribute("tbvol",t),e.volume=t,i.shouldMuteVid&&(e.muted=0===t)})},_.VIDEO,this.store.get("debug"))}},{key:"_overideVolumeInIframe",value:function(e){var t;e&&e.sv||(t=this,e.sv=!0,e.addEventListener("volumechange",function(){e.volume!==parseFloat(this.getAttribute("tbvol"))?(e.volume=0,t.emit(t.vpaidEvents.SoundViolation,{})):e.volume=t.adVolume}))}},{key:"_onParserError",value:function(e){this.stopped||(this.status="error",this.error=e.type||"",this.isPlaying=!1,c(this.vpaidLog,"AdError",{errType:e.type,handlerType:e.handlerType,isPraserError:!0}),this.parser&&this.parser.trackingPixels&&this.pixelManager.loadPixelData(this.parser.trackingPixels),this.stop(this.error,e.oppsId))}},{key:"_onNetworkError",value:function(e){this.stopped||(this.status="error",this.error=e?"xhrStatuses_".concat(e):"",this.isPlaying=!1,this.stop(this.error,v.a.networkError))}},{key:"_updateAdVideoDurationOnVideoControls",value:function(e){this._setVideoControlsState({vidDuration:e,vidCurrentTime:0})}},{key:"_getMediaType",value:function(){return this.type===_.VIDEO?this.hasOmid&&this.isOmidActive?6:1:this.type===_.VPAID?2:"adx"===this.type?5:void 0}},{key:"_onVastFound",value:function(e){this.stopped||this.tag.isPrebid&&(this._sendOpp(this.oppsID.prebidVastObjectFound),e=this.tag.prebidHandler.interpretResponse(this.prebidAdapterSpec,e.prbdObj,this.prebidConf,this.tag.request,this.vpaidLog),this._handlePrebidResponse(e))}},{key:"_handlePrebidResponse",value:function(e){this.tag.prebidHandler.isValidInterpretation(e)?this.tag.prebidHandler.isValidCpm(e)?(this.tag.prebidHandler.logInterpretedResponse(this.vpaidLog,e),this.tag.prebidHandler.isResponseCpmAboveFloor(e.cpm)?(this._sendOpp(this.oppsID.validPrebidResponse),this.tag.prebidPrice=e.cpm):this.stop("prebid_cpm_below_floor",this.oppsID.prebidBelowBid)):this.stop("prebid_missing_cpm",this.oppsID.prebidMissingCpm):this.stop("prebid_no_interpretation",this.oppsID.prebidNoInterpretation)}},{key:"_getVastVersionFromCreationData",value:function(e){return Math.trunc(parseInt(e.vastOptions.analysis.vr))}},{key:"_createHandler",value:function(e){var t;this.stopped||(e&&e.vastOptions&&e.vastOptions.hasOmid&&(t={vastVersion:this._getVastVersionFromCreationData(e),vendorsNum:e.vastOptions.omidElements.length,vendor:e.vastOptions.omidVendor},this._sendOmidOpps(t),this.handlerOptions.omid=e.vastOptions.omidElements),e?(this.setVastPrice(e.vastOptions.price),this.setVastIcons(e.vastOptions.icons||[]),this.setExternalScripts(e.vastOptions.creativeExtensions||[]),this.playerDAST.set({vdr:e.handlerOptions.extra.duration}),this.playerDAST.addWrapper(e.vastOptions.analysis||[]),this.handlerOptions.adParams=e.handlerOptions.adParams,this.handlerOptions.vpaidFiles=e.handlerOptions.vpaidFiles,this.handlerOptions.extra.duration=e.handlerOptions.extra.duration,this.handlerOptions.trackingPixels=e.handlerOptions.trackingPixels):e={type:"ima"},this.nonVideoVpaid||(this.vpaidLog.setVastWrapperCount(this.parser.wrappersCount),this._setTimers(),this.creatives.AdParameters=this.handlerOptions.adParams,this.handlerOptions.adSettings=this._getAdSettings(),this.adSettings&&this.adSettings.hasOwnProperty("wtfradpsdbfrrsmad")&&!0===this.adSettings.wtfradpsdbfrrsmad&&(this.waitForAdPausedBeforeResumeAd=!0)),this.vpaidHandler=this.vpaidHandlersFactory.create(e.type,this.handlerOptions),this.vpaidHandler?this.nonVideoVpaid||(this.type=e.type,this.hasOmid=e.vastOptions&&e.vastOptions.hasOmid,this.omidElements=e.vastOptions&&e.vastOptions.omidElements,this.omidVendor=e.vastOptions&&e.vastOptions.omidVendor,this.store.emit(g.outer.EmitQueueStatus),this.tag.vpaidWrapperData.mediatype=this._getMediaType(),this.debugTracker.info("ParserResponded[".concat(this.type,"-").concat(this.isMobile?"mob":"desk","]"),this.handlerOptions.vpaidFiles),this.pixelManager.loadPixelData(this.handlerOptions.trackingPixels),this._setClickThroughData(),this._updateAdVideoDurationOnVideoControls(this.handlerOptions.extra.duration),this.vpaidHandler.removeClickableTarget(),this._createVideoControls(this.vpaidHandler),this._createMoatTracker(),this._shouldCreateOMIDHandler()&&this._createOmidHandler()):this._onParserError({type:"handlerCreatingFail",handlerType:e.type,oppsId:this.oppsID.mediaFileNotSupported}))}},{key:"_shouldCreateOMIDHandler",value:function(){return!!this.isOmidActive&&!!this.hasOmid&&!(!this.omidElements||0===this.omidElements.length||this.type&&this.type===_.VPAID||this._isBrowserInOMIDBlacklist())}},{key:"_isBrowserInOMIDBlacklist",value:function(){var e,t=this.store.get("omddsbldbrwsrs");return!!(t&&Array.isArray(t)&&0!==t.length&&(e=this.store.get("wurfl.browser.name"))&&t.includes(e))}},{key:"_sendOmidOpps",value:function(e){e={vendor:(this.omidVendor||e.vendor).substring(0,30)};this._sendOpp(this.oppsID.omidDetected,e)}},{key:"_createOmidHandler",value:function(){var e=this.store.get("isInApp")&&window.taboolaBridge?gn:Sn;this.omidHandler=new e(this.store,this.handlerOptions,this.vpaidLog)}},{key:"_createMoatTracker",value:function(){for(var e=this.moatTrackersCreativeExtensions||[],t=(this.tag.moatSampling&&e.push(void 0),this.playerDAST.get()),i=0;i<e.length;i++)this.moatTrackers.push(new ht({moatTag:e[i],container:this.vpaidHandler.getDOMContainer(),tag:this.tag,moatPartnerCode:this.tag.getValueByKey("moatPartnerCode"),duration:this.vpaidHandler.getAdDuration(),url:this.vpaidHandler.mediaFiles?this.vpaidHandler.mediaFiles[0].url:"",store:this.store,vpaidLog:this.vpaidLog,playerDast:t,debugTracker:this.debugTracker,zMoat:this.opportunityManager.generateOppParams(this.tag,void 0,t)}));this._extractWinningPrice()}},{key:"_getAdSettings",value:function(){return this.adSettings=this.store.getByAdInline(this.playerDAST.getWrappers())||{},0<Object.keys(this.adSettings).length&&c(this.vpaidLog,"adSettings",this.adSettings,!0,!1),this.adSettings}},{key:"_cleanIframe",value:function(){var e=this.localTarget.querySelectorAll("iframe");this._clearIframe(e&&e.length?e[0]:null)}},{key:"_cleanVpaid",value:function(e){if(!(this.clean||this.stayAlive&&this.isReplayable&&"post_repeat"!==e)){this.clean=!0,this.vpaidLog&&(this.vpaidLog.saveToDb(),this.vpaidLog.getVpaidAnalyticsReport=void 0),this.pixelManager&&this.pixelManager.destroy(),this.localTarget&&(this.localVideo&&this.localVideo.parentElement&&this.localTarget.removeChild(this.localVideo),this._cleanIframe(),this.localTarget.parentNode)&&this.localTarget.parentNode.removeChild(this.localTarget),this.adTarget&&this.adTarget.parentNode&&this.adTarget.parentNode.removeChild(this.adTarget),this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this._killTimers(),this.nonVideoVpaid||this.externalPlayerItem||(this._unregisterToVastParserEvents(),this.parser.destroy()),this._reportBuffering&&this.vpaidHandler&&(this.vpaidHandler.off("buffering",this.bindedOnBuffering),this.vpaidHandler.off("bufferingEnded",this.bindedOnBufferingEnd)),this.omidHandler&&this.omidHandler.dispose();for(var t=0;t<this.moatTrackers.length;t++)this.moatTrackers[t].dispose();this.creativeExtensionsHandler&&(this.creativeExtensionsHandler.off("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.destroy()),this.status="stopped",this.working=!1,this.videoControls&&this.videoControls.destroy(),this.playerDAST&&this.playerDAST.destroy(),this.vpaidHandlersFactory&&this.vpaidHandlersFactory.destroy(),this.store&&(this._bindedOnAdLoadVideoThrottleDelayEnd&&(this.store.off(this.onThrottleEndEventName,this._bindedOnAdLoadVideoThrottleDelayEnd),this._bindedOnAdLoadVideoThrottleDelayEnd=void 0),this._bindedOnRemovedFromVideoThrottleListeners)&&(this.store.off(this.onRemovedFromThrottleListenersEventName,this._bindedOnRemovedFromVideoThrottleListeners),this._bindedOnRemovedFromVideoThrottleListeners=void 0),this.isVideoProgressingInterval&&(this.isVideoProgressingInterval=clearInterval(this.isVideoProgressingInterval)),this.creatives=this.vpaidLog=this.parser=this.debugTracker=this.manager=this.tag=this.vast=this.pixelManager=this.config=this.vpaidEvents=this.localTarget=this.vpaidHandler=this.store=this._wfStats=this.localVideo=this.videoControls=this.adSettings=this.omidHandler=this.creativeExtensionsHandler=this.moatTrackers=this.moatTrackersCreativeExtensions=void 0,this.isPlaying=!1,window.setTimeout(this.onAfterStop,0),this.emit("vpaidCleaned")}}},{key:"_clearIframe",value:function(e){e&&(le(e,"iframe",function(e){var t=cmTag.$;e.forEach(function(e){t(e).remove()})},"*",this.store.get("debug")),e)&&e.parentNode.removeChild(e)}},{key:"bringToFront",value:function(){var e;this.localTarget&&!this.blockBringToFront&&(e=this.store.get("height"),this.localTarget.style.display="block",this.localTarget.style.height="".concat(e,"px"),e=99+Gn++,this.localTarget.style.zIndex=e,this.clickableTarget&&(this.clickableTarget.style.zIndex=e),this.vpaidHandler&&(this.vpaidHandler.zIndex=e),this._setVideoControlsState({isVisible:!0}),this.toggleIframeContentDisplay("hide"))}},{key:"moveToBack",value:function(){this.localTarget&&(this.localTarget.style.zIndex=0,this.clickableTarget)&&(this.clickableTarget.style.zIndex=0)}},{key:"subscribe",value:function(e,t){this.stopped||this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents&&this.vpaidEvents[t]&&(e?this.off(t,e):this.off(t))}},{key:"stop",value:function(e,t,i){var n,r=this;e||this.pixelManager.getState()!==this.vpaidEvents.AdVideoThirdQuartile||this.adCompleted?"post_repeat"!==e&&"global_ad_timeout"!==e&&"undefinedIframeSrc"!==e&&this.stayAlive&&this.isReplayable||this.stopped||(this.opportunityManager.isRegisterAvailable("unloadCallbacks",this.unloadCallback,!1),e&&"hijackAttempt"!==e&&(i&&i.eventData?c(this.vpaidLog,e,{eventDataStr:m(i.eventData),status:this.status}):c(this.vpaidLog,e,{status:this.status})),this._stopForceAdVolumeInterval(),this.hadImpression||(n=this.store.get("failsCount")+1,this.store.set("failsCount",n),c(this.vpaidLog,"fails",{count:n},!0,!1)),this._wfStats&&(this.hadImpression||this._wfStats.increaseFailure(),c(this.vpaidLog,"wfStats",{data:this._wfStats.getData()},!1,!1)),this.isStarted&&this.store.decr("ads_started"),this.stopReason=e,this.oldStatus+=this.status,this.isPlaying=!1,void 0!==t&&this._sendOpp(t,i),"NoMediaFileAfterSort"===e&&t===this.oppsID.mediaFileNotSupported&&this._firePixel("AdError",{eventData:{iabErrorCode:s.a.mediaFileNotSupported}}),"playerClosed"===e&&this.hadImpression&&this.pixelManager.firePixel(y.close),this.stopped=!0,this.vpaidHandler&&(this.vpaidHandler.onAfterStop=this._cleanVpaid.bind(this),this.vpaidHandler.stopAd()),this.emit("end"),this.store.emit("vpaidEnded",this),this.manager._terminatePPDFlow(this.tag.advType),setTimeout(function(){r._cleanVpaid(e)},2),"global_ad_timeout"===e&&(this.isReplayable=!1)):(c(this.vpaidLog,"earlyAdStopped",{early:!0},!0,!1),this._handleVpaidEvents(this.vpaidEvents.AdVideoComplete,{}))}},{key:"callVpaidMethod",value:function(e,t,i){if(!this.stopped){if(this.vpaidHandler&&this.vpaidHandler.callIMAApi&&("pauseAd"!=e&&"resumeAd"!=e||this.vpaidHandler.callIMAApi(e)),"resizeAd"!==e&&c(this.vpaidLog,"vpaidApi_"+e,{}),"setAdVolume"==e&&(this.adVolume=l(t[0])),"pauseAd"==e&&this._setIsUnpaused(!1),"resizeAd"!=e||this.nonVideoVpaid||this.externalPlayerItem||this._resizeContainers(t[0],t[1],t[2]),"resizeAd"==e&&this.externalPlayerItem&&this._resizeLocalTarget(),!this.vpaidHandler||!this.vpaidHandler[e])return i;try{return this.vpaidHandler[e].apply(this.vpaidHandler,t)}catch(e){return i}}}},{key:"_resizeContainers",value:function(e,t,i){this.localVideo.style.width=e+"px",this.localVideo.style.height=t+"px",this.localVideo.setAttribute("width",e),this.localVideo.setAttribute("height",t),this._resizeLocalTarget(e,t,i)}},{key:"_resizeLocalTarget",value:function(e,t,i){this.localTarget.style.width=e+"px",this.localTarget.style.height=t+"px",this.localTarget.setAttribute("width",e),this.localTarget.setAttribute("height",t)}},{key:"onAfterStop",value:function(){}},{key:"_hijackAttempt",value:function(e,t){"maliciousUrl"===e?this.hijackFired||(this.hijackFired=!0,c(this.vpaidLog,"hijackAttempt",{type:"url",badUrl:t.url,earlyHijack:t.isEarly||!1},!1,!1),!1!==this.store.get("hjkstp")&&this.stop("hijackAttempt",v.a.hijackAttempt)):"maliciousAction"===e&&(this._sendOpp(this.oppsID.blockedActionByHijack),c(this.vpaidLog,"hijackAttempt",{type:"action",action:t.action}))}},{key:"_onVpaidResourceEvent",value:function(e){"hijackAttempt"===e.event?this._hijackAttempt(e.data.type,e.data.data):"undefinedIframeSrc"===e.event?(c(this.vpaidLog,"undefinedRelativeIframeSrcError",{url:e.data.url}),this.store.get("stpvpdonudfndsrc")&&this.stop("undefinedIframeSrc",v.a.networkError)):"maxNetworkCalls"===e.event&&(c(this.vpaidLog,"vpaidAnalyticsCallLimit",{adImpression:this.adimpFired,limitExceeded:!0,maxNetworkCalls:e.data.maxNetworkCalls}),this.adimpFired||this.stop("networkCallsLimitExceeded",v.a.maxNetworkCalls))}},{key:"fire99",value:function(){this._sendOpp(this.oppsID.firstImpression)}},{key:"_onEvent",value:function(e,t){var i;this.pendingEvents&&this.pendingEvents.hasOwnProperty(e)&&(-1!=(i=this.pendingEvents[e]).timeoutId&&clearTimeout(i.timeoutId),i.cb&&"function"==typeof i.cb&&i.cb(t),delete this.pendingEvents[e])}},{key:"_waitForEvent",value:function(e,t,i,n){function r(){}var s=-1,o=this;0<t&&n&&"function"==typeof n&&(s=setTimeout(function(){c(this.vpaidLog,"vpaidTimeout_"+e,{}),n(),delete o.pendingEvents[e],s=null,n=i=r}.bind(this),t)),this.pendingEvents||(this.pendingEvents={}),this.pendingEvents[e]={cb:i,timeoutId:s}}},{key:"_onAdLoadedTimeout",value:function(){this.error="adloadedTimeout",this._firePixel("AdError",{eventData:{iabErrorCode:s.a.timeout}}),this.stop(this.error,this.oppsID.adloadedTimeout)}},{key:"_onAdLoadedEvent",value:function(){}},{key:"_onAdImpressionTimeout",value:function(){this.error="adImpressionTimeout",this._fireAdImpressionTimeoutOpp(),this.stop(this.error)}},{key:"_onAdImpressionEvent",value:function(e){this.manager&&this.manager.cleanGetAdTimeout(e)}},{key:"setVastPrice",value:function(e){0<(this.tag.vpaidWrapperData.vastPrice=e)&&c(this.vpaidLog,"vastPrice",{value:e})}},{key:"setExternalScripts",value:function(e){0!==e.length&&(this.pushExternalMoatTracker=this._pushExternalMoatTracker.bind(this),this.creativeExtensionsHandler=new Ji(e,this.localTarget,this.vpaidLog),this.creativeExtensionsHandler.on("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.handleExternalScripts())}},{key:"_pushExternalMoatTracker",value:function(e){this.moatTrackersCreativeExtensions=this.moatTrackersCreativeExtensions||[],this.moatTrackersCreativeExtensions.push(e)}},{key:"setVastIcons",value:function(e){this.tag.getValueByKey("fkadchcs")?(this.hasAdChoices=!0,c(this.vpaidLog,"ad_choices",{fakeAdChoices:!0})):(this.tag.vpaidWrapperData.icons=e,this.hasAdChoices=e.length,this.hasAdChoices&&this._addAdChoiceDiv(e))}},{key:"_addAdChoiceDiv",value:function(e){c(this.vpaidLog,"ad_choices",{vast:!0});var t,i=Un(e);try{for(i.s();!(t=i.n()).done;){var n,r,s,o=t.value;o.attributes.program&&-1===this.iconsPrograms.indexOf(o.attributes.program)&&(this.iconsPrograms.push(o.attributes.program),(n=document.createElement("div")).className="_cm-ad-choices-player",n.style.zIndex=1,o.attributes.xPosition&&(n.style.left="initial",n.style[o.attributes.xPosition]="13px"),o.attributes.yPosition&&(n.style.top="initial",n.style[o.attributes.yPosition]="16px"),r=document.createElement("a"),o.clickThroughUrl&&(r.href=o.clickThroughUrl),r.onclick=this._appendOnClick(o),r.target="_blank",r.className="_cm-ad-choices-player-anchor",r.style.width=o.attributes.width||"19px",r.style.height=o.attributes.height||"15px",o.staticresource?r.style.background="#fff url(".concat(o.staticresource,") no-repeat center center"):o.htmlresource&&(r.innerHTML+=o.htmlresource),o.iconViewTracking.length&&(s=o.iconViewTracking,this.fireViewTracking=function(){setTimeout(function(e){var t,i=Un(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;(new Image).src=n}}catch(e){i.e(e)}finally{i.f()}},5e3,s)}),n.appendChild(r),this.localVideo.parentElement.appendChild(n))}}catch(e){i.e(e)}finally{i.f()}}},{key:"_appendOnClick",value:function(n){return function(){var e,t=Un(n.clickTracking);try{for(t.s();!(e=t.n()).done;){var i=e.value;(new Image).src=i}}catch(e){t.e(e)}finally{t.f()}}}},{key:"_copyFromStoreToBi",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.store.get(e)&&c(this.vpaidLog,e,this.store.get(e),!1,t)}},{key:"mute",value:function(){this.stopped||(this.vpaidHandler.video&&this.vpaidHandler.video.muteButtonClicked&&0<this.adVolume&&this.vpaidHandler.video.muteButtonClicked(),this.adVolume=0,this._setVideoControlsState({isMuted:!0}))}},{key:"unmute",value:function(){this.stopped||(this.vpaidHandler.video&&this.vpaidHandler.video.muteButtonClicked&&0===this.adVolume&&this.vpaidHandler.video.muteButtonClicked(),this.adVolume=l(this.store.get("dfltvlm")),this.videoControls&&(this.store.get("forceMute")?this.adVolume=0:(this._setVideoControlsState({isMuted:!1}),this.adVolume=l(this.videoControls.getFromState("volume")))))}},{key:"updateStatusesOnGetAd",value:function(e){c(this.vpaidLog,"statusesOnGetAd",{status:this.status,hadImpression:!!this.hadImpression,isStarted:!!this.isStarted,requiredViewability:e.requiredViewability})}},{key:"logVpaidFamily",value:function(){var e=[],t=[];if(this.vpaidHandler.adUnit._iframe&&this.vpaidHandler.adUnit._iframe.contentWindow)for(var i,n=this.vpaidHandler.adUnit._iframe.contentWindow.document.scripts,r=0;r<n.length;r++)-1<n[r].src.indexOf("z.moatads.com")&&4<n[r].src.split("/").length&&e.push(n[r].src.split("/")[3]),-1<n[r].src.indexOf("sc.iasds01.com")&&2===(i=n[r].src.match(/EntityId=([^&]*)/)).length&&t.push("ias-".concat(i[1]));var s="".concat(this.tag.dp).concat(0<e.length?e.join("_"):"").concat(0<t.length?t.join("_"):"").concat(this.isGoogleIframe?"_ggl":"").concat(this.isUnfriendlyIframe?"_ui":"");s!==this.tag.dp&&c(this.vpaidLog,"vpaidFamily",{family:s})}},{key:"resizeAd",value:function(e,t,i){if(!this.stopped)try{null!=e&&!isNaN(parseInt(e))||(e=!1),null!=t&&!isNaN(parseInt(t))||(t=!1);var n,r,s,o,a=0,d=0;e||t?(t&&e?(d=this._convertSizeFromNumberToPixels(t),a=this._convertSizeFromNumberToPixels(e)):(r=(i=i&&1<i.split(":").length?i:this.store.get("playerAspectRatio")).split(":"),e?(n=parseInt(r[1])/parseInt(r[0]),a=this._convertSizeFromNumberToPixels(e),d=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(a)*n))):(n=parseInt(r[0])/parseInt(r[1]),d=this._convertSizeFromNumberToPixels(t),a=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(d)*n)))),a&&d&&(s=parseFloat(a),o=parseFloat(d),this.localTarget.style.width=a,this.localTarget.style.height=d,this.localTarget.setAttribute("width",s),this.localTarget.setAttribute("height",o),this.nonVideoVpaid||this.externalPlayerItem||(this.localVideo.style.width=a,this.localVideo.style.height=d,this.localVideo.setAttribute("width",s),this.localVideo.setAttribute("height",o)),this.clickableTarget&&(this.clickableTarget.style.width=a,this.clickableTarget.style.height=d,this.clickableTarget.setAttribute("width",s),this.clickableTarget.setAttribute("height",o)),this.isMultiAdsActive&&(!this.isVerticalVideoSupported||o<s?(this.store.set("width",s.toString()),this.store.set("height",o.toString()),this.store.emit("resizeVpaidWrapper",{width:s,height:o})):this.isVertical=!0),this._handleVerticalAd(s,o,i),this.vpaidHandler.resizeAd(s,o,this.config.viewMode||"normal",i)),this.blockBringToFront&&(this.blockBringToFront=!1,this.bringToFront())):this.debugTracker.error("resize","No `height` or `width` specified!")}catch(e){this.debugTracker.error("resize","Resizing component failed!")}}},{key:"_handleVerticalAd",value:function(e,t,i){this.localVideo&&this._isVerticalAd(e,t,i)&&(a(this.localVideo,"vertical-video"),d(this.localVideo,"ie-black-edges"))}},{key:"_isVerticalAd",value:function(e,t,i){return!!this.isVerticalVideoSupported&&(e<=t||(i&&-1<i.indexOf(":")?(i=i.split(":"),parseInt(i[1])>=parseInt(i[0])):!(!this.localVideo.videoWidth||!this.localVideo.videoHeight)&&this.localVideo.videoHeight>=this.localVideo.videoWidth))}},{key:"_convertSizeFromNumberToPixels",value:function(e){e+="";return e.search(/px$/g)<0&&(e+="px"),e}},{key:"getCurrentVolume",value:function(){return this.videoControls?this.videoControls.getFromState("volume"):this.adVolume}},{key:"_onSoundChange",value:function(e){this.vpaidHandler&&this.vpaidHandler.onMuteChanged&&this.vpaidHandler.onMuteChanged(e)}},{key:"_appendVpaidCSS",value:function(){var e=this.tag.getValueByKey("vpdcss"),t=[];if(void 0!==e){for(var i in e){var n=null;if(n=-1<this.localTarget.className.indexOf(i)?this.localTarget:this.localTarget.querySelectorAll(i)[0])for(var r in e[i])n.style[r]=e[i][r];else t.push("No element matching ".concat(i))}c(this.vpaidLog,"appendVpaidCSS",{success:0===t.length,style:m(e),errors:t.join(",")})}}},{key:"toggleIframeContentDisplay",value:function(e){!this.stopped&&this.isMultiVpaidUnit&&this.toggleIframeContentDisplayActive&&this.vpaidHandler.toggleIframeContentDisplay&&this.vpaidHandler.toggleIframeContentDisplay(e)}},{key:"_isOppSent",value:function(e){return-1<this.oppsToFireOnce.indexOf(e)}},{key:"_sendOppOnce",value:function(e,t){this._isOppSent(e)||(this.oppsToFireOnce.push(e),this._sendOpp(e,t))}},{key:"_sendOpp",value:function(e,t){if(!this.stopped&&this.opportunityManager){var i={};if(this.store.get("erronopp"))switch(e){case this.oppsID.adError:case this.oppsID.adErrorBeforeLoad:i.sdid=ge(t);break;case this.oppsID.adUnitLoadFailed:case this.oppsID.adloadedTimeout:case this.oppsID.adtoTimeout:case this.oppsID.globalTimeout:i.sdid=s.a.timeout;break;case this.oppsID.emptyVast:i.sdid=s.a.schemaValidationError;break;case this.oppsID.mediaFileNotSupported:i.sdid=s.a.mediaFileNotSupported,i.debugData=t&&t.debugData||""}e===this.oppsID.vpaidProgress&&(i.sdid=t.sdid),e===this.oppsID.tagImpression&&this._isVideoSrcExist()&&this._addBufferingData(i),i.vidCurrentTime=this.localVideo?this.localVideo.currentTime:void 0,e===this.oppsID.omidDetected&&(i.vendor=t&&t.vendor?t.vendor:void 0),i.prdid=this.predictorId,this.opportunityManager.send(this.tag,e,this.playerDAST.get(),i)}}},{key:"_addBufferingData",value:function(e){this.localVideo.buffered&&0<this.localVideo.buffered.length&&this.localVideo.buffered.end(0)&&(e.bis=this.localVideo.buffered.end(0))}},{key:"_isVideoSrcExist",value:function(){return this.localVideo&&this.localVideo.getSrc&&this.localVideo.getSrc()}},{key:"getAdDuration",value:function(){var i=this;isNaN(this.localVideo.duration)?this.vpaidHandler&&this.vpaidHandler.getAdDuration(function(e,t){i._setVideoControlsDuration(t)}):this._setVideoControlsDuration(this.localVideo.duration)}},{key:"_setVideoControlsDuration",value:function(e){this._setVideoControlsState({vidDuration:e})}},{key:"registerToVPAIDVideoTimeupdateEvent",value:function(){var t,i=this;this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement&&null!==(t=this.vpaidHandler.getVPAIDVideoElement())&&t.addEventListener("timeupdate",function(e){i._onTimeupdate(t)})}},{key:"_onTimeupdate",value:function(e){this.workingVpaid&&0<e.currentTime&&this._setVideoControlsState({preventAdTicker:!0,vidDuration:e.duration,vidCurrentTime:e.currentTime})}},{key:"getVpaidStatus",value:function(){return this.vpaidStatus.get()}},{key:"_sendFirstUnmuteOpp",value:function(){this._isOppEnabled(this.oppsID.adUnmuted)&&this._sendOpp(this.oppsID.adUnmuted)}},{key:"_isOppEnabled",value:function(e){return this.store.get("enblopp.".concat(e))}},{key:"getPrice",value:function(e){if(!this.stopped){var t=this.tag.vpaidWrapperData&&this.tag.vpaidWrapperData.vastPrice?this.tag.vpaidWrapperData.vastPrice:this.tag.price;if(this.tag.isPrebid&&this.store.get("isprbdprc")&&void 0!==this.tag.prebidPrice&&(t=this.tag.prebidPrice,this.setVastPrice(t)),t||void 0!==this.defaultTagPrice)if(e){for(var i,e=t,n=JSON.stringify(e),r="",s=0;s<n.length;s++)i=s%"PlAyER".length,r+=String.fromCharCode(n[s].charCodeAt(0).toString(10)^"PlAyER"[i].charCodeAt(0).toString(10));try{r=btoa(r)}catch(e){return!1}return r}else return t}return""}},{key:"_getAdSettingValue",value:function(e){return this.adSettings&&this.adSettings.hasOwnProperty(e)?this.adSettings[e]:void 0}},{key:"_extractWinningPrice",value:function(){var e,t;this._getAdSettingValue("extwnprc")&&(t=this._getAdSettingValue("wnprcfld"),e=this._getAdSettingValue("blkemptywp"),t=this.pixelManager.extractWinningPrice(t,e))&&(c(this.vpaidLog,"winningPrice",t,!1,!1),this.playerDAST.set({wp:t}))}},{key:"getVpaidData",value:function(e){if(this.stopped)return{};this.tag.nas&&(this.tag.nas.isClickable=void 0!==this.tag.nas.isClickable?this.tag.nas.isClickable:this._isNativeAdSettingsClickable());var t=this.vpaidHandler.getAdWidth()||this.playerDAST.getByKey(Rt.vastWidth),i=this.vpaidHandler.getAdHeight()||this.playerDAST.getByKey(Rt.vastHeight);return{adjacency:this.tag.adjacencyAd,advId:this.tag.advId,advType:this.tag.advType,backfill:this.tag.priority===this.bfPriority,brand:this.tag.brand,campaignId:this.tag.campaignId,costModel:this.tag.cstmdl,cpcv:this.tag.isCPCV,creativeId:this.tag.creativeId,dp:this.tag.dp,itemType:this.tag.itemType,lineItem:this.tag.lineItemId,nonVideoVpaid:this.nonVideoVpaid,price:this.getPrice(e),pubId:this.tag.pubId,replayable:this.isReplayable,rv:this.tag.requiredViewability,singleAd:this.tag.singleAd,vpaidStatus:this.vpaidStatus.get(),wfSequence:this.tag.sequenceId,wfTagId:this.tag.wfIndex,adNativeSettings:this.tag.nas,adWidth:t||0,adHeight:i||0,supportVerticalVideo:this.isVerticalVideoSupported,vastClickThruLink:this.clickThruUrl,eventTrackers:this._getUnitEventTrackers(),supportVideoCurrentTimeEvents:!(!this.vpaidHandler||!this.vpaidHandler.activeVideoElement),duration:this.vpaidHandler&&this.vpaidHandler.activeVideoElement?this.vpaidHandler.getActiveVideoElementDuration():null,earlySrcVPAID:this.earlySrcVPAID,startTimestamp:this.startTimestamp,hip:!!this.tag.hip,allowSlider:!!this.tag.alwsldr}}},{key:"_isNativeAdSettingsClickable",value:function(){var e=this.tag.nas.link||this.clickThruUrl;return void 0!==e&&""!==e}},{key:"_getUnitEventTrackers",value:function(){var i=this,e=this.store.get("untetrk")||[],n={};return e.forEach(function(e){var t=i.pixelManager.getPixels(e);0<t.length&&(n[e]=t)}),n}},{key:"setDebugData",value:function(e){this.stopped||(this.tag.vpaidWrapperData.debugData=e)}},{key:"setDebugDataFunc",value:function(e){this.stopped||(this.tag.setDebugDataFunc=e)}},{key:"_onBuffering",value:function(){this.emit("buffering"),this._sendOpp(this.oppsID.buffering)}},{key:"_onBufferingEnd",value:function(){this.emit("bufferingEnded"),this._sendOpp(this.oppsID.bufferingEnded)}},{key:"_onNavigatorConnectionChange",value:function(){var e;this.stopped||(e=this.store.get("navigatorConnection"),c(this.vpaidLog,"navigatorConnection",e,!0,!1))}},{key:"skipAd",value:function(){this.stopped||this.vpaidHandler.skipAd()}},{key:"getLocalTarget",value:function(){return this.localTarget}},{key:"getHandlerOptions",value:function(){return this.handlerOptions}},{key:"setVpaidHandler",value:function(e){this.vpaidHandler=e}},{key:"getVpaidLog",value:function(){return this.vpaidLog}},{key:"createPlacement",value:function(){var e=this._createAdTargetElement();return{adTarget:e,localTarget:this._createLocalTarget(e)}}},{key:"_createLocalTarget",value:function(e){var t=document.createElement("div");return this._styleElement(t),this._appendExtraCSSRules(t),e?(d(t,"multi-vpaids"),e.appendChild(t),this.target.appendChild(e)):this.target.appendChild(t),t}},{key:"_styleElement",value:function(e){var t=this.store.get("noplrcntr"),i=this.store.get("mltads"),t=(t?(localTarget.id="_cm-css-reset",e.className=Qn++):(e.style.cssText=this.target.style.cssText,e.className="".concat(this.target.className||""," ").concat(Qn++),e.id="vpaid-player-container"),this.tag.getValueByKey("adtnlclsnm"));return t&&a(e,t),e.style.position="absolute",e.style.overflow="hidden",e.style.top="0",e.style.height="0",e.style.left="0",e.style.zIndex="1",e.style.background="transparent",i&&e.className.indexOf("_cm-video-ad")<0&&(e.className="_cm-video-ad ".concat(e.className),e.id="vpaid-player-container"),e}},{key:"_appendExtraCSSRules",value:function(e){var t=this.store.get("adtrgtcss")?this.tag.getValueByKey("trgtcss"):void 0;if(t)for(var i in t)e.style[i]=t[i]}},{key:"_createAdTargetElement",value:function(){var e,t=this.store.get("mltads");return(this.store.get("isMultiVpaidUnit")||t)&&((e=document.createElement("div")).className="_cm-ad",e.id="_cm-css-reset"),e}},{key:"_fireAdImpressionTimeoutOpp",value:function(){this._sendOpp(this.oppsID.adImpressionTimeout)}},{key:"_setVideoControlsState",value:function(e){!this.stopped&&this.videoControls&&this.videoControls.setState(e)}},{key:"_resetVideoControls",value:function(){this._setVideoControlsState({preventAdTicker:""!==this.getVideoUrl(),isMuted:!0})}}])&&Hn(e.prototype,t),i&&Hn(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function Jn(e){return(Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Jn(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Jn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Jn(e)?e:String(e)}(n.key),n)}}var Yn=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.iframesWeights=e}var e,i,n;return e=t,(i=[{key:"detect",value:function(e,i){var n=this,r={};return e.map(function(e){var t=n._detectIframeTypeFromUrl(e,i);r[t]=r[t]||{urls:[],counter:0},r[t].urls.push(e),r[t].counter++}),r}},{key:"_detectIframeTypeFromUrl",value:function(e,t){return-1<e.indexOf("imasdk")?"ggl":t?"pxls":"gen"}},{key:"calculateWeightsByIframeType",value:function(e){var t,i=0;for(t in e)i+=this.iframesWeights[t]*e[t].counter;return i}}])&&Xn(e.prototype,i),n&&Xn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function $n(e){return($n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==$n(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==$n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===$n(e)?e:String(e)}(n.key),n)}}var er={undefinedIframeSrc:"undefinedIframeSrc",event_AdImpression:"conversion",event_SoundViolation:"soundViolation",adStartTimeout:"adStartTimeout",AutoKill:"auto_kill",AdStopADTO:"before_startAd_timeout",queueTrimmed:"queueTrimmed",adPlayTimeout:"adPlayTimeout",queueExpired:"removed_from_queue",tagError:"tagError",vastFilterdByRegex:"vast_blacklisted",event_AdLoaded:"adLoaded",fetchVastXhr:"fetchVastXhr",fetchVastFallToXhr:"fetchVastFallToXhr",vpaidTimeout_AdLoaded:"adload_timeout",creatingVpaidHandler:"initVpaid",createdVpaidHandler:"before_adload",creatingVpaidHandlerError:"creatingVpaidHandlerError",networkError:"networkError",adUnitLoadFailed:"vpaid_unit_failed",adloadedTimeout:"adload_timeout",adImpressionTimeout:"adImpressionTimeout",playerClosed:"playerClosed",idleMode:"idleMode",hijackAttempt:"vpaid_blacklisted_url"},tr=["conversion","soundViolation","timeout","bfRon","adPlayTimeout","vast_blacklisted","tagError","queueTrimmed","before_startAd_timeout","auto_kill","vpaidTimeout","creatingVpaidHandlerError","networkError","vpaid_unit_failed","adload_timeout","adImpressionTimeout","idleMode","vpaid_blacklisted_url","removed_from_queue"],ir={NoMediaFiles:"empty_vast",event_AdError:"ad_error",vastxhrerror_noflash:"vast_fetch_fail",WrapperError:"wrapper_error",ParsingError:"xml_parsing_error",NoMediaFileAfterSort:"unsupported_mediafile"},nr={BfRon:!0},rr={difa:"idfa",aid:"appId",aname:"appName"},sr=function(){function r(e,t){var i=this;if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.tag=e,this.store=t,this.created=Date.now(),this.dataChanged=!1,this.friendlyVideoUrl=!1,this._setIframesDetector();var t=this.store.get("dast"),n="",t=(t&&(n=t.cicmp),this.store.get("subUnitType"));this.sessionStarted=this.store.get("session_started")||this.created,this.data={_id:oe(10),player_id:this.store.get("player_id"),tag:e,isMobile:e.isMobile,created:(new Date).toISOString(),timeSinceSessionStarted:this.created-this.sessionStarted,dp:e.dp,status:"new",statuses:["new"],itemScore:-1,fullPageUrl:this.store.get("fullPageUrl"),documentVisible:!document.hidden,oneAuction:this.store.get("mltads"),su:null!=t?t:-99999,redId:this.store.get("red_id")||"na",displayLineItem:n,updatesCount:0,serverSideDataSaver:this.store.get("serverSideDataSaver")||"na",clientSideDataSaver:this.store.get("clientSideDataSaver")||"na",dataSaver:this.store.get("dataSaver"),taboolaVpaid:this.store.get("istblvpd"),hasDsm:!!this.store.get("dsm"),hasVpaidAnalytics:!!this.store.get("analyticsFuncString"),isAmp:this.store.get("isAmp"),isCPCV:e.isCPCV,isPrivateBrowsing:this.store.get("isPrivateBrowsing")||"na",frameType:this.store.get("frameType")||-1,playWhenOutOfView:e.pwov,oppsulaVersion:this.store.get("opslavrsn")||"na",oppsulaEnabled:this.store.get("usopsla")||!1,allowSlider:{isAllowed:!!this.tag.allowSlider,isActive:this.store.get("isSliderCutOff")||!1},unitElastic:{sessionId:this.store.get("elasticSessionId"),dependOnUnitForReporting:this.store.get("dpndonuntfrlgtoelstc"),shouldReport:this.store.get("shouldSendDataToElastic")&&void 0!==this.store.get("elasticSessionId")}},Object.assign(this.data,this._getDastData()),this.isReportDb=!1,this.dtor=!1,this._dataModified=!0,this.updatingInterval=setInterval(function(){i._dataModified&&i._sendData()},1e4)}var e,t,i;return e=r,(t=[{key:"_setIframesDetector",value:function(){this.iframesDetector=this.store.get("iframesDetector"),this.iframesDetector||(this.iframesDetector=new Yn(this.store.get("ifrmswghts")),this.store.set("iframesDetector",this.iframesDetector))}},{key:"_getDastData",value:function(){var e,t=this.store.get("dast")||{},i={},n=this.store.get("isInApp")||!1;for(e in rr){var r=t[e];r&&(i[rr[e]]=r,n=!0)}return i.inApp=n,this.store.set("isInApp",n),i}},{key:"push",value:function(e,t,i){var n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];this.data&&(-1<e.indexOf("AdError")||"event_SoundViolation"===e?this._addStatus(this._prettyErrorStatus(e,t)):er.hasOwnProperty(e)&&"conversion"!==this.data.status?this._addStatus(er[e]):nr.hasOwnProperty(e)&&(this.data["is"+e]=!0),n&&(n=Date.now()-this.created,t.time=n),this._dataChanged(),!i&&this.data.hasOwnProperty(e)?(Array.isArray(this.data[e])||(this.data[e]=[this.data[e]]),this.data[e].push(t),3<this.data[e].length&&this.data[e].splice(0,1)):(this.data[e]=t,-1!==tr.indexOf(this.data.status)&&this._setDpStats()))}},{key:"_dataChanged",value:function(){this._dataModified=!0}},{key:"_sendData",value:function(){this._collectDataFromVpaidAnalytics(),this.data&&this.data.updatesCount++,Z("VpaidLog",this.data,this.store),this._dataModified=!1}},{key:"_collectDataFromVpaidAnalytics",value:function(){try{var e,t;this.getVpaidAnalyticsReport&&((e=this.getVpaidAnalyticsReport()).realTotalRequestsCounter=e.totalRequestsCounter,this._wrappersCount&&(e.totalRequestsCounter+=this._wrappersCount,e.wrappersCount=this._wrappersCount),t=this.iframesDetector.detect(e.iframes,this.friendlyVideoUrl),e.totalRequestsCounter+=this.iframesDetector.calculateWeightsByIframeType(t),e.totalRequestsCounter-=e.iframes.length,this.push("vpaidAnalytics",e,!0),this.push("vpaidIframesDetection",t,!0))}catch(e){this.push("vpaidAnalyticsCollectFail",{ex:e})}}},{key:"_prettyErrorStatus",value:function(e,t){t=t.errType||e;return ir.hasOwnProperty(t)?ir[t]:"error_".concat(t)}},{key:"_setDpStats",value:function(){var e,t;this.isDPStatusSet||this.store.get("static_schedule")||(t=Date.now(),this.data.dtor=!0,this.data.timeFromLastPlayFromQueue=t-this.store.get("playFromQueue"),this.data.timeFromLastPlayFromQueueFound=t-this.store.get("playFromQueueFound"),this.isDPStatusSet=!0,this._incrStats(".tries"),"conversion"===this.data.status?(this._incrStats(".conversions"),this.store.set(this.tag.dp+".failsRow",0),t=this.store.get(this.tag.lineItem+".failsRow"),this.store.set(this.tag.lineItem+".failsInARowTillConversion",t<0?0:t),this.store.set(this.tag.lineItem+".failsRow",0)):(this._incrStats(".fails"),this.store.get(this.tag.lineItem+".failsRow")<0?this.store.set(this.tag.lineItem+".failsRow",1):this._incrStats(".failsRow")),t=this.store.get(this.tag.dp)||{fails:0,failsRow:0,conversions:0},(e=this.store.get(this.tag.lineItem)||{}).fails||(e.fails=0),e.failsRow||(e.failsRow=0),e.conversions||(e.conversions=0),t.lineItems=t.lineItems||[],-1===t.lineItems.indexOf(this.tag.lineItem)&&t.lineItems.push(this.tag.lineItem),this.data.lineItemLog=e,this.data.dpLog=t,this.data.conversionsCount=this.store.get("conversionsCount"),this.data.unit={width:this.store.get("width"),height:this.store.get("height")},-1===(t=this.store.get("lineItems")||[]).indexOf(this.tag.lineItem)&&(t.push(this.tag.lineItem),this.store.set("lineItems",t)),this.store.set(this.tag.lineItem,e))}},{key:"_incrStats",value:function(e){this.store.incr(this.tag.dp+e),this.store.incr(this.tag.lineItem+e)}},{key:"saveToDb",value:function(){this.saveToDbWithoutReport(),this._reportDb()}},{key:"saveToDbWithoutReport",value:function(){if(this.data){var e;this._collectDataFromVpaidAnalytics(),this._setDpStats();try{e=cmTag.utils.getLoopTime()}catch(e){}e&&(this.data.loopTime=e)}}},{key:"_reportDb",value:function(){this.isReportDb||(this.data.updatesCount++,Z("VpaidLog",this.data,this.store),this.tag=null,this.data=null,this.store=null,this.isReportDb=!0,this._dataModified=!1,clearInterval(this.updatingInterval))}},{key:"_addStatus",value:function(e){var t=this;-1===tr.indexOf(this.data.status)&&(this.data.status=e,this.data.statuses.push(e),"conversion"===e)&&setTimeout(function(){t._sendData()},2e3)}},{key:"toString",value:function(){return m(this.data,4)}},{key:"setVastWrapperCount",value:function(e){this._wrappersCount=e}}])&&Zn(e.prototype,t),i&&Zn(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}();function or(e){return(or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ar(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==or(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==or(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===or(e)?e:String(e)}(n.key),n)}}var dr=function(){function n(e,t,i){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.parameters=e,this.store=t,this.debugTracker=new o("OpportunityManager"),this.oppsulaLoaded=!1,this._initOppsAggregator(),this.isOppsulaRegisterAPI=this.oppsAggregator&&this.oppsAggregator.registerCallback,this._sentOpps={},this._oppsToSendOnlyOnce=[v.a.tagImpression,v.a.adLoaded,v.a.videoFirstQuartile,v.a.videoMidpoint,v.a.videoThirdQuartile,v.a.videoComplete,v.a.videoComplete,v.a.soundOnHover],this._isPaused=!1,this.vpaidLog=i,this.billableEvents=this.store.get("bllblevt").split(",")}var e,t,i;return e=n,(t=[{key:"_initOppsAggregator",value:function(){this.store.get("usopsla")&&this.store.get("oppsula")?(this.oppsAggregator=this.store.get("oppsula"),this.oppsulaLoaded=!0):this.oppsAggregator=this.store.get("oppsAggregator")}},{key:"alreadySent",value:function(e,t){return!(!this._sentOpps[e.sequenceId]||!this._sentOpps[e.sequenceId][e.lineItemId])&&-1!=this._sentOpps[e.sequenceId][e.lineItemId].indexOf(t)}},{key:"_shouldUseOppsula",value:function(){return this.oppsAggregator&&this.oppsulaLoaded&&this.store.get("usopsla")}},{key:"send",value:function(e,i,t){var n,r,s=this,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};e&&!this.store.get("isFireOppBlocked")&&(this._isPaused?this.debugTracker.info("OpportunityPixel","[tag-"+(+e.waterfallTagId+1)+"] Disgarded sending '"+i):-1!=this._oppsToSendOnlyOnce.indexOf(i)&&this.alreadySent(e,i)||(this._sentOpps[e.sequenceId]=this._sentOpps[e.sequenceId]||{},this._sentOpps[e.sequenceId][e.lineItemId]=this._sentOpps[e.sequenceId][e.lineItemId]||[],this._sentOpps[e.sequenceId][e.lineItemId].push(i),this.debugTracker.info("OpportunityPixel","[tag-"+(+e.waterfallTagId+1)+"] Sending '"+i,{color:"#6ef936"}),n=this.generateOppParams(e,i,t,o),o.unv=this.store.get("unit_version"),o.uv=this.store.get("unit_version"),r=this._isBillableEvent(i),this._shouldUseOppsula()?(e={tagItem:e,playerDAST:t,extraData:o||{},playerParams:this.parameters},this.oppsAggregator.send("player",i,e)):this.oppsAggregator&&!r?(this._reportOppToKibana(n,i,o.vidCurrentTime),this.oppsAggregator.send(n)):(t=(r||!this.store.get("non_bllb_opps_base_path")?this.store.get("opps_base_path"):this.store.get("non_bllb_opps_base_path"))||creativeConfig.CM_DOMAIN,this.url="".concat(ae(t)).concat(/.*\/$/g.test(t)?"":"/","OpportunityServlet?rst=").concat(i),this.postHeaders=this.store.get("psthdrs")||"application/json",Ye(this.url,m([n]),function(e,t){s.oppFireSuccess(e,t,i)},function(e,t){s.oppFireFailure(e,t,i)},void 0,!1,!1,5e3,this.postHeaders,!1))))}},{key:"_isStickyDisabled",value:function(){return 6!==this.store.get("subUnitType")||!this.store.get("enableStickyOnNonAllowSlider")}},{key:"_getSubUnitType",value:function(e){return 6===this.store.get("subUnitType")&&e.adjacencyAd||this.store.get("isSliderCutOff")&&!e.alwsldr&&this._isStickyDisabled()?0:this.store.get("subUnitType")}},{key:"generateOppParams",value:function(e,t,i){var n,r,s,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},a=o.debugData||this._getDebugDataStrFromUnit(e),d=e.lineItemStats,l=this.store.get("pstn")||1,u=e.vidDast||e.dast,c=(new Date).getTime()-e.created,h="".concat(this.store.get("ab_test")).concat(ie(e,this.store)),p=e.vpaidWrapperData||(e.vpaidWrapper&&e.vpaidWrapper.tag?e.vpaidWrapper.tag.vpaidWrapperData:void 0),f={st:(n=e.rollType,r=(f={"pre-roll":r=0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2}).hasOwnProperty(n)?f[n]:r),rs:e.sequenceId,os:+e.waterfallTagId+1,tms:Date.now(),d:c,rst:t,dast:u,pstn:l,dp:de(e.dp),mob:te(this.store.get("isMobile")),vstt:te(!document.hidden),unv:this.store.get("unit_version"),uv:this.store.get("unit_version"),unt:de(this.store.get("unit_type")),abt:h,frd:this.store.get("fdScore"),agl:this.store.get("preset.level"),rp:p&&p.vastPrice,mty:p&&p.mediatype,fv_t:d&&d.tries,fv_c:d&&d.conversions,fv_f:d&&d.fails,fv_fr:d&&d.failsRow,awr:this.store.get("performance.dtsvrRoundTripAverageDuration"),pm:this.store.get("performance.performanceMeasurment"),dbg:a,su:this.store.get("subUnitType"),pdast:i,extpvid:window.TRCImpl&&window.TRCImpl.external_page_view,prdid:o.prdid},v=(this.store.get("modifiedPlacement")&&(o.mp=this.store.get("modifiedPlacement")),o.su=this._getSubUnitType(e),this._addExtraParams(o,f),this._addCmTagParams(f),this._addDelayedParams(f,e),this._addExternalPlayerPriceParam(f,e),f);for(s in v)void 0===v[s]&&delete v[s];return f}},{key:"_getDebugDataStrFromUnit",value:function(e){var t;return e.setDebugDataFunc?e.setDebugDataFunc():(t=this.store.get("debugDataFunc"))?t():e.vpaidWrapperData&&e.vpaidWrapperData.debugData?e.vpaidWrapperData.debugData:this.store.get("debugStr")||void 0}},{key:"_addCmTagParams",value:function(e){var t=this.store.get("oppsQS")||{};Object.assign(e,t)}},{key:"_addDelayedParams",value:function(e,t){t=this._delayedParams(t)||{};Object.assign(e,t)}},{key:"_addExternalPlayerPriceParam",value:function(e,t){t.externalPlayerItem&&t.externalPlayerCpm&&(e.cisbp=ye(t.externalPlayerCpm))}},{key:"_addExtraParams",value:function(e,t){for(var i in e)"vidCurrentTime"!==i&&(t[i]=e[i])}},{key:"oppFireSuccess",value:function(e,t,i){"0"!==e&&c(this.vpaidLog,"billableEventsTracking",{opp:i,type:"serverError",xhrErrors:t},!1,!1)}},{key:"oppFireFailure",value:function(e,t,i){c(this.vpaidLog,"billableEventsTracking",{opp:i,type:"sendingError",url:t,error:e},!1,!1)}},{key:"_reportOppToKibana",value:function(e,t,i){var n={rstStr:function(e,t){for(var i in e)if(e[i]===t)return i;return""}(v.a,t)};i&&this._isQuartileOpportunity(t)&&(n.vidCurrentTime=i),c(this.vpaidLog,"Opps",Object.assign({},e,n))}},{key:"_isQuartileOpportunity",value:function(e){return 21<=e&&e<=25}},{key:"_flattenParams",value:function(e){return e.map(function(e){return e.key+"="+e.value})}},{key:"_delayedParams",value:function(e){return{"auc-dast":this.store.get("auc_dast")||void 0,sts:this.parameters.STS,wp:this.parameters.WP,vpd:e.pubId||this.parameters.VPD,vptd:e.tagId||this.parameters.VPTD,vmt:(e.isRon?1:0)||this.parameters.VMT||0,pv:this.store.get("player_version")||999,pt:de(this.store.get("ab_test")||999),w:ce(this.store.get("width")).toString(),h:ce(this.store.get("height")).toString(),rv:e.requiredViewability}}},{key:"destroy",value:function(){this.debugTracker=void 0,this.store=void 0,this.oppsAggregator=void 0,this.billableEvents=void 0}},{key:"pause",value:function(){this._isPaused=!0}},{key:"unpause",value:function(){this._isPaused=!1}},{key:"_isBillableEvent",value:function(e){return-1<this.billableEvents.indexOf(""+e)}},{key:"isRegisterAvailable",value:function(e,t,i){this.isOppsulaRegisterAPI&&(i?this.oppsAggregator.registerCallback(e,t):this.oppsAggregator.unRegisterCallback(e,t))}}])&&ar(e.prototype,t),i&&ar(e,i),Object.defineProperty(e,"prototype",{writable:!1}),n}(),lr=e(8),ur=e.n(lr);function cr(e){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,s,o,a=[],d=!0,l=!1;try{if(s=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;d=!1}else for(;!(d=(n=s.call(i)).done)&&(a.push(n.value),a.length!==t);d=!0);}catch(e){l=!0,r=e}finally{try{if(!d&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw r}}return a}}(e,t)||function(e,t){var i;if(e)return"string"==typeof e?pr(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?pr(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pr(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function fr(e,t,i){return(t=mr(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function vr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mr(n.key),n)}}function mr(e){e=function(e,t){if("object"!==cr(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==cr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===cr(e)?e:String(e)}var yr=function(){function i(e,t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.vpaidLog=t,this.trackingPixels=Object.assign({},lr),this.pixelDataLoaded=!1,this.events=[],this.done=[],this.store=e,this.vpaidEvents=f.a,this.state="",this.clickThruUrl="",this._isPaused=!1,this.buildPixelsRestrictions(),this._isPaused=!1,this.replacePixelMacros=this.store.get("rplcpxlmcrplchldr"),this.fireMultiplePixels=this.store.get("frmltplpxls")||[]}var e,t,n;return e=i,(t=[{key:"getState",value:function(){return this.state}},{key:"buildPixelsRestrictions",value:function(){this.pixelsRestrictions={},this.pixelsRestrictions.baseState=this.vpaidEvents.AdVideoThirdQuartile,this.pixelsRestrictions[this.vpaidEvents.AdVideoComplete]=this.vpaidEvents.AdVideoThirdQuartile}},{key:"loadPixelData",value:function(e){this.pixelDataLoaded=!0,this.trackingPixels=e}},{key:"getClickThruUrl",value:function(){if(!this.clickThruUrl)for(var e=["adclickthrough","clickthrough","adclickthru","clickthru"],t=0;t<e.length;t++){var i=e[t];if(this.trackingPixels&&this.trackingPixels.hasOwnProperty(i)&&0<this.trackingPixels[i].length){this.clickThruUrl=this.trackingPixels[i][0].pixel;break}}return this.clickThruUrl}},{key:"firePixel",value:function(e,i){var n=this;if(this._isPaused)return!1;if(!this.isValid(e,i))return!1;for(var t=this.getPixels(e,i),r=0;r<t.length;r++)this._sendPixel(t[r].pixel,t[r].method,e,i);this.events.push(e),""===this.state&&e===this.pixelsRestrictions.baseState&&(this.state=this.pixelsRestrictions.baseState);var s=fr({},e,this._getAllLinkedPixelTypes(e));return s&&Object.entries(s).forEach(function(e){var e=hr(e,2),t=e[0];e[1].forEach(function(e){n._reportPixelToKibana(t,{eventData:i||"",pixValue:e})})}),!0}},{key:"_cleanPixelType",value:function(e){return e.toLowerCase().replace(/^advideo|^aduser|^ad/gi,"")}},{key:"_getAllLinkedPixelTypes",value:function(e){var t,i=[];return"clickthrough"===(e=this._cleanPixelType(e))||"clickthru"===e?i.push("adclicktracking","clicktracking"):(t="ed",e.match(new RegExp("".concat(t,"$")))&&(this._pushLinkedPixelTypesEdEnding(e,i),this._reportPixelToKibana("PixelEndsWithEd",e)),this._pushLinkedPixelTypes(e,i)),i}},{key:"_reportPixelToKibana",value:function(e,t){c(this.vpaidLog,"PixelsReportedByType",fr({},e,t),!1)}},{key:"_pushLinkedPixelTypes",value:function(e,t){t.push(e,"aduser".concat(e),"advideo".concat(e),"ad".concat(e))}},{key:"_pushLinkedPixelTypesEdEnding",value:function(e,t){for(var i=e.charAt(e.length-3)===e.charAt(e.length-4)?3:2,n=0;n<i;n++)e=e.slice(0,-1),this._pushLinkedPixelTypes(e,t)}},{key:"getPixels",value:function(e,t){var i=[];if("progress"!==e.toLowerCase())for(var n=this._getAllLinkedPixelTypes(e),r=0;r<n.length;r++)this.trackingPixels&&this.trackingPixels.hasOwnProperty(n[r])&&(i=i.concat(this._checkConcatPixels(this.trackingPixels[n[r]])));else t&&t.hasOwnProperty("eventData")&&t.eventData.hasOwnProperty("pixel")&&t.eventData.pixel&&(i=i.concat(t.eventData));return i}},{key:"_removePixel",value:function(e,t){for(var i,n=this._getAllLinkedPixelTypes(e),r=0;r<n.length;r++)this.trackingPixels.hasOwnProperty(n[r])&&-1<(i=this.trackingPixels[n[r]].indexOf(t))&&this.trackingPixels[n[r]].splice(i,1)}},{key:"isValid",value:function(e,t){return!this.pixelsRestrictions.hasOwnProperty(e)||!(e!==this.vpaidEvents.AdVideoComplete||!t||!0!==t.newCompletion)||this.pixelsRestrictions[e]===this.state&&(this.state=e,!0)}},{key:"destroy",value:function(){this.trackingPixels=this.done=this.events=this.vpaidEvents=this.pixelsRestrictions=this.state=this.clickThruUrl=void 0}},{key:"_checkConcatPixels",value:function(e){return e&&e.length?e:[]}},{key:"_sendPixel",value:function(e,t,i,n){if("about:blank"!==e&&-1===this.done.indexOf(e)){var r=this.vpaidLog&&this.vpaidLog.tag?this.vpaidLog.tag.advId:null;-1===this.fireMultiplePixels.indexOf(i)&&this.done.push(e);try{return e=this._replaceMacros(e.trim(),n),r&&!this.vpaidLog.tag.getValueByKey("pxlnotsmtp")&&(e+=(-1<e.search(/\?/)?"&":"?")+(new Date).getTime()),"img"===t?(new Image).src=e:"js"===t&&this._sendJSPixel(e),!0}catch(e){return!1}}}},{key:"_sendJSPixel",value:function(e){var t=document.createElement("script");t.src=e,t.type="text/javascript",t.async=!0,document.body.appendChild(t)}},{key:"_replaceMacros",value:function(e,t){return e=fe(e,this.store,t),e=this._replaceCachebustingMacro(e),this.replacePixelMacros&&(e=this._replaceErrorMacro(e,t),e=this._replaceTimestampMacro(e),e=this._replaceVideoMacro(e,t),e=this._replaceVideoCurrentTimeMacro(e,t)),e}},{key:"_replaceCachebustingMacro",value:function(e){var t=Date.now().toString().substring(5);return e.replace("[CACHEBUSTING]",t)}},{key:"_replaceVideoMacro",value:function(e,t){return-1<e.indexOf("[ASSETURI]")?t&&t.dispatcher&&t.dispatcher.getVideoUrl?e.replace("[ASSETURI]",t.dispatcher.getVideoUrl()):e.replace("[ASSETURI]",""):e}},{key:"_replaceTimestampMacro",value:function(e){return-1<e.indexOf("[TIMESTAMP]")?e.replace("[TIMESTAMP]",(new Date).toISOString()):e}},{key:"_replaceVideoCurrentTimeMacro",value:function(t,e){if(-1<t.indexOf("[CONTENTPLAYHEAD]"))try{var i,n,r,s;if(e&&e.dispatcher&&e.dispatcher.video)return i=e.dispatcher.video.currentTime,n=10<=(n=Math.floor(i/60))?n:"0"+n,r=10<=(r=Math.floor(i%60))?r:"0"+r,s=i.toFixed(3).split(".")[1],t.replace("[CONTENTPLAYHEAD]","00:".concat(n,":").concat(r,".").concat(s))}catch(e){return t.replace("[CONTENTPLAYHEAD]","")}return t}},{key:"_replaceErrorMacro",value:function(e,t){return-1===e.indexOf("[ERRORCODE]")?e:e.replace("[ERRORCODE]",ge(t))}},{key:"pause",value:function(){this._isPaused=!0}},{key:"extractWinningPrice",value:function(e,t){var i,n=this.getPixels(this.vpaidEvents.AdImpression),r=void 0;if(0<n.length)for(var s=new RegExp("".concat(e,"=(.*?)(&|$)"),"gi"),o=0;o<n.length;o++){var a=s.exec(n[o].pixel);a&&(1<a.length&&a[1]&&(i=a[1],i=parseFloat(i),!isNaN(i))?r={found:!0,price:a[1]}:(r=r||{found:!1},t&&this._removePixel(this.vpaidEvents.AdImpression,n[o].pixel)))}return r}}])&&vr(e.prototype,t),n&&vr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();function gr(e){return(gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function br(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,s,o,a=[],d=!0,l=!1;try{if(s=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;d=!1}else for(;!(d=(n=s.call(i)).done)&&(a.push(n.value),a.length!==t);d=!0);}catch(e){l=!0,r=e}finally{try{if(!d&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(l)throw r}}return a}}(e,t)||function(e,t){var i;if(e)return"string"==typeof e?_r(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_r(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function kr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==gr(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==gr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===gr(e)?e:String(e)}(n.key),n)}}var wr=e(7),Ar=(window.vpaidId=Date.now()+"-"+parseInt(1e4*Math.random()),0),Tr=function(){function i(e,t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");wr.mixin(this),this.store=t,this.startTime=(new Date).getTime(),this.trackingPixels=ur()(),this._addExternalEventTrackers(e),this.tag=e.tag,this.pvidtp=this.tag.getValueByKey("pvidtp"),this.vpaidLog=e.vpaidLog,this.stopped=!1,this.destroyed=!1,this.debugTracker=new o("VastParser"),this.width=parseInt(e.width||this.store.get("width")),this.height=parseInt(e.height||this.store.get("height")),this.bitrate=parseInt(e.bitrate),this.redirCount=0,this.isMobile=this.store.get("isMobile"),this.secureWrapperUrls=me(t),this.fileSizeConfiguration=this.store.get("fileSizeConfiguration"),this.fileTypes=["flv","wmv","mp4","webm","ogg","mov"],this.vastUrls=[],this.addWrappersToPlayerDAST=this.store.get("adwrprstoplrdst"),this.creativeExtensions=[],this.omidElements=[],this.index=++Ar,this.jsTrackers=e.tag.jsTrackers}var e,t,n;return e=i,(t=[{key:"_addExternalEventTrackers",value:function(e){var i=this;this._addEventPixel("adimpression",e.internalPixel,void 0,void 0);for(var t=0;t<e.tag.conversionPixels.length;t++)this._addEventPixel("adimpression",e.tag.conversionPixels[t],void 0,void 0);for(var n in e.tag.eventTrackers)!function(t){(e.tag.eventTrackers[t]||[]).forEach(function(e){i._addEventPixel(t,e.url,void 0,void 0,e.type)})}(n);var r,s=this.store.get("expxls")||{};for(r in s)this._addEventPixel(r,s[r],void 0,void 0)}},{key:"_fetch",value:function(n,r,t,s){var o=this,e=cmTag.$||e;e.ajax({url:n,beforeSend:function(e){t&&(e.withCredentials=!0)},timeout:1e4,complete:function(e,t,i){e.responseText&&r(null,e.responseText)},error:function(e,t,i){if(s)return r(t);o._fetch(n,r,!1,!0)}})}},{key:"parseVastFromUrl",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(e=e&&e.replace(/\s/g,""),e=this._replaceMacros(e),c(this.vpaidLog,"parseVastFromUrl",{url:e},!1,!1),this.vastUrls.push(e),this.store.get("vstprxy"))return this._fetchVastByProxy(e);this._fetchVastXhr(e,t)}},{key:"_fetchVastByProxy",value:function(e){var t=this.store.get("pxyurl");this._fetchVastXhr(t+e)}},{key:"_fetchVastXhr",value:function(e,t){var i=this,n=this.store.get("psthdrs")||"application/json";Ye(e,t,this._onTagResponse.bind(this),function(){i._onTagResponseError("vastxhrerror_noflash",e)},void 0,void 0,void 0,void 0,n)}},{key:"parseVastFromString",value:function(e){c(this.vpaidLog,"parseVastFromString",{xml:e},!1,!1),this._onTagResponse(e)}},{key:"stop",value:function(){this.stopped=!0,this.vpaidLog=null,this.debugTracker=this.trackingPixels=void 0}},{key:"_extractDuration",value:function(e){var e=this._extractTag("duration",e),t=30;return t=e&&e.length&&e[0].textContent?parseInt(e[0].textContent.replace("00:00:","")):t}},{key:"_extractMediaFile",value:function(e,t,i){if(!this.stopped){for(var n=!1,r=!1,s=this._getFilesTemplate(),o={},a=[],d=0;d<e.length;d++){var l=this._getMediaFileType(e[d]);switch(l&&l.url&&a.push(l.url),l.type){case"vpaid":l.subType==_.VPAID&&(n&&n!=_.VPAID?r=!0:n=_.VPAID,o[_.VPAID]=1,s.vpaid.javascript.push(l));break;case _.VIDEO:n&&n!=_.VIDEO?r=!0:n=_.VIDEO,o[_.VIDEO]=1,s.videoFiles[l.subType].push(l);break;default:r=!0,s.mixed.push(l)}}var u={flag:r,vpaid:1===o[_.VPAID],video:1===o[_.VIDEO],mixed:0<s.mixed.length};r&&(this.mixedFilesFlag=u.vpaid&&u.video),(n=r&&this.preferdVpaid&&o.hasOwnProperty(this.preferdVpaid)?this.preferdVpaid:n)===_.VIDEO&&(s=this.onVideoWrapperMode(s)),a.length&&c(this.vpaidLog,"vastMediaFiles",{urls:a},!1,!1),this.storedMediaFiles=s,this.publishParseTagResults(n,s,t,i)}}},{key:"onVideoWrapperMode",value:function(e){for(var t=null,i=0;i<this.fileTypes.length;i++){var n=e.videoFiles[this.fileTypes[i]],n=(t||0<n.length&&n[0].url&&(t=n[0]),this._chooseBestVideoFile(n,this.bitrate,this.width,this.height));n&&n.url&&e.video.push(n)}return 0===e.video.length&&null!==t&&e.video.push(t),this._sortVideos(e.video),e}},{key:"_sortVideos",value:function(e){var i=this;e.length&&this.pvidtp&&e.sort(function(e,t){return-1!=e.url.indexOf(i.pvidtp)?-1:-1!=t.url.indexOf(i.pvidtp)?1:0})}},{key:"publishParseTagResults",value:function(e,t,i,n){if(!this.stopped){var r=!1;switch(e){case _.VPAID:0<t.vpaid.javascript.length&&(r=!0);break;case _.VIDEO:0<t.video.length&&(r=!0)}r?(this._reportVastXmlList(n),this._onWrapperFound(e,t,i)):(this._onVastError("NoMediaFileAfterSort",n,v.a.mediaFileNotSupported),c(this.vpaidLog,"noMediaFileAfterSort",{}))}}},{key:"_reportVastXmlList",value:function(e){this.store.get("report_vast_xml")&&window.TRC&&window.TRC.vastXmlList&&window.TRC.vastXmlList.push(e)}},{key:"_onWrapperFound",value:function(e,t,i){c(this.vpaidLog,"vpiadWrapperFound",{wrapperMode:e},!1,!1);i={adParams:i,vpaidFiles:t,extra:{duration:this.duration},trackingPixels:this.trackingPixels,mixedFiles:this.mixedFilesFlag},t={price:this.price,icons:this.icons,analysis:this.analysis,creativeExtensions:this.creativeExtensions,omidElements:this.omidElements,hasOmid:this.hasOmid||!1,omidVendor:this.omidVendor||""};this.emit(V.a.VastData,{type:e,handlerOptions:i,vastOptions:t})}},{key:"_chooseBestVideoFile",value:function(e,t,i,n){var r=this;if(this.stopped)return!1;for(var s=!1,o=this.store.get("isMobile"),a=(o&&this.tag.isDirectDemand&&this.store.get("mblmdiadrctdmnd")&&0<(d=e.filter(function(e){return-1<e.url.indexOf("MOBILE")})).length&&(e=d),this.width>=this.height?"width":"height"),d=e.filter(function(e){return e[a]>=r[a]}),l=(0<d.length&&(e=d),n/i),u=99999999,c=0;c<e.length;c++)e[c].ratioFactor=Math.abs(l-e[c].ratio),e[c].sizeFactor=Math.abs(i-e[c].width)+Math.abs(n-e[c].height),e[c].rateFactor=Math.abs(t-e[c].bitrate),e[c].weight=0,o&&(e[c].rateFactor*=-1,this._isRtmp(e[c].url))&&(e[c].weight=1e6),e[c].score=100*e[c].ratioFactor+ +e[c].sizeFactor+e[c].rateFactor+e[c].weight,u>e[c].score&&(u=e[c].score,s=e[c]);return s}},{key:"_isRtmp",value:function(e){return 0===e.indexOf("rtmp://")}},{key:"_getFilesTemplate",value:function(){for(var e={video:[],videoFiles:{},vpaid:{flash:[],javascript:[]},mixed:[]},t=0;t<this.fileTypes.length;t++)e.videoFiles[this.fileTypes[t]]=[];return e}},{key:"_getMediaFileType",value:function(e){if(this.stopped)return{};var t={},i=(t.url=e.textContent,t.url&&(t.url=t.url.trim()),parseInt(e.getAttribute("bitrate"))),i=(t.bitrate=i||0,parseInt(e.getAttribute("width"))),i=(t.width=i||0,parseInt(e.getAttribute("height")));switch(t.height=i||0,t.originalType=e.getAttribute("type"),t.originalType){case"video/x-flv":t.type=_.VIDEO,t.subType="flv";break;case"video/x-ms-wmv":t.type=_.VIDEO,t.subType="wmv";break;case"video/mp4":t.type=_.VIDEO,t.subType="mp4";break;case"video/webm":t.type=_.VIDEO,t.subType="webm";break;case"video/ogg":t.type=_.VIDEO,t.subType="ogg";break;case"video/quicktime":this.store.get("wurfl.browser.name").indexOf(He)<0?(t.originalType="video/mp4",t.type=_.VIDEO,t.subType="mp4"):(t.type=_.VIDEO,t.subType="mov");break;case"application/javascript":case"application/x-javascript":case"text/javascript":t.type="vpaid",t.subType=_.VPAID;break;case"application/x-shockwave-flash":t.type="vpaid",t.subType="flash";break;default:c(this.vpaidLog,"unknownMediaFileType",{type:t.originalType}),t.type="unknown",t.subType="unknown"}return t.ratio=t.width&&t.height?t.height/t.width:"1:1",t}},{key:"_extractTrackingEvents",value:function(e){if(!this.stopped){this._checkForSpecificEvent("impression",e),this._checkForSpecificEvent("error",e),this._checkForSpecificEvent("clickthru",e),this._checkForSpecificEvent("clickthrough",e),this._checkForSpecificEvent("clicktracking",e);e=this._extractTag("trackingevents",e);if(0<e.length)for(var t=this._extractTag("tracking",e[0]),i=0;i<t.length;i++){var n,r,s=t[i].getAttribute("event");s&&("progress"===s.toLowerCase()?((r=t[i].getAttribute("offset"))&&(n=-1===r.indexOf("%")?"time":"precentage"),this._addEventPixel(s.toLowerCase(),this._extractTagUrl(t[i]),r,n)):this._addEventPixel(s.toLowerCase(),this._extractTagUrl(t[i])))}}}},{key:"_extractTagUrl",value:function(e){var t;if(!this.stopped)return(0<(t=this._extractTag("url",e)).length?t[0]:e).textContent}},{key:"_extractTag",value:function(e,t){if(!this.stopped){for(var i,n=t.childNodes,r=[],s=Array.isArray(e),o=0;o<n.length;o++)n[o].tagName&&(i=n[o].tagName.toLowerCase(),(s?-1<e.indexOf(i):i==e)?r.push(n[o]):r=r.concat(this._extractTag(e,n[o])));return r}}},{key:"_extractTagArttibute",value:function(e,t,i){if(!this.stopped){for(var n,r=t.childNodes,s=[],o=0;o<r.length;o++)r[o].tagName&&(r[o].tagName.toLowerCase()==e?(n=r[o].getAttribute(i),s.push(n)):s=s.concat(this._extractTagArttibute(e,r[o],i)));return s}}},{key:"_filterVastByRegex",value:function(e){var t=!0,i=this.tag.getValueByKey("rgxdcdd");return i&&0!==i.length||(i=this.tag.getValueByKey("regx"),t=!1),!!i&&!(!(t=new RegExp(t?i.map(function(t){try{return atob(t)}catch(e){return t}}).join("|"):i,"i").exec(e))||!t.length)}},{key:"_onTagResponse",value:function(e,t){var i,n;this.stopped||(this.tag.getValueByKey("prsvstfrmobj")?this._handlePrebidObject(e):(this.debugTracker.info("Vast was loaded",{vast:e}),c(this.vpaidLog,"tagResponse",{response:e,xhrErrors:t},!0,!1),this._filterVastByRegex(e)?(c(this.vpaidLog,"vastFilterdByRegex",{regex:this.tag.getValueByKey("regx")}),this._onVastFilterdByRegexError("VastFilterdByRegex",e,v.a.filterVastByRegex)):(e=fe(e,this.store,{},this.tag),this.emit(V.a.VastFound,{prbdObj:this.tag.prbdObj}),t=this._parseXml(e),this.store.get("addcdatavst")&&t&&0<t.getElementsByTagName("parsererror").length&&(e=function(e){for(var t,i,n=/http/g,r="<![CDATA[";null!=(t=n.exec(e));)(i=e.substr(t.index-r.length,r.length))!==r&&">"===i[i.length-1]&&(i=(e=e.slice(0,t.index)+r+e.slice(t.index)).indexOf("</",t.index),e=e.slice(0,i)+"]]>"+e.slice(i));return e}(e),t=this._parseXml(e)),null==t||this._extractTag(["parsererror"],t).length?this._onVastError("ParsingError",e,v.a.vastError):(this.vastVersion=this._extractTagArttibute("vast",t,"version").shift()||"1.1",c(this.vpaidLog,"vastVersion",{version:this.vastVersion},!1,!1),this.price=this._getPrice(t),this.icons||(this.icons=this._getIcons(t)),this.creativeExtensions=this.creativeExtensions.concat(this._getCreativeExtensions(t)),this.creativeExtensions=this.creativeExtensions.concat(this.jsTrackers),this.omidElements=this.omidElements.concat(this._getOmidElements(t)),this.duration=this._extractDuration(t),(n=this._extractTag("mediafiles",t))&&1==n.length&&n[0].childNodes.length?0==(n=this._extractTag("mediafile",n[0])).length?(this.debugTracker.error("Vast","No media files!"),this._onVastError("ParsingError",e,v.a.vastError,"noMediaFile")):(this._extractMediaFileAnalysisToPlayerDAST(t),this._setPreferredVpaid(n[0]),this._extractTrackingEvents(t),-1!==(i=this._getAdParameters(t)).indexOf("mp4")&&c(this.vpaidLog,"mp4AdParams",{parameters:i}),(n=this._validateAllMediaFiles(n)).length?this._extractMediaFile(n,i,e):this._onVastError("NoMediaFiles",e,v.a.heavyFilesBlocked,"noMediaFilesAndWrapper")):1==(n=this._extractTag("wrapper",t)).length?(this._extractTrackingEvents(t),this._onWrapper(n[0],e,t)):this._onVastError("NoMediaFiles",e,v.a.emptyVast,"noMediaFilesAndWrapper")))))}},{key:"_handlePrebidObject",value:function(t){if(t){var i={};try{i=JSON.parse(t)}catch(e){i.vastXml=t}this.tag.prbdObj=i,c(this.vpaidLog,"prebidObj",{prebidObj:i}),this.tag.dsm.prsvstfrmobj=!1,this._handleResponseType(i)}else this._onVastError("prebid_no_response",t,v.a.prebidNoResponse,"PrebidParsingError")}},{key:"_handleResponseType",value:function(t){t=t.vastXml||t.ad||t.vastUrl;if(t)try{new URL(t),this.parseVastFromUrl(t)}catch(e){this.parseVastFromString(t)}else this._onVastError("empty_vast_field",t,v.a.prebidEmptyResponse,"EmptyVastFieldPrbdObj")}},{key:"_extractMediaFileAnalysisToPlayerDAST",value:function(e,t){this.analysis={vr:this.vastVersion};var i=this._extractTag("ad",e).shift(),i=(i&&(this.analysis.aid=this._extractAttributeFromTag(i,"id")),this._extractTag("adsystem",e).shift()),i=(i&&(this.analysis.as=this._extractTextFromTag(i),c(this.vpaidLog,"adSystem",{system:this.analysis.as},!1,!1)),this._extractTag("adtitle",e).shift());i&&(this.analysis.at=this._extractTextFromTag(i)),t&&(this.analysis.wu=t)}},{key:"_extractAttributeFromTag",value:function(e,t){return e.getAttribute(t)||""}},{key:"_extractTextFromTag",value:function(e){return e.textContent||""}},{key:"_getPrice",value:function(e){var e=this._extractTag(["price","pricing"],e).shift(),t=0;if(e){e=e.textContent;try{isNaN(Number(e))&&-1!=e.indexOf("DATA")&&(t=e.replace(/[^0-9.]/g,"")),t=(t=Number(e)).toFixed(3),t=Number(t)}catch(e){t=0}}return t}},{key:"_decodeType",value:function(e){var t,i=e.attributes,n={};for(t in i)i[t].value&&(n[i[t].name]=i[t].value.toLowerCase());return n}},{key:"_getCreativeExtensions",value:function(e){for(var t=[],i=this._extractTag(["creativeextension"],e),n=0;n<i.length;n++){var r={};r.element=i[n].textContent.trim(),r.attributes=this._decodeType(i[n]),t.push(r)}return t}},{key:"_getOmidElements",value:function(e){for(var t=[],i={creativeExtnsTags:this._extractTag(["javascriptresource"],e),verificationParameters:this._extractTag(["verification"],e),verificationParametersTags:this._extractTag(["verificationparameters"],e)},n=0;n<i.creativeExtnsTags.length;n++){var r,s,o=i.creativeExtnsTags[n].attributes.getNamedItem("apiFramework");this._isOmidFramework(o)&&(this.hasOmid=!0,s=(o=br(this._getOmidTag(i,n),3))[0],r=o[1],o=o[2],s=this._getValidOmidObj(s,r,o))&&t.push(s)}return t}},{key:"_getOmidTag",value:function(e,t){return[e.creativeExtnsTags[t],e.verificationParameters[t],e.verificationParametersTags[t]]}},{key:"_getValidOmidObj",value:function(e,t,i){var t=this._getOmidVendor(t),n=(c(this.vpaidLog,"OMID",{vendor:t}),this._isInvalidOmidVendor(t.toLowerCase()));if(this.omidVendor||(this.omidVendor=t),!n)return n={scriptUrl:e.textContent.trim(),vendor:t},i&&(n.verificationParameters=i.textContent.trim()),n}},{key:"_getOmidVendor",value:function(e){return e.attributes.getNamedItem("vendor").value}},{key:"_getIcons",value:function(e){for(var t=[],i=this._extractTag(["icon"],e),n=0;n<i.length;n++){var r={},s=this._isIconClicksExists(i[n]);s&&(r.clickThroughUrl=this._decodeIconData(i[n],"iconclickthrough").shift()),r.staticresource=this._decodeIconData(i[n],"staticresource").shift(),r.staticresource||(r.htmlresource=this._decodeIconData(i[n],"htmlresource").shift()),!r.htmlresource&&!r.staticresource||s&&!r.clickThroughUrl||(r.iconViewTracking=this._decodeIconData(i[n],"iconviewtracking"),r.clickTracking=this._decodeIconData(i[n],"iconclicktracking"),r.attributes=this._decodeIconAttributes(i[n]),t.push(r))}return t}},{key:"_isIconClicksExists",value:function(e){return!!this._extractTag(["iconclicks"],e).shift()}},{key:"_decodeIconAttributes",value:function(e){var t,i=e.attributes,n={};for(t in i)i[t].value&&(n[i[t].name]=i[t].value.toLowerCase()),"width"!==i[t].name&&"height"!==i[t].name||(n[i[t].name]+="px");return n}},{key:"_decodeIconData",value:function(e,t){try{return this._extractTag([t],e).map(function(e){return e.textContent.trim()})}catch(e){return this.debugTracker.warn("Vast","decode Icon ".concat(t),e),""}}},{key:"_onWrapper",value:function(e,t,i){var n;if(!this.stopped)return 0==(n=this._extractTag("vastadtagurl",e)).length&&0==(n=this._extractTag("vastadtaguri",e)).length?this._onVastError("WrapperError",t,v.a.vastWrapperError,"EmptyWrapper"):(e=this._extractTagUrl(n[0]))?(0===(e=fe(e,this.store)).indexOf("http:")?_e("absolute_vpaid_wrpper",{url:e}):0!==e.indexOf("//")||this.store.get("secured_protocol")||_e("relative_vpaid_wrpper",{url:e}),this.secureWrapperUrls&&(e=e.replace("http:","https:")),0===this.redirCount&&c(this.vpaidLog,"VastWrapper",{type:"wrapper"}),this.redirCount++,this.addWrappersToPlayerDAST&&this._extractMediaFileAnalysisToPlayerDAST(i,e),void this.parseVastFromUrl(e)):this._onVastError("WrapperError",t,v.a.vastWrapperError,"NoUrl")}},{key:"_getAdParameters",value:function(e){var t;if(!this.stopped)return t="",0<(e=this._extractTag("adparameters",e)).length&&e[0].textContent?e[0].textContent:t}},{key:"_checkForSpecificEvent",value:function(e,t){if(!this.stopped)for(var i=this._extractTag(e,t),n=0;n<i.length;n++)this._addEventPixel(e,this._extractTagUrl(i[n]))}},{key:"_addEventPixel",value:function(e,t,i,n){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"img";this.stopped||null!=this.trackingPixels[e]&&t&&(r=r.toLowerCase(),"progress"===e?i&&n&&this._addProgressPixel(t,i,n,r):this.trackingPixels[e].push({pixel:t,method:r}))}},{key:"_addProgressPixel",value:function(e,t,i,n){try{this.trackingPixels.progress.push({pixel:e,offset:"time"===i?function(e){var t=(e=e.split("."))[0].split(":"),i=0,n=1;for(2===e.length&&(i+=parseInt(e[1])/1e3);0<t.length;)i+=n*parseInt(t.pop(),10),n*=60;return i}(t):parseInt(t.replace("%",""))/100,offsetType:i,fired:!1,method:n})}catch(e){}}},{key:"_parseXml",value:function(e){if(this.stopped)return null;var t=null;if(window.DOMParser)try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(e){t=null}else if(window.ActiveXObject)try{(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e)||(t=null)}catch(e){t=null}return t}},{key:"_onTagResponseError",value:function(e,t){this.stopped||(this.debugTracker.error("Vast","Vast url was not loaded!aborting..."),this.emit(V.a.NetworkFail,{type:e}))}},{key:"_onVastError",value:function(e,t,i,n){this.stopped||(this.debugTracker.error("VAST-ERROR",e),c(this.vpaidLog,"vastParseError",{reason:n,xml:t}),this.emit(V.a.ParserError,{type:e,oppsId:i}))}},{key:"_onVastFilterdByRegexError",value:function(e,t,i){this.stopped||(this.debugTracker.error("VAST-ERROR",e),this.emit(V.a.ParserError,{type:e,oppsId:i}))}},{key:"_sampleVastXml",value:function(e){this.stopped}},{key:"destroy",value:function(){this.stopped=!0,this.destroyed=!0,this.vpaidLog=null,this.vastUrls=null,this.tag=null,this.trackingPixels=this.debugTracker=this.fileTypes=void 0,this._onTagResponse=this._onTagResponseError=function(){}}},{key:"_replaceMacros",value:function(e){return e=e.replace(/\[CACHEBUSTER\]/,Date.now())}},{key:"hasMixedFiles",value:function(){return!0===this.mixedFilesFlag}},{key:"_setPreferredVpaid",value:function(e){this.preferdVpaid=this._getDefaultPreferredMediaFile(),this.hasOmid?this._isOmidActive()||(this.preferdVpaid=_.VPAID):(this.store.getByAdInline([this.analysis],e)||{}).pvpdJs&&(this.preferdVpaid=_.VPAID)}},{key:"_getDefaultPreferredMediaFile",value:function(){var e=this.store.get("prfrmdfl");return Object.values(_).includes(e)?e:_.VIDEO}},{key:"_isOmidActive",value:function(){var e;return(this.tag.getValueByKey("enblomid")||this.store.get("omid.isActive"))&&((null==(e=window.taboolaMobile)?void 0:e.isSupportOMSDK())||!window.taboolaMobile)}},{key:"_isOmidFramework",value:function(e){return e&&"omid"===e.value}},{key:"_isInvalidOmidVendor",value:function(e){var t=this.store.get("omidExcludedVendors"),i=new RegExp(e,"g");return!!t&&t.some(function(e){return i.test(e)})}},{key:"_validateAllMediaFiles",value:function(e){var t=this;return this.fileSizeConfiguration&&this.fileSizeConfiguration.enabled&&this.fileSizeConfiguration.frameTypes&&"number"==typeof this.fileSizeConfiguration.threshold&&-1<this.fileSizeConfiguration.frameTypes.indexOf(this.store.get("frameType"))?e.filter(function(e){return t._isValidSize(t._getMediaFileType(e))}):e}},{key:"_isValidSize",value:function(e){var e=e.bitrate,t=this.duration;return!isNaN(t)&&!isNaN(e)&&e/8/1e3*t<this.fileSizeConfiguration.threshold}}])&&kr(e.prototype,t),n&&kr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();function Er(e){return(Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Er(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Er(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Er(e)?e:String(e)}(n.key),n)}}var Pr=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.tag=e.tag,this.tagId=e.tagId,this.manager=e.manager,this.store=e.store,this.config=e.config,this.target=e.target,this.opportunityManager=e.opportunityManager,this.vpaidLog=e.vpaidLog,this.placement=e.placement,this.vpaidLog=this._createVpaidLog(),this.opportunityManager=this._createOpportunityManager(),this.pixelManager=new yr(this.store,this.vpaidLog),this.vastParser=this.tag.externexternalPlayerItem?null:this._createVastParser(),this.vpaidWrapper=this._createVpaidWrapper()}var e,i,n;return e=t,(i=[{key:"_createVpaidWrapper",value:function(){return new Kn({tag:this.tag,creatives:this.config.creatives,vpaidEvents:f.a,config:this.config,tagid:this.tagId,manager:this.manager,wfStats:this.tag.wfStats,target:this.target,store:this.store,vpaidLog:this.vpaidLog,opportunityManager:this.opportunityManager,pixelManager:this.pixelManager,vastParser:this.vastParser,placement:this.placement})}},{key:"_createVpaidLog",value:function(){var e,t={auctionId:this.tag.auctionId,advId:this.tag.advId,dast:this.tag.dast,price:this.tag.price,queueNumber:this.tag.queueNumber,cpmFloor:this.tag.cpmFloor,dp:this.tag.dp,rollType:this.tag.rollType,lineItem:this.tag.lineItem,unitType:this.store.get("unit_type"),unitVersion:this.store.get("unit_version"),isMobile:this.store.get("isMobile")||!1,rpox:this.tag.rpox,alfrox:this.tag.alfrox,frox:this.tag.frox,waterfallIndex:this.tag.wfIndex,itemType:this.tag.itemType,requiredViewability:this.tag.requiredViewability,requiredViewabilityDrawn:this.tag.requiredViewabilityDrawn,flad:this.tag.flad||this.tag.flad_delay||0,brand:this.tag.brand,priority:this.tag.priority,isCPCV:this.tag.isCPCV,backfillDelayed:!!this.tag.isBackfillDelayed,moatSampling:this.tag.moatSampling,getValueByKey:this.tag.getValueByKey,pwov:this.tag.pwov,allowSlider:this.tag.alwsldr};return this.tag.crId&&(e={stId:this.tag.stId,cmpgnId:this.tag.cmpgnId,itemType:this.tag.itemType},t=Object.assign(t,e)),new sr(t,this.store)}},{key:"_createOpportunityManager",value:function(){var e=this.config.creatives;return new dr({CM_DOMAIN:e.CM_DOMAIN,AUC_DAST:e.AUC_DAST,sequenceId:this.tag.sequenceId,ST:e.ST,STS:e.STS,SDID:e.SDID,PT:e.PT,PV:e.PV,WP:e.WP,VPD:e.PUBID,VPTD:e.TAGID,VMT:e.VMT},this.store,this.vpaidLog)}},{key:"_createVastParser",value:function(){var e=this.config;return new Tr({vpaidLog:this.vpaidLog,width:e.width,height:e.height,bitrate:e.bitrate,internalPixel:this.tag.pixel,tag:this.tag},this.store)}}])&&Sr(e.prototype,i),n&&Sr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Vr(e){return(Vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cr(e,t,i){(t=Or(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}function Ir(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Or(n.key),n)}}function Or(e){e=function(e,t){if("object"!==Vr(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Vr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Vr(e)?e:String(e)}var D="function",x="prop",Dr="tag",xr="object",Mr=function(){function i(e){var t=this;if(this instanceof i)return this.interface={},this.vpaidWrapper=e,this.members=[{name:"dontDie",type:D},{name:"restartAd",type:D},{name:"emit",type:D},{name:"getVpaidData",type:D},{name:"setDebugData",type:D},{name:"on",type:D},{name:"off",type:D},{name:"pauseAd",type:D},{name:"resumeAd",type:D},{name:"resizeAd",type:D},{name:"mute",type:D},{name:"unmute",type:D},{name:"toggleIframeContentDisplay",type:D},{name:"setDebugDataFunc",type:D},{name:"stop",type:D},{name:"skipAd",type:D},{name:"nonVideoVpaid",type:x},{name:"isCPCV",type:x},{name:"adTarget",type:x},{name:"hadImpression",type:x},{name:"isBf",type:x},{name:"hasAdChoices",type:x},{name:"type",type:x},{name:"localTarget",type:x},{name:"pwov",type:x},{name:"clickThruUrl",type:x},{name:"adVolume",type:x},{name:"isReplayable",type:x},{name:"tag",type:Dr},{name:"playerDAST",type:xr},{name:"vpaidLog",type:xr}],this.memberConverter=(Cr(e={},D,this._convertFunction.bind(this)),Cr(e,x,this._convertProp.bind(this)),Cr(e,Dr,this._convertTag.bind(this)),Cr(e,xr,this._convertObject.bind(this)),e),this.vpaidWrapper.once("vpaidCleaned",function(){t._stop()}),this._appendMembersToInterface(),this.interface;throw new TypeError("Cannot call a class as a function")}var e,t,n;return e=i,(t=[{key:"_appendMembersToInterface",value:function(){var t=this;this.members.forEach(function(e){t.memberConverter[e.type](e.name)})}},{key:"_convertFunction",value:function(e){this.interface[e]=this.vpaidWrapper[e].bind(this.vpaidWrapper)}},{key:"_convertProp",value:function(e){var t=this;Object.defineProperty(this.interface,e,{get:function(){if(!t.stopped)return t.vpaidWrapper[e]}})}},{key:"_convertTag",value:function(e){var t=this;Object.defineProperty(this.interface,e,{get:function(){if(!t.stopped)return Object.assign(t.vpaidWrapper[e],t.vpaidWrapper[e].vpaidWrapperData)}})}},{key:"_convertObject",value:function(e){this.interface[e]=this.vpaidWrapper[e]}},{key:"_stop",value:function(){this.stopped=!0,this.vpaidWrapper=this.members=this.memberConverter=this.interface=void 0}}])&&Ir(e.prototype,t),n&&Ir(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(),M=e(4);function Rr(e){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Rr(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Rr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Rr(e)?e:String(e)}(n.key),n)}}var Fr=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.store=e}var e,i,n;return e=t,(i=[{key:"loadFromTRC",value:function(e,t,i,n){this._isServiceLoadedOnTRC(e,t)&&this._isServiceValid(e,t)&&this._onServiceLoaded(e,t,i,n)}},{key:"loadFromExternalUrl",value:function(e,t,i,n){var r;this._isServiceValid(e,t)&&((r=document.createElement("script")).src="".concat(ae(this.store.get("base_url")),"/").concat(e,"/").concat(t,"/").concat(e,".js"),r.async=!0,r.onerror=function(){},r.onload=this.loadFromTRC.bind(this,e,t,i,n),document.getElementsByTagName("head")[0].appendChild(r))}},{key:"_isServiceValid",value:function(e,t){return e&&t}},{key:"_isServiceLoadedOnTRC",value:function(e,t){return window.TRC&&window.TRC[e]&&window.TRC[e][t]}},{key:"_onServiceLoaded",value:function(e,t,i,n){if(i)try{i(window.TRC[e][t])}catch(e){n&&n()}}}])&&Lr(e.prototype,i),n&&Lr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Br(e){return(Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Br(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Br(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Br(e)?e:String(e)}(n.key),n)}}function Wr(e){return!!e.adjacencyAd}function Ur(e){return!!e.getValueByKey("nbladnoorgnc")}var Nr=e(7),Hr=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");Nr.mixin(this),this.store=e,this.debugTracker=new o("PrebidHandler"),this.config={debug:this.store.get("isDebug"),usePrebidCache:this.store.get("prbdcch"),cache:{url:this.store.get("prbdcchul")}},this.width=+this.store.get("width"),this.height=+this.store.get("height"),this.bidderRequest=null,this.bidRequest=null}var e,i,n;return e=t,(i=[{key:"loadPrebidJs",value:function(){var t=this;this.prebidJs?this._emitOnLoad():(window.pbjs=window.pbjs||{},window.pbjs.installedModules=window.pbjs.installedModules||[],this.serviceLoader=new Fr(this.store),this.serviceLoader.loadFromExternalUrl("prebid",this.store.get("prbdjsv"),function(e){t.prebidJs=e,t._emitOnLoad()},function(){t.debugTracker.error("Prebid.js","Error while loading from service loader")}))}},{key:"requestBids",value:function(e,t,i){this.bidderRequest=this._parsePrebidConfig(e,i),this.bidRequest=this.bidderRequest&&this._getBid(),this.bidRequest?(this._setSizes(),this._setReferer(),this._setMimes(),this._setVideoDivId(t.id),this._setBidParams(t.id),this._logRequest(i),this._buildRequestUrl(i)):this.emit("noBids")}},{key:"interpretResponse",value:function(e,t,i,n,r){if(e){e=this.prebidJs.interpretResponse({vast:t,adUnit:i.adUnit,request:n});if(null!=e&&e[0])return c(r,"responseNum",{number:e.length}),e[0]}}},{key:"logInterpretedResponse",value:function(e,t){c(e,"prebidPricing",{price:t.cpm,currency:t.currency,netRevenue:t.netRevenue,floor:this.prebidFloor,belowFloor:t.cpm<this.prebidFloor,ad:!!t.ad,vastUrl:!!t.vastUrl,vastXml:!!t.vastXml})}},{key:"isResponseCpmAboveFloor",value:function(e){return e>=this.prebidFloor}},{key:"isValidInterpretation",value:function(e){return!!e}},{key:"isValidCpm",value:function(e){return e.cpm&&0<e.cpm}},{key:"_emitOnLoad",value:function(){this.emit("prebidLoaded")}},{key:"_parsePrebidConfig",value:function(e,t){try{return JSON.parse(e)}catch(e){c(t,"Failed to parse prebid configuration string",{ex:e})}}},{key:"_getBid",value:function(){var e=this.bidderRequest.adUnit,e=(void 0===e?{}:e).bids;if(e&&0<e.length)return e[0]}},{key:"_setSizes",value:function(){this.bidderRequest.adUnit.sizes.push([this.width,this.height]),this.bidderRequest.adUnit.mediaTypes.video.playerSize.push([this.width,this.height])}},{key:"_setMimes",value:function(){this.bidderRequest.adUnit.mediaTypes.video.mimes=["video/mp4"]}},{key:"_setVideoDivId",value:function(e){this.bidderRequest.adUnit.video=this.bidderRequest.adUnit.video||{},this.bidderRequest.adUnit.video.divId=e}},{key:"_setReferer",value:function(){var e=this.bidderRequest.refererInfo,e=void 0===e?{}:e,e=e.referer?decodeURIComponent(e.referer):location.href;this.bidderRequest.refererInfo={referer:e,page:e}}},{key:"_logRequest",value:function(e){var t=this.bidRequest,i=t.bidder,n=t.crumbs,n=void 0===n?{}:n,t=t.params,t=void 0===t?{}:t,r=this.bidderRequest.adUnit,r=void 0===r?{}:r,s=r.code,o=r.mediaTypes,r=r.sizes,o=o.video;c(e,"prebidReq",{bidder:i,pubcid:null!=n&&n.pubcid?n.pubcid:void 0,placementId:null!=t&&t.placementId?t.placementId:void 0,zoneId:null!=t&&t.zoneId?t.zoneId:void 0,code:s,video:o,sizes:void 0===r?[]:r,floor:this.prebidFloor})}},{key:"_buildRequestUrl",value:function(e){var t=this.bidRequest.bidder,i=this.prebidJs.getBuildRequestsMethod(t),n=this.prebidJs.getAdapterSpec(t);i&&n.isBidRequestValid(this.bidRequest)?(this._setGdprData(),i=this._getRequest(i,e),this._isValidRequest(i)?(c(e,"prbdReq",{method:i.method}),this.emit("receivedBids",{req:i,spec:n,conf:this.bidderRequest})):this._reportErrorAndEmitNoBids(e,"invalidPrebidRequest",null!=i?i:{})):this._reportErrorAndEmitNoBids(e,"buildRequestsMissing",{bidder:t})}},{key:"_reportErrorAndEmitNoBids",value:function(e,t,i){c(e,t,i),this.emit("noBids")}},{key:"_getRequest",value:function(e,t){e=e([this.bidRequest],this.bidderRequest);return Array.isArray(e)?(c(t,"requestNum",{number:e.length}),e[0]):e}},{key:"_isValidRequest",value:function(e){return null==e?void 0:e.url}},{key:"_setGdprData",value:function(){var e=this.bidderRequest.adUnit,e=(void 0===e?{}:e).gdprData,e=void 0===e?{}:e,t=e.ccpa,t=void 0===t?"1YYY":t,i=e.sChainParams,i=void 0===i?{}:i;this._setGdpr(e),this._setCcpa(t),this._setSupplyChain(i)}},{key:"_setGdpr",value:function(e){this.bidderRequest.gdprConsent={gdprApplies:1==e.gdprApplies,consentString:e.consentStr||""}}},{key:"_setCcpa",value:function(e){this.bidderRequest.uspConsent=e}},{key:"_setSupplyChain",value:function(e){var t;this.bidRequest.schain={ver:"1.0",complete:1,nodes:[{asi:"taboola.com",sid:null!=(t=e.sid)?t:"",rid:null!=(t=e.rid)?t:"",hp:1}]}}},{key:"_setBidParams",value:function(e){var t;this.prebidFloor=null!=(t=this.bidRequest.params.bidfloor)?t:0,this.bidderRequest.adUnit.code=e,this.bidderRequest.adUnit.params=this.bidRequest.params,this.bidRequest.code=this.bidderRequest.adUnit.code,this.bidRequest.mediaTypes=this.bidderRequest.adUnit.mediaTypes,this.bidRequest.sizes=this.bidderRequest.adUnit.sizes}}])&&jr(e.prototype,i),n&&jr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qr(e){return(qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==qr(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==qr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===qr(e)?e:String(e)}(n.key),n)}}function Qr(e,t,i){return t&&zr(e.prototype,t),i&&zr(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var Gr=Qr(function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.store=t.store,this.config=t.config,this.options=t.options,this.target=t.target,this.EXPIRATION_TIME=this.store.get("expirationTime")||6e4});function Kr(e){return(Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==Kr(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==Kr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===Kr(e)?e:String(e)}(n.key),n)}}var Xr=e(7),Yr=function(){function i(e){var t=this;if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");Xr.mixin(this),this.store=e.store,this.config=e.config,this.options=e.options,this.target=e.target,this.consts=new Gr(e),this.time=(new Date).getTime(),this.sequenceId=((new Date).getTime()+"").substring(3,11),this.loops=0,this.stopped=!1,this.started=!1,this.schedule=[],this.timedTimeout=0,this.waterfall={},this.adSlots=1,this.filledSlots=0,this.adIsPlaying=!1,this.shouldBlockRv1Ads=!1,this.debugTracker=new o("Manager"),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.supportExternalPlayers=this.store.get("sprtxtrnlplyrs"),this.prebidJsEnabled=this.store.get("prbdjse"),this.droppableTypes=this.store.get("drpbletps")||[],this.shouldFireGetAdPixels=$(this.store.get("frgtadpxls")),this.shouldFirePpdFlowPixel=$(this.store.get("frppdfpxl")),this.store.set("isFirstImpression",!0),this.oppsID=v.a,this.queueSize=this.store.get("queue_size")||10,this.store.on("stop",this.stop.bind(this)),this.store.on(g.outer.EmitQueueStatus,this._emitQueueStatus.bind(this,"queueStatus")),this.store.on("navigatorConnectionChange",this._onNavigatorConnectionChange.bind(this)),this._onNavigatorConnectionChange(),this.queueStatus=new rt(this.store),this.supportNonVideoVpaid&&(this.nonVideoItem=null,this.store.on(g.inner.NonVideoItemInWaterfall,this._onNonVideoItemInWaterfall.bind(this))),this.store.get("debug")&&setInterval(function(){t._postMessageSchedule()},1e3),this.dontTrimMp4=this.store.get("novdtrm"),this.maxBackfillDelayItems=this.store.get("mxbckflldlyitms"),this.maxBackfillDelayItems&&(this.backfilldelayTime=this.store.get("bckflldlyms"),this.backfillPriority=this.store.get("bfprty")),this.continueGetAdFlow=this.store.get("cntgtad")}var e,t,n;return e=i,(t=[{key:"_postMessageSchedule",value:function(){if(window.cmPlayerDeubg){var e=this.schedule,t=this.store;try{window.cmPlayerDeubg({schedule:e,store:t})}catch(e){console.log(e)}}}},{key:"trigger",value:function(e,t,i){var n;this._handleAllEvents({type:e,dispatcher:t}),this.store.emit(e,t),!t.working&&e!==f.a.AdImpression||(n={type:e,dispatcher:t},e===f.a.AdImpression&&(n.tag=t.tag),n.vpaidReady=this.getVpaidReadyCount(),n.qsize=this.schedule.length,n.dp=t&&t.tag?t.tag.dp:"na",n.adImpMS=t?t.adImpInMS:0,n.readyInMS=t?t.readyInMS:0,n.loadToImpMS=t?t.adImpInMS-t.readyInMS:0,n.clickThru={url:i?i.url:"",playerHandles:i&&!1!==i.playerHandles},this.emit(e,n))}},{key:"getVpaidReadyCount",value:function(){var t=0;return this.schedule.map(function(e){e&&e.vpaidWrapper&&"ready"===e.vpaidWrapper.status&&t++}),t}},{key:"getVpaidReadyImpressionCount",value:function(){var t=0;return this.schedule.map(function(e){e&&e.vpaidWrapper&&e.vpaidWrapper.hadImpression&&t++}),t}},{key:"subscribeToVpaidWrapper",value:function(e){e.on("vpaidCleaned",this._onVpaidCleaned.bind(this,e)),this.stopped||e.subscribe(this._handleError.bind(this),f.a.AdError)}},{key:"_handleAllEvents",value:function(e){var t=this,i=this.store.get("max_ready_vpaid")||2;e.type!==f.a.AdVideoStart&&e.type!==f.a.AdImpression&&e.type!==f.a.AdPlaying||!e.dispatcher.isPlaying||this.trigger("viewAdPlayer",e.dispatcher.tag),e.type===f.a.AdLoaded&&this.shouldPlayWhenAvialable&&!this.store.get("evtbsschdl")&&(setTimeout(function(){t.playFromQueue(t.shouldPlayWhenAvialable,t.options||{})},2),e.dispatcher&&e.dispatcher.tag,this.shouldPlayWhenAvialable=!1),e.type===f.a.AdImpression&&(this.getVpaidReadyImpressionCount()>=i&&$(parseInt(this.store.get("frdmrvhpxls")))&&h(u(y.maxReadyVpaidHit,this.store)),e.dispatcher.options&&e.dispatcher.options.getAdContext?(e.dispatcher.gotAd=!0,this.debugTracker.info("gotAd",e.dispatcher,{color:"#5EB9FF"}),c(e.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!1}),e.dispatcher.options.getAdContext.getAdCallback(new Mr(e.dispatcher))):e.dispatcher&&e.dispatcher.vpaidLog&&c(e.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!0}))}},{key:"_runNextAd",value:function(){}},{key:"_handleError",value:function(e){e=e.dispatcher;this.adIsPlaying&&e&&e.isStarted&&!e.hadImpression&&!this.store.get("evtbsschdl")&&this.playFromQueue(this.shouldPlayWhenAvialable,e.options||{})}},{key:"initVpaidInQue",value:function(){if(!this.stopped)for(var e,t=this.schedule,i={},n=0;n<t.length;n++)i=t[n],e="".concat(n,"-").concat(i.waterfallTagId),i.vpaidWrapper||(this.maxBackfillDelayItems&&i.priority===this.backfillPriority?i.backfillDelay=setTimeout(this._createVpaidWrapper.bind(this,i,e),this.backfilldelayTime):this._createVpaidWrapper(i,e))}},{key:"_createVpaidWrapper",value:function(e,t,i){this._setBackfillDelay(e),e.sequenceId=e.wfIndex;t=this._createQueueItem(e,t,i);e.vpaidWrapper=t.vpaidWrapper,this.subscribeToVpaidWrapper(e.vpaidWrapper)}},{key:"_setBackfillDelay",value:function(e){e.backfillDelay&&(e.backfillDelay=window.clearTimeout(e.backfillDelay),e.isBackfillDelayed=!0)}},{key:"_updateCostModel",value:function(e){var t=new dt(this.store),i=e.getValueByKey("cstmdl");void 0===i&&(i=e.cstmdl),e.cstmdl=i,e.isCPCV=t.isCPCV(e.cstmdl)}},{key:"_createQueueItem",value:function(e,t,i){e={tag:e,tagId:t,manager:this,store:this.store,config:this.config,target:this.target,placement:i};return new Pr(e)}},{key:"_onVpaidCleaned",value:function(e){this.cleanQueue(this.queueSize),this.continueGetAdFlow&&e.options&&e.adStarted&&!e.hadImpression&&this.getAdFromQueue(e.options),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"unsubscribeFromVpaid",value:function(e){!this.stopped&&e&&(e.unsubscribe(null,f.a.AdError),e.unsubscribe(null,f.a.AdFound),e.unsubscribe(null,f.a.AdStopped),e.unsubscribe(null,f.a.AdSkipped),e.unsubscribe(null,f.a.AdImpression),e.unsubscribe(null,f.a.AdSkippableStateChange),e.unsubscribe(null,f.a.AdSizeChange),e.unsubscribe(null,f.a.AdLinearChange),e.unsubscribe(null,f.a.AdDurationChange),e.unsubscribe(null,f.a.AdExpandedChange),e.unsubscribe(null,f.a.AdVolumeChange),e.unsubscribe(null,f.a.AdVideoStart),e.unsubscribe(null,f.a.AdVideoFirstQuartile),e.unsubscribe(null,f.a.AdVideoMidpoint),e.unsubscribe(null,f.a.AdVideoThirdQuartile),e.unsubscribe(null,f.a.AdVideoComplete),e.unsubscribe(null,f.a.AdClickThru),e.unsubscribe(null,f.a.AdInteraction),e.unsubscribe(null,f.a.AdUserAcceptInvitation),e.unsubscribe(null,f.a.AdUserMinimize),e.unsubscribe(null,f.a.AdUserClose),e.unsubscribe(null,f.a.AdPaused),e.unsubscribe(null,f.a.AdPlaying),e.unsubscribe(null,f.a.AdLog))}},{key:"_shouldDropAd",value:function(e,t){return-1<this.droppableTypes.indexOf(e)&&this._isItemOfType(t,e)&&!(Wr(t)&&Ur(t))}},{key:"_isItemOfType",value:function(e,t){return e.hasOwnProperty(t)&&e[t]}},{key:"_isPPDPreventingCleanup",value:function(){return this.store.get("isPPD")}},{key:"cleanQueue",value:function(n,r){var s,o,a=this;this._isPPDPreventingCleanup()||(this.schedule.map(function(e,t){var i,n;e&&e.vpaidWrapper&&!e.vpaidWrapper.working&&(i=!1,n=null,"error"===e.vpaidWrapper.status||"stopped"===e.vpaidWrapper.status?(i=!0,n="error"===e.vpaidWrapper.status?a.oppsID.vastError:a.oppsID.adError):r&&a._shouldDropAd(r,e)&&!e.vpaidWrapper.hadImpression&&(i=!0,n=a.oppsID.adDropped),i)&&(a.queueStatus.onItemRemovedFromQueue(e),e.vpaidWrapper._status=e.vpaidWrapper.status,a.unsubscribeFromVpaid(a.schedule[t].vpaidWrapper),a.schedule[t].vpaidWrapper.stop("cleanExpierd",n),a.schedule[t]&&(a.schedule[t].vpaidWrapper=null),a.schedule[t]=void 0)}),this.schedule=this.schedule.filter(function(e){return e}),this.schedule=tt.a.sort(this.schedule,this.store),this.schedule.length>n&&(s=this.config.creatives.ADTO||this.consts.EXPIRATION_TIME,o=this.store.get("trmrdyvpaid"),this.schedule.map(function(e,t){var i;!a.schedule[t]||e.vpaidWrapper.working||!o&&"ready"===e.vpaidWrapper.status||(i=Date.now()-a.schedule[t].vpaidWrapper.created,e&&(t<a.schedule.length-n||s<i)&&(a.queueStatus.onItemRemovedFromQueue(e),a.unsubscribeFromVpaid(a.schedule[t].vpaidWrapper),a._canTrim(i=s<i?"queueExpired":"queueTrimmed",e))&&(a.schedule[t].vpaidWrapper.stop(i,a.oppsID[i]),a.schedule[t]=void 0))})),this.schedule=this.schedule.filter(function(e){return e}))}},{key:"_canTrim",value:function(e,t){return"queueTrimmed"!==e||!(t.vpaidWrapper&&"mp4"===t.vpaidWrapper.type&&this.dontTrimMp4)}},{key:"_setPPDpriorityIfPPD",value:function(e){e.advType===M.PUBLISHER_DEMAND&&this.store.set("isPPD",!0)}},{key:"_terminatePPDFlow",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];(this.store.get("isPPD")&&e===M.PUBLISHER_DEMAND||t)&&this.store.set("isPPD",!1)}},{key:"_clientPreferPPD",value:function(e){return e&&this.store.get("isPPD")}},{key:"_reportQueueSizeHit",value:function(){$(parseInt(this.store.get("frdqshpxls")))&&h(u(y.queueSizeHit,this.store))}},{key:"fillSchedule",value:function(e){this.schedule.length>this.queueSize&&(this.cleanQueue(this.queueSize),this._reportQueueSizeHit()),this.started=!0,this.stopped=!1;for(var t={},i=0,n=this.config.creatives,r=(n.ADTO=1<parseInt(n.ADTO)?parseInt(n.ADTO):60,n.ADTO=n.ADTO<1e3?1e3*n.ADTO:n.ADTO,this.adSlots=parseInt(n.B2B)&&1<parseInt(n.B2B)?parseInt(n.B2B):1,n.DEFAULTTAGTIMEOUT<1e3?1e3*n.DEFAULTTAGTIMEOUT:n.DEFAULTTAGTIMEOUT),i=0;i<e.tags.length;i++)this._setPPDpriorityIfPPD(e.tags[i]),this._shouldInsertToQueue(e.tags[i])&&((t=e.tags[i]).active=!1,t.adFound=!1,t.offset=0,t.tagStart=0,t.tagTimeout=r,t.queueNumber=0,t.ADTO=n.ADTO,t.vpaidWrapper=!1,t.tagEnd=+t.tagStart+ +t.tagTimeout,t.wfStats=e.data,t.externalPlayerItem=this.store.get("xtrnlplyrstyps").includes(t.itemType),t.isPrebid=t.advType===M.PREBID,this._updateCostModel(t),this.store.get("frstlk")&&this._updateItemFirstLook(t),t.externalPlayerItem?this.supportExternalPlayers&&this._handleExternalPlayer(t):t.isPrebid?this.prebidJsEnabled&&this._loadPrebidJs(t):this.schedule.push(t));this._printQueue(this.schedule),this.time=(new Date).getTime(),this.initVpaidInQue(),this.store.set("queueLength",this.schedule.length),this.store.set("vpaidReadyCount",this.getVpaidReadyCount()),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"_shouldInsertToQueue",value:function(e){return!(this.maxBackfillDelayItems&&e.priority===this.backfillPriority&&!(e.priority===this.backfillPriority&&this._getBackfillCount()<this.maxBackfillDelayItems)||this.shouldBlockRv1Ads&&e.requiredViewability)}},{key:"_printQueue",value:function(e){e=e.map(function(e){return{dp:e.dp,lineItem:e.lineItem,alfrox:e.alfrox,waterfallIndex:e.wfIndex,status:e.vpaidWrapper?e.vpaidWrapper.status:"",videoUrl:e.vpaidWrapper&&e.vpaidWrapper.hadImpression?e.vpaidWrapper.getVideoUrl():""}});this.debugTracker.table(e)}},{key:"_updateItemFirstLook",value:function(e){e.flad&&(this.store.get("first_look_ad_loaded")?(e.flad_delay=e.flad,delete e.flad):this._startFladTimeout(e.flad))}},{key:"_handleExternalPlayer",value:function(t){var i=this;this.externalPlayersManager?this.externalPlayersManager.initExternalPlayer(this._generateExternalPlayerSettings(t)):(this.serviceLoader=new Fr(this.store),this.serviceLoader.loadFromExternalUrl("external-players-manager",this.store.get("xtrnlplyrsmngrv"),function(e){i.externalPlayersManager=new e(i._generateExternalPlayersManagerSettings()),i.externalPlayersManager.on("pushItems",i._onPushItems.bind(i)),i.externalPlayersManager.initExternalPlayer(i._generateExternalPlayerSettings(t))},function(){i.debugTracker.error("External players manager","Error while loading from service loader")}))}},{key:"_generateExternalPlayersManagerSettings",value:function(){return{queueData:this._getExternalPlayersManagerQueueData(),vpaidEvents:f.a,aggregate:this.store.get("xtrnlplyrsmngragg"),pushItemsInterval:this.store.get("xtrnlplyrsmngrpshintrvl")}}},{key:"_getExternalPlayersManagerQueueData",value:function(){return{createQueueItemMethod:this._createQueueItem.bind(this),subscribeToVpaidWrapperMethod:this.subscribeToVpaidWrapper.bind(this)}}},{key:"_generateExternalPlayerSettings",value:function(e){return{item:e,store:this.store}}},{key:"_onPushItems",value:function(e){var t=this;e.forEach(function(e){t.schedule.push(e),e.vpaidWrapper.getHandlerOptions().onReady()}),this.store.set("queueLength",this.schedule.length),this.store.set("vpaidReadyCount",this.getVpaidReadyCount()),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"_startFladTimeout",value:function(e){this.store.set("first_look_ad_loaded",e),this.fladTimeout=setTimeout(this._onFladTimeout.bind(this),1e3*e)}},{key:"_onFladTimeout",value:function(){for(var e=null,t=0;t<this.schedule.length;t++)if((e=this.schedule[t]).flad_delay)return e.flad=e.flad_delay,delete e.flad_delay,void this._startFladTimeout(e.flad);this.store.set("first_look_ad_loaded",!1),this.store.emit("fladInactive")}},{key:"stop",value:function(){if(!this.stopped){this.stopped=!0,window.clearTimeout(this.timedTimeout);for(var e=0;e<this.schedule.length;e++)this.schedule[e].backfillDelay?window.clearTimeout(this.schedule[e].backfillDelay):this.schedule[e].vpaidWrapper.stop("playerClosed",this.oppsID.playerClosed);this._destroyExternalPlayersManager(),this.nonVideoItem=null}}},{key:"_destroyExternalPlayersManager",value:function(){this.externalPlayersManager&&this.externalPlayersManager.destroy()}},{key:"managerEnd",value:function(){}},{key:"playFromQueue",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!this.store.get("isIdleMode")&&!this.stopped){for(var i=Date.now(),n=(this.store.set("playFromQueue",i),this.getVpaidReadyCount()),r=(this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=tt.a.sort(this.schedule,this.store)),this.config.creatives.ADTO,!1),s=this._getItemScores(),o=(this._getItemDps(),this.schedule.length-1);0<=o;o--){var a=this.schedule[o];a&&(this._setItemScores(a,o,s),"ready"!==a.vpaidWrapper.status||a.vpaidWrapper.working||a.vpaidWrapper.isStarted||r||this.store.get("first_look_ad_loaded")&&!a.flad||(this.store.set("playFromQueueFound",i),a.vpaidWrapper.workingVpaid=!0,this.store.set("ad_controls",!1!==a.getValueByKey("ad_controls")),a.vpaidWrapper.working=!0,a.vpaidWrapper.isPlaying=!0,r=this.adIsPlaying=!0,a.vpaidWrapper.startAd(t),c(a.vpaidWrapper.vpaidLog,"startFromQ",{score:a.score})))}this.store.get("run_wf_when_empty")&&0===n&&this.store.emit("playFromEmptyQueue")}}},{key:"bringVpaidToFront",value:function(){for(var e=this.schedule.length-1;0<=e;e--){var t=this.schedule[e];if(t&&t.vpaidWrapper.workingVpaid){t.vpaidWrapper.bringToFront();break}}}},{key:"_getItemScores",value:function(){for(var e=[],t=this.schedule.length-1;0<=t;t--){var i=this.schedule[t];i&&e.push(i.score)}return e}},{key:"_getItemDps",value:function(){for(var e=[],t=this.schedule.length-1;0<=t;t--){var i=this.schedule[t];i&&e.push(i.dp)}return e}},{key:"_setItemScores",value:function(e,t,i){e.vpaidWrapper&&e.vpaidWrapper.vpaidLog&&e.vpaidWrapper.vpaidLog.data&&(e.vpaidWrapper.vpaidLog.data.itemScore=e.score,i)&&c(e.vpaidWrapper.vpaidLog,"itemScores",{index:t,scores:i},!1,!1)}},{key:"resizeAd",value:function(e,t,i){if(!this.stopped){this.config.creatives.PLAYER_WIDTH=this.config.width=parseInt(e),this.config.creatives.PLAYER_HEIGHT=this.config.height=parseInt(t),this.config.creatives.VIEW_MODE=this.config.viewMode=i;for(var n=0;n<this.schedule.length;n++)this.schedule[n].vpaidWrapper&&!this.schedule[n].vpaidWrapper.stopped&&this.schedule[n].vpaidWrapper.callVpaidMethod("resizeAd",[e,t,i],0)}}},{key:"setAdVolume",value:function(e,t){if(!this.stopped){if(e=1<e?e/100:e,isNaN(parseFloat(e)))return!1;e=parseFloat(e),t||(this.config.creatives.VOLUME=e),this.config.creatives.MUTED=0==e;for(var i=0;i<this.schedule.length;i++)this.schedule[i].vpaidWrapper&&!this.schedule[i].vpaidWrapper.stopped&&this.schedule[i].vpaidWrapper.workingVpaid&&this.schedule[i].vpaidWrapper.setAdVolume(e)}}},{key:"callWorkingVpaid",value:function(e,t,i){if(!this.stopped)for(var n=0;n<this.schedule.length;n++){var r=this.schedule[n].vpaidWrapper;if(r&&r.workingVpaid)return r.callVpaidMethod(e,t,i)}}},{key:"getVpaidLogs",value:function(){for(var e=[],t=0;t<this.schedule.length;t++){var i=this.schedule[t];i&&i.vpaidWrapper&&i.vpaidWrapper.vpaidLog&&e.push(i.vpaidWrapper.vpaidLog)}return e}},{key:"getAd",value:function(i){var t=this,n=(this.store.incr("getAdData.count"),this),e=(this.debugTracker.info("getAd",i||"empty getAd",{color:"#5EB9FF"}),this.shouldFireGetAdPixels&&h(u(y.getAd,this.store)),this.store.set("ppdAdImpressionTimeoutInMS",i.ppdAdImpressionTimeout),new Promise(function(e,t){e={getAdCallback:e};(i=i||{}).id=(new Date).getTime(),i.getAdContext=e,i.getAdRetries=0,i.getAdContext.getAdTimeout=setTimeout(function(){n.cancelGetAd(i),i.getAdContext=void 0,t({name:"error",message:"couldn't find a suitable ad to play"})},1e3*(i.getAdTimeout||n.store.get("get_ad_timeout_seconds"))),n.getAdFromQueue(i)}));return e.cancel=function(e){t.cancelGetAd(i,e),t.debugTracker.info("getAd","getAd cancelled!",{color:"#5EB9FF"})},e}},{key:"cancelGetAd",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=(this.store.decr("getAdData.count"),this.cleanGetAdTimeout(t),t.getAdContext=void 0,this.schedule.find(function(e){return e.vpaidWrapper.getAdId===t.id}));!i||i.vpaidWrapper.stopped||i.vpaidWrapper.hadImpression||i.vpaidWrapper.stop(e,v.a[e])}},{key:"cleanGetAdTimeout",value:function(e){e.getAdContext&&e.getAdContext.getAdTimeout&&(clearTimeout(e.getAdContext.getAdTimeout),e.getAdContext.getAdTimeout=void 0)}},{key:"_skipItemByPublisherPriority",value:function(e,t){return!(t&&e.advType===M.PUBLISHER_DEMAND||!t||e.advType===M.PUBLISHER_DEMAND)}},{key:"getAdFromQueue",value:function(e){if(!this.store.get("isIdleMode")&&!this.stopped&&(e=e||{})&&e.getAdContext&&(!e.requiredViewability||!document.hidden)){this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=tt.a.sort(this.schedule,this.store));for(var t=!1,i=this._getItemScores(),n=this._clientPreferPPD(e.preferPPD),r=this.schedule.length-1;0<=r;r--){var s=this.schedule[r];if(this._updateStatusesOnGetAd(s,e),this._setItemScores(s,r,i),this.isViewabilityMatch(s,e)&&this.checkAdProperties(s,e.adProperties,e.excAdProperties)&&!this._skipItemByPublisherPriority(s,n)&&this._canPullItem(s)){this._pullItemFromQueue(s,e),t=!0;break}}this.store.get("run_wf_when_empty")&&0==this.getVpaidReadyCount()&&(this.store.emit("playFromEmptyQueue",e.forceWf),e.forceWf=!1),t||(this._canPullAdxCard(e)?this._pullAdxCard(e):this.nextAdFromQueue=setTimeout(this.getAdFromQueue.bind(this,e),1e3))}}},{key:"_canPullItem",value:function(e){return"ready"===e.vpaidWrapper.status&&!e.vpaidWrapper.working&&!e.vpaidWrapper.isStarted&&(!this.store.get("first_look_ad_loaded")||e.flad)}},{key:"_pullAdxCard",value:function(e){this.nonVideoItem.adx=!0,this._pullItemFromQueue(this.nonVideoItem,e)}},{key:"_canPullAdxCard",value:function(e){return e.requiredViewability&&this.nonVideoItem&&this.nonVideoItem.vpaidWrapper&&this._canPullItem(this.nonVideoItem)}},{key:"_pullItemFromQueue",value:function(e,t){e.vpaidWrapper.working=!0,e.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,e.vpaidWrapper.bringToFront(),"mp4"===e.vpaidWrapper.type&&e.vpaidWrapper.vpaidHandler.logVideoBuffer("StartFromQ"),this._clientPreferPPD(t.preferPPD)&&e.advType===M.PUBLISHER_DEMAND&&this._sendPpdPixel(),e.vpaidWrapper.startAd(t),c(e.vpaidWrapper.vpaidLog,"startFromQ",{score:e.score,adx:e.adx}),t.getAdRetries++}},{key:"_updateStatusesOnGetAd",value:function(e,t){e.vpaidWrapper&&e.vpaidWrapper.vpaidLog&&!e.vpaidWrapper.gotAd&&e.vpaidWrapper.updateStatusesOnGetAd(t)}},{key:"isViewabilityMatch",value:function(e,t){return!(!e||!e.vpaidWrapper)&&(void 0===t.requiredViewability||(t.requiredViewability?e.requiredViewability:!e.requiredViewability))}},{key:"checkAdProperties",value:function(e,t,i){return this._isAdPropertiesMatch(t,e,!0)&&this._isAdPropertiesMatch(i,e,!1)}},{key:"_isAdPropertiesMatch",value:function(e,t,i){if(e)for(var n in e){n=this._isPropertyMatch(n,e[n],t);if(n&&!i||!n&&i)return!1}return!0}},{key:"_isPropertyMatch",value:function(e,t,i){for(var n,r=0;r<t.length;r++)if(n=i,e.split("/").reduce(function(e,t){return e[t]},n)==t[r])return!0;return!1}},{key:"isActivePausedAd",value:function(){for(var e=0;e<this.schedule.length;e++){var t=this.schedule[e];if(t&&t.vpaidWrapper&&t.vpaidWrapper.isPlaying&&!t.vpaidWrapper.isUnPaused)return!0}return!1}},{key:"isWorkingVpaidItem",value:function(t){var i=!1;return this.schedule.map(function(e){e&&e.vpaidWrapper&&e.vpaidWrapper==t&&e.vpaidWrapper.working&&(i=!0)}),i}},{key:"_saveCountersToStore",value:function(e,t,i){!t&&this.store&&i&&this.store.set(e,i)}},{key:"callAllWorkingVpaids",value:function(t){return this.schedule.map(function(e){if(e.vpaidWrapper&&!e.vpaidWrapper.stopped&&e.vpaidWrapper.workingVpaid)return t(e.vpaidWrapper)})}},{key:"mute",value:function(){this.callAllWorkingVpaids(function(e){return e.mute()})}},{key:"unmute",value:function(){this.callAllWorkingVpaids(function(e){return e.unmute()})}},{key:"play",value:function(){this.callAllWorkingVpaids(function(e){return e.resumeAd()})}},{key:"pause",value:function(){this.callAllWorkingVpaids(function(e){return e.pauseAd()})}},{key:"getCurrentWorkingAdVolume",value:function(){var t=null;return this.callAllWorkingVpaids(function(e){null===t&&(t=e.getCurrentVolume())}),t||0}},{key:"_emitQueueStatus",value:function(e){this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem,e)}},{key:"_getBackfillCount",value:function(){var t=this,i=0;return this.schedule.map(function(e){e&&e.priority===t.backfillPriority&&i++}),i}},{key:"_onNonVideoItemInWaterfall",value:function(e){this.stopped||this.nonVideoItem||(this.nonVideoItem=e.item,this._createVpaidWrapper(this.nonVideoItem,"adx-".concat(this.nonVideoItem.waterfallTagId)))}},{key:"getPlayerDAST",value:function(){for(var e=this.callAllWorkingVpaids(function(e){return e.playerDAST.get()}),t=0;t<e.length;t++)if(e[t])return e[t];return""}},{key:"_loadPrebidJs",value:function(e){e=this._onPrebidJsLoaded.bind(this,e);this.prebidHandler||(this.prebidHandler=new Hr(this.store)),this.prebidHandler.once("prebidLoaded",e),this.prebidHandler.loadPrebidJs()}},{key:"_onPrebidJsLoaded",value:function(e){e.prebidHandler=this.prebidHandler,this.schedule.push(e),this.initVpaidInQue()}},{key:"_onNavigatorConnectionChange",value:function(){var e=this.store.get("navigatorConnection")||{},t=this.store.get("rmvrvlwntwrk"),i=this.store.get("dwnlnktrshld"),e=e.downlink;i&&t&&void 0!==e&&(e<i?(this.shouldBlockRv1Ads=!0,this._removeRv1AdsFromQueue()):this.shouldBlockRv1Ads=!1)}},{key:"_removeRv1AdsFromQueue",value:function(){this.schedule=this.schedule.filter(function(e){return!e.requiredViewability})}},{key:"getClickedAd",value:function(){var t=void 0;return this.callAllWorkingVpaids(function(e){e.isClicked&&(t=e)}),t}},{key:"reportQueueStatus",value:function(){this.queueStatus&&this.queueStatus.emit(g.outer.EmitQueueStatus)}},{key:"_sendPpdPixel",value:function(){this.shouldFirePpdFlowPixel&&h(u(y.ppdAdIsPlaying,this.store))}}])&&Jr(e.prototype,t),n&&Jr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();function $r(e){return($r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zr(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==$r(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==$r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===$r(e)?e:String(e)}(n.key),n)}}var es=function(){function i(e,t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.id=Date.now()+"_"+oe(20),this.index=t,this.store=e,this.vpaidsCount=0,this.reportedVpaidsCount=0,this.success=0,this.fails=0,this.isSuccessed=!1}var e,t,n;return e=i,(t=[{key:"increaseVpaidsCount",value:function(){this.vpaidsCount++}},{key:"increaseSuccess",value:function(){this.success++,this._update()}},{key:"increaseFailure",value:function(){this.fails++,this._update()}},{key:"_update",value:function(){this.reportedVpaidsCount++,this.isSuccessed||(1===this.success?(this.store.incr("waterfallSuccessesInARow"),this.store.set("waterfallFailsInARow",0),this.isSuccessed=!0):this.reportedVpaidsCount===this.vpaidsCount&&(this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0)))}},{key:"getData",value:function(){return{id:this.id,index:this.index,allVpaidsReported:this.vpaidsCount===this.reportedVpaidsCount,wf_sr:this.store.get("waterfallSuccessesInARow"),wf_fr:this.store.get("waterfallFailsInARow")}}}])&&Zr(e.prototype,t),n&&Zr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();function ts(e){return(ts="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t,i){(t=ns(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}function is(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ns(n.key),n)}}function ns(e){e=function(e,t){if("object"!==ts(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==ts(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===ts(e)?e:String(e)}var rs=function(){function s(e){var t=this;if(!(this instanceof s))throw new TypeError("Cannot call a class as a function");this.store=e,this.waterfallIndex=-1;var e=this.store.get("waterfallFailsInARow"),i=(this.store.set("waterfallFailsInARow",e||0),this.store.set("waterfallSuccessesInARow",0),this.encryptWaterfallResponse=this.store.get("encwfrs"),this.wfv=this.store.get("wfv"),this.requiredViewabilityFactor=this.store.get("rvfctr"),this.defaultTagPrice=this.store.get("dftgprc"),this.fireWaterfallErrorPixels=$(parseInt(this.store.get("frwferrpxls"))),this.fireMaxEmptyWaterfallPixel=$(parseInt(this.store.get("frmxemptwfpxl"))),this.fireEmptyWaterfallPassbackPixel=parseInt(this.store.get("frwfpssbckrpxl")),this.shouldFirePrebidSessionPixel=this.store.get("firpbidpxl"),this.updateCMPData=this.store.get("sndgdprprmswf")&&this.store.get("updtcmpbfrwf"),this.lastRun=this.store.get("ltuntwflstrn"),this.store.get("drpbletps")||[]),n=this.store.get("adTypesToDrop")||[];this.adsToDrop={};for(var r=0;r<i.length;r++)this.adsToDrop[i[r]]=-1<n.indexOf(i[r]);this.creatives={},this.debugTracker=new o("WaterfallManager"),this.cachedTags=!1,this.cacheAge=0,this.staticWf=this.store.get("static_schedule"),this.shouldRun=function(){return!t._tbWfResponseExists()},this._runBindedWaterfallTicker=this._runWaterfallTicker.bind(this),this._roundTripAverageDuration=0,this._roundTripsCount=0,this._initDynamicWfsValues(),this.store.get("wf_manual")||this.startNextWfTimeout(),this.store.on("stop",this._stop.bind(this)),this.store.on("pausePlayer",this._stop.bind(this)),this.store.on("queueStatusChanged",this._onQueueStatusChanged.bind(this));this.store.get("wf_dynmc_ps")&&(this.store.on("contentPaused",this._stop.bind(this)),this.store.on("contentResumed",this.startNextWfTimeout.bind(this))),this.isFirstRun=!0,this.igonreWfWhenHidden=this.store.get("ignrwfhdn"),this.lineitemMaxFails=this.store.get("mxlifls"),this._registerQueueEvent(),this.maxAllowedEmptyWaterfalls=this.store.get("mxemptwf");e=this.store.get("emptyWaterfallsInARow");this.store.set("emptyWaterfallsInARow",e||0),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.store.on("startWf",function(){t.store.set("dlywf",!1),t.runWaterfall("startWf")}),this.store.on("stopWf",function(){t.store.set("dlywf",!0)}),this.wfParamsFromUnit={},this.isWaitUntilContainerInView=this.store.get("wtuntlcntrinvw"),this.containerElement=this.isWaitUntilContainerInView&&this.store.get("cntrelm")&&document.querySelector(this.store.get("cntrelm"))}var e,t,i;return e=s,(t=[{key:"handleLiteUnitWfResponse",value:function(){var e=this.store.get("ltuntWfRes");e&&this._handleWaterfallSuccess(e)}},{key:"_shouldDelayWaterfall",value:function(){return this.store.get("dlywf")}},{key:"_isContainerOutOfView",value:function(){var e;return!(!this.isWaitUntilContainerInView||!this.containerElement)&&(e=this.containerElement.getBoundingClientRect())&&0===e.height&&0===e.width}},{key:"startNextWfTimeout",value:function(){var e=this;this.wfInterval&&clearTimeout(this.wfInterval),this._calcDynamicWfsValues(),0<this._delayBetweenWfs?this.wfInterval=setTimeout(function(){e._runBindedWaterfallTicker()},this._delayBetweenWfs):this.store.emit("closePlayer")}},{key:"_initDynamicWfsValues",value:function(){this.maxTimeBetweenWaterfalls=this.store.get("mxtmbtwfs"),this.minTimeBetweenWaterfalls=this.store.get("mntmbtwfs"),this.defaultTimeBetweenWaterfalls=this.store.get("time_between_waterfall"),this.timeBetweenWfFunc=this.store.get("tmbtwfs"),"function"!=typeof this.timeBetweenWfFunc&&(this.timeBetweenWfFunc=void 0),this.minTimeBetweenWfFunc=this.store.get("mntmbtwfsf"),"function"!=typeof this.minTimeBetweenWfFunc&&(this.minTimeBetweenWfFunc=void 0),this.defaultMinTimeBetweenWf=this.store.get("mintimwf")||5e3,this.store.set("dynamicWf.lastDelayBetweenWfs",-1),this.store.set("dynamicWf.currentDelayBetweenWfs",-1),this._calcDynamicWfsValues()}},{key:"_calcDynamicWfsValues",value:function(){this._delayBetweenWfs=1e3*this._calcDelayBetweenWf(),0<this._delayBetweenWfs&&(this._minTimeBetweenWf=this._calcMinDelayBetweenWfs()),this._saveDynamicWfsValues()}},{key:"_calcDelayBetweenWf",value:function(){var t=-1;if(this.timeBetweenWfFunc)try{t=this.timeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(e){t=this.defaultTimeBetweenWaterfalls}return t>this.maxTimeBetweenWaterfalls?t=-1:t<this.minTimeBetweenWaterfalls&&(t=this.minTimeBetweenWaterfalls),t}},{key:"_calcMinDelayBetweenWfs",value:function(){var t=this.defaultMinTimeBetweenWf;if(this.minTimeBetweenWfFunc)try{t=this.minTimeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(e){t=this.defaultMinTimeBetweenWf}return t}},{key:"_saveDynamicWfsValues",value:function(){this.store.set("dynamicWf.lastDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),this.store.set("dynamicWf.currentDelayBetweenWfs",this._delayBetweenWfs)}},{key:"_registerQueueEvent",value:function(){var t=this;this.store.get("run_wf_when_empty")&&this.store.on("playFromEmptyQueue",function(e){t.runWaterfall("queueEmpty",e)})}},{key:"_isInIdleMode",value:function(){return this.store.get("isIdleMode")}},{key:"_runWaterfallTicker",value:function(){this.startNextWfTimeout(),this.runWaterfall("interval")}},{key:"init",value:function(e,t){this.creatives=e,this.store.set("creatives",e),this.adParams=t,this._loadWaterfallGenerator()}},{key:"_loadWaterfallGenerator",value:function(){var t=this;this.serviceLoader=new Fr(this.store),this.serviceLoader.loadFromTRC("wf-generator",this.store.get("wfgenv"),function(e){t.debugTracker.info("Wf generator v".concat(t.store.get("wfgenv")," loaded")),t.wfGenerator=new e(t.store,t.creatives),t.store.set("waterfallIndex",t.wfGenerator.getWfCounter()),t._shouldRunWaterfallOnInit()&&t.runWaterfall("run_wf_on_init")},function(){t.debugTracker.error("Load wf generator","Error while loading from service loader")})}},{key:"_shouldRunWaterfallOnInit",value:function(){return this.store.get("run_wf_on_init")}},{key:"_serveStaticWf",value:function(){this._getRollType();var e=0,e=("mid-roll"==this.currentRollType?e=1:"post-roll"==this.currentRollType&&(e=2),new Function("try { return "+this.staticWf[e].ad_parameters+";} catch(e){}")());this._handleWaterfallSuccess(m(e.waterfall))}},{key:"runWaterfall",value:function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(i&&h(u(y.forceWf,this.store)),this.wfGenerator||this.staticWf){if(!i){if(this.passedMaxEmptyWaterfalls())return;if(this.store.get("first_look"))return;if("function"==typeof this.shouldRun&&!this.shouldRun())return;if(this._shouldDelayWaterfall())return;if(this._isInIdleMode())return;if(this._isContainerOutOfView())return}var n=this,r=(new Date).getTime(),s=this.lastRun?r-this.lastRun:this._minTimeBetweenWf;if(!(s<this._minTimeBetweenWf)||i)if(this.lastRun=r,this.staticWf)setTimeout(function(){t._serveStaticWf()},20);else if(this._tbWfResponseSuccess())ee("player_waterfall","firstWfFromTb",{type:"debug",message:"firstWfFromTb",fullPageUrl:this.store.get("fullPageUrl"),player_id:this.store.get("player_id")},this.store);else{var s=!0===this.store.get("pstflrs"),i=(this.lastRun=r,this.waterfallIndex=this.wfGenerator.getWfCounter(),function(e,t){n._handleWaterfallError(e,t)}),r=function(e,t,i){n._handleWaterfallSuccess(e,i)},o=this.wfGenerator.generateUrl({roll:this._getRollType(),pubid:this.pubid,tagid:this.tagid,isFirstRun:this.isFirstRun,unitWfParams:this.wfParamsFromUnit});if(o){if(this.adParams&&this.adParams.waterfall)window.setTimeout(this._handleWaterfallSuccess.bind(this,m(this.adParams.waterfall)),0);else{if(!s)return this.wfGenerator.send({wfUrl:o,postData:"",onSuccess:r,onFail:i}),this.wfGenerator.increaseWfCounter(),this.store.set("waterfallIndex",this.wfGenerator.getWfCounter()),void(this.isFirstRun&&(this.isFirstRun=!1));s=m(this.wfGenerator.generatePOSTParams({queueStatus:this.queueStatus,droppedAdTypes:this._getAdTypesToDrop()}));this.wfGenerator.send({wfUrl:o,postData:s,onSuccess:r,onFail:i}),this.isFirstRun&&(this.isFirstRun=!1)}this._incrementWfCounter(),this.wfGenerator.changeWfBasePath()}}}}},{key:"_getAdTypesToDrop",value:function(){var e,t=[];for(e in this.adsToDrop)this.adsToDrop[e]&&t.push(e);return t}},{key:"passedMaxEmptyWaterfalls",value:function(){return!!this.maxAllowedEmptyWaterfalls&&this.store.get("emptyWaterfallsInARow")>this.maxAllowedEmptyWaterfalls}},{key:"_sendWaterfallResponsePixel",value:function(e){this.fireWaterfallErrorPixels&&h(u(e,this.store))}},{key:"_handleWaterfallSuccess",value:function(e,t){if(!this.igonreWfWhenHidden)if(this._addRoundTripDuration(),e){this.encryptWaterfallResponse&&(e=this._decodeText(e));var i=new Function("try { return "+e+";} catch(e){}")();if(i&&i.tags&&i.tags.length){this.store.set("emptyWaterfallsInARow",0),this.debugTracker.info("Waterfall number ".concat(this.waterfallIndex+1," received"),i.tags,{color:"#D15EFF"}),this.store.set("sessionData",i.sd),i&&i.pixel_piggies&&this._firePiggies(i.pixel_piggies);var n,r,s=[];for(n in i.tags){var o,a,d,l,u,c,h,p,f,v=i.tags[n];(v.url||v.vast)&&(a=v.lp&&0<v.lp.length&&v.lp[0]?v.lp[0]:"",h=void 0,p=we(c=v.dast&&v.cirid&&v.vidDast?(l=v.cirid,u=v.dast,v.vidDast):(l=(c=function(e){var e=0<arguments.length&&void 0!==e?e:"",t={};return e.substring(e.indexOf("?")+1).split("&").forEach(function(e){e=e.split("=");0<e.length&&(t[e[0]]=e[1]||"")}),t}(d=this._getPixel(v.pixel)||"")).cirid,u=c.dast,c["vid-dast"])),v.lineItemId||(h=we(u)),v.getValueByKey=function(e,t){return this.dsm&&this.dsm.hasOwnProperty(t)?this.dsm[t]:e.get(t)}.bind(v,this.store),f=v.advType===M.DIRECT||v.advType===M.PMP_DIRECT,v=Object.assign(v,(R(o={score:-1,waterfallTagId:n,created:(new Date).getTime(),dp:a?a.replace(/http:\/\/|.com|https:\/\/|.com/g,""):"na",dpFull:a||"na",conversionPixels:v.conversionPixels||[],ts:Date.now(),wfIndex:-1<this.waterfallIndex?this.waterfallIndex:this.wfGenerator.getWfCounter()-1,url:v.url?(a=fe(v.url,this.store),o=r=void 0,a&&X&&(o=r=void 0,0===a.indexOf("http:")&&(o="absolute",r=a.replace("http:","https:")),0!==a.indexOf("//")||X.get("secured_protocol")||(o="relative",r="https:"+a),r&&_e(o,{url:a}),r)||a):"",vast:v.vast?fe(v.vast,this.store):"",pixel:d,eventTrackers:v.etrk||{},jsTrackers:v.jstrk||[],brand:v.brand||"",dsm:v.dsm||{},rollType:this.currentRollType,pubId:this.pubid,tagId:this.tagid,isRon:this.isRon,cstmdl:v.cstmdl||-1,singleAd:1===v.sa,adjacencyAd:1===v.adjac},void 0!==this.defaultTagPrice&&"price",v.price||this.defaultTagPrice),R(o,l&&"cirid",l),R(o,"dast",u),R(o,"vidDast",c),R(o,"campaignId",p&&p.hasOwnProperty("cipid")?p.cipid:-1),R(o,"lineItem",(v.lineItemId||h&&h.cicmp||"").toString()),R(o,"isDirectDemand",f),R(o,"isDirectOrPMP",f||v.advType===M.PMP),R(o,"isRTB",v.advType===M.OPEN_EXCHANGE_RTB_DSP||v.advType===M.OPEN_EXCHANGE_RTB_SSP),o),this._overrideParamsByDemand(v),this._decodeItemParams(v)),0<this.requiredViewabilityFactor&&!v.requiredViewability&&(v.requiredViewability=this._drawRequiredViewabilityByFactor(v)),this._shouldDropAd(v)||(this._ignoreLineitem(v.lineItem)?this.store.get(v.lineItem+".failsRow")?this.store.incr(v.lineItem+".failsRow"):this.store.set(v.lineItem+".failsRow",1):s.push(v),this.store.get(v.lineItem)||this.store.set(v.lineItem,{failsRow:0,tries:0,conversions:0,fails:0}),v.lineItemStats=function(e){try{return JSON.parse(m(e))}catch(e){return{}}}(this.store.get(v.lineItem)),this._firePrebidPixel(v)))}0<s.length?(i.tags=s,i.data=new es(this.store,this.staticWf?1:this.wfGenerator.getWfCounter()),this.onWaterfallSuccess(i)):(this.debugTracker.error("runWaterfall","Failed to get any tags!"),this._handleWaterfallError("no-clean-tags",t))}else e=i&&i.tags?"Failed to decode empty server response":"No tags returned from waterfall response!",this.debugTracker.warn("runWaterfall",e),this._updateWaterfallFailure("no-tags",t,y.noTagsInWFResponse)}else this.debugTracker.info("runWaterfall","Empty Waterfall!"),this._updateWaterfallFailure("empty-response",t,y.emptyWFResponse)}},{key:"_updateWaterfallFailure",value:function(e,t,i){this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0),this._handleWaterfallError(e,t),this._sendWaterfallResponsePixel(i)}},{key:"_handlePassbackTrigger",value:function(){1===this.waterfallIndex&&(this.store.emit("emptyFirstWaterfall"),this._sendEmptyFirstWaterfallPassbackPixel())}},{key:"_sendEmptyFirstWaterfallPassbackPixel",value:function(){this.fireEmptyWaterfallPassbackPixel&&h(u(y.passbackOnEmptyFirstWF,this.store))}},{key:"_shouldDropAd",value:function(e){for(var t in this.adsToDrop)if(this._shouldDropAdByType(e,t))return!0;return!(!this.store.get("isAmp")||!e.getValueByKey("drponamp"))||!(!e.requiredViewability||!this.store.get("iosAutoPlayDisabled"))}},{key:"_shouldDropAdByType",value:function(e,t){return this.adsToDrop[t]&&e.hasOwnProperty(t)&&e[t]&&!(Wr(e)&&Ur(e))}},{key:"_drawRequiredViewabilityByFactor",value:function(e){var t=re(0,100)<=this.requiredViewabilityFactor&&e&&(e.advType===M.OPEN_EXCHANGE_RTB_DSP||e.advType===M.OPEN_EXCHANGE_RTB_SSP);return t&&(e.requiredViewabilityDrawn=!0),t}},{key:"_overrideParamsByDemand",value:function(e){return this.store.get("ovrtgbydc")?e.getValueByKey("ovrdtag"):{}}},{key:"_addRoundTripDuration",value:function(){var e=Date.now()-this.lastRun;this._roundTripAverageDuration=parseInt((this._roundTripAverageDuration*this._roundTripsCount+e)/(this._roundTripsCount+1)),this.store.set("waterfall_data.last_duration",e),this.store.set("waterfall_data.average_duration",this._roundTripAverageDuration),this._roundTripsCount++}},{key:"_ignoreLineitem",value:function(e){return 0<this.lineitemMaxFails&&((e=this.store.get(e))?e.failsRow:-1)>this.lineitemMaxFails}},{key:"_firePrebidPixel",value:function(e){this.shouldFirePrebidSessionPixel&&e.advType===M.PREBID&&(h(u(y.prebidSession,this.store)),this.shouldFirePrebidSessionPixel=!1)}},{key:"_decodeItemParams",value:function(e){return Object.assign({rpox:this._decodeValue(e.rpox),alfrox:this._decodeValue(e.alfrox),frox:this._decodeValue(e.frox),itemType:e.t},e.ex&&{crId:e.ex.ecrid,stId:e.ex.s,cmpgnId:e.ex.ecid},e.ex&&e.ex.b&&{brand:this.encryptWaterfallResponse?e.ex.b:this._decodeText(e.ex.b)})}},{key:"_decodeValue",value:function(e){return this.encryptWaterfallResponse?e:(2530^e)/1e3}},{key:"_decodeText",value:function(e){for(var t=function(e){try{for(var t=e.length,i=[],n=0;n<be.length;n++)i[be.charCodeAt(n)]=n;for(var r,s,o,a=be.charAt(64),d=(a&&-1!==(r=e.indexOf(a))&&(t=r),[]),l=0,u=0;u<t;u++)u%4&&(s=i[e.charCodeAt(u-1)]<<u%4*2,o=i[e.charCodeAt(u)]>>>6-u%4*2,d[l>>>2]|=(s|o)<<24-l%4*8,l++);for(var c=[],u=0;u<l;u++){var h=d[u>>>2]>>>24-u%4*8&255;c.push(String.fromCharCode(h))}return decodeURIComponent(escape(c.join("")))}catch(e){return""}}(e),i="",n=0;n<t.length;n++){var r=n%"PlAyER".length,s=t[n].charCodeAt(0).toString(10),r="PlAyER"[r].charCodeAt(0).toString(10);i+=String.fromCharCode(s^r)}return i}},{key:"_firePiggies",value:function(e){var t=this.store.get("fire_piggies");if(t&&!(5<=this.wfGenerator.getWfCounter()))for(var i=0;i<e.length;i++){var n=e[i];if(n.url){n=ae(n.url);try{(new Image).src=n}catch(e){this.debugTracker.error("_fireIframePig - Malformed url!",e)}}}}},{key:"_handleWaterfallError",value:function(e){this.store.incr("emptyWaterfallsInARow"),this.passedMaxEmptyWaterfalls()&&this._sendMaxEmptyWaterfallPixel(),this._addRoundTripDuration(),this.onWaterfallError(e),this._handlePassbackTrigger()}},{key:"_sendMaxEmptyWaterfallPixel",value:function(){this.fireMaxEmptyWaterfallPixel&&h(u(y.maxEmptyWfs,this.store))}},{key:"_getPixel",value:function(e){var t;if(e)return(t=(t=new RegExp(/src=[\"|\']([^"]+)[\"|\']/).exec(e))&&1<t.length&&t[1]?t[1]:e).substring(t.indexOf("//"))}},{key:"onWaterfallError",value:function(){}},{key:"onWaterfallSuccess",value:function(){}},{key:"SetWaterfallError",value:function(e){this.onWaterfallError=e}},{key:"SetWaterfallSuccess",value:function(e){this.onWaterfallSuccess=e}},{key:"SetShouldRun",value:function(e){this.shouldRun=e||function(){}}},{key:"GetCounter",value:function(){return this.wfGenerator.getWfCounter()}},{key:"_getRollType",value:function(){var e=this.store.get("contentSchedule")||{},t=null,i=Object.keys(e)||[];return this.staticWf||1===this.wfGenerator.getWfCounter()?t=e[i[0]]:0<i.length&&(t=e[i[1]]),this.currentRollType=t?t.roll_type:"",this.pubid=t?t.pubid:0,this.tagid=t?t.tagid:0,t}},{key:"_stop",value:function(){clearTimeout(this.wfInterval)}},{key:"start",value:function(){this.startNextWfTimeout()}},{key:"stop",value:function(){this._stop()}},{key:"_onQueueStatusChanged",value:function(e){function t(e){return(e=Object.assign({},e)).aid=e.cstmdl=e.dp=e.pid=void 0,""===e.br&&(e.br=void 0),e}this.queueStatus={size:e.size,prevItems:e.previousQueue.map(t),items:e.items.map(t)}}},{key:"dropAds",value:function(e){this.adsToDrop.hasOwnProperty(e)&&!this.adsToDrop[e]&&(this.adsToDrop[e]=!0)}},{key:"addWfParameter",value:function(e,t){void 0!==t&&(this.wfParamsFromUnit[e]=encodeURIComponent(t))}},{key:"updateWfParameter",value:function(e,t){this.addWfParameter(e,t)}},{key:"removeWfParameter",value:function(e){this.wfParamsFromUnit[e]&&(this.wfParamsFromUnit[e]=void 0,delete this.wfParamsFromUnit[e])}},{key:"_incrementWfCounter",value:function(){this.wfGenerator.increaseWfCounter(),this.store.set("waterfallIndex",this.wfGenerator.getWfCounter())}},{key:"_tbWfResponseExists",value:function(){return!!this.store.get("firstWfRes")}},{key:"_tbWfResponseSuccess",value:function(){if(this._tbWfResponseExists())try{return this._handleTbWfResponse(),!0}catch(e){this.debugTracker.error("tbWaterfallResponse",e)}return!1}},{key:"_handleTbWfResponse",value:function(){var e=this.wfGenerator.getWfCounter()-1;this.waterfallIndex=e,this._handleWaterfallSuccess(this.store.get("firstWfRes")),this.store.set("firstWfRes",void 0)}}])&&is(e.prototype,t),i&&is(e,i),Object.defineProperty(e,"prototype",{writable:!1}),s}(),ss={WF_PARAMS:{VIEW_MODE:"normal",REFERRER:"",VIDEO_URL:"",DOMAIN:"",PUBID:0,TAGID:0,VPD:0,VPTD:0,AUC_DAST:"",VIDLENGTH:0,KEY_WORDS:"",DESCRIPTION:"",SERVICE:"WhiteLabelBidRequestHandlerServlet",VERTICAL:"",SCHEMA:"vast2-vpaid",TYPE:"application/javascript",PV:"15.0.9",RS:1,ST:1,WP:1,PT:5,CIRF:"",SDID:1,STS:0,CB:"",VOLUME:0,TAG:"",PAGE_URL:(t=(t=(t=window).TRC&&window.TRC.isAMP?window.context:t).location?t.location.href:"",encodeURIComponent(t)),TIME_STAMP:"",TITLE:"",MFP:4,ISVIDEO:1,PLMD:2,MINDUR:1,MAXDUR:60,MINBR:1,MAXBR:512,AFBP:!1,ADTO:60,B2B:1,VMT:0,SORTORDERTYPE:0,DEFAULTTAGTIMEOUT:30,OID:"",NOAOP:"",TOTALTIMEOUT:60,CM_DOMAIN:"http://exchange.basebanner.com",OFFSET:0,MODE:"paralel",MUTED:!1,DEBUG:!1,PAUSE_ON_START:!1,PLAYER_WIDTH:0,PLAYER_HEIGHT:0},CONFIG:{waterfall:{},source:"",videoSlotCanAutoPlay:!0,videoSlotControls:!1,vpaid_protect_path:!1,running:!1,inited:!1,stopped:!1,started:!1,target:!1,video:!1,bitrate:512,creatives:{},protectedCreatives:["WP","PV","PT","SDID","CM_DOMAIN","SERVICE"]}};function os(e){return(os="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function as(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==os(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==os(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===os(e)?e:String(e)}(n.key),n)}}var ds=e(7),ls=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");ds.mixin(this),this.options=e.options,this.store=e.store,this.target=e.target,this.video=e.video,this.stopped=!1,this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit"),this.playWithoutContainer=this.store.get("noplrcntr"),this.aggregateOpps=this.store.get("cmbopps"),this.useOppsula=this.store.get("usopsla"),this.isMobile=this.store.get("isMobile"),this.viewmode="normal",this.adPlaying=!1,this.isAdPlayerVisible=!1,this.volumeBeforeMute=0,this.paused=!1,this._createDebugTracker(),this._normalizeAdParams(),this._createVideoPlayer(),this._init()}var e,i,n;return e=t,(i=[{key:"_createDebugTracker",value:function(){this.debugTracker=new o("ComponentsManager")}},{key:"_normalizeAdParams",value:function(){this.options.vpaidTag=Object.assign({},this.options.tagDefault,this.options.vpaidTag),this.options.vpaidTag.adto=this.options.vpaidTag.ad_timeout,this.options.vpaidTag["player-width"]=this.video.offsetWidth||this.video.width,this.options.vpaidTag["player-height"]=this.video.offsetHeight||this.video.height,this.options.vpaidTag["video-url"]=this.video.name,this.options.vpaidTag.vidlength=parseInt(this.video.duration),this.options.vpaidTag.sts=0,this.options.vpaidTag["vpaid-version"]=this.options.vpaidTag.vpaid_version,this.options.vpaidTag["auc-dast"]=this.options.vpaidTag.auc_dast,this.options.vpaidTag.plmd=this._getPlayMode()}},{key:"_getPlayMode",value:function(){return this.options.vpaidTag.use_as_is?2:0===this.options.vpaidTag.plmd?this.options.vpaidTag.muted?2:1:this.options.vpaidTag.plmd}},{key:"_createVideoPlayer",value:function(){this.playWithoutContainer||(this.videoWrapper=document.createElement("div"),this.videoWrapper.className="".concat(this.target.className," vpaid-handler"),this.videoWrapper.id="0_".concat(this.target.id),this.videoWrapper.style.cssText="".concat(this.target.style.cssText,";position:absolute;top:0;left:0;border:0; z-index:0"),this._registerVideoWrapperEvents(),this.target.appendChild(this.videoWrapper)),this.options.vpaidTag.mute=this.options.vpaidTag.mute||this.options.mute,this.options.height=ce(this.store.get("height")),this.options.width=ce(this.store.get("width"))}},{key:"_registerVideoWrapperEvents",value:function(){this.store.get("contentClickUrl")&&!this.playWithoutContainer&&this.videoWrapper.addEventListener("click",this._onVideoWrapperClickEvent.bind(this))}},{key:"_onVideoWrapperClickEvent",value:function(e){e.stopPropagation()}},{key:"_init",value:function(){this._initializeConfig(),this._registerEvents(),this._createOpportunityAggregator(),this._createWaterfallManager(),this._onWaterfallManagerCreated()}},{key:"_initializeConfig",value:function(){this.config=ss.CONFIG;var e=this._convertConfigToUpperCase();this.config.creatives=Object.assign({},ss.WF_PARAMS,e)}},{key:"_convertConfigToUpperCase",value:function(){var e,t={};for(e in this.options.vpaidTag)t[e.toUpperCase()]=this.options.vpaidTag[e];return t}},{key:"_registerEvents",value:function(){this.store.get("mltads")&&this.store.on("resizeVpaidWrapper",this._onResizeAd.bind(this))}},{key:"_onResizeAd",value:function(e){this.config&&(this.config.width=e.width,this.config.height=e.height)}},{key:"_createOpportunityAggregator",value:function(){this.aggregateOpps&&this.useOppsula&&this._loadOppsula(),this._createFallbackOpportunityAggregator()}},{key:"_loadOppsula",value:function(){this.serviceLoader=new Fr(this.store),this.serviceLoader.loadFromTRC("oppsula",this.store.get("opslavrsn"),this._onOppsulaLoaded.bind(this),this._onOppsulaError.bind(this))}},{key:"_onOppsulaLoaded",value:function(e){var t=this.store.get("non_bllb_opps_base_path")||this.store.get("opps_base_path"),t=(this.store.set("ms_data",{opps_base_path:t||this.config.creatives.CM_DOMAIN}),new e(this.store,"player"));this.store.set("oppsula",t),this.store.emit("oppsulaCreated",t)}},{key:"_onOppsulaError",value:function(){this.debugTracker.error("Load Oppsula","Error while loading from service loader")}},{key:"_createFallbackOpportunityAggregator",value:function(){var e;this.aggregateOpps&&(e=new et(this.store,this.config.creatives),this.store.set("oppsAggregator",e))}},{key:"_createWaterfallManager",value:function(){this.waterfallManager=new rs(this.store),this._setCreativeData(),this.waterfallManager.init(this.config.creatives,this.config.creativeData.AdParameters),this.waterfallManager.SetWaterfallSuccess(this._onWaterfallSuccess.bind(this)),this.waterfallManager.SetShouldRun(this._shouldRunWaterfall.bind(this))}},{key:"_setCreativeData",value:function(){for(var e in this.config.creativeData={},this.config.creatives)(void 0===this.config.creativeData[e]||-1<this.config.protectedCreatives.indexOf(e))&&(this.config.creativeData[e]=this.config.creatives[e]);try{this.config.creativeData.AdParameters&&"string"==typeof this.config.creativeData.AdParameters&&(this.config.creativeData.AdParameters=JSON.parse(this.config.creativeData.AdParameters))}catch(e){}}},{key:"_onWaterfallSuccess",value:function(e){this.manager&&this.manager.fillSchedule(e)}},{key:"_shouldRunWaterfall",value:function(){var e=this.store.get("max_ready_vpaid")||2;return!this.manager||this.manager.getVpaidReadyCount()<e}},{key:"_onWaterfallManagerCreated",value:function(){if(this.debugTracker.info("_onWaterfallManagerCreated","Vpaid-Player->Creating..."),this.slot=this._getVideoSlot(),this.slot){this._setSizesToConfig(),this._setAdParameters();try{this._initManagerAndLiteUnitResponse()}catch(e){this._initManagerAndLiteUnitResponseFallback()}this.manager&&this._registerManagerEvents()}}},{key:"_registerManagerEvents",value:function(){this.manager.on(f.a.AdVideoStart,this._onAdVideoStartEvent.bind(this)),this.manager.on(f.a.AdImpression,this._onAdImpressionEvent.bind(this)),this.manager.on(f.a.AdStopped,this._onAdStoppedEvent.bind(this)),this.manager.on(f.a.AdVideoComplete,this._onAdVideoCompleteEvent.bind(this)),this.manager.on(f.a.AdError,this._onAdErrorEvent.bind(this)),this.manager.on(f.a.AdStarted,this._onAdStartedEvent.bind(this)),this.manager.on(f.a.HijackAttempt,this._onHijackAttemptEvent.bind(this)),this.manager.on(f.a.AdPaused,this._onAdPausedEvent.bind(this)),this.manager.on(f.a.AdPlaying,this._onAdPlayingEvent.bind(this)),this.manager.on(f.a.AdSkipped,this._onAdStoppedEvent.bind(this)),this.manager.on("viewAdPlayer",this._displayAdPlayer.bind(this))}},{key:"_onAdVideoStartEvent",value:function(){this.stopped||(this.volume(this._getWorkingVolume()),this.emit(f.a.AdVideoStart))}},{key:"_getWorkingVolume",value:function(){var e=0;return this.options.vpaidTag.volume?"auto"==this.options.vpaidTag.volume&&(e=this.store.get("volume")):e=this.options.volume/100,l(e=0==e&&this.manager?this.getCurrentWorkingAdVolume():e)}},{key:"volume",value:function(e){if(null==(e=l(e)))return this._getAdVolume();this._setAdVolume(e),this._volume=e}},{key:"_setAdVolume",value:function(e){if(!this.isMobile){if(e=l(e),isNaN(parseFloat(e)))return!1;this.manager&&this.manager.setAdVolume(e)}}},{key:"_getAdVolume",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdVolume",[],0):0}},{key:"_onAdImpressionEvent",value:function(e){this._displayAdPlayer(e?e.dispatcher:void 0),this.stopped||(this.emit(f.a.AdImpression,e),this.volume(this._getWorkingVolume()),this.isMultiVpaidUnit)||this._resizeAd(this.options.width,this.options.height,this.viewmode)}},{key:"_displayAdPlayer",value:function(){this._hideAdPlayer(),this.adPlaying||(this.adPlaying=!0,this._hideContentVideo(),this._displayVideoWrapper(),this.manager.bringVpaidToFront()),this.isAdPlayerVisible||(this.isAdPlayerVisible=!0,this.store.emit("AdPlayerVisible"))}},{key:"_hideContentVideo",value:function(){this.video.pause(),this.video.style.display="none",this.video.style.zIndex=0}},{key:"_displayVideoWrapper",value:function(){this.playWithoutContainer||(this.videoWrapper.style.zIndex=100,a(this.videoWrapper,"_ad-cm-playing"),this.videoWrapper.style.display="block")}},{key:"_resizeAd",value:function(e,t,i){try{this.config.width=e,this.config.height=t,this.config.viewMode=i,this.manager&&this.manager.resizeAd(e,t,i)}catch(e){this.debugTracker.error(e)}}},{key:"_onAdStoppedEvent",value:function(e){this.emit(f.a.AdStopped,e),this.stop()}},{key:"_hideAdPlayer",value:function(){clearTimeout(this.hideAdPlayerDelayId)}},{key:"_onAdVideoCompleteEvent",value:function(){this._hideAdPlayer(),this.emit(f.a.AdVideoComplete)}},{key:"_onAdErrorEvent",value:function(){var e=arguments&&0<arguments.length?arguments[0]:"";this.debugTracker.error("Ad-".concat(this.options.uid),e||"Ad Threw Error"),this.emit(f.a.AdError),this.stop()}},{key:"_onAdStartedEvent",value:function(){this.volume(this._getWorkingVolume())}},{key:"_onHijackAttemptEvent",value:function(){(new Image).src="".concat(pe({dataCenter:"us",baseReportD:"basebanner.com"}),"?cijs=0&ttype=5&pix=31542217&dast=").concat(this.options.vpaidTag.auc_dast,"&").concat((new Date).getTime())}},{key:"_onAdPausedEvent",value:function(){this.store.emit("contentPaused"),this.paused=!0}},{key:"_onAdPlayingEvent",value:function(){this.paused&&this.store.emit("contentResumed"),this.paused=!1}},{key:"_getVideoSlot",value:function(){var e=this.playWithoutContainer?this.target:this.videoWrapper;if("string"==typeof e){if(document.getElementById(e))return document.getElementById(e)}else if("object"===os(e)&&e.style&&e.tagName)return e;return this.debugTracker.error("_getVideoSlot","Bad slot"),!1}},{key:"_setSizesToConfig",value:function(){this.config.width=parseInt(this.options.width),this.config.height=parseInt(this.options.height),this.config.creatives.PLAYER_WIDTH=this.config.width,this.config.creatives.PLAYER_HEIGHT=this.config.height}},{key:"_setAdParameters",value:function(){this.options.vpaidTag.skip_vast||!this.config.creativeData.adParameters?this.config.creativeData.adparameters=this.config.creativeData.AdParameters=this.config.creativeData.adParameters=this.options.vpaidTag.ad_parameters:this.config.creativeData.adparameters=this.config.creativeData.AdParameters=this.config.creativeData.adParameters}},{key:"_initManagerAndLiteUnitResponse",value:function(){this._createManager(),this.waterfallManager.handleLiteUnitWfResponse()}},{key:"_createManager",value:function(){this.manager=new Yr({store:this.store,config:this.config,options:this.options,target:this.slot})}},{key:"_initManagerAndLiteUnitResponseFallback",value:function(){try{this._parseAdParameters(),this._initManagerAndLiteUnitResponse()}catch(e){this._onManagerInitError()}}},{key:"_parseAdParameters",value:function(){var e=this.config.creativeData.AdParameters;this.config.creativeData.adParameters={},this.config.creativeData.adParameters=JSON.parse(e),this.config.creativeData.adparameters=this.config.creativeData.AdParameters=this.config.creativeData.adParameters}},{key:"_onManagerInitError",value:function(){this.emit("AdLoadError"),this.stop()}},{key:"dropAds",value:function(e){this.manager.cleanQueue(this.store.get("queue_size")||10,e),this.waterfallManager.dropAds(e)}},{key:"addWfParameter",value:function(e,t){this.waterfallManager.addWfParameter(e,t)}},{key:"updateWfParameter",value:function(e,t){this.waterfallManager.updateWfParameter(e,t)}},{key:"removeWfParameter",value:function(e){this.waterfallManager.removeWfParameter(e)}},{key:"playManager",value:function(){this.manager.play()}},{key:"pauseManager",value:function(){this.manager.pause()}},{key:"muteManager",value:function(){this.manager.mute()}},{key:"unmuteManager",value:function(){this.manager.unmute()}},{key:"getCurrentWorkingAdVolume",value:function(){return this.manager.getCurrentWorkingAdVolume()}},{key:"setPaused",value:function(e){this.paused=e}},{key:"runWaterfall",value:function(e){this.waterfallManager.runWaterfall(e)}},{key:"stop",value:function(){this.stopped||(this.stopped=!0,setTimeout(this._hideAdPlayer.bind(this),0),this.waterfallManager&&this.waterfallManager.stop(),this.manager&&this.manager.stop())}},{key:"resize",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"normal";if(t=parseInt(t),e=parseInt(e),this.options.height=t,this.options.width=e,this.viewmode=i,!isNaN(e)||!isNaN(t))return this._resizeVideoWrapper(e,t),this._tryResizeAdForSingleVpaidUnit(e,t,i)}},{key:"_resizeVideoWrapper",value:function(e,t){this.playWithoutContainer||(this.videoWrapper.style.width="".concat(e,"px"),this.videoWrapper.style.height="".concat(t,"px"))}},{key:"_tryResizeAdForSingleVpaidUnit",value:function(e,t,i){var n=this.isMultiVpaidUnit||!1;if(!this.isMultiVpaidUnit)try{this._resizeAd(e,t,i)}catch(e){this.debugTracker.error("resize",e),n=!1}return n}},{key:"getAd",value:function(e){if(this.manager)return this.manager.getAd(e)}},{key:"unmute",value:function(e){this.volumeBeforeMute||(this.options.volumeBeforeMute=this.volumeBeforeMute=e||50),this._volume=e,this.volume(this._volume)}},{key:"getVpaidLogs",value:function(){if(this.manager)return this.manager.getVpaidLogs()}},{key:"getClickedAd",value:function(){if(this.manager)return this.manager.getClickedAd()}},{key:"reportQueueStatus",value:function(){this.manager&&this.manager.reportQueueStatus()}}])&&as(e.prototype,i),n&&as(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function us(e){return(us="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cs(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==us(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==us(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===us(e)?e:String(e)}(n.key),n)}}e(15).polyfill();var hs="killAfterXWithNoConversion",ps="none",fs="_onVpaidClosed",vs="pre-roll",i=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this._overrideWindowMethods(),this._init(),this._createStore(e),this._fireDisplayImpression(),this.isMobile=this.store.get("isMobile"),this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit"),this.playWithoutContainer=this.store.get("noplrcntr"),this._initServiceLoader(),this._setTrackerDebugLevels(),this.isClickToPlay=this._isAutoplayDisabled(),this._handleDAST(),this._setBaseURL(),this._createModules(),this._setStaticSchedule(),this._overrideNonNativeFunctions(),this._shouldDisabledIosAutoPlay(),this.playContentBeforeAds=this.store.get("plcntbfrads"),this._onVpaidClosed=function(){},this._registerEvents(),this._killAfterXWithNoConversion(),this.onPlayerReadyActions=new Array,this.target=this._handleTarget(e.target_id),this.target&&this.target.appendChild?(this.store.set("can_opt_out",this._shouldOptOut()),this._onTargetCreated(),this._handleReportVastXmlList(),this._createComponentsManager()):this.debugTracker.error("Constructor","No player target! Can't build player in [".concat(this.target,"]... aborting!"))}var e,i,n;return e=t,(i=[{key:"_overrideWindowMethods",value:function(){void 0!==Object.assign&&ue(Object.assign)||this._overrideObjectAssign()}},{key:"_overrideObjectAssign",value:function(){Object.assign=function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}}},{key:"_init",value:function(){this.status="loading",this.videoLength=0,this.video=void 0,this.repeatCount=0,this.schedule={},this.playerIsClosed=!1}},{key:"_createStore",value:function(e){this.options=function(e){var t,i={domain:window.location.hostname,cirf:"",referrer:document.referrer?document.referrer.split("//")[1]:window.location.hostname,vertical:"default",auc_dast:"0",title:"",description:"",keywords:"",default_ad_parameters:"",files:[],image:!1,target_id:"",height:!1,width:!1,controls:!0,aspect_ratio:"16:9",repeat:!0,mute:!1,oid:0,default_ad_timeout:30,volume:0,video_class_name:"video-js vjs-default-skin",schedule:[],schedule_auto:1,min_vpaid_run_time:4,debug:[],report_vast_xml:!1,htmlVideoSupport:!!document.createElement("video").canPlayType,ga_factor:1,fire99:!0,ad_controls:!1,time_between_waterfall:10,tmbtwfs:function(e,t,i,n){return i.get("time_between_waterfall")},mntmbtwfsf:function(e,t,i,n){return i.get("mintimwf")},mintimwf:5e3,mntmbtwfs:5,mxtmbtwfs:900,queue_size:6,max_ready_vpaid:3,waterfall_watermark:0,base_url:"//vidstat.taboola.com",wf_path:"VideoBidRequestHandlerServlet",run_wf_when_empty:!0,kaxwnc:18e5,pstflrs:!0,pvpd:"javascript",pvidtp:"",sncad:!1,blkflshjs:!0,altmot:6e4,adimptmot:0,rv1adimptmot:0,prtctv2:"/vpaid/hjk.214.js",hjkclb:"HijackResponse",jsnoflshdtct:!1,qsrtscr:function(e,t){return 0===t.alfrox&&0<t.rpox?t.requiredViewability<<30|t.priority<<16|parseInt(1e3*t.rpox):t.requiredViewability<<30|t.priority<<16|parseInt(t.alfrox*t.rpox*1e3)},psthdrs:"text/plain",rstmrai:!0,vstprxy:!1,pxyurl:"http://vid.mikysrv.com/fetch?url=",global_ad_timeout:18e4,mprdct:void 0,uscnvsmpg:!0,mpgclrslv:["gcdn.2mdn.net"],dsu:"/vpaid/ds/117/dsm.js",run_wf_on_init:!0,wf_dynmc_ps:!0,sprssviderr:!1,get_ad_timeout_seconds:10,wf_manual:!1,disctxt:"By Taboola",httpsOverride:!0,usscrtgurl:!1,evtbsschdl:!0,timbtopps:2e3,cmbopps:!0,anltcsurlv4:"",anltcsurlv5:"",anltcsclb:"VpaidAnalytics",anltcsOptions:{withXHR:!0,withIframes:!0,withScripts:!0,maxNetworkCalls:0,timeout:3e3,deepIframes:!1},moat:!1,omidVerificationScriptVersion:"1.3.21-iab2898",omidWebUrl:"https://cdn.taboola.com/shared/omweb-v1.js",omidSessionUrl:"https://cdn.taboola.com/shared/omid-session-client-v1.js",omidExcludedVendors:["doubleverify"],moatPartnerCode:"taboolajsvideo2446883476",sndvltopp:!1,novdtrm:!1,dcdvdurl:!1,firstWaterfallNoaop:0,mxlifls:0,kbnul:"//vidanalytics.taboola.com",frcmtfrms:!0,frcvlm:!1,pxlnotsmtp:!1,cntonvfrc:!0,mxemptwf:0,mltads:!1,erlyai:!1,jsDsbleErlyai:!1,frcadvlmtrvl:1e3,dbncadvltm:50,stpfrcvlevnt:"AdVideoFirstQuartile",imapihok:!1,trmrdyvpaid:!0,dfltvlm:.4,usstrckisyn:!1,dlywf:!1,adto:3e5,vakll:3e5,ovrtgbydc:!1,strgprvdrttl:6048e5,frstlk:!1,pusvidprtctn:!1,encwfrs:!0,dsktmouttoadcmpltn:3e4,mbltmouttoadcmpltn:3e4,wfv:1,aderrbfradlddopactv:!0,isMultiVpaidUnit:!1,hdeadsplypusbtn:!0,isIdleMode:!1,mttst:"",mxntwrkclls:80,rplvpdactv:!1,rvfctr:0,dnapmxvl:0,usopsla:!0,mcrsrvcsnmspc:"trc",bllblevt:"1,25,21,22,23,24",ifrmswghts:{gen:15,ggl:6,pxls:30},dskVidMuted:!0,ovrdnonntvfnclst:{},fkadchcs:!1,istblvpd:!1,mtdhkactv:!1,addprld:!0,blckbrngtofrnt:!1,tglifrmcntndsplyactv:!0,cmpltonstpddmn:["innovid.com"],cmpltonstpdms:0,aduntldflbfruntld:!0,adwrprstoplrdst:!0,bckflldlyms:1e4,mxbckflldlyitms:0,bfprty:0,lgvpdtxtelmnts:!1,shwadmtebtn:!0,shwadsplypusbtn:"hide",disprgrbrclk:!1,wtfradpsdbfrrsmad:!1,mtfctr:0,noplrcntr:!1,vpdcntrcstmcss:"",flbktovdo:!0,cntdwnrgx:"",msnifrmsrchk:!0,prvaupl:!0,stpvpdonudfndsrc:!0,sprtnnvidvpd:!0,adxcrdgtadtmt:5e3,adtnladxsprtdszs:[],stpvpdonrltvsrc:!1,rvfrquesttsemttr:!0,cntgtad:!0,dftgprc:void 0,scrmf:!0,hjkbldoms:[],rtryonfl:!1,hjkbldomsencdd:[],cpcvcmpgntps:[14,17],cstmdltps:{tags:7,dCPM:9,externalCPCV:14,internalCPCV:17},dtctcmp:!1,dtctcmpfctr:0,comp:{},cmpdtctv:"1.0.0",vidautoplydtctv:"1.0.0",drpbletps:["singleAd","adjacencyAd"],vdelv:"3.0.1",rplcpxlmcrplchldr:!0,erronopp:!0,dtctprvtbrwsng:!1,plcntbfrads:!0,sndvptmrst:!1,frwferrpxls:0,frdmrvhpxls:0,frdqshpxls:0,hdtrgt:!1,spprtvrtclvd:!0,prvnterlyadimpopp:!1,untetrk:["viewability","viewable50precent1sec","fullyviewable1sec"],vdtck:0,htsptdflt:{pos:"bottom-left",txtclr:"white",mrgn:20,lbl:""},frwfpssbckrpxl:0,wtchvdointrvl:1e3,rprtvidsttsintrvl:1e3,q5byprgrss:!0,mnvlddrtn:.1,frgtadpxls:0,frmltplpxls:["AdPaused","AdClickThru","AdPlaying"],rprtbuffrng:0,wtchprgrssopp:0,mblmdiadrctdmnd:!1,firstWfRes:void 0,blckngtgcnvrsncnt:5,fmli:void 0,fmpw:"",dlyimpnonmoatrv:1,updtcmpbfrwf:!1,rgxdcdd:[],firedsplyimp:!1,addcdatavst:!0,aduntladtmt:1e4,mnbfrsz:.25,prftchmxlngth:15,imscrptsrc:"//imasdk.googleapis.com/js/sdkloader/ima3.js",sprtxtrnlplyrs:!0,xtrnlplyrstyps:[28],xtrnlplyrsmngrv:"3.0.1",xtrnlplyrsmngragg:!1,xtrnlplyrsmngrpshintrvl:5e3,vdgtrpxmthd:function(){return 0},adtrgtcss:!0,wtuntlcntrinvw:!1,cntrelm:"",firpbidpxl:!1,sndgdprprmswf:!1,prbdjsv:"1.1.0",prbdjse:!0,isprbdprc:!0,prbdcch:!1,prbdcchul:"https://prebid.adnxs.com/pbc/v1/cache",prfrmncmsrmnts:!0,slwcnctlngt:10,dlyastsld:!1,vwclcflbkenbld:!1,omidaccsmd:"full",frdwnlnkpxls:0,dwnlnktrshld:8,rmvrvlwntwrk:!1,vldtvwbfrcmp:!0,frtbcmpaftrmtvw:!1,omddsbldbrwsrs:[],frppdfpxl:0,atplyhk:!1,fileSizeConfiguration:{enabled:!1,frameTypes:[3],threshold:2},prfrmdfl:"video",dpndonuntfrlgtoelstc:!1,rtbmtfctr:10,enblopp:{},useVideoControls:!0,onPlayerReady:function(e){},onPlayerLoadError:function(e){},onPlayerError:function(e){},onPlayerPlay:function(e){},onPlayerStop:function(e){},onPlayerClose:function(e){},onPlayerPause:function(e){},onPlayerResume:function(e){},onPlayerRepeat:function(e){},onPlayerComplete:function(e){},onAdLoadError:function(e,t){},onAdError:function(e,t){},onAdStopped:function(e,t){},onAdImpression:function(e,t){},onAdVideoStart:function(e,t){},onAdVideoEnd:function(e,t){},onAdClick:function(e,t,i){}};for(t in i)null==e[t]&&(e[t]=i[t]);e.description||(e.description=e.title),e.keywords||(e.keywords=e.title),parseFloat(e.width)||parseFloat(e.height)||(e.width="377",e.height="314");var n=parseInt(100*Math.random())+1<=e.ron_percent;return e.tagDefault={ad_controls:e.ad_controls,url:"",pubid:"",tagid:"",vidlength:"",video_url:e.files[0],title:e.title,cirf:e.cirf,description:e.description,keywords:e.keywords,ad_parameters:e.default_ad_parameters,muted:e.mute?1:0,auc_dast:e.auc_dast,referrer:e.referrer,domain:e.domain,vertical:e.vertical,roll_type:"mid-roll",oid:e.oid,ad_timeout:e.default_ad_timeout,rs:"1",st:"1",sts:"1",type:"wf",noaop:"10",sortOrderType:0,mfp:4,afbp:e.use_flash_bypass,isRon:n,isvideo:0,mindur:1,maxdur:e.default_ad_timeout,minbr:1,maxbr:1e4,plmd:0,defaultTagTimeout:30,totaltimeout:60,use_as_is:!1,skip_vast:!1},e}(e);e=Object.assign(W(),e.dplayerSettings);this.options=Object.assign({},this.options,e),this.store=new Ce(this.options),this._appendParamsToStore()}},{key:"_appendParamsToStore",value:function(){this.store.set("player_id","".concat(Date.now(),"_").concat(oe(30))),this.store.set("fullPageUrl",window.location.href),this.store.set("forcePause",!1),this.store.set("forceMute",!1),this.store.set("conversionsCount",0),this.store.set("failsCount",this.store.get("failsCount")||0),this.store.set("getAdData.count",0),this.store.set("playerAspectRatio",this.options.aspect_ratio),this.store.set("noplrcntr",this.store.get("noplrcntr")&&this.store.get("isMultiVpaidUnit")),this.store.set("isAmp",window.TRC&&window.TRC.isAMP),this.store.set("queueLength",0),this.store.set("vpaidReadyCount",0),this.store.set("document.visible",!document.hidden),this.store.set("ads_playing",0),this.store.set("ads_started",0),this.store.set("total_impressions",0)}},{key:"_fireDisplayImpression",value:function(){this.store.get("firedsplyimp")&&h(u(y.playerDisplayImpression,this.store))}},{key:"_initServiceLoader",value:function(){this.serviceLoader=new Fr(this.store)}},{key:"_setTrackerDebugLevels",value:function(){o.prototype.debugLevels=this.store.get("debugLevels")||""}},{key:"_isAutoplayDisabled",value:function(){return!this.isMobile&&this.store.get("prvaupl")&&-1<this.store.get("wurfl.browser.name").indexOf(Ne)}},{key:"_handleDAST",value:function(){var e=we(this.options.auc_dast,this._onDASTDecodingError.bind(this));e&&this._onDASTDecoded(e)}},{key:"_onDASTDecodingError",value:function(e){this.store.set("dastDecoderError",m(e))}},{key:"_onDASTDecoded",value:function(e){e.sesid&&this.store.set("sessionId",e.sesid),this._logConnectionType(e.ct),this.store.set("dast",e),this._appendABTestFromDAST(e)}},{key:"_logConnectionType",value:function(e){var t="unknown";e&&(t=Xe.hasOwnProperty(e)?Xe[e]:e.toString()),this.store.set("connectionType",{type:t})}},{key:"_appendABTestFromDAST",value:function(e){e.hasOwnProperty("abt")&&(this.store.set("dast_AbTest",e.abt),this.store.set("abTest",this.store.get("abTest")?"".concat(this.store.get("abTest"),"|").concat(e.abt):e.abt))}},{key:"_setBaseURL",value:function(){var e=this.store.get("base_url");e&&0!==e.length||(this.store.set("original_base_url","empty"),this.store.set("href",window.location.href),this.store.set("base_url","//www.cmbestsrv.com"))}},{key:"_createModules",value:function(){this._createConnectionTypeDetector(),this._createPrivateBrowsingDetector(),this._createDependciesLoader(),this._createDebugTracker()}},{key:"_createConnectionTypeDetector",value:function(){this.connectionTypeDetector=new Fe(this.store)}},{key:"_createPrivateBrowsingDetector",value:function(){this.store.get("dtctprvtbrwsng")&&(this.privateBrowsingDetector=new Je(this.store))}},{key:"_createDependciesLoader",value:function(){this.dependenciesLoader=new Me(this.store)}},{key:"_createDebugTracker",value:function(){this.debugTracker=new o("OvaMediaPlayer"),this.debugTracker.info("unit-version: ".concat(this.store.get("unit_loader_version"),", player-version: ").concat(this.store.get("player_version")),this.store,{color:"#D15EFF"}),this.debugTracker.info("userAgent: ".concat(JSON.stringify(this.store.get("wurfl"))))}},{key:"_createComponentsManager",value:function(){this.options.vpaidTag=this._getVpaidTag(),this._initContentSchedule(),this.componentsManager=new ls({options:this.options,store:this.store,target:this.target,video:this.video}),this._registerToComponentsManagerEvents(),this.componentsManager.runWaterfall("vforceInit")}},{key:"_initContentSchedule",value:function(){var e={"00:00":this.options.vpaidTag,"00:01":this.options.vpaidTag};this.store.set("contentSchedule",e)}},{key:"_getVpaidTag",value:function(){var e=this.store.get("schedule"),t={};return e.forEach(function(e){e&&e.roll_type===vs&&(t=e)}),t}},{key:"_registerToComponentsManagerEvents",value:function(){this.componentsManager.on(f.a.AdVideoStart,this._onAdVideoStartEvent.bind(this)),this.componentsManager.on(f.a.AdImpression,this._onAdImpressionEvent.bind(this)),this.componentsManager.on(f.a.AdStopped,this._onAdStoppedEvent.bind(this)),this.componentsManager.on(f.a.AdVideoComplete,this._onAdVideoCompleteEvent.bind(this)),this.componentsManager.on(f.a.AdError,this._onAdErrorEvent.bind(this)),this.componentsManager.on("AdLoadError",this._onAdLoadErrorEvent.bind(this))}},{key:"_onAdVideoStartEvent",value:function(){this.options.onAdVideoStart(this,this.componentsManager)}},{key:"_onAdImpressionEvent",value:function(e){this.options.onAdImpression(this.componentsManager,e.dispatcher,e.tag)}},{key:"_onAdStoppedEvent",value:function(e){this.options.onAdStopped(e.dispatcher.index,this.componentsManager)}},{key:"_onAdVideoCompleteEvent",value:function(){this.options.onAdVideoEnd(this,this.componentsManager)}},{key:"_onAdErrorEvent",value:function(){this.options.onAdError(this,this.componentsManager)}},{key:"_onAdLoadErrorEvent",value:function(){this.options.onAdLoadError(this,this.componentsManager)}},{key:"_setStaticSchedule",value:function(){this._shouldUseStaticSchedule()&&this.store.set("static_schedule",this.options.schedule)}},{key:"_shouldUseStaticSchedule",value:function(){return this.options.schedule&&this.options.schedule.length&&this.options.schedule[0].ad_parameters&&2<this.options.schedule[0].ad_parameters.length}},{key:"_overrideNonNativeFunctions",value:function(){var e=this.store.get("ovrdnonntvfnclst");if(0!==Object.keys(e).length){var t,i=this._createHiddenIframe();for(t in e)ue(window[t])||(window[t]=e[t](i))}}},{key:"_createHiddenIframe",value:function(){var e=document.createElement("iframe");return e.style.width=0,e.style.height=0,e.style.visibility="hidden",e.style.display="none",document.body.appendChild(e),e}},{key:"_shouldDisabledIosAutoPlay",value:function(){var e=this;this.isMobile&&!this.store.get("iosAutoPlayDisabled")&&this.store.get("wurfl.os.name")===p&&document.addEventListener("ltIosAutoDisable",function(){e.store.set("iosAutoPlayDisabled",!0)})}},{key:"_registerEvents",value:function(){this._registerBeforeUnloadEvent(),this._registerAdImpressionEvent(),this._registerClosePlayerEvent(),this._registerAdClickThroughEvent()}},{key:"_registerBeforeUnloadEvent",value:function(){var e=this;window.addEventListener("beforeunload",function(){e.store.emit("beforeunload")})}},{key:"_registerAdImpressionEvent",value:function(){this.store.on("AdImpression",this._killAfterXWithNoConversion.bind(this))}},{key:"_killAfterXWithNoConversion",value:function(){var e=this,t=this.store.get("kaxwnc");t&&(this.kaxwnc&&clearTimeout(this.kaxwnc),this.kaxwnc=setTimeout(function(){e.closeCleanPlayer(hs)},t))}},{key:"closeCleanPlayer",value:function(e){var t=this;this.store.set("playerClosed",!0),setTimeout(function(){e=e||ps,t.store.emit("stop","close:".concat(e)),t.playerIsClosed||(clearInterval(t.contentInterval),t._destroyModules(),t.playerIsClosed=!0,t._onVpaidClosed=function(){},t._stop(),t._removeTargetElement(),t.onPlayerReadyActions=t.debugTracker=t.video=t.schedule=t.options=t.target=void 0)},0)}},{key:"_destroyModules",value:function(){this.componentsManager&&!this.componentsManager.stopped?this.componentsManager.stop():this.parent&&this._onVpaidClosed(),this.dependenciesLoader&&this.dependenciesLoader.destroy()}},{key:"_removeTargetElement",value:function(){if(!this.playWithoutContainer)for(;this.target.childNodes.length;)this.target.removeChild(this.target.childNodes[0])}},{key:"_onPlayContentAfterFirstAd",value:function(){this.playContentBeforeAds||(this.playContentBeforeAds=!0,this.video.autoplay=!1,this._appendCotnentMediaFiles(),this.target.appendChild(this.video))}},{key:"_registerClosePlayerEvent",value:function(){this.store.on("closePlayer",this._closePlayer.bind(this))}},{key:"_closePlayer",value:function(){this._onVpaidClosed=this.closeCleanPlayer.bind(this,fs),this.options.onPlayerClose(this)}},{key:"_registerAdClickThroughEvent",value:function(e){this.store.on(f.a.AdClickThru,this._onAdClickThroughEvent.bind(this))}},{key:"_onAdClickThroughEvent",value:function(e){this.options.onAdClick(this,this.componentsManager.getClickedAd(),e)}},{key:"_resizeVpaidHandler",value:function(e,t){this.componentsManager.resize(e,t)}},{key:"_resize",value:function(e,t){this.options.height=t+"",this.options.width=e+"",this._setVideoSize(r(this.options.width),r(this.options.height))}},{key:"_resizeBasedOnWidth",value:function(e){this.options.height=!1,this.options.width=e+"";var e=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0],t=r(this.options.width),e=r(Math.floor(parseFloat(t)*e)+"");this._setVideoSize(t,e)}},{key:"_resizeBasedOnHeight",value:function(e){this.options.width=!1,this.options.height=e+"";var e=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1],t=r(this.options.height),e=r(Math.floor(parseFloat(t)*e)+"");this._setVideoSize(e,t)}},{key:"_setVideoSize",value:function(e,t){this.isMultiVpaidUnit||(this.playWithoutContainer||this._resizeTarget(e,t),this._resizeVideo(e,t))}},{key:"_resizeTarget",value:function(e,t){this.target.style.width=e,this.target.style.height=t,this.target.setAttribute("width",parseInt(e)),this.target.setAttribute("height",parseInt(t))}},{key:"_resizeVideo",value:function(e,t){this.video.style.width=e,this.video.style.height=t,this.video.setAttribute("width",parseInt(e)),this.video.setAttribute("height",parseInt(t))}},{key:"_handleTarget",value:function(e){return this.playWithoutContainer?document.querySelector(e):"string"==typeof e?document.getElementById(e):e}},{key:"_shouldOptOut",value:function(){return this.store.get("can_opt_out")||null!==this.target.parentElement.querySelector("#_cm-opt-out-view")}},{key:"_onTargetCreated",value:function(){this.options.htmlVideoSupport?this._createMediaPlayer():(this.debugTracker.error("Constructor","Browser does not support <video> Tag!Nothing to do, aborting..."),this.options.onPlayerLoadError(this))}},{key:"_createMediaPlayer",value:function(){this._handlePlayerContainer(),this._createPlayerTag(),this._attachEventsToVideo(),this.isMultiVpaidUnit&&this._onMultiVpaidUnit(),this._setPlayerTagAttributes(),this._createHandleOnCanPlayTimeout(),this._appendCotnentMediaFiles(),this._shouldPlayContent()&&this.target.appendChild(this.playerTag),this.video=this.playerTag,this._setTargetId(),this._setInitialVolume(),this._setVideoVolume(this.options.mute?0:this.options.volume),this._setVideoSize(this.options.width+"px",this.options.height+"px")}},{key:"_setTargetId",value:function(){this.playWithoutContainer||(this.target.id="_cm-css-reset")}},{key:"_setInitialVolume",value:function(){this.isMobile&&!this.hasAutoPlay||(this.playerTag.volume=this.options.volume/100)}},{key:"_handlePlayerContainer",value:function(){this.playWithoutContainer||(a(this.target,"vpaid-player-container"),this.isMultiVpaidUnit&&a(this.target,"multi-vpaids"))}},{key:"_createPlayerTag",value:function(){this.playerTag=new jn(this.store,xn),this.playerTag.id=this._generateId(),this.playerTag.className=this.options.video_class_name,this._initPlayerTag()}},{key:"_initPlayerTag",value:function(){this.isMultiVpaidUnit&&a(this.playerTag,"multi-vpaids"),this.playerTag.style.cssText="position: relative; z-index:99; cursor:pointer; display:block",this.isClickToPlay||this.playerTag.setAttribute("autoplay",""),this.isMobile&&this.store.get("wurfl.os.name")===p&&this.playerTag.removeAttribute("autoplay","")}},{key:"_attachEventsToVideo",value:function(){this.playerTag.addEventListener("canplay",this._onVideoCanPlayEvent.bind(this),!0),this.playerTag.addEventListener("play",this._onVideoPlayEvent.bind(this),!0),this.playerTag.addEventListener("pause",this._onVideoPauseEvent.bind(this),!0),this.playerTag.addEventListener("ended",this._onVideoPlayerEnded.bind(this),!0),this.playerTag.addEventListener("error",this._onVideoError.bind(this),!0),this._createContentInterval()}},{key:"_onVideoCanPlayEvent",value:function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":this._onLoadingPlay();break;case"loading":this._onLoading()}}},{key:"_onLoadingPlay",value:function(){var e=this;this.status="playing",this._onLoading(),window.setTimeout(function(){e.options.onPlayerPlay()},0)}},{key:"_onPlayerReadyRun",value:function(){if(0!=this.onPlayerReadyActions.length){for(var e=0;e<this.onPlayerReadyActions.length;e++)this.onPlayerReadyActions[e].apply(this,[]);this.onPlayerReadyActions=new Array}}},{key:"_onLoading",value:function(){var e=this;window.setTimeout(function(){e._onPlayerReadyRun(),e.options.onPlayerReady(),e.componentsManager&&e.componentsManager.reportQueueStatus()},0)}},{key:"_onVideoPlayEvent",value:function(){if(!this.playerIsClosed)switch(this.status){case"loading":this.status="loading-play";break;case"ended":this._onPlayNextVideo();break;case"loading-play":case"stopped":case"paused":this._onCurrentVideoStopped()}}},{key:"_onPlayNextVideo",value:function(){var e=this;this.status="playing",window.setTimeout(function(){!e.playerIsClosed&&e.options._onPlayerRepeat&&e.options._onPlayerRepeat()},0),window.setTimeout(function(){!e.playerIsClosed&&e.options.onPlayerPlay&&e.options.onPlayerPlay()},0)}},{key:"_onCurrentVideoStopped",value:function(){var e=this;this.status="playing",window.setTimeout(function(){!e.playerIsClosed&&e.options.onPlayerResume&&e.options.onPlayerResume()},0)}},{key:"_onVideoPauseEvent",value:function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":case"playing":this._onPause()}}},{key:"_onPause",value:function(){this.status="paused",this.options.onPlayerPause(this)}},{key:"_onVideoPlayerEnded",value:function(){if(!this.playerIsClosed)switch(this.store.emit("contentChanged"),this.status){case"playing":this._onPlayingAfterEnded();case"paused":this._onEnded()}}},{key:"_onVideoError",value:function(e){this.isMobile||this._onError(e)}},{key:"_onError",value:function(e){this.status="stopping",this.video.pause(),this.status="loading",this.options.onPlayerError(this,e)}},{key:"_onPlayingAfterEnded",value:function(){var e=this;window.setTimeout(function(){e.options.onPlayerPause()},0)}},{key:"_onEnded",value:function(){var e=this;this.status="ended",this.options.repeat?window.setTimeout(function(){e.video.play()},0):(this.options.onPlayerComplete(this),this.options.onPlayerStop(this))}},{key:"_createContentInterval",value:function(){var e=this;this.contentInterval=setInterval(function(){e.store.set("contentTime",e.playerTag.currentTime),e.store.set("contentDuration",e.playerTag.duration)},5e3)}},{key:"_onMultiVpaidUnit",value:function(){var e,t;this.options.height||this.options.width?this.options.height&&this.options.width?(this.playerTag.style.height=r(this.options.height),this.playerTag.style.width=r(this.options.width)):(e=this.options.aspect_ratio.split(":"),this.options.width?(t=e[1]/e[0],this.playerTag.style.width=r(this.options.width),this.playerTag.style.height=r(Math.floor(parseFloat(this.playerTag.style.width)*t))):(t=e[0]/e[1],this.playerTag.style.height=r(this.options.height),this.playerTag.style.width=r(Math.floor(parseFloat(this.playerTag.style.height)*t)))):this.debugTracker.error("createMediaPlayer","No `height` or `width` specified!")}},{key:"_setPlayerTagAttributes",value:function(){this.playerTag.muted=!0,this.playerTag.setAttribute("width",parseFloat(this.playerTag.style.width)+""),this.playerTag.setAttribute("height",parseFloat(this.playerTag.style.height)+""),this.playerTag.setAttribute("playsinline",""),this.options.repeat&&(this.playerTag.playerRepeat=!0),this.options.image&&this.playerTag.setAttribute("poster",this.options.image)}},{key:"_createHandleOnCanPlayTimeout",value:function(){var e=this,t=200;this._checkOnIOS()&&(t=500),setTimeout(function(){try{e._onVideoCanPlayEvent()}catch(e){}},t)}},{key:"_appendCotnentMediaFiles",value:function(){try{if(this._shouldPlayContent())for(var e=0;e<this.options.files.length;e++)this._handleMediaFile(this.options.files[e])}catch(e){this.debugTracker.error("createMediaPlayer","Files array supplied is corrupted or malformed!")}}},{key:"_shouldPlayContent",value:function(){return this.store.get("cntonvfrc")}},{key:"_handleMediaFile",value:function(e){Ae(e.url)||this._appendSourceToPlayerTag(e)}},{key:"_appendSourceToPlayerTag",value:function(e){var t=document.createElement("source");t.setAttribute("type",e.type),t.src=e.url,this.playerTag.name||(this.playerTag.name=e.name||e.url),this.playerTag.appendChild(t)}},{key:"_generateId",value:function(){for(var e="vpaid-".concat(Math.floor(65536*(1+Math.random())));document.getElementById(e);)e="vpaid-".concat(Math.floor(1e5*(1+Math.random())));return e}},{key:"_getVideoSourceUrl",value:function(){var t;return this.video.src||(t="",this.options.files.map(function(e){t||Ae(e.url)||(t=e.url)}),t)}},{key:"_onNewVidCreated",value:function(e){this.video.parentElement.removeChild(this.video),this.video=e.data.videoElement}},{key:"_checkOnIOS",value:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}},{key:"_handleReportVastXmlList",value:function(){this.store.get("report_vast_xml")&&window.TRC&&(window.TRC.vastXmlList=[])}},{key:"set",value:function(e,t){this.store.set(e,t)}},{key:"get",value:function(e){return this.store.get(e)}},{key:"on",value:function(e,t){this.store.on(e,t)}},{key:"off",value:function(e,t){this.store.off(e,t)}},{key:"emit",value:function(e,t){e&&this.store.emit(e,t)}},{key:"getAd",value:function(e){if(this.componentsManager)return this.componentsManager.getAd(e)}},{key:"startIdleMode",value:function(){this.store.set("isIdleMode",!0)}},{key:"stopIdleMode",value:function(){this.store.set("isIdleMode",!1)}},{key:"startWf",value:function(){this.store.emit("startWf")}},{key:"stopWf",value:function(){this.store.emit("stopWf")}},{key:"dropAds",value:function(e){this.componentsManager.dropAds(e)}},{key:"setDebugData",value:function(e){this.store.set("debugStr",e)}},{key:"setDebugDataFunc",value:function(e){this.store.set("debugDataFunc",e)}},{key:"addWfParameter",value:function(e,t){this.componentsManager.addWfParameter(e,t)}},{key:"updateWfParameter",value:function(e,t){this.componentsManager.updateWfParameter(e,t)}},{key:"removeWfParameter",value:function(e){this.componentsManager.removeWfParameter(e)}},{key:"play",value:function(){this.store.get("forcePause")||this.componentsManager.playManager()}},{key:"pause",value:function(){this.componentsManager.pauseManager()}},{key:"_resume",value:function(){this.componentsManager.playManager()}},{key:"_stop",value:function(){try{this.status="stopped",this.options.onPlayerStop(this)}catch(e){}}},{key:"resize",value:function(e,t,i){this._resizeVpaidHandler(e,t);try{null!=e&&!isNaN(parseInt(e))||(e=!1),null!=t&&!isNaN(parseInt(t))||(t=!1),e||t||(this.debugTracker.error("resize","No `height` or `width` specified!"),e=this.store.get("width"),t=this.store.get("height")),t&&e?this._resize(e,t):(i&&1<i.split(":").length&&(this.options.aspect_ratio=i),e?this._resizeBasedOnWidth(e):this._resizeBasedOnHeight(t))}catch(e){this.debugTracker.error("resize","Resizing component failed!")}}},{key:"mute",value:function(){this._muteManager()}},{key:"_muteManager",value:function(){this.componentsManager.muteManager()}},{key:"_muteVpaidHandler",value:function(){this.componentsManager&&this.componentsManager.volume(0)}},{key:"unMute",value:function(){this.componentsManager.unmute()}},{key:"_unmuteVpaidHandler",value:function(){this.componentsManager&&this.componentsManager.volume(1<this.options.volume?this.options.volume/100:this.options.volume)}},{key:"volume",value:function(e){if("stopped"!=this.status&&!(this.store.get("forceMute")&&0<e))return this._setVpaidHandlerVolume(e),null==e?this._getCurrentVolume():this.options.videoControlsForceMute&&0<e?void 0:(this._saveVolumeBeforeMute(e),e=l(this.options.volume=e),this._setVideoVolume(e),this.store.set("volume",e),e)}},{key:"_setVpaidHandlerVolume",value:function(e){this.componentsManager&&this.componentsManager.volume(e)}},{key:"_getCurrentVolume",value:function(){return this.options.volume}},{key:"_saveVolumeBeforeMute",value:function(e){0===e&&0!=this.options.volume&&(this.options.volumeBeforeMute=this.options.volume)}},{key:"_setVideoVolume",value:function(e){0==e?(this.video.muted=this.options.mute=!0,this.video.volume=0):(this.video.muted=this.options.mute=!1,this.video.volume=e)}},{key:"getVpaidLogs",value:function(){if(this.componentsManager)return this.componentsManager.getVpaidLogs()}},{key:"setVideoFile",value:function(e,t,i){this._emptyVideoSources(),this._setVideoPoster(t),this._setVideoAutoplay(i);try{this.video.removeAttribute("src");for(var n=0;n<e.length;n++)this._appendSourceToPlayerTag(e[n]);this.video.load()}catch(e){this.debugTracker.error("setVideoFile","Error creating video sources!")}}},{key:"_emptyVideoSources",value:function(){for(;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0])}},{key:"_setVideoPoster",value:function(e){e?this.video.setAttribute("poster",e):this.video.removeAttribute("poster")}},{key:"_setVideoAutoplay",value:function(e){e?(this.status="loading",this.isClickToPlay||this.video.setAttribute("autoplay","true")):this.video.removeAttribute("autoplay")}},{key:"_pausePlayer",value:function(){this._stop(),this.store.emit("pausePlayer")}}])&&cs(e.prototype,i),n&&cs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();window.OvaMediaPlayer=i,F.default=i}])}catch(e){}